var requirejs,require,define,initializing=(!function(global,setTimeout){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function commentReplace(t,e){return e||""}function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t)for(var n=0;n<t.length&&(!t[n]||!e(t[n],n,t));n+=1);}function eachReverse(t,e){if(t)for(var n=t.length-1;-1<n&&(!t[n]||!e(t[n],n,t));--n);}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){for(var n in t)if(hasProp(t,n)&&e(t[n],n))break}function mixin(n,t,i,r){t&&eachProp(t,function(t,e){!i&&hasProp(n,e)||(!r||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?n[e]=t:(n[e]||(n[e]={}),mixin(n[e],t,i,r)))})}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){var e;return t&&(e=global,each(t.split("."),function(t){e=e[t]}),e)}function makeError(t,e,n,i){e=new Error(e+"\nhttps://requirejs.org/docs/errors.html#"+t);return e.requireType=t,e.requireModules=i,n&&(e.originalError=n),e}if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,n,i){var r,a=defContextName;return isArray(t)||"string"==typeof t||(r=t,isArray(e)?(t=e,e=n,n=i):t=[]),r&&r.context&&(a=r.context),i=(i=getOwn(contexts,a))||(contexts[a]=req.s.newContext(a)),r&&i.configure(r),i.require(t,e,n)},req.config=function(t){return req(t)},req.nextTick=void 0!==setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require=require||req,req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement)&&(head=s.head=baseElement.parentNode),req.onError=defaultOnError,req.createNode=function(t,e,n){var i=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=t.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,n,i){var t,r=e&&e.config||{};if(isBrowser)return(t=req.createNode(r,n,i)).setAttribute("data-requirecontext",e.contextName),t.setAttribute("data-requiremodule",n),!t.attachEvent||t.attachEvent.toString&&t.attachEvent.toString().indexOf("[native code")<0||isOpera?(t.addEventListener("load",e.onScriptLoad,!1),t.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,t.attachEvent("onreadystatechange",e.onScriptLoad)),t.src=i,r.onNodeCreated&&r.onNodeCreated(t,r,n,i),currentlyAddingScript=t,baseElement?head.insertBefore(t,baseElement):head.appendChild(t),currentlyAddingScript=null,t;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(n)}catch(t){e.onError(makeError("importscripts","importScripts failed for "+n+" at "+i,t,[n]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){if(head=head||t.parentNode,dataMain=t.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(mainScript=(src=mainScript.split("/")).pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(t,n,e){var i,r;"string"!=typeof t&&(e=n,n=t,t=null),isArray(n)||(e=n,n=null),!n&&isFunction(e)&&(n=[],e.length)&&(e.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(t,e){n.push(e)}),n=(1===e.length?["require"]:["require","exports","module"]).concat(n)),useInteractive&&(i=currentlyAddingScript||getInteractiveScript())&&(t=t||i.getAttribute("data-requiremodule"),r=contexts[i.getAttribute("data-requirecontext")]),r?(r.defQueue.push([t,n,e]),r.defQueueMap[t]=!0):globalDefQueue.push([t,n,e])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}function newContext(l){var e,t,d,c,n,v={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},h={},u={},i={},p=[],f={},r={},m={},g=1,y=1;function b(t,e,n){var i,r,a,s,o,l,c,h,u,d=e&&e.split("/"),p=v.map,f=p&&p["*"];if(t){e=(t=t.split("/")).length-1,v.nodeIdCompat&&jsSuffixRegExp.test(t[e])&&(t[e]=t[e].replace(jsSuffixRegExp,""));for(var m,g=t="."===t[0].charAt(0)&&d?d.slice(0,d.length-1).concat(t):t,y=0;y<g.length;y++)"."===(m=g[y])?(g.splice(y,1),--y):".."!==m||0===y||1===y&&".."===g[2]||".."===g[y-1]||0<y&&(g.splice(y-1,2),y-=2);t=t.join("/")}if(n&&p&&(d||f)){t:for(a=(r=t.split("/")).length;0<a;--a){if(o=r.slice(0,a).join("/"),d)for(s=d.length;0<s;--s)if(i=(i=getOwn(p,d.slice(0,s).join("/")))&&getOwn(i,o)){l=i,c=a;break t}!h&&f&&getOwn(f,o)&&(h=getOwn(f,o),u=a)}!l&&h&&(l=h,c=u),l&&(r.splice(0,c,l),t=r.join("/"))}return getOwn(v.pkgs,t)||t}function k(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===d.contextName)return t.parentNode.removeChild(t),!0})}function w(t){var e=getOwn(v.paths,t);return e&&isArray(e)&&1<e.length&&(e.shift(),d.require.undef(t),d.makeRequire(null,{skipMap:!0})([t]),1)}function x(t){var e,n=t?t.indexOf("!"):-1;return-1<n&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function S(t,e,n,i){var r,a,s,o=null,l=e?e.name:null,c=t,h=!0,u="";return t||(h=!1,t="_@r"+(g+=1)),o=(s=x(t))[0],t=s[1],o&&(o=b(o,l,i),a=getOwn(f,o)),t&&(o?u=n?t:a&&a.normalize?a.normalize(t,function(t){return b(t,l,i)}):-1===t.indexOf("!")?b(t,l,i):t:(o=(s=x(u=b(t,l,i)))[0],u=s[1],n=!0,r=d.nameToUrl(u))),{prefix:o,name:u,parentMap:e,unnormalized:!!(t=!o||a||n?"":"_unnormalized"+(y+=1)),url:r,originalName:c,isDefine:h,id:(o?o+"!"+u:u)+t}}function T(t){var e=t.id;return getOwn(h,e)||(h[e]=new d.Module(t))}function _(t,e,n){var i=t.id,r=getOwn(h,i);!hasProp(f,i)||r&&!r.defineEmitComplete?(r=T(t)).error&&"error"===e?n(r.error):r.on(e,n):"defined"===e&&n(f[i])}function I(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){t=getOwn(h,t);t&&(t.error=e,t.events.error)&&(i=!0,t.emit("error",e))}),i||req.onError(e))}function E(){globalDefQueue.length&&(each(globalDefQueue,function(t){var e=t[0];"string"==typeof e&&(d.defQueueMap[e]=!0),p.push(t)}),globalDefQueue=[])}function C(t){delete h[t],delete u[t]}function A(){var i,t=1e3*v.waitSeconds,r=t&&d.startTime+t<(new Date).getTime(),a=[],s=[],o=!1,l=!0;if(!e){if(e=!0,eachProp(u,function(t){var e=t.map,n=e.id;if(t.enabled&&(e.isDefine||s.push(t),!t.error))if(!t.inited&&r)w(n)?o=i=!0:(a.push(n),k(n));else if(!t.inited&&t.fetched&&e.isDefine&&(o=!0,!e.prefix))return l=!1}),r&&a.length)return(t=makeError("timeout","Load timeout for modules: "+a,null,a)).contextName=d.contextName,I(t);l&&each(s,function(t){!function i(r,a,s){var t=r.map.id;r.error?r.emit("error",r.error):(a[t]=!0,each(r.depMaps,function(t,e){var t=t.id,n=getOwn(h,t);!n||r.depMatched[e]||s[t]||(getOwn(a,t)?(r.defineDep(e,f[t]),r.check()):i(n,a,s))}),s[t]=!0)}(t,{},{})}),r&&!i||!o||(isBrowser||isWebWorker)&&(n=n||setTimeout(function(){n=0,A()},50)),e=!1}}function s(t){hasProp(f,t[0])||T(S(t[0],null,!0)).init(t[1],t[2])}function a(t,e,n,i){t.detachEvent&&!isOpera?i&&t.detachEvent(i,e):t.removeEventListener(n,e,!1)}function o(t){t=t.currentTarget||t.srcElement;return a(t,d.onScriptLoad,"load","onreadystatechange"),a(t,d.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function M(){var t;for(E();p.length;){if(null===(t=p.shift())[0])return I(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));s(t)}d.defQueueMap={}}return c={require:function(t){return t.require||(t.require=d.makeRequire(t.map))},exports:function(t){if(t.usingExports=!0,t.map.isDefine)return t.exports?f[t.map.id]=t.exports:t.exports=f[t.map.id]={}},module:function(t){return t.module||(t.module={id:t.map.id,uri:t.map.url,config:function(){return getOwn(v.config,t.map.id)||{}},exports:t.exports||(t.exports={})})}},(t=function(t){this.events=getOwn(i,t.id)||{},this.map=t,this.shim=getOwn(v.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(t,e,n,i){i=i||{},this.inited||(this.factory=e,n?this.on("error",n):this.events.error&&(n=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,--this.depCount,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,d.startTime=(new Date).getTime();var t=this.map;if(!this.shim)return t.prefix?this.callPlugin():this.load();d.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()}))}},load:function(){var t=this.map.url;r[t]||(r[t]=!0,d.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var e,n,t=this.map.id,i=this.depExports,r=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=d.execCb(t,a,i,r)}catch(t){e=t}else r=d.execCb(t,a,i,r);if(this.map.isDefine&&void 0===r&&((i=this.module)?r=i.exports:this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",I(this.error=e)}else r=a;this.exports=r,this.map.isDefine&&!this.ignore&&(f[t]=r,req.onResourceLoad)&&(n=[],each(this.depMaps,function(t){n.push(t.normalizedMap||t)}),req.onResourceLoad(d,this.map,n)),C(t),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(d.defQueueMap,t)||this.fetch()}},callPlugin:function(){var o=this.map,l=o.id,t=S(o.prefix);this.depMaps.push(t),_(t,"defined",bind(this,function(t){var a,e,n=getOwn(m,this.map.id),i=this.map.name,r=this.map.parentMap?this.map.parentMap.name:null,s=d.makeRequire(o.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(t.normalize&&(i=t.normalize(i,function(t){return b(t,r,!0)})||""),_(e=S(o.prefix+"!"+i,this.map.parentMap,!0),"defined",bind(this,function(t){this.map.normalizedMap=e,this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),(i=getOwn(h,e.id))&&(this.depMaps.push(e),this.events.error&&i.on("error",bind(this,function(t){this.emit("error",t)})),i.enable())):n?(this.map.url=d.nameToUrl(n),this.load()):((a=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})})).error=bind(this,function(t){this.inited=!0,(this.error=t).requireModules=[l],eachProp(h,function(t){0===t.map.id.indexOf(l+"_unnormalized")&&C(t.map.id)}),I(t)}),a.fromText=bind(this,function(t,e){var n=o.name,i=S(n),r=useInteractive;e&&(t=e),r&&(useInteractive=!1),T(i),hasProp(v.config,l)&&(v.config[n]=v.config[l]);try{req.exec(t)}catch(t){return I(makeError("fromtexteval","fromText eval for "+l+" failed: "+t,t,[l]))}r&&(useInteractive=!0),this.depMaps.push(i),d.completeLoad(n),s([n],a)}),t.load(o.name,s,a,v))})),d.enable(t,this),this.pluginMaps[t.id]=t},enable:function(){(u[this.map.id]=this).enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var n,i;if("string"==typeof t){if(t=S(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,i=getOwn(c,t.id))return void(this.depExports[e]=i(this));this.depCount+=1,_(t,"defined",bind(this,function(t){this.undefed||(this.defineDep(e,t),this.check())})),this.errback?_(t,"error",bind(this,this.errback)):this.events.error&&_(t,"error",bind(this,function(t){this.emit("error",t)}))}i=t.id,n=h[i],hasProp(c,i)||!n||n.enabled||d.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(h,t.id);e&&!e.enabled&&d.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){(this.events[t]||(this.events[t]=[])).push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},(d={config:v,contextName:l,registry:h,defined:f,urlFetched:r,defQueue:p,defQueueMap:{},Module:t,makeModuleMap:S,nextTick:req.nextTick,onError:I,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/"),"string"==typeof t.urlArgs&&(n=t.urlArgs,t.urlArgs=function(t,e){return(-1===e.indexOf("?")?"?":"&")+n});var n,i=v.shim,r={paths:!0,bundles:!0,config:!0,map:!0};eachProp(t,function(t,e){r[e]?(v[e]||(v[e]={}),mixin(v[e],t,!0,!0)):v[e]=t}),t.bundles&&eachProp(t.bundles,function(t,e){each(t,function(t){t!==e&&(m[t]=e)})}),t.shim&&(eachProp(t.shim,function(t,e){!(t=isArray(t)?{deps:t}:t).exports&&!t.init||t.exportsFn||(t.exportsFn=d.makeShimExports(t)),i[e]=t}),v.shim=i),t.packages&&each(t.packages,function(t){var e=(t="string"==typeof t?{name:t}:t).name;t.location&&(v.paths[e]=t.location),v.pkgs[e]=t.name+"/"+(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(h,function(t,e){t.inited||t.map.unnormalized||(t.map=S(e,null,!0))}),(t.deps||t.callback)&&d.require(t.deps||[],t.callback)},makeShimExports:function(e){return function(){var t;return(t=e.init?e.init.apply(global,arguments):t)||e.exports&&getGlobal(e.exports)}},makeRequire:function(a,s){function o(t,e,n){var i,r;return s.enableBuildCallback&&e&&isFunction(e)&&(e.__requireJsBuild=!0),"string"==typeof t?isFunction(e)?I(makeError("requireargs","Invalid require call"),n):a&&hasProp(c,t)?c[t](h[a.id]):req.get?req.get(d,t,a,o):(i=S(t,a,!1,!0).id,hasProp(f,i)?f[i]:I(makeError("notloaded",'Module name "'+i+'" has not been loaded yet for context: '+l+(a?"":". Use require([])")))):(M(),d.nextTick(function(){M(),(r=T(S(null,a))).skipMap=s.skipMap,r.init(t,e,n,{enabled:!0}),A()}),o)}return s=s||{},mixin(o,{isBrowser:isBrowser,toUrl:function(t){var e,n=t.lastIndexOf("."),i=t.split("/")[0];return-1!==n&&(!("."===i||".."===i)||1<n)&&(e=t.substring(n,t.length),t=t.substring(0,n)),d.nameToUrl(b(t,a&&a.id,!0),e,!0)},defined:function(t){return hasProp(f,S(t,a,!1,!0).id)},specified:function(t){return t=S(t,a,!1,!0).id,hasProp(f,t)||hasProp(h,t)}}),a||(o.undef=function(n){E();var t=S(n,a,!0),e=getOwn(h,n);e.undefed=!0,k(n),delete f[n],delete r[t.url],delete i[n],eachReverse(p,function(t,e){t[0]===n&&p.splice(e,1)}),delete d.defQueueMap[n],e&&(e.events.defined&&(i[n]=e.events),C(n))}),o},enable:function(t){getOwn(h,t.id)&&T(t).enable()},completeLoad:function(t){var e,n,i,r=getOwn(v.shim,t)||{},a=r.exports;for(E();p.length;){if(null===(n=p.shift())[0]){if(n[0]=t,e)break;e=!0}else n[0]===t&&(e=!0);s(n)}if(d.defQueueMap={},i=getOwn(h,t),!e&&!hasProp(f,t)&&i&&!i.inited){if(!(!v.enforceDefine||a&&getGlobal(a)))return w(t)?void 0:I(makeError("nodefine","No define call for "+t,null,[t]));s([t,r.deps||[],r.exportsFn])}A()},nameToUrl:function(t,e,n){var i,r,a,s,o,l=getOwn(v.pkgs,t);if(l=getOwn(m,t=l?l:t))return d.nameToUrl(l,e,n);if(req.jsExtRegExp.test(t))s=t+(e||"");else{for(i=v.paths,a=(r=t.split("/")).length;0<a;--a)if(o=getOwn(i,r.slice(0,a).join("/"))){isArray(o)&&(o=o[0]),r.splice(0,a,o);break}s=r.join("/"),s=("/"===(s+=e||(/^data\:|^blob\:|\?/.test(s)||n?"":".js")).charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":v.baseUrl)+s}return v.urlArgs&&!/^blob\:/.test(s)?s+v.urlArgs(t,s):s},load:function(t,e){req.load(d,t,e)},execCb:function(t,e,n,i){return e.apply(i,n)},onScriptLoad:function(t){"load"!==t.type&&!readyRegExp.test((t.currentTarget||t.srcElement).readyState)||(interactiveScript=null,t=o(t),d.completeLoad(t.id))},onScriptError:function(t){var n,i=o(t);if(!w(i.id))return n=[],eachProp(h,function(t,e){0!==e.indexOf("_@r")&&each(t.depMaps,function(t){if(t.id===i.id)return n.push(e),!0})}),I(makeError("scripterror",'Script error for "'+i.id+(n.length?'", needed by: '+n.join(", "):'"'),t,[i.id]))}}).require=d.makeRequire(),d}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),function(t){if("interactive"===t.readyState)return interactiveScript=t}),interactiveScript}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("requireLib",function(){}),!1),fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;function printStackTrace(t){var e=t&&t.e?t.e:null,t=!t||!!t.guess,n=new printStackTrace.implementation,e=n.run(e);return t?n.guessFunctions(e):e}Class=function(){},Class.extend=function(t){var e,r=this.prototype,n=(initializing=!0,new this);for(e in initializing=!1,t)n[e]="function"==typeof t[e]&&"function"==typeof r[e]&&fnTest.test(t[e])?function(n,i){return function(){var t=this._super,e=(this._super=r[n],i.apply(this,arguments));return this._super=t,e}}(e,t[e]):t[e];return(Class=function(){!initializing&&this.init&&this.init.apply(this,arguments)}).prototype=n,(Class.constructor=Class).extend=arguments.callee,Class},"undefined"!=typeof exports&&(exports.Class=Class),define("lib/class",function(){}),!function(){function n(n,i,r){var a;return function(){var t=this,e=arguments;r&&clearTimeout(a),!r&&a||(a=setTimeout(function(){a=null,n.apply(t,e)},i))}}function i(t,e){return e?x(t).chain():t}var t=this,e=t._,s={},r=Array.prototype,a=Object.prototype,o=r.slice,l=r.unshift,c=a.toString,h=a.hasOwnProperty,u=r.forEach,d=r.map,p=r.reduce,f=r.reduceRight,m=r.filter,g=r.every,y=r.some,v=r.indexOf,b=r.lastIndexOf,a=Array.isArray,k=Object.keys,w=Function.prototype.bind,x=function(t){return new I(t)},S=("undefined"!=typeof module&&module.exports?(module.exports=x)._=x:t._=x,x.VERSION="1.1.7",x.each=x.forEach=function(t,e,n){if(null!=t)if(u&&t.forEach===u)t.forEach(e,n);else if(t.length===+t.length)for(var i=0,r=t.length;i<r&&!(i in t&&e.call(n,t[i],i,t)===s);i++);else for(i in t)if(h.call(t,i)&&e.call(n,t[i],i,t)===s)break}),T=(x.map=function(t,i,r){var a=[];if(null!=t){if(d&&t.map===d)return t.map(i,r);S(t,function(t,e,n){a[a.length]=i.call(r,t,e,n)})}return a},x.reduce=x.foldl=x.inject=function(t,i,r,a){var s=void 0!==r;if(null==t&&(t=[]),p&&t.reduce===p)return a&&(i=x.bind(i,a)),s?t.reduce(i,r):t.reduce(i);if(S(t,function(t,e,n){s?r=i.call(a,r,t,e,n):(r=t,s=!0)}),s)return r;throw new TypeError("Reduce of empty array with no initial value")},x.reduceRight=x.foldr=function(t,e,n,i){return null==t&&(t=[]),f&&t.reduceRight===f?(i&&(e=x.bind(e,i)),void 0!==n?t.reduceRight(e,n):t.reduceRight(e)):(t=(x.isArray(t)?t.slice():x.toArray(t)).reverse(),x.reduce(t,e,n,i))},x.find=x.detect=function(t,i,r){var a;return T(t,function(t,e,n){if(i.call(r,t,e,n))return a=t,!0}),a},x.filter=x.select=function(t,i,r){var a=[];if(null!=t){if(m&&t.filter===m)return t.filter(i,r);S(t,function(t,e,n){i.call(r,t,e,n)&&(a[a.length]=t)})}return a},x.reject=function(t,i,r){var a=[];return null!=t&&S(t,function(t,e,n){i.call(r,t,e,n)||(a[a.length]=t)}),a},x.every=x.all=function(t,i,r){var a=!0;if(null!=t){if(g&&t.every===g)return t.every(i,r);S(t,function(t,e,n){if(!(a=a&&i.call(r,t,e,n)))return s})}return a},x.some=x.any=function(t,i,r){i=i||x.identity;var a=!1;return null==t?a:y&&t.some===y?t.some(i,r):(S(t,function(t,e,n){if(a|=i.call(r,t,e,n))return s}),!!a)}),_=(x.include=x.contains=function(t,e){var n=!1;if(null!=t){if(v&&t.indexOf===v)return-1!=t.indexOf(e);T(t,function(t){if(n=t===e)return!0})}return n},x.invoke=function(t,e){var n=o.call(arguments,2);return x.map(t,function(t){return(e.call?e||t:t[e]).apply(t,n)})},x.pluck=function(t,e){return x.map(t,function(t){return t[e]})},x.max=function(t,i,r){var a;return!i&&x.isArray(t)?Math.max.apply(Math,t):(a={computed:-1/0},S(t,function(t,e,n){(e=i?i.call(r,t,e,n):t)>=a.computed&&(a={value:t,computed:e})}),a.value)},x.min=function(t,i,r){var a;return!i&&x.isArray(t)?Math.min.apply(Math,t):(a={computed:1/0},S(t,function(t,e,n){(e=i?i.call(r,t,e,n):t)<a.computed&&(a={value:t,computed:e})}),a.value)},x.sortBy=function(t,i,r){return x.pluck(x.map(t,function(t,e,n){return{value:t,criteria:i.call(r,t,e,n)}}).sort(function(t,e){t=t.criteria,e=e.criteria;return t<e?-1:e<t?1:0}),"value")},x.groupBy=function(t,n){var i={};return S(t,function(t,e){e=n(t,e);(i[e]||(i[e]=[])).push(t)}),i},x.sortedIndex=function(t,e,n){n=n||x.identity;for(var i=0,r=t.length;i<r;){var a=i+r>>1;n(t[a])<n(e)?i=1+a:r=a}return i},x.toArray=function(t){return t?t.toArray?t.toArray():x.isArray(t)||x.isArguments(t)?o.call(t):x.values(t):[]},x.size=function(t){return x.toArray(t).length},x.first=x.head=function(t,e,n){return null==e||n?t[0]:o.call(t,0,e)},x.rest=x.tail=function(t,e,n){return o.call(t,null==e||n?1:e)},x.last=function(t){return t[t.length-1]},x.compact=function(t){return x.filter(t,function(t){return!!t})},x.flatten=function(t){return x.reduce(t,function(t,e){return x.isArray(e)?t.concat(x.flatten(e)):(t[t.length]=e,t)},[])},x.without=function(t){return x.difference(t,o.call(arguments,1))},x.uniq=x.unique=function(t,i){return x.reduce(t,function(t,e,n){return 0!=n&&(!0===i?x.last(t)==e:x.include(t,e))||(t[t.length]=e),t},[])},x.union=function(){return x.uniq(x.flatten(arguments))},x.intersection=x.intersect=function(t){var n=o.call(arguments,1);return x.filter(x.uniq(t),function(e){return x.every(n,function(t){return 0<=x.indexOf(t,e)})})},x.difference=function(t,e){return x.filter(t,function(t){return!x.include(e,t)})},x.zip=function(){for(var t=o.call(arguments),e=x.max(x.pluck(t,"length")),n=Array(e),i=0;i<e;i++)n[i]=x.pluck(t,""+i);return n},x.indexOf=function(t,e,n){if(null!=t){var i;if(n)return t[n=x.sortedIndex(t,e)]===e?n:-1;if(v&&t.indexOf===v)return t.indexOf(e);for(n=0,i=t.length;n<i;n++)if(t[n]===e)return n}return-1},x.lastIndexOf=function(t,e){if(null!=t){if(b&&t.lastIndexOf===b)return t.lastIndexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n}return-1},x.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,a=Array(i);r<i;)a[r++]=t,t+=n;return a},x.bind=function(t,e){var n;return t.bind===w&&w?w.apply(t,o.call(arguments,1)):(n=o.call(arguments,2),function(){return t.apply(e,n.concat(o.call(arguments)))})},x.bindAll=function(e){var t=o.call(arguments,1);return 0==t.length&&(t=x.functions(e)),S(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,n){var i={};return n=n||x.identity,function(){var t=n.apply(this,arguments);return h.call(i,t)?i[t]:i[t]=e.apply(this,arguments)}},x.delay=function(t,e){var n=o.call(arguments,2);return setTimeout(function(){return t.apply(t,n)},e)},x.defer=function(t){return x.delay.apply(x,[t,1].concat(o.call(arguments,1)))},x.throttle=function(t,e){return n(t,e,!1)},x.debounce=function(t,e){return n(t,e,!0)},x.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}},x.wrap=function(e,n){return function(){var t=[e].concat(o.call(arguments));return n.apply(this,t)}},x.compose=function(){var n=o.call(arguments);return function(){for(var t=o.call(arguments),e=n.length-1;0<=e;e--)t=[n[e].apply(this,t)];return t[0]}},x.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},x.keys=k||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e,n=[];for(e in t)h.call(t,e)&&(n[n.length]=e);return n},x.values=function(t){return x.map(t,x.identity)},x.functions=x.methods=function(t){var e,n=[];for(e in t)x.isFunction(t[e])&&n.push(e);return n.sort()},x.extend=function(n){return S(o.call(arguments,1),function(t){for(var e in t)void 0!==t[e]&&(n[e]=t[e])}),n},x.defaults=function(n){return S(o.call(arguments,1),function(t){for(var e in t)null==n[e]&&(n[e]=t[e])}),n},x.clone=function(t){return x.isArray(t)?t.slice():x.extend({},t)},x.tap=function(t,e){return e(t),t},x.isEqual=function(t,e){if(t!==e){if((i=typeof t)!=typeof e)return!1;if(t!=e){if(!t&&e||t&&!e)return!1;if(t._chain&&(t=t._wrapped),e._chain&&(e=e._wrapped),t.isEqual)return t.isEqual(e);if(e.isEqual)return e.isEqual(t);if(x.isDate(t)&&x.isDate(e))return t.getTime()===e.getTime();if(x.isNaN(t)&&x.isNaN(e))return!1;if(x.isRegExp(t)&&x.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline;if("object"!=i)return!1;if(t.length&&t.length!==e.length)return!1;var n,i=x.keys(t),r=x.keys(e);if(i.length!=r.length)return!1;for(n in t)if(!(n in e&&x.isEqual(t[n],e[n])))return!1}}return!0},x.isEmpty=function(t){if(x.isArray(t)||x.isString(t))return 0===t.length;for(var e in t)if(h.call(t,e))return!1;return!0},x.isElement=function(t){return!(!t||1!=t.nodeType)},x.isArray=a||function(t){return"[object Array]"===c.call(t)},x.isObject=function(t){return t===Object(t)},x.isArguments=function(t){return!(!t||!h.call(t,"callee"))},x.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},x.isString=function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)},x.isNumber=function(t){return!!(0===t||t&&t.toExponential&&t.toFixed)},x.isNaN=function(t){return t!=t},x.isBoolean=function(t){return!0===t||!1===t},x.isDate=function(t){return!(!t||!t.getTimezoneOffset||!t.setUTCFullYear)},x.isRegExp=function(t){return!(!t||!t.test||!t.exec||!t.ignoreCase&&!1!==t.ignoreCase)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.noConflict=function(){return t._=e,this},x.identity=function(t){return t},x.times=function(t,e,n){for(var i=0;i<t;i++)e.call(n,i)},x.mixin=function(e){S(x.functions(e),function(t){E(t,x[t]=e[t])})},0),I=(x.uniqueId=function(t){var e=_++;return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},x.template=function(t,e){var n=x.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.interpolate,function(t,e){return"',"+e.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";return n=new Function("obj",n),e?n(e):n},function(t){this._wrapped=t}),E=(x.prototype=I.prototype,function(t,e){I.prototype[t]=function(){var t=o.call(arguments);return l.call(t,this._wrapped),i(e.apply(x,t),this._chain)}});x.mixin(x),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];I.prototype[t]=function(){return e.apply(this._wrapped,arguments),i(this._wrapped,this._chain)}}),S(["concat","join","slice"],function(t){var e=r[t];I.prototype[t]=function(){return i(e.apply(this._wrapped,arguments),this._chain)}}),I.prototype.chain=function(){return this._chain=!0,this},I.prototype.value=function(){return this._wrapped}}(),define("lib/underscore.min",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t){var e=this._mode||this.mode();return"other"===e?this.other(arguments.callee):(t=t||function(){try{__undef__}catch(t){return t}}(),this[e](t))},mode:function(){try{__undef__}catch(t){if(t.arguments)return this._mode="chrome";if(window.opera&&t.stacktrace)return this._mode="opera10";if(t.stack)return this._mode="firefox";if(window.opera&&!("stacktrace"in t))return this._mode="opera"}return this._mode="other"},instrumentFunction:function(t,e,n){(t=t||window)["_old"+e]=t[e],t[e]=function(){return n.call(this,printStackTrace()),t["_old"+e].apply(this,arguments)},t[e]._instrumented=!0},deinstrumentFunction:function(t,e){t[e].constructor===Function&&t[e]._instrumented&&t["_old"+e].constructor===Function&&(t[e]=t["_old"+e])},chrome:function(t){return t.stack.replace(/^[^\n]*\n/,"").replace(/^[^\n]*\n/,"").replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(t){return t.stack.replace(/^[^\n]*\n/,"").replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(t){for(var e,n,i=t.stacktrace.split("\n"),r=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i,a=2,s=0,o=i.length;a<o-2;a++)r.test(i[a])&&(e=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,n=(n=RegExp.$3).replace(/<anonymous function\s?(\S+)?>/g,"{anonymous}"),i[s++]=n+"@"+e);return i.splice(s,i.length-s),i},opera:function(t){for(var e=t.message.split("\n"),n=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i,i=4,r=0,a=e.length;i<a;i+=2)n.test(e[i])&&(e[r++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:"{anonymous}()@"+RegExp.$2+":"+RegExp.$1)+" -- "+e[i+1].replace(/^\s+/,""));return e.splice(r,e.length-r),e},other:function(t){for(var e,n,i="{anonymous}",r=/function\s*([\w\-$]+)?\s*\(/i,a=[],s=0;t&&a.length<10;)e=r.test(t.toString())&&RegExp.$1||i,n=Array.prototype.slice.call(t.arguments),a[s++]=e+"("+this.stringifyArguments(n)+")",t=t.caller;return a},stringifyArguments:function(t){for(var e=0;e<t.length;++e){var n=t[e];void 0===n?t[e]="undefined":null===n?t[e]="null":n.constructor&&(n.constructor===Array?n.length<3?t[e]="["+this.stringifyArguments(n)+"]":t[e]="["+this.stringifyArguments(Array.prototype.slice.call(n,0,1))+"..."+this.stringifyArguments(Array.prototype.slice.call(n,-1))+"]":n.constructor===Object?t[e]="#object":n.constructor===Function?t[e]="#function":n.constructor===String&&(t[e]='"'+n+'"'))}return t.join(",")},sourceCache:{},ajax:function(t){var e=this.createXMLHTTPObject();if(e)return e.open("GET",t,!1),e.setRequestHeader("User-Agent","XMLHTTP/1.0"),e.send(""),e.responseText},createXMLHTTPObject:function(){for(var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<e.length;n++)try{return t=e[n](),this.createXMLHTTPObject=e[n],t}catch(t){}},isSameDomain:function(t){return-1!==t.indexOf(location.hostname)},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessFunctions:function(t){for(var e=0;e<t.length;++e){var n,i=t[e],r=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/.exec(i);r&&(n=r[1],r=r[4],n)&&this.isSameDomain(n)&&r&&(n=this.guessFunctionName(n,r),t[e]=i.replace("{anonymous}",n))}return t},guessFunctionName:function(e,t){try{return this.guessFunctionNameFromLines(t,this.getSource(e))}catch(t){return"getSource failed with url: "+e+", exception: "+t.toString()}},guessFunctionNameFromLines:function(t,e){for(var n=/function ([^(]*)\(([^)]*)\)/,i=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,r="",a=0;a<10;++a)if(void 0!==(r=e[t-a]+r)){var s=i.exec(r);if(s&&s[1])return s[1];if((s=n.exec(r))&&s[1])return s[1]}return"(?)"}},define("lib/stacktrace",function(){});var Utils={},isInt=function(t){return t%1==0},TRANSITIONEND="transitionend webkitTransitionEnd oTransitionEnd",getUrlVars=(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,16)},function(){var i={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,n){i[e]=n});return i}),distanceTo=function(t,e,n,i){t=Math.abs(t-n),n=Math.abs(e-i);return n<t?t:n},random=function(t){return Math.floor(Math.random()*t)},randomRange=function(t,e){return t+Math.random()*(e-t)},randomInt=function(t,e){return t+Math.floor(Math.random()*(e-t+1))},SendNative=(Utils.randomRangeInt=randomInt,function(t){"undefined"!=typeof Native&&(t=(t=JSON.stringify(t)).replace("null","0"),Native("dataCallback",t))}),fixed=function(t,e){t="00000000"+t;return t.substring(t.length-e)},_base64ToArrayBuffer=(String.prototype.format=String.prototype.f=function(){for(var t=this,e=arguments.length;e--;)t=t.replace(new RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t},function(t){for(var e=window.atob(t),n=e.length,i=new Uint8Array(n),r=0;r<n;++r)i[r]=e.charCodeAt(r);return i.buffer}),_arrayBufferToBase64=function(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,r=0;r<i;r++)e+=String.fromCharCode(n[r]);return window.btoa(e)},removeDoubleQuotes=function(t){return t.toString().replace(/^"(.+(?="$))"$/,"$1")},rgb2hex=function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},shuffle=function(t){},manhattenDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},realDistance=function(t,e){return Utils.realDistance([t.x,t.y],[e.x,e.y])},pointerEventToXY=(Utils.realDistance=function(t,e){return~~Math.pow(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2),.5)},function(t){var e,n={x:0,y:0};return t.originalEvent.hasOwnProperty("touches")?(e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],n.x=e.pageX,n.y=e.pageY):(n.x=t.pageX,n.y=t.pageY),n}),ceilGrid=function(t){return~~(t+.5)},clamp=(Number.prototype.ceilGrid||(Number.prototype.ceilGrid=function(){return~~(this+.5)}),function(t,e,n){return Math.min(Math.max(t,e),n)}),remainder=(Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Utils.clamp=function(t,e,n){return n.clamp(t,e)},Number.prototype.mod=function(t){return(this%t+t)%t},function(t,e){return t-t/e*e}),getGoldShortHand=function(t){return t<=1e3?t:t<=1e6?(t/1e3).toFixed(2)+"K":t<=1e9?(t/1e6).toFixed(2)+"M":t<=1e12?(t/1e9).toFixed(2)+"B":(t/1e12).toFixed(2)+"T"},padding=function(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n},WORLDTIME=null,LOCALTIME=null,setWorldTime=function(t,e){var n=~~((Date.now()-t)/2);WORLDTIME=e+n,LOCALTIME=t+n,console.warn("LOCALTIME: "+LOCALTIME),console.warn("WORLDTIME: "+WORLDTIME),console.warn("Date.diff: "+(LOCALTIME-WORLDTIME))},getWorldTime=function(){return WORLDTIME+(Date.now()-LOCALTIME)},getTime=function(){return Date.now()},getX=(Number.prototype.roundupsign=function(){return(0<=this||-1)*Math.ceil(Math.abs(this))},Number.prototype.roundUpTo=function(t){return Math.ceil(this/t)*t},Number.prototype.roundTo=function(t){return Math.round(this/t)*t},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},function(t,e){return 0===t?0:t%e==0?e-1:t%e-1}),BinToHex=(Array.prototype.parseInt||Object.defineProperty(Array.prototype,"parseInt",{value:function(){return this.map(function(t){return parseInt(t,10)})}}),Array.prototype.In||Object.defineProperty(Array.prototype,"In",{value:function(t){return 0<=t&&t<this.length}}),String.prototype.reverse||(String.prototype.reverse=function(){return this.split("").reverse().join("")}),function(t){for(var e=Math.ceil(t.length/4),n="",i=0;i<e;i++){j=4*i;var r=t.slice(j,j+4).join("");n+=parseInt(r,2).toString(16).toUpperCase()}return n}),HexToBin=function(t){for(var e,n=Math.ceil(t.length),i="",r=0;r<n;r++)e=t.substr(r,1),i+=parseInt(e,16).toString(2).padStart(4,"0");return new Uint8Array(i.split(""))},RectContains=function(t,e){return!(t.x1>=e.x2||e.x1>=t.x2||t.y1>=e.y2||e.y1>=t.y2)},msleep=function(e){return new Promise(t=>setTimeout(t,e))},getGridPosition=(Number.prototype.between=function(t,e){var n=Math.min(t,e),t=Math.max(t,e);return n<=this&&this<=t},String.prototype.format=function(t){var n=Array.isArray(t)?t:arguments;return this.replace(/{([0-9]+)}/g,function(t,e){return void 0===n[e]?t:n[e]})},function(t,e){return{gx:t>>4,gy:e>>4}}),getPositionFromGrid=function(t,e){return{x:t<<4,y:e<<4}},ItemTypes=(define("util",function(){}),{}),ItemData={},KindData={},Clamp=(ItemTypes.setKindData=function(t){KindData=t,ItemTypes.KindData=t},ItemTypes.getData=function(t){t=KindData[t];return t&&1!=t.legacy?t:null},ItemTypes.getName=function(e){try{var t=KindData[e];return t?t.name:""}catch(t){log.error("No name found for item: "+KindData[e]),log.error("Error stack: "+t.stack)}},ItemTypes.getWeaponLevel=function(e){try{var t=KindData[e];return t?t.modifier:0}catch(t){log.error("No level found for weapon: "+KindData[e]),log.error("Error stack: "+t.stack)}},ItemTypes.getArmorLevel=function(e){try{var t=KindData[e];return t?t.modifier:0}catch(t){log.error("No level found for armor: "+KindData[e]),log.error("Error stack: "+t.stack)}},ItemTypes.getItemByLevel=function(t,e){for(var n in KindData){n=KindData[n];if(("armor"==n.type||"armorarcher"==n.type)&&n.type==t&&e==n.modifier)return n;if(("weapon"==n.type||"weaponarcher"==n.type)&&n.type==t&&e==n.modifier)return n}return null},ItemTypes.getLevelByKind=function(t){var e=KindData[t];return ItemTypes.isArmor(t)||ItemTypes.isWeapon(t)?e.level:null},ItemTypes.getType=function(e){try{return KindData[e].type}catch(t){log.error("No type found for item: "+e),log.error("Error stack: "+t.stack)}},ItemTypes.getBuyPrice=function(t){var e,n=KindData[t];return n?"bow"==(e=n.type)||"chest"==e||ItemTypes.isArmor(t)||ItemTypes.isWeapon(t)?Math.floor(n.modifier*n.modifier*10):"object"==e&&0<n.buy?1<n.buyCount?n.buy*n.buyCount:n.buy:0:0},ItemTypes.getCraftPrice=function(t){var e=KindData[t];return e&&1!=e.legacy?0<e.buy?e.buy:~~(ItemTypes.getBuyPrice(t)/4):0},ItemTypes.getEnchantSellPrice=function(t){var e=ItemTypes.getBuyPrice(t.itemKind)/10;return 1<t.itemNumber&&(e+=~~(ItemTypes.getEnchantPrice(t)/10)),e*=t.itemDurabilityMax/900,Math.floor(e)},ItemTypes.getEnchantPrice=function(t,e){if(!t)return NaN;var n=KindData[t.itemKind],e=(e=e||!1)?t.itemNumber:t.itemNumber+1;t.itemNumber;if(25<=e)return NaN;experience=t.itemExperience;t=n.modifier,console.info("getEnchantPrice: "+ItemTypes.itemExpForLevel[e]),n=Math.floor(t*t*10*Math.pow(2,e)*(1-experience/ItemTypes.itemExpForLevel[e]));return console.info("cost: "+n),n},function(t,e,n){return n<t?t:e<n?e:n});for(ItemTypes.getRepairPrice=function(t){var e=ItemTypes.getBuyPrice(t.itemKind)/10;if(t.itemDurability==t.itemDurabilityMax)return 0;1<t.itemNumber&&(e=ItemTypes.getEnchantPrice(t,!0)/10);t=t.itemDurabilityMax/900*(1-t.itemDurability/t.itemDurabilityMax);return log.info("getRepairPrice - mp: "+t),1+~~(e*=Clamp(0,1,t))},ItemTypes.isEquippable=function(t){return!!(ItemTypes.isArmor(t)||ItemTypes.isWeapon(t)||ItemTypes.isArcherWeapon(t)||ItemTypes.isClothes(t))},ItemTypes.isClothes=function(t){t=KindData[t];return!!t&&("helm"===t.type||"chest"===t.type||"gloves"===t.type||"boots"===t.type)},ItemTypes.isArmor=function(t){return!!KindData[t]&&ItemTypes.isClothes(t)},ItemTypes.isWeapon=function(t){return!!KindData[t]&&(ItemTypes.isMeleeWeapon(t)||ItemTypes.isArcherWeapon(t))},ItemTypes.isEquipment=function(t){return!!KindData[t]&&(ItemTypes.isWeapon(t)||ItemTypes.isArmor(t))},ItemTypes.getSpriteCode=function(t){var e=KindData[t];if(ItemTypes.isArmor(t))return t;if(ItemTypes.isWeapon(t)){t=e.type;if(!t)return 0;if("sword"==t)return 1;if("axe"==t)return 2;if("hammer"==t)return 12;if("bow"==t)return 50}return 0},ItemTypes.getEquipmentSlot=function(t){return ItemTypes.isWeapon(t)?4:(t=KindData[t])?"helm"===t.type?0:"chest"===t.type?1:"gloves"===t.type?2:"boots"===t.type?3:-1:-1},ItemTypes.isMeleeWeapon=function(t){t=KindData[t];return!!t&&("sword"===t.type||"hammer"===t.type||"axe"===t.type)},ItemTypes.isHarvestWeapon=function(t){t=KindData[t];return!!t&&("hammer"===t.type||"axe"===t.type)},ItemTypes.isArcherWeapon=function(t){t=KindData[t];return!!t&&"bow"===t.type},ItemTypes.isObject=function(t){t=KindData[t];return!!t&&"object"===t.type},ItemTypes.isCraftItem=function(t){t=KindData[t];return!!t&&"craft"===t.type},ItemTypes.isLootItem=function(t){return 1e3<=t&&t<2e3},ItemTypes.isConsumableItem=function(t){t=KindData[t];return!!t&&"object"===t.type},ItemTypes.isHealingItem=function(t){t=KindData[t];return!!t&&"object"===t.type&&("health"==t.typemod||"healthpercent"==t.typemod)},ItemTypes.isItem=function(t){var e=ItemTypes.KindData[t];return!!e&&(ItemTypes.isArmor(t)||ItemTypes.isWeapon(t)||"object"==e.type||"craft"==e.type)},ItemTypes.forEachKind=function(t){for(var e in kindData)t(KindData[e],e)},ItemTypes.forEachArmorKind=function(n){Types.forEachKind(function(t,e){ItemTypes.isArmor(t)&&n(t,e)})},ItemTypes.forEachWeaponKind=function(n){Types.forEachKind(function(t,e){ItemTypes.isWeapon(t)&&n(t,e)})},ItemTypes.forEachArcherWeaponKind=function(n){Types.forEachKind(function(t,e){ItemTypes.isArcherWeapon(t)&&n(t,e)})},ItemTypes.getItemListBy=function(t,e,n){var i,r=[];for(i in KindData){var a=KindData[i];a&&1!=a.legacy&&(4!=t||ItemTypes.isArmor(i)||ItemTypes.isWeapon(i)||r.push({name:a.name,kind:i,type:a.type,buyCount:a.buycount,buyPrice:a.buy,craftPrice:ItemTypes.getCraftPrice(i),itemKind:i,itemNumber:a.buycount,craft:a.craft}),1==t&&"object"==a.type&&0<a.buy?r.push({name:a.name,kind:i,type:a.type,buyCount:a.buycount,buyPrice:a.buy,craftPrice:ItemTypes.getCraftPrice(i),itemKind:i,itemNumber:a.buycount,craft:a.craft}):(2==t&&ItemTypes.isArmor(i)&&a.modifier>=e&&a.modifier<=n||3==t&&ItemTypes.isWeapon(i)&&a.modifier>=e&&a.modifier<=n)&&r.push({name:a.name,kind:i,type:a.type,buyCount:a.buyCount,buyPrice:ItemTypes.getBuyPrice(i),craftPrice:ItemTypes.getCraftPrice(i),rank:a.level,itemKind:i,itemNumber:a.buycount,craft:a.craft}))}return 0<r.length&&0<r[0].rank&&r.sort(function(t,e){return t.rank-e.rank}),r},ItemTypes.Store={isBuy:function(t){t=KindData[t];return!!t&&0<t.buy},isBuyMultiple:function(t){t=KindData[t];return!!t&&0<t.buycount},isSell:function(t){t=KindData[t];return!!t&&2<=t.buy},getBuyCount:function(t){t=KindData[t];return!!t&&(1<t.buyCount?t.buyCount:1)},getItems:function(t,e,n){return ItemTypes.getItemListBy(t,e,n)}},ItemTypes.itemExpForLevel=[],ItemTypes.itemExpForLevel[0]=0,i=1;i<30;i++){var points=Math.floor(150*i*Math.pow(2,i/10));ItemTypes.itemExpForLevel[i]=points}ItemTypes.getItemLevel=function(t){if(0==t)return 1;for(var e=1,e=1;e<30;e++)if(t>ItemTypes.itemExpForLevel[e-1]&&t<=ItemTypes.itemExpForLevel[e])return e;return 30},"undefined"!=typeof exports&&(module.exports=ItemTypes),define("../shared/js/itemtypes",function(){}),EventType={KILLMOB:1,LOOTITEM:2,KILLPLAYER:3,DAMAGE:4,USE_NODE:5,HARVEST:6},QuestType={KILLMOBKIND:1,GETITEMKIND:2,KILLMOBS:3,HIDEANDSEEK:4,USENODE:5},QuestStatus={STARTED:0,INPROGRESS:1,COMPLETE:2},InventoryMode={MODE_NORMAL:0,MODE_SELL:1,MODE_REPAIR:2,MODE_ENCHANT:3,MODE_BANK:4,MODE_AUCTION:5},SkillEffects={SkillType:{SELF:0,TARGET:1,ATTACK:2},TargetType:{SELF:0,ENEMY:1,PLAYER_AOE:2,ENEMY_AOE:3},EffectStat:{HP:0,EP:1,ATTACK:2,DEFENSE:3,DAMAGE:4,FREEZE:5,MOVESPEED:6}},Types={Messages:{BI_SYNCTIME:200,CS_CREATE_USER:1,CS_LOGIN_USER:2,CS_CREATE_PLAYER:3,CS_LOGIN_PLAYER:4,CS_REMOVE_USER:5,CS_ITEMSLOT:6,CS_APPEARANCEUNLOCK:7,CS_ATTACK:8,CS_AUCTIONBUY:9,CS_AUCTIONDELETE:10,CS_AUCTIONOPEN:11,CS_AUCTIONSELL:12,CS_BANKRETRIEVE:13,CS_BANKSTORE:14,CS_CHAT:15,CS_COLOR_TINT:16,CS_BLOCK_MODIFY:17,CS_GOLD:18,CS_PARTY:19,CS_HARVEST:20,CS_USE_NODE:21,CS_LOOKUPDATE:22,CS_LOOT:23,CS_MOVE:24,CS_MOVEPATH:25,CS_QUEST:26,CS_STATADD:27,CS_STOREBUY:28,CS_STORE_MODITEM:29,CS_STORESELL:30,CS_TALKTONPC:31,CS_CRAFT:32,CS_TELEPORT_MAP:33,CS_WHO:34,CS_SKILL:35,CS_SHORTCUT:36,SC_ERROR:100,SC_WORLDS:101,SC_VERSION:102,SC_PLAYER_SUM:103,SC_PLAYER:104,SC_ACHIEVEMENT:105,SC_AUCTIONOPEN:106,SC_ITEMSLOT:107,SC_CHANGEPOINTS:108,SC_CHAT:109,SC_COLOR_TINT:110,SC_DAMAGE:111,SC_DESPAWN:112,SC_SWAPSPRITE:113,SC_APPEARANCE:114,SC_GOLD:115,SC_PARTY:116,SC_PLAYERINFO:140,SC_ITEMLEVELUP:118,SC_STAT:119,SC_LEVELUP:120,SC_LIST:121,SC_LOOKS:122,SC_LOG:123,SC_HARVEST:124,SC_MOVE:125,SC_MOVEPATH:126,SC_NOTIFY:127,SC_QUEST:128,SC_SKILLEFFECTS:129,SC_SKILLLOAD:130,SC_SPAWN:131,SC_SPEECH:132,SC_STATINFO:133,SC_TELEPORT_MAP:134,SC_SKILL_XP:135,SC_DIALOGUE:136,SC_SET_SPRITE:137,SC_SET_ANIMATION:138,SC_BLOCK_MODIFY:139},Orientations:{NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4},EntityTypes:{NONE:0,PLAYER:1,MOB:2,ITEM:3,ITEMLOOT:4,NPCSTATIC:5,NPCMOVE:6,CHEST:7,BLOCK:8,TRAP:9,NODE:10},Keys:{ENTER:13,UP:38,DOWN:40,LEFT:37,RIGHT:39,W:87,A:65,S:83,D:68,SPACE:32,I:73,H:72,M:77,P:80,T:84,Y:89,KEYPAD_4:100,KEYPAD_6:102,KEYPAD_8:104,KEYPAD_2:98,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57},Skills:{BLOODSUCKING:1,RECOVERHEALTH:2,HEALANDHEAL:3,AVOIDATTACK:4,ADDEXPERIENCE:5,ATTACKWITHBLOOD:6,CRITICALATTACK:7,CRITICALRATIO:8},PlayerClass:{FIGHTER:0,ARCHER:1,DEFENDER:2,MAGE:3},PlayerState:{Roaming:0,Moving:1,Following:2,Aggro:3,Hurting:4,GettingItems:5,FollowPlayer:6}};var EntityTypes=Types.EntityTypes;for(Types.expForLevel=[],Types.defenseExp=[],Types.attackExp=[],Types.moveExp=[],Types.skillExp=[],Types.weaponExp=[],Types.expForLevel[0]=0,Types.defenseExp[0]=0,Types.attackExp[0]=0,Types.moveExp[0]=0,Types.skillExp[0]=0,Types.weaponExp[0]=0,i=1;i<50;i++){var points=Math.floor(300*i*Math.pow(1.5,i/5));console.info("level_"+i+"="+points),Types.expForLevel[i]=points,Types.defenseExp[i]=10*points+50,Types.attackExp[i]=10*points+50,Types.moveExp[i]=5*points+20,Types.skillExp[i]=~~(points/1.5),Types.weaponExp[i]=10*points+50}function ItemRoom(t,e,n,i,r,a){this.slot=t,this.itemKind=e,this.itemNumber=n,this.itemDurability=i,this.itemDurabilityMax=r,this.itemExperience=a}Types.getLevel=function(t){if(void 0===t||0==t)return 1;for(var e=1;e<200;e++)if(t<Types.expForLevel[e])return e;return 50},Types.getAttackLevel=function(t){if(0==t)return 1;for(var e=1;e<200;e++)if(t<Types.attackExp[e])return e;return 50},Types.getDefenseLevel=function(t){if(0==t)return 1;for(var e=1;e<200;e++)if(t<Types.defenseExp[e])return e;return 50},Types.getMoveLevel=function(t){if(0==t)return 1;for(var e=1;e<200;e++)if(t<Types.moveExp[e])return e;return 50},Types.getWeaponLevel=function(t){if(0==t)return 1;for(var e=1;e<200;e++)if(t<Types.weaponExp[e])return e;return 50},Types.getSkillLevel=function(t,e){if(void 0===t||0==t)return 1;for(var n=e=e||1;n<20;n++)if(t<Types.skillExp[n])return n;return 20},Types.isPlayer=function(t){return 1===t||222===t},Types.getOrientationAsString=function(t){switch(t){case Types.Orientations.LEFT:return"left";case Types.Orientations.RIGHT:return"right";case Types.Orientations.UP:return"up";case Types.Orientations.DOWN:return"down"}},Types.getMessageTypeAsString=function(n){var i;return _.each(Types.Messages,function(t,e){t===n&&(i=e)}),i=i||"UNKNOWN"},"undefined"!=typeof exports&&(module.exports=Types),define("../shared/js/gametypes",function(){}),!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("lib/localforage",[],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}(function(){return function i(r,a,s){function o(n,t){if(!a[n]){if(!r[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(l)return l(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}e=a[n]={exports:{}};r[n][0].call(e.exports,function(t){var e=r[n][1][t];return o(e||t)},e,e.exports,i,r,a,s)}return a[n].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)o(s[t]);return o}({1:[function(t,c,e){!function(e){"use strict";var t,n,i,r,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(t=0,a=new a(l),n=e.document.createTextNode(""),a.observe(n,{characterData:!0}),function(){n.data=t=++t%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((i=new e.MessageChannel).port1.onmessage=l,function(){i.port2.postMessage(0)}),o=[];function l(){r=!0;for(var t,e,n=o.length;n;){for(e=o,o=[],t=-1;++t<n;)e[t]();n=o.length}r=!1}c.exports=function(t){1!==o.push(t)||r||s()}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){"use strict";var r=t(1);function l(){}var c={},a=["REJECTED"],s=["FULFILLED"],i=["PENDING"];function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=i,this.queue=[],this.outcome=void 0,t!==l&&p(this,t)}function h(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,n,i){r(function(){var t;try{t=n(i)}catch(t){return c.reject(e,t)}t===e?c.reject(e,new TypeError("Cannot resolve promise with itself")):c.resolve(e,t)})}function d(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(e,t){var n=!1;function i(t){n||(n=!0,c.reject(e,t))}function r(t){n||(n=!0,c.resolve(e,t))}var a=f(function(){t(r,i)});"error"===a.status&&i(a.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}(e.exports=n=o).prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n;return"function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a?this:(n=new this.constructor(l),this.state!==i?u(n,this.state===s?t:e,this.outcome):this.queue.push(new h(n,t,e)),n)},h.prototype.callFulfilled=function(t){c.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){c.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},c.resolve=function(t,e){var n=f(d,e);if("error"===n.status)return c.reject(t,n.value);n=n.value;if(n)p(t,n);else{t.state=s,t.outcome=e;for(var i=-1,r=t.queue.length;++i<r;)t.queue[i].callFulfilled(e)}return t},c.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},n.resolve=function(t){if(t instanceof this)return t;return c.resolve(new this(l),t)},n.reject=function(t){var e=new this(l);return c.reject(e,t)},n.all=function(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);var a=new Array(i),s=0,e=-1,o=new this(l);for(;++e<i;)!function(t,e){n.resolve(t).then(function(t){a[e]=t,++s!==i||r||(r=!0,c.resolve(o,a))},function(t){r||(r=!0,c.reject(o,t))})}(t[e],e);return o},n.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);var r=-1,a=new this(l);for(;++r<n;)!function(t){e.resolve(t).then(function(t){i||(i=!0,c.resolve(a,t))},function(t){i||(i=!0,c.reject(a,t))})}(t[r]);return a}},{1:1}],3:[function(e,t,n){!function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,$,B){"use strict";var R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var s=function(){try{return"undefined"!=typeof indexedDB?indexedDB:"undefined"!=typeof webkitIndexedDB?webkitIndexedDB:"undefined"!=typeof mozIndexedDB?mozIndexedDB:"undefined"!=typeof OIndexedDB?OIndexedDB:"undefined"!=typeof msIndexedDB?msIndexedDB:void 0}catch(t){}}();function a(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(t){if("TypeError"!==t.name)throw t;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)i.append(e[r]);return i.getBlob(n.type)}}"undefined"==typeof Promise&&t(3);var h=Promise;function u(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function l(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}function d(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}var e,p,o="local-forage-detect-blob-support",j=Object.prototype.toString,n="readonly",c="readwrite";function H(t){return"boolean"==typeof e?h.resolve(e):(i=t,new h(function(n){var t=i.transaction(o,c),e=a([""]);t.objectStore(o).put(e,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),n(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);n(e||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1}).then(function(t){return e=t}));var i}function f(t){var t=p[t.name],e={};e.promise=new h(function(t){e.resolve=t}),t.deferredOperations.push(e),t.dbReady?t.dbReady=t.dbReady.then(function(){return e.promise}):t.dbReady=e.promise}function m(r,a){return new h(function(e,n){if(r.db){if(!a)return e(r.db);f(r),r.db.close()}var t=[r.name],i=(a&&t.push(r.version),s.open.apply(s,t));a&&(i.onupgradeneeded=function(e){var t=i.result;try{t.createObjectStore(r.storeName),e.oldVersion<=1&&t.createObjectStore(o)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+r.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+r.storeName+'" already exists.')}}),i.onerror=function(t){t.preventDefault(),n(i.error)},i.onsuccess=function(){var t;e(i.result),(t=p[(t=r).name].deferredOperations.pop())&&t.resolve()}})}function g(t){return a([function(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),r=0;r<e;r++)i[r]=t.charCodeAt(r);return n}(atob(t.data))],{type:t.type})}function y(t){return t&&t.__local_forage_encoded_blob}function F(t){var e=this,n=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return l(n,t,t),n}function q(i){f(i);for(var n=p[i.name].forages,t=0;t<n.length;t++)n[t]._dbInfo.db&&(n[t]._dbInfo.db.close(),n[t]._dbInfo.db=null);return m(i,!1).then(function(t){for(var e=0;e<n.length;e++)n[e]._dbInfo.db=t}).catch(function(t){var e,n;throw n=t,(e=p[(e=i).name].deferredOperations.pop())&&e.reject(n),t})}function v(e,n,i){try{var t=e.db.transaction(e.storeName,n);i(null,t)}catch(t){if(!e.db||"InvalidStateError"===t.name)return q(e).then(function(){var t=e.db.transaction(e.storeName,n);i(null,t)});i(t)}}t={_driver:"asyncStorage",_initStorage:function(t){var s=this,o={db:null};if(t)for(var e in t)o[e]=t[e];var i=(p=p||{})[o.name],n=(i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},p[o.name]=i),i.forages.push(s),s._initReady||(s._initReady=s.ready,s.ready=F),[]);function r(){return h.resolve()}for(var a=0;a<i.forages.length;a++){var l=i.forages[a];l!==s&&n.push(l._initReady().catch(r))}var c=i.forages.slice(0);return h.all(n).then(function(){return o.db=i.db,m(o,!1)}).then(function(t){var e,n,i,r,a;return o.db=t,e=o,n=s._defaultConfig.version,!e.db||(i=!e.db.objectStoreNames.contains(e.storeName),a=e.version<e.db.version,r=e.version>e.db.version,a&&(e.version!==n&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(r||i)&&(i&&(a=e.db.version+1)>e.version&&(e.version=a),1))?m(o,!0):t}).then(function(t){o.db=i.db=t,s._dbInfo=o;for(var e=0;e<c.length;e++){var n=c[e];n!==s&&(n._dbInfo.db=o.db,n._dbInfo.version=o.version)}})},_support:function(){try{var t,e;return s?(t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code"),(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange):!1}catch(t){return!1}}(),iterate:function(s,t){var o=this,e=new h(function(r,a){o.ready().then(function(){v(o._dbInfo,n,function(t,e){if(t)return a(t);try{var n=e.objectStore(o._dbInfo.storeName).openCursor(),i=1;n.onsuccess=function(){var t,e=n.result;e?(y(t=e.value)&&(t=g(t)),void 0!==(t=s(t,e.key,i++))?r(t):e.continue()):r()},n.onerror=function(){a(n.error)}}catch(t){a(t)}})}).catch(a)});return u(e,t),e},getItem:function(a,t){var s=this,e=(a=d(a),new h(function(i,r){s.ready().then(function(){v(s._dbInfo,n,function(t,e){if(t)return r(t);try{var n=e.objectStore(s._dbInfo.storeName).get(a);n.onsuccess=function(){var t=n.result;y(t=void 0===t?null:t)&&(t=g(t)),i(t)},n.onerror=function(){r(n.error)}}catch(t){r(t)}})}).catch(r)}));return u(e,t),e},setItem:function(s,e,t){var o=this,n=(s=d(s),new h(function(r,a){var t;o.ready().then(function(){return t=o._dbInfo,"[object Blob]"===j.call(e)?H(t.db).then(function(t){return t?e:(i=e,new h(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){t=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:t,type:i.type})},n.readAsBinaryString(i)}));var i}):e}).then(function(i){v(o._dbInfo,c,function(t,e){if(t)return a(t);try{var n=e.objectStore(o._dbInfo.storeName).put(i,s);null===i&&(i=void 0),e.oncomplete=function(){r(i=void 0===i?null:i)},e.onabort=e.onerror=function(){var t=n.error||n.transaction.error;a(t)}}catch(t){a(t)}})}).catch(a)}));return u(n,t),n},removeItem:function(a,t){var s=this,e=(a=d(a),new h(function(i,r){s.ready().then(function(){v(s._dbInfo,c,function(t,e){if(t)return r(t);try{var n=e.objectStore(s._dbInfo.storeName).delete(a);e.oncomplete=function(){i()},e.onerror=function(){r(n.error)},e.onabort=function(){var t=n.error||n.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)}));return u(e,t),e},clear:function(t){var a=this,e=new h(function(i,r){a.ready().then(function(){v(a._dbInfo,c,function(t,e){if(t)return r(t);try{var n=e.objectStore(a._dbInfo.storeName).clear();e.oncomplete=function(){i()},e.onabort=e.onerror=function(){var t=n.error||n.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return u(e,t),e},length:function(t){var a=this,e=new h(function(i,r){a.ready().then(function(){v(a._dbInfo,n,function(t,e){if(t)return r(t);try{var n=e.objectStore(a._dbInfo.storeName).count();n.onsuccess=function(){i(n.result)},n.onerror=function(){r(n.error)}}catch(t){r(t)}})}).catch(r)});return u(e,t),e},key:function(o,t){var l=this,e=new h(function(a,s){o<0?a(null):l.ready().then(function(){v(l._dbInfo,n,function(t,e){if(t)return s(t);try{var n=e.objectStore(l._dbInfo.storeName),i=!1,r=n.openCursor();r.onsuccess=function(){var t=r.result;t?0===o||i?a(t.key):(i=!0,t.advance(o)):a(null)},r.onerror=function(){s(r.error)}}catch(t){s(t)}})}).catch(s)});return u(e,t),e},keys:function(t){var s=this,e=new h(function(r,a){s.ready().then(function(){v(s._dbInfo,n,function(t,e){if(t)return a(t);try{var n=e.objectStore(s._dbInfo.storeName).openCursor(),i=[];n.onsuccess=function(){var t=n.result;t?(i.push(t.key),t.continue()):r(i)},n.onerror=function(){a(n.error)}}catch(t){a(t)}})}).catch(a)});return u(e,t),e}};var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/^~~local_forage_type~([^~]+)~/,w="__lfsc__:",x=w.length,S="arbf",T="blob",_=x+S.length,I=Object.prototype.toString;function E(t){for(var e,n,i,r,a=.75*t.length,s=t.length,o=0,a=("="===t[t.length-1]&&(a--,"="===t[t.length-2])&&a--,new ArrayBuffer(a)),l=new Uint8Array(a),c=0;c<s;c+=4)e=b.indexOf(t[c]),n=b.indexOf(t[c+1]),i=b.indexOf(t[c+2]),r=b.indexOf(t[c+3]),l[o++]=e<<2|n>>4,l[o++]=(15&n)<<4|i>>2,l[o++]=(3&i)<<6|63&r;return a}function C(t){for(var e=new Uint8Array(t),n="",i=0;i<e.length;i+=3)n=(n=(n=(n+=b[e[i]>>2])+b[(3&e[i])<<4|e[i+1]>>4])+b[(15&e[i+1])<<2|e[i+2]>>6])+b[63&e[i+2]];return e.length%3==2?n=n.substring(0,n.length-1)+"=":e.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var A={serialize:function(e,n){var t="";if(e&&(t=I.call(e)),e&&("[object ArrayBuffer]"===t||e.buffer&&"[object ArrayBuffer]"===I.call(e.buffer))){var i,r=w;e instanceof ArrayBuffer?(i=e,r+=S):(i=e.buffer,"[object Int8Array]"===t?r+="si08":"[object Uint8Array]"===t?r+="ui08":"[object Uint8ClampedArray]"===t?r+="uic8":"[object Int16Array]"===t?r+="si16":"[object Uint16Array]"===t?r+="ur16":"[object Int32Array]"===t?r+="si32":"[object Uint32Array]"===t?r+="ui32":"[object Float32Array]"===t?r+="fl32":"[object Float64Array]"===t?r+="fl64":n(new Error("Failed to get type for BinaryArray"))),n(r+C(i))}else if("[object Blob]"===t){r=new FileReader;r.onload=function(){var t="~~local_forage_type~"+e.type+"~"+C(this.result);n(w+T+t)},r.readAsArrayBuffer(e)}else try{n(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),n(null,t)}},deserialize:function(t){if(t.substring(0,x)!==w)return JSON.parse(t);var e,n=t.substring(_),i=t.substring(x,_),r=(i===T&&k.test(n)&&(e=(t=n.match(k))[1],n=n.substring(t[0].length)),E(n));switch(i){case S:return r;case T:return a([r],{type:e});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+i)}},stringToBuffer:E,bufferToString:C};function M(s,t,o,l){var c=this,e=(s=d(s),new h(function(r,a){c.ready().then(function(){var n=t=void 0===t?null:t,i=c._dbInfo;i.serializer.serialize(t,function(e,t){t?a(t):i.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+i.storeName+" (key, value) VALUES (?, ?)",[s,e],function(){r(n)},function(t,e){a(e)})},function(t){t.code===t.QUOTA_ERR&&(0<l?r(M.apply(c,[s,n,o,l-1])):a(t))})})}).catch(a)}));return u(e,o),e}var i={_driver:"webSQLStorage",_initStorage:function(t){var i=this,r={db:null};if(t)for(var e in t)r[e]="string"!=typeof t[e]?t[e].toString():t[e];var n=new h(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(t){return n(t)}r.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){i._dbInfo=r,e()},function(t,e){n(e)})})});return r.serializer=A,n},_support:"function"==typeof openDatabase,iterate:function(c,t){var e=this,n=new h(function(l,n){e.ready().then(function(){var o=e._dbInfo;o.db.transaction(function(t){t.executeSql("SELECT * FROM "+o.storeName,[],function(t,e){for(var n=e.rows,i=n.length,r=0;r<i;r++){var a=n.item(r),s=(s=a.value)&&o.serializer.deserialize(s);if(void 0!==(s=c(s,a.key,r+1)))return void l(s)}l()},function(t,e){n(e)})})}).catch(n)});return u(n,t),n},getItem:function(e,t){var a=this,n=(e=d(e),new h(function(i,r){a.ready().then(function(){var n=a._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){e=(e=e.rows.length?e.rows.item(0).value:null)&&n.serializer.deserialize(e);i(e)},function(t,e){r(e)})})}).catch(r)}));return u(n,t),n},setItem:function(t,e,n){return M.apply(this,[t,e,n,1])},removeItem:function(r,t){var a=this,e=(r=d(r),new h(function(n,i){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[r],function(){n()},function(t,e){i(e)})})}).catch(i)}));return u(e,t),e},clear:function(t){var r=this,e=new h(function(n,i){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName,[],function(){n()},function(t,e){i(e)})})}).catch(i)});return u(e,t),e},length:function(t){var r=this,e=new h(function(n,i){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){e=e.rows.item(0).c;n(e)},function(t,e){i(e)})})}).catch(i)});return u(e,t),e},key:function(r,t){var a=this,e=new h(function(n,i){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[r+1],function(t,e){e=e.rows.length?e.rows.item(0).key:null;n(e)},function(t,e){i(e)})})}).catch(i)});return u(e,t),e},keys:function(t){var i=this,e=new h(function(r,n){i.ready().then(function(){var e=i._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName,[],function(t,e){for(var n=[],i=0;i<e.rows.length;i++)n.push(e.rows.item(i).key);r(n)},function(t,e){n(e)})})}).catch(n)});return u(e,t),e}};var z={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var n in t)e[n]=t[n];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),(this._dbInfo=e).serializer=A,h.resolve()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(t){return!1}}(),iterate:function(l,t){var c=this,e=c.ready().then(function(){for(var t=c._dbInfo,e=t.keyPrefix,n=e.length,i=localStorage.length,r=1,a=0;a<i;a++){var s=localStorage.key(a);if(0===s.indexOf(e)){var o=(o=localStorage.getItem(s))&&t.serializer.deserialize(o);if(void 0!==(o=l(o,s.substring(n),r++)))return o}}});return u(e,t),e},getItem:function(n,t){var i=this,e=(n=d(n),i.ready().then(function(){var t=i._dbInfo,e=localStorage.getItem(t.keyPrefix+n);return e=e&&t.serializer.deserialize(e)}));return u(e,t),e},setItem:function(s,t,e){var o=this,n=(s=d(s),o.ready().then(function(){var a=t=void 0===t?null:t;return new h(function(n,i){var r=o._dbInfo;r.serializer.serialize(t,function(t,e){if(e)i(e);else try{localStorage.setItem(r.keyPrefix+s,t),n(a)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}})})}));return u(n,e),n},removeItem:function(e,t){var n=this,i=(e=d(e),n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(i,t),i},clear:function(t){var i=this,e=i.ready().then(function(){for(var t=i._dbInfo.keyPrefix,e=localStorage.length-1;0<=e;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}});return u(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return u(e,t),e},key:function(n,t){var i=this,e=i.ready().then(function(){var e,t=i._dbInfo;try{e=localStorage.key(n)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return u(e,t),e},keys:function(t){var r=this,e=r.ready().then(function(){for(var t=r._dbInfo,e=localStorage.length,n=[],i=0;i<e;i++)0===localStorage.key(i).indexOf(t.keyPrefix)&&n.push(localStorage.key(i).substring(t.keyPrefix.length));return n});return u(e,t),e}},D=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},N={},K={},r={INDEXEDDB:t,WEBSQL:i,LOCALSTORAGE:z},t=[r.INDEXEDDB._driver,r.WEBSQL._driver,r.LOCALSTORAGE._driver],O=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],U={description:"",driver:t.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function P(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var i in n)n.hasOwnProperty(i)&&(D(n[i])?t[i]=n[i].slice():t[i]=n[i])}return t}function L(t){var e,n,i;if(!(this instanceof L))throw new TypeError("Cannot call a class as a function");for(e in r)r.hasOwnProperty(e)&&(i=(n=r[e])._driver,this[e]=i,N[i]||this.defineDriver(n));this._defaultConfig=P({},U),this._config=P({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}L.prototype.config=function(t){if("object"!==(void 0===t?"undefined":R(t)))return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)},L.prototype.defineDriver=function(c,t,e){var n=new h(function(e,n){try{var i=c._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(c._driver){for(var r=O.concat("_initStorage"),a=0,s=r.length;a<s;a++){var o=r[a];if(!o||!c[o]||"function"!=typeof c[o])return void n(t)}var l=function(t){N[i]&&console.info("Redefining LocalForage driver: "+i),N[i]=c,K[i]=t,e()};"_support"in c?c._support&&"function"==typeof c._support?c._support().then(l,n):l(!!c._support):l(!0)}else n(t)}catch(t){n(t)}});return l(n,t,e),n},L.prototype.driver=function(){return this._driver||null},L.prototype.getDriver=function(t,e,n){t=N[t]?h.resolve(N[t]):h.reject(new Error("Driver not found."));return l(t,e,n),t},L.prototype.getSerializer=function(t){var e=h.resolve(A);return l(e,t),e},L.prototype.ready=function(t){var e=this,n=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return l(n,t,t),n},L.prototype.setDriver=function(t,e,n){var a=this,i=(D(t)||(t=[t]),this._getSupportedDrivers(t));function s(){a._config.driver=a.driver()}function o(t){return a._extend(t),s(),a._ready=a._initStorage(a._config),a._ready}function r(r){return function(){var i=0;return function t(){for(;i<r.length;){var e=r[i];return i++,a._dbInfo=null,a._ready=null,a.getDriver(e).then(o).catch(t)}s();var n=new Error("No available storage method found.");return a._driverSet=h.reject(n),a._driverSet}()}}t=null!==this._driverSet?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=t.then(function(){var t=i[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,s(),a._wrapLibraryMethodsWithReady(),a._initDriver=r(i)})}).catch(function(){s();var t=new Error("No available storage method found.");return a._driverSet=h.reject(t),a._driverSet}),l(this._driverSet,e,n),this._driverSet},L.prototype.supports=function(t){return!!K[t]},L.prototype._extend=function(t){P(this,t)},L.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];this.supports(r)&&e.push(r)}return e},L.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=O.length;t<e;t++)!function(e,n){e[n]=function(){var t=arguments;return e.ready().then(function(){return e[n].apply(e,t)})}}(this,O[t])},L.prototype.createInstance=function(t){return new L(t)};i=new L;$.exports=i},{3:3}]},{},[4])(4)}),define("timer",[],function(){return Class.extend({init:function(t,e){this.lastTime=e,!isNaN(e)&&null!==e&&0!==e||(this.lastTime=Date.now()),this.duration=t},isOver:function(t){var e=!1;return(0==this.lastTime||t-this.lastTime>this.duration)&&(e=!0,this.lastTime=t),e},getRatio:function(t){t=(t-this.lastTime)/this.duration;return 1<=t?1:t}})}),define("entity/entity",["../timer"],function(r){return Class.extend({init:function(t,e,n,i){this.id=t,this.type=e,this.mapIndex=n,this.kind=i,this.sprite=null,this.flipSpriteX=!1,this.flipSpriteY=!1,this.pjsSprite=null,this.animations=null,this.currentAnimation=null,this.isLoaded=!1,this.visible=!0,this.isFading=!1,this.prevOrientation=null,this.name="",this.fadingTime=1e3,this.fadingTimer=new r(this.fadingTime,getTime()),this.lockfadeIn=!1,this.spriteChanged=!0,this.x=0,this.y=0},hasAnimation:function(t){return!!this.currentAnimation&&0==this.currentAnimation.name.indexOf(t)},animate:function(t,e,n,i){var r=this.orientation||Types.Orientations.DOWN;this.flipSpriteX=!1,this.flipSpriteY=!1,0<=_.indexOf(["atk","walk","idle"],t)&&(t+="_"+(r===Types.Orientations.LEFT?"right":Types.getOrientationAsString(r)),this.flipSpriteX=this.orientation===Types.Orientations.LEFT),10==this.type&&console.info("animation: "+t+", speed:"+e+", count:"+n+", onEndCount:"+i),this.setAnimation(t,e,n,i)},onRemove:function(t){this.remove_callback=t},setName:function(t){this.name=t},_setPosition:function(t,e){var n=G_TILESIZE,i=(this.x=t)>>4,r=(this.y=e)>>4;t%n==0&&(this.gx=i),e%n==0&&(this.gy=r)},setPosition:function(t,e){this._setPosition(t,e)},setPositionGrid:function(t,e){game.tilesize;t=(this.x=t)>>4,e=(this.y=e)>>4;this.gx=t,this.gy=e},getPositionGridPrev:function(){return{gx:this.gx,gy:this.gy}},setPositionSpawn:function(t,e){log.info("setPositionSpawn - x:"+t+"y:"+e),this.x=t,this.y=e;t=this.gx=t>>4,e=this.gy=e>>4;this.spawnGx=t,this.spawnGy=e},setSprite:function(t){if(!t)throw log.error(this.id+" : sprite is null",!0),"Sprite error";this.sprite&&this.sprite.name===t.name||(this.pjsSprite?game.renderer.changeSprite(t,this.pjsSprite):this.pjsSprite=game.renderer.createSprite(t),this.oldSprite=this.sprite,this.sprite=t,this.animations=t.createAnimations(),this.isLoaded=!0,this.ready_func&&this.ready_func())},getSprite:function(){return this.sprite},getSpriteName:function(){return this.spriteName},getAnimationByName:function(t){var e;return t in this.animations?this.animations[t]:(e=new Error,log.error(e.stack),log.info("No animation called "+t),null)},setAnimation:function(t,e,n,i){var r,a=this;this.isLoaded?this.currentAnimation&&this.currentAnimation.name===t||(!this.isDying&&!this.isDead||"death"!=this.currentAnimation.name)&&(this.sprite,r=this.getAnimationByName(t))&&(this.currentAnimation=r,0===t.indexOf("atk")&&this.currentAnimation.reset(),this.currentAnimation.setSpeed(e),this.currentAnimation.setCount(n||0,i||function(){a.idle(a.orientation)})):this.log_error("Not ready for animation")},ready:function(t){this.ready_func=t},clean:function(){},log_info:function(t){log.info("["+this.id+"] "+t)},log_error:function(t){log.error("["+this.id+"] "+t)},setVisible:function(t){this.visible=t},isVisible:function(){return this.visible},toggleVisibility:function(){this.visible?this.setVisible(!1):this.setVisible(!0)},fadeInEntity:function(t){1!=this.lockfadeIn&&(this.isFading=!0,this.fadingTime.lastTime=t)},getFadeRatio:function(t){return 1==this.lockfadeIn?1:this.fadingTimer.isOver(t)?(this.isFading=!1,this.lockfadeIn=!0,1):this.fadingTimer.getRatio(t)},isNextToo:function(t,e,n){return n=n||G_TILESIZE,Math.abs(this.x-t)<=n&&Math.abs(this.y-e)<=n},isNextTooEntity:function(t){return this.isNextToo(t.x,t.y)},isWithin:function(t){return this.isNextToo(t.x,t.y,G_TILESIZE>>1)},isTouching:function(t){return this.isNextToo(t.x,t.y,G_TILESIZE-1)},isOver:function(t,e){return this.isNextToo(t,e,G_TILESIZE>>1)},isOverlapping:function(){var t,e=this.map.entities.getCharactersAround(this,1);res=!1,ts=G_TILESIZE;for(t of e)if(t&&this!=t){t.x,t.y;if(this.isTouching(t.x,t.y)){res=!0;break}}return res}})}),define("transition",[],function(){return Class.extend({init:function(t){this.startValue=0,this.endValue=0,this.duration=0,this.inProgress=!1,this.modValue=0,this.object=t},start:function(t,e,n){this.updateFunction=t,this.stopFunction=e,this.modValue=n,this.inProgress=!0},step:function(){if(this.inProgress){var t=this.modValue;if(0!=t){3<t&&console.warn("inc="+t);if(this.updateFunction)for(var e=Math.abs(t),n=0<t?1:-1,i=1;i<=e;++i)if(this.updateFunction(this.object,n))return void this.stop(this.object)}}},stop:function(){this.stopFunction&&this.stopFunction(this.object),this.inProgress=!1}})}),define("entity/entitymoving",["./entity","../transition","../timer"],function(t,s,e){return t.extend({init:function(t,e,n,i,r,a){this._super(t,e,n,i,r,a),this.moveSpeed=100,this.setMoveRate(this.moveSpeed),this.walkSpeed=150,this.idleSpeed=randomInt(750,1e3),this.followingMode=!1,this.step=0,this.orientation=0,this.movement=new s(this),this.path=null,this.newDestination=null,this.adjacentTiles={},this.freeze=!1},moveTo_:function(t,e,n){return this._moveTo(t,e,n)},_moveTo:function(t,e,n){this.destination={x:t,y:e},this.adjacentTiles={},this.isMovingPath()?this.continueTo(t,e):(t=this.requestPathfindingTo(t,e))&&this.followPath(t)},requestPathfindingTo:function(t,e){if(Array.isArray(this.path)&&0<this.path.length)return this.path;if(this.request_path_callback)return this.request_path_callback(t,e);log.info(this.id+" couldn't request pathfinding to "+t+", "+e),log.info("char x:"+this.x+",y: "+this.y+", x:"+t+"y: "+e);try{throw new Error}catch(t){log.info(t.stack)}return null},onRequestPath:function(t){this.request_path_callback=t},onStartPathing:function(t){this.start_pathing_callback=t},onStopPathing:function(t){this.stop_pathing_callback=t},onAbortPathing:function(t){this.abort_pathing_callback=t},followPath:function(t){t&&(this.path=t,this.step=0,this.followingMode&&t.pop(),this.start_pathing_callback)&&this.start_pathing_callback(t)},continueTo:function(t,e){this.newDestination={x:t,y:e}},go:function(t,e){this.followingMode&&(this.followingMode=!1,this.target=null),this.moveTo_(t,e)},follow:function(t,e){t=this.getClosestSpot(t,e);t&&t.x&&t.y&&this.moveTo_(t.x,t.y)},getLastMove:function(){var t;return this.path?[(t=this.path[this.path.length-1])[0],t[1]]:null},getSpotsAroundFrom:function(t,e,n){e=e||1,n=n||1;for(var i=[],r=Math.min(e,n),a=Math.max(e,n),s=r;s<=a;++s)i=i.concat(this.getSpotsAround(t,s));return i},getSpotsAround:function(t,e){for(var n,i,r=(e=e||1)*G_TILESIZE,a=4*e,e=[t.x,t.y],s=e[0],o=e[1],l=this.x,c=this.y,h=[],u=2*Math.PI/a,d=0,p=0;p<a;++p)d+=u,n=~~(s+Math.sin(d)*r),i=~~(o+Math.cos(d)*r),h.push([n,i]);for(var f,m=[],g=(h=h.filter((e,t,n)=>n.findIndex(t=>t[0]===e[0]&&t[1]===e[1])===t)).length,p=0;p<g;++p)f=h[p],m.push({d:Utils.realDistance([l,c],f),x:f[0],y:f[1]});return m},getClosestSpot:function(t,e,n){for(var i=this.getSpotsAroundFrom(t,e=e||1,n=n||1),r=i.length-1;0<=r;--r){var a=i[r];game.mapContainer.isColliding(a.x,a.y)&&i.splice(r,1)}return i.sort(function(t,e){return t.d-e.d}),{x:i[0].x,y:i[0].y}},stopInPath:function(t,e){this.isMovingPath()&&this.map.entities.pathfinder.isInPath(this.path,[t,e])&&(this.setPosition(t,e),this.interrupted=!0,this.forceStop())},idle:function(t){this.setOrientation(t||this.orientation),this.animate("idle",this.idleSpeed)},walk:function(t){this.setOrientation(t||this.orientation),this.animate("walk",this.walkSpeed)},forceStop:function(){this._forceStop(),this.isDying||this.isDead||this.hasAnimation("atk")||this.idle()},_forceStop:function(){this.path&&this.movement.inProgress&&this.abort_pathing_callback&&this.abort_pathing_callback(this.x,this.y),this._stop()},_stop:function(){this.movement.stop(),this.keyMove=!1,this.moving=!1,this.interrupted=!1,this.path=null,this.newDestination=null,this.isReadyToMove=!0,this.followingMode=!1},setMoveStopCallback:function(t){this.movestop_callback=t},onHasMoved:function(t){this.hasmoved_callback=t},hasMoved:function(){this.setDirty(),this.hasmoved_callback&&this.hasmoved_callback(this)},setMoveRate:function(t){this.moveSpeed=t,this.walkSpeed=~~(t/4),this.tick=Math.round(1e3/this.moveSpeed)},getPathIndex:function(t){return null===!this.path||0===this.path.length||t<0||t>=this.path.length?null:this.path[t]},updateMovement:function(){var t=this.path,e=this.step;!t||e>t.length-1||(this.orientation=this.getOrientation([this.x,this.y],t[e]),this.walk(this.orientation))},updateWalk:function(t,e){this.orientation=this.getOrientation(t,e),this.walk(this.orientation)},nextStepPath:function(){return 0==this.step&&(this.step++,this.updateMovement()),this.step<this.path.length&&this.x==this.path[this.step][0]&&this.y==this.path[this.step][1]&&(this.step++,this.updateMovement(),!0)},nextStep:function(){var t,e,n=!1,i=!1;return(n=this.isMovingPath()&&!this.freeze?n:this.interrupted=!0)||(i=this.nextStepPath(),this.step>=this.path.length&&(n=!0),this.step_callback&&this.step_callback()),this.hasChangedItsPath()?(this.setPosition(this.x,this.y),t=this.newDestination.x,e=this.newDestination.y,t=this.requestPathfindingTo(t,e),this.newDestination=null,this.followPath(t),!0):(n&&(this.stop_pathing_callback&&(this.stop_pathing_callback(this.x,this.y),this.forceStop()),i=!0),i)},onBeforeMove:function(t){this.before_move_callback=t},onBeforeStep:function(t){this.before_step_callback=t},onStep:function(t){this.step_callback=t},isMoving:function(){return this.movement.inProgress},isMovingPath:function(){return this.path&&0<this.path.length},hasNextStep:function(){return this.path&&this.path.length-1>this.step},hasChangedItsPath:function(){return!(null===this.newDestination)},movePath:function(t,e){this.orientation=this.getOrientationTo([t[1][0],t[1][1]]),this.walk(),this.path=t,this.step=0},setPosition:function(t,e){this._setPosition(t,e)},move:function(t,e,n,i,r){this.orientation=e,1==n&&e!=Types.Orientations.NONE?(this.forceStop(),this.setPosition(i,r),this.walk(e)):0!=n&&2!=n&&e!=Types.Orientations.NONE||(this.forceStop(),this.setPosition(i,r))},isNear:function(t,e){var n=!1,i=Math.abs(this.x-t.x),t=Math.abs(this.y-t.y);return n=i<=e*G_TILESIZE&&t<=e*G_TILESIZE?!0:n},nextDist:function(t,e,n,i){switch(t=t||this.x,e=e||this.y,i=i||1,n=n||this.orientation){case 1:return[t,e-i];case 2:return[t,e+i];case 3:return[t-i,e];case 4:return[t+i,e]}return[t,e]},nextMove:function(t,e,n,i){return this.nextDist(t,e,n,1)},nextTile:function(t,e,n,i){return this.nextDist(t,e,n,G_TILESIZE)},isWithinPath:function(t){var e=null;if("Object"==typeof t&&0<t.x&&0<t.y?e=[t.x,t.y]:Array.isArray(t)&&2==t.length&&(e=[t[0],t[1]]),e&&null!==this.path&&0!==this.path.length)for(var n=this.path.length,i=0;i<n;++i)if(this.path[i][0]===e[0]&&this.path[i][1]===e[1])return{x:e[0],y:e[1],step:i};return null},getOrientationTo:function(t){return this.getOrientation([this.x,this.y],t)},getOrientation:function(t,e){var n=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]);return i<n?t[0]>e[0]?3:4:n<i?t[1]>e[1]?1:2:0},setOrientation:function(t){t&&(this.orientation=t||0)},lookAt:function(t,e){return this.orientation=this.getOrientationTo([t,e]),this.idle(this.orientation),this.orientation},lookAtEntity:function(t){this._lookAtEntity(t)},_lookAtEntity:function(t){return t&&(this.orientation=this.getOrientationTo([t.x,t.y])),this.orientation},lookAtTile:function(t,e){var n=G_TILESIZE>>1,t=getGridPosition(t,e),t=getPositionFromGrid(t.gx,t.gy);this.lookAt(t.x+n,t.y+n)},isNextToo:function(t,e,n){n=n||this.orientation,n=G_TILESIZE;return Math.abs(this.x-t)<=n&&Math.abs(this.y-e)<=n},isInReach:function(t,e,n,i,r){var n=n||this.orientation,a=G_TILESIZE,r=r||a>>1,i=i||a+r,s=r,o=r;switch(n){case Types.Orientations.UP:case Types.Orientations.DOWN:o=i;break;case Types.Orientations.LEFT:case Types.Orientations.RIGHT:s=i;break;case Types.Orientations.NONE:return!1}return Math.abs(this.x-t)<=s&&Math.abs(this.y-e)<=o},isFacing:function(t,e){var n=this.x-t,i=this.y-e;switch(this.orientation){case 1:return 0<i;case 2:return i<0;case 3:return 0<n;case 4:return n<0}return!1},isFacingEntity:function(t){return this.isFacing(t.x,t.y)},isNextTooEntity:function(t){return this.isNextToo(t.x,t.y)},setFreeze:function(t,e){var n=this;t<=0?n.freeze=!1:(this.freeze=!0,this.freeze_callback=setTimeout(function(){n.freeze=!1,e&&e(n)},t))}})}),!function(){var i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,s=[];define("text",[],function(){var o,t,n;return"undefined"!=typeof window&&window.navigator&&window.document?t=function(t,e){var n=o.createXhr();n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&e(n.responseText)},n.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t=function(t,e){e(n.readFileSync(t,"utf8"))}):"undefined"!=typeof Packages&&(t=function(t,e){var n,i,r=new java.io.File(t),a=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),t="";try{for(n=new java.lang.StringBuffer,(i=r.readLine())&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=r.readLine());)n.append(a),n.append(i);t=String(n.toString())}finally{r.close()}e(t)}),o={version:"0.26.0",strip:function(t){var e;return t?(e=(t=t.replace(r,"")).match(a))&&(t=e[1]):t="",t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(e=0;e<3;e++){n=i[e];try{t=new ActiveXObject(n)}catch(t){}if(t){i=[n];break}}if(t)return t;throw Error("createXhr(): XMLHttpRequest not available")},get:t,parseName:function(t){var e=!1,n=t.indexOf("."),i=t.substring(0,n);return-1!==(n=(t=t.substring(n+1,t.length)).indexOf("!"))&&(e="strip"===(e=t.substring(n+1,t.length)),t=t.substring(0,n)),{moduleName:i,ext:t,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,canUseXhr:function(t,e,n,i){var r,a=o.xdRegExp.exec(t);return!(a&&(t=a[2],r=(a=(a=a[3]).split(":"))[1],a=a[0],t&&t!==e||a&&a!==n||(r||a)&&r!==i))},finishLoad:function(t,e,n,i,r){n=e?o.strip(n):n,r.isBuild&&r.inlineText&&(s[t]=n),i(n)},load:function(e,t,n,i){var r=o.parseName(e),a=r.moduleName+"."+r.ext,s=t.toUrl(a);!l||o.canUseXhr(s)?o.get(s,function(t){o.finishLoad(e,r.strip,t,n,i)}):t([a],function(t){o.finishLoad(r.moduleName+"."+r.ext,r.strip,t,n,i)})},write:function(t,e,n){e in s&&n("define('"+t+"!"+e+"', function () { return '"+o.jsEscape(s[e])+"';});\n")},writeFile:function(t,e,n,i,r){var a=(e=o.parseName(e)).moduleName+"."+e.ext,s=n.toUrl(e.moduleName+"."+e.ext)+".js";o.load(a,n,function(){o.write(t,a,function(t){i(s,t)},r)},r)}}})}(),define("text!data/../../shared/data/mobs.json",function(){return'{\r\n    "Rat":{\r\n        "name":"Rat",\r\n        "kind":1,\r\n        "attackMod": 1,\r\n        "defenseMod": 1,\r\n        "hpMod": 1,\r\n        "xpMod": 1,\r\n        "minLevel": 1,\r\n        "maxLevel": 1,\r\n        "aggroRange": 0,\r\n        "attackRange": 1,\r\n        "isAggressive": 0,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "rat",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Crab":{\r\n        "name":"Crab",\r\n        "kind":2,\r\n        "attackMod": 1.3,\r\n        "defenseMod": 1.3,\r\n        "hpMod": 1,\r\n        "minLevel": 2,\r\n        "maxLevel": 2,\r\n        "aggroRange": 5,\r\n        "attackRange": 1,\r\n        "isAggressive": 0,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "crab",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Skeleton":{\r\n        "name":"Skeleton",\r\n        "kind":3,\r\n        "attackMod": 1.2,\r\n        "defenseMod": 1.2,\r\n        "hpMod": 1.5,\r\n        "minLevel": 6,\r\n        "maxLevel": 10,\r\n        "aggroRange": 2,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1.5,\r\n        "reactionMod": 1.5,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "skeleton",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Goblin":{\r\n        "name":"Goblin",\r\n        "kind":4,\r\n        "attackMod": 1.3,\r\n        "defenseMod": 0.9,\r\n        "hpMod": 0.9,\r\n        "minLevel": 3,\r\n        "maxLevel": 9,\r\n        "aggroRange": 3,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "goblin",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Snake":{\r\n        "name":"Snake",\r\n        "kind":5,\r\n        "attackMod": 2,\r\n        "defenseMod": 1,\r\n        "hpMod": 0.8,\r\n        "minLevel": 10,\r\n        "maxLevel": 14,\r\n        "aggroRange": 3,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "snek",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Bat":{\r\n        "name":"Bat",\r\n        "kind":6,\r\n        "attackMod": 1.3,\r\n        "defenseMod": 1,\r\n        "hpMod": 1,\r\n        "minLevel": 10,\r\n        "maxLevel": 30,\r\n        "aggroRange": 6,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 1,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "bat",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Skeleton2":{\r\n        "name":"HardSkeleton",\r\n        "kind":7,\r\n        "attackMod": 1.5,\r\n        "defenseMod": 1.5,\r\n        "hpMod": 1.5,\r\n        "minLevel": 15,\r\n        "maxLevel": 19,\r\n        "aggroRange": 2,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 2,\r\n        "reactionMod": 2,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "skeleton2",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Ogre":{\r\n        "name":"Ogre",\r\n        "kind":8,\r\n        "attackMod": 1.5,\r\n        "defenseMod": 1.2,\r\n        "hpMod": 2,\r\n        "minLevel": 20,\r\n        "maxLevel": 24,\r\n        "aggroRange": 5,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "ogre",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Eye":{\r\n        "name":"Eye",\r\n        "kind":9,\r\n        "attackMod": 1.5,\r\n        "defenseMod": 1,\r\n        "hpMod": 1,\r\n        "minLevel": 25,\r\n        "maxLevel": 29,\r\n        "aggroRange": 3,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "eye",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Wizard":{\r\n        "name":"Wizard",\r\n        "kind":10,\r\n        "attackMod": 1.5,\r\n        "defenseMod": 1,\r\n        "hpMod": 1,\r\n        "minLevel": 30,\r\n        "maxLevel": 34,\r\n        "aggroRange": 6,\r\n        "attackRange": 3,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 1,\r\n        "reactionMod": 1,\r\n        "moveSpeedMod": 3,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "wizard",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "Spectre":{\r\n        "name":"Spectre",\r\n        "kind":11,\r\n        "attackMod": 1.5,\r\n        "defenseMod": 1.5,\r\n        "hpMod": 1,\r\n        "minLevel": 35,\r\n        "maxLevel": 29,\r\n        "aggroRange": 2,\r\n        "attackRange": 2,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 2,\r\n        "reactionMod": 0.5,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "spectre",\r\n        "idleSpeedMod": 1\r\n    },\r\n    "DeathKnight":{\r\n        "name":"DeathKnight",\r\n        "kind":12,\r\n        "attackMod": 1.8,\r\n        "defenseMod": 1.8,\r\n        "hpMod": 1.5,\r\n        "minLevel": 40,\r\n        "maxLevel": 49,\r\n        "aggroRange": 4,\r\n        "attackRange": 1,\r\n        "isAggressive": 1,\r\n        "attackRateMod": 2,\r\n        "reactionMod": 0.5,\r\n        "moveSpeedMod": 2,\r\n        "respawnMod": 1,\r\n        "dropRate": 1,\r\n        "spawnChance": 50,\r\n        "dropBonus": 0,\r\n        "spriteName": "deathknight",\r\n        "idleSpeedMod": 1\r\n    }\r\n}\r\n'}),define("data/mobdata",["text!../../shared/data/mobs.json"],function(t){var n={Kinds:{},Properties:{}},t=JSON.parse(t);return $.each(t,function(t,e){n.Properties[t.toLowerCase()]={key:t.toLowerCase(),kind:e.kind,attack:e.attackMod?4*e.attackMod:4,defense:e.defenseMod?3*e.defenseMod:40,hp:e.hpMod?200*e.hpMod:200,xp:e.xpMod?30*e.xpMod:30,level:e.level||0,minLevel:e.minLevel||0,maxLevel:e.maxLevel||0,aggroRange:e.aggroRange?e.aggroRange+1:4,attackRange:e.attackRange||1,isAggressive:1==e.isAggressive,attackRate:e.attackRateMod?1e3*e.attackRateMod:1e3,reactionDelay:e.reactionMod?768*e.reactionMod:768,moveSpeed:e.moveSpeedMod?~~(300+200*e.moveSpeedMod):500,idleSpeed:e.idleSpeedMod?1e3*e.idleSpeedMod:1e3,respawn:e.respawnMod?6e4*e.respawnMod:6e4,dropRate:e.dropRate||1,spawnChance:e.spawnChance||50,dropBonus:e.dropBonus||0,drops:e.drops||null,spriteName:e.spriteName},n.Kinds[e.kind]=n.Properties[t.toLowerCase()]}),n}),define("text!data/../../shared/data/npcs.json",function(){return'[\n  {\n    "uid": "default",\n    "index": 0\n  },\n  {\n    "uid": "agent",\n    "name": "Auction",\n    "index": 1\n  },\n  {\n    "uid": "ancientmanumentnpc",\n    "index": 2\n  },\n  {\n    "uid": "angelnpc",\n    "index": 3\n  },\n  {\n    "uid": "beachnpc",\n    "name": "Beachgoer",\n    "index": 4\n  },\n  {\n    "uid": "bluebikinigirlnpc",\n    "index": 5\n  },\n  {\n    "uid": "bluestoremannpc",\n    "name": "Bank",\n    "index": 6\n  },\n  {\n    "uid": "boxingman",\n    "name": "Bank",\n    "index": 7\n  },\n  {\n    "uid": "coder",\n    "name": "Looks",\n    "index": 8\n  },\n  {\n    "uid": "desertnpc",\n    "name": "Repair",\n    "index": 9\n  },\n  {\n    "uid": "doctor",\n    "name": "Looks",\n    "index": 10\n  },\n  {\n    "uid": "elfnpc",\n    "index": 11\n  },\n  {\n    "uid": "fairynpc",\n    "index": 12\n  },\n  {\n    "uid": "firstsonangelnpc",\n    "index": 13\n  },\n  {\n    "uid": "fisherman",\n    "index": 14\n  },\n  {\n    "uid": "forestnpc",\n    "index": 15\n  },\n  {\n    "uid": "guard",\n    "index": 16\n  },\n  {\n    "uid": "iamverycoldnpc",\n    "index": 17\n  },\n  {\n    "uid": "iceelfnpc",\n    "index": 18\n  },\n  {\n    "uid": "king",\n    "index": 19\n  },\n  {\n    "uid": "lavanpc",\n    "name": "Dying Man",\n    "index": 20\n  },\n  {\n    "uid": "mermaidnpc",\n    "name": "Mermaid",\n    "index": 21\n  },\n  {\n    "uid": "mojojojonpc",\n    "index": 22\n  },\n  {\n    "uid": "momangelnpc",\n    "index": 23\n  },\n  {\n    "uid": "nyan",\n    "index": 24\n  },\n  {\n    "uid": "octocat",\n    "index": 25\n  },\n  {\n    "uid": "octopus",\n    "index": 26\n  },\n  {\n    "uid": "oddeyecat",\n    "index": 27\n  },\n  {\n    "uid": "pirategirlnpc",\n    "index": 28\n  },\n  {\n    "uid": "priest",\n    "index": 29\n  },\n  {\n    "uid": "redbikinigirlnpc",\n    "index": 30\n  },\n  {\n    "uid": "redstoremannpc",\n    "name": "Craft",\n    "index": 31\n  },\n  {\n    "uid": "rick",\n    "name": "Collect",\n    "index": 32\n  },\n  {\n    "uid": "scientist",\n    "index": 33\n  },\n  {\n    "uid": "secondsonangelnpc",\n    "index": 34\n  },\n  {\n    "uid": "shepherdboy",\n    "name": "Shop",\n    "index": 35\n  },\n  {\n    "uid": "snowshepherdboy",\n    "name": "Beginner shop",\n    "index": 36\n  },\n  {\n    "uid": "soldier",\n    "index": 37\n  },\n  {\n    "uid": "sorcerer",\n    "index": 38\n  },\n  {\n    "uid": "sponge",\n    "index": 39\n  },\n  {\n    "uid": "superiorangelnpc",\n    "index": 40\n  },\n  {\n    "uid": "vampire",\n    "index": 41\n  },\n  {\n    "uid": "vendingmachine",\n    "name": "Enchant",\n    "index": 42\n  },\n  {\n    "uid": "villagegirl",\n    "name": "Enchant",\n    "index": 43\n  },\n  {\n    "uid": "villager",\n    "name": "Craft",\n    "index": 44\n  },\n  {\n    "uid": "zombiegf",\n    "name": "Craft",\n    "index": 45\n  }\n]\n'}),define("text!data/../../shared/data/npc_english.json",function(){return'{\r\n  "0": {"type": 0, "text": "Kill %count Monsters Level %level or more"},\r\n  "1": {"type": 2, "text": "%names! Kill %count of em"},\r\n  "2": {"type": 2, "text": "I am dying kill %count of %names"},\r\n  "3": {"type": 2, "text": "%names have destroyed my home kill %count"},\r\n  "4": {"type": 2, "text": "%names have swarmed us kill %count"},\r\n  "5": {"type": 2, "text": "We\'ve been overtaken by %names kill %count"},\r\n  "6": {"type": 2, "text": "Kill %count %names for fun, there evil."},\r\n  "7": {"type": 1, "text": "Get %count %name. Return them to Collect in town."},\r\n  "8": {"type": 4, "text": "Find %name. We playing hide and seek!"}\r\n}\r\n'}),define("data/npcdata",["text!../../shared/data/npcs.json","text!../../shared/data/npc_english.json"],function(t,e){var n={};return n.npcSpeak=JSON.parse(e),n.Properties={},n.Kinds=JSON.parse(t),n.Kinds.forEach(function(t,e){t.title=t.name||t.uid,n.Properties[t.uid]=t}),n.isNpc=function(t){return!!n.Kinds[t]},n}),define("entity/character",["./entitymoving","../transition","../timer","data/mobdata","data/npcdata"],function(t,e,r,i,n){var a=t.extend({init:function(t,e,n,i){this._super(t,e,n,i),this.orientation=Types.Orientations.DOWN,this.atkSpeed=70,this.setAttackRate(70),this.target=null,this.unconfirmedTarget=null,this.stats={},this.stats.hp=0,this.stats.hpMax=0,this.stats.ep=0,this.stats.epMax=0,this.isDying=!1,this.isDead=!1,this.attackingMode=!1,this.followingMode=!1,this.inspecting=null,this.isStunned=!1,this.isAttacking=!1,this.isReadyToMove=!0,this.updateCharacter=!1,this.requestMove=!1,this.freeze=!1,this.flagAttacking=!1,this.observeTimer=new r(4096),this.sprite=[],this.attackers={}},resetHP:function(){var t=this.stats.hpMax;this.stats.hp=t},resetEP:function(){var t=this.stats.epMax;this.stats.ep=t},setHP:function(t){t=t||this.stats.hpMax,this.stats.hp=t},setEP:function(t){t=t||this.stats.epMax,this.stats.ep=t},setMaxHP:function(t){this.stats.hpMax=t,this.stats.hp=t},setMaxEP:function(t){this.stats.epMax=t,this.stats.ep=t},setAttackRange:function(t){this.attackRange=t},hit:function(t){var e=this;this.setOrientation(t||this.orientation),this.fsm="ATTACK",this.animate("atk",this.atkSpeed,1,function(){e.fsm="IDLE",e.idle(e.orientation)})},engage:function(t){this.attackingMode=!0,this.setTarget(t)},disengage:function(){this.attackingMode=!1,this.followingMode=!1,this.removeTarget()},isAttacking:function(){return this.attackingMode},isAttackedBy:function(t){return 0!=Object.keys(this.attackers).length&&this.attackers.hasOwnProperty(t.id)&&this.attackers[t.id]===t},isAttacked:function(){return!(0==Object.keys(this.attackers).length)},addAttacker:function(t){this.isAttackedBy(t)||(this.attackers[t.id]=t)},removeAttacker:function(t){this.isAttacked()&&delete this.attackers[t.id]},removeAttackers:function(){this.attackers={}},clearAttackerRefs:function(){var e=this;this.forEachAttacker(function(t){t.removeAttacker(e)})},forEachAttacker:function(e){_.each(this.attackers,function(t){e(t)})},waitToAttack:function(t){this.unconfirmedTarget=t},isWaitingToAttack:function(t){return this.unconfirmedTarget===t},canAttack:function(t){return!(0!=this.isDead||!this.attackCooldown.isOver(t))},setAttackRate:function(t){this.attackCooldown=new r(t)},setTarget:function(t){var e;null==t||t.isDying||t.isDead?this.removeTarget():this.target!==t?(this.hasTarget()&&this.removeTarget(),this.target=t,this.settarget_callback&&(e=this.target.spriteName,i.Kinds[t.kind])&&e&&this.settarget_callback(t,e,t.level)):log.debug(t.id+" is already the target of "+this.id)},onSetTarget:function(t){this.settarget_callback=t},showTarget:function(t){var e,n;this.inspecting!==t&&t!==this&&(this.inspecting=t,this.settarget_callback)&&this.target&&((n=i.Kinds[t.kind])?e=n.spriteName||n.key:isItem(t.id)&&(e=ItemTypes.getKindAsString(t.kind)),this.settarget_callback(t,e,t.level,!0))},removeTarget:function(){this.target&&(this.target instanceof a&&this.target.removeAttacker(this),this.removetarget_callback&&this.removetarget_callback(this.target.id),this.target=null)},onRemoveTarget:function(t){this.removetarget_callback=t},hasTarget:function(){return!(null===this.target)},canReachTarget:function(){return this.canReach(this.target)},canInteract:function(t){return this.isInReach(t.x,t.y)},canReach:function(t){G_TILESIZE;return 1===this.attackRange?this.isInReach(t.x,t.y,this.orientation):1<this.attackRange&&~~(Utils.realDistance([t.x,t.y],[this.x,this.y])/G_TILESIZE)<=this.attackRange},clearTarget:function(){this.target=null},lookAtEntity:function(t){this._lookAtEntity(t)},_lookAtEntity:function(t){return log.info("lookAtEntity"),t&&(log.info("lookAtEntity "+t.id),this.orientation=this.getOrientationTo([t.x,t.y]),log.info("this.orientation="+this.orientation)),this.hasAnimation("atk")||this.idle(this.orientation),this.orientation},onDeath:function(t){this.death_callback=t},hasWeapon:function(){return!1},dead:function(){this.isDead=!0,this.isDying=!1,this.forceStop(),this.freeze=!0},die:function(){this.forceStop(),this.removeTarget(),this.isDying=!0,this.freeze=!0,clearTimeout(this.moveTimeout),this.death_callback&&this.death_callback()},hurt:function(){this.stopHurting(),this.sprite=this.hurtSprite,this.hurting=setTimeout(this.stopHurting.bind(this),75)},stopHurting:function(){this.sprite=this.normalSprite,clearTimeout(this.hurting)},followAttack:function(t){t=this.getClosestSpot(t,1,this.attackRange);t&&t.x&&t.y&&this.moveTo_(t.x,t.y)},clean:function(){},canObserve:function(t){return!!this.observeTimer.isOver(t)}});return a}),define("entity/mob",["./character","data/mobdata"],function(t,s){return t.extend({init:function(t,e,n,i,r,a){this._super(t,e,n,i),this.data=s.Kinds[this.kind],this.idleSpeed=randomInt(~~(2*this.data.idleSpeed/3),~~(4*this.data.idleSpeed/3)),this.level=a||this.data.level,this.title=this.data.name,this.stats.attack=this.data.attack*this.level,this.stats.defense=this.data.defense*this.level,this.stats.hp=this.data.hp*this.level,this.stats.hpMax=this.data.hp*this.level,this.stats.xp=this.data.xp*this.level,this.hatelist=[],this.hateCount=0,this.tankerlist=[],this.respawnTimeout=null,this.returnTimeout=null,this.isDead=!1,this.aggroRange=this.data.aggroRange,this.attackRange=this.data.attackRange,this.isAggressive=this.data.isAggressive,this.moveSpeed=this.data.moveSpeed,this.setMoveRate(this.moveSpeed),this.setAttackRate(this.data.attackRate)},getSpriteName:function(){return log.info("spriteName="+s.Kinds[this.kind].spriteName),s.Kinds[this.kind].spriteName}})}),ItemRoom.toArray=function(){return[parseInt(this.slot),this.itemKind,this.itemNumber,this.itemDurability,this.itemDurabilityMax,this.itemExperience]},ItemRoom.toString=function(){return this.toArray().join(",")},define("entity/item",["./entity"],function(t){t=t.extend({init:function(t,e,n,i){this._super(t,e,n,i),this.kind=i,this.type=e,this.wasDropped=!1,this.count=1},getItemSpriteName:function(){return""!==ItemTypes.KindData[this.kind].sprite?(log.info("item-"+ItemTypes.KindData[this.kind].sprite),"item-"+ItemTypes.KindData[this.kind].sprite):null},getInfoMsg:function(){return this.getInfoMsgEx(this)},getInfoMsgEx:function(t){return ItemTypes.isEquipment(t.itemKind)?ItemTypes.getName(t.itemKind)+": Lv "+ItemTypes.getLevelByKind(t.itemKind)+(t.itemNumber?"+"+t.itemNumber+" ":" ")+t.itemDurability/10+"/"+t.itemDurabilityMax/10:ItemTypes.getName(t.itemKind)||""},getState:function(){this._getBaseState().concat([this.count])}});return t.getInfoMsgEx=t.prototype.getInfoMsgEx,t}),!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("lib/pako",[],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=t()}(function(){return function i(r,a,s){function o(n,t){if(!a[n]){if(!r[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(l)return l(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}e=a[n]={exports:{}};r[n][0].call(e.exports,function(t){var e=r[n][1][t];return o(e||t)},e,e.exports,i,r,a,s)}return a[n].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)o(s[t]);return o}({1:[function(t,e,n){"use strict";var s=t("./zlib/deflate"),o=t("./utils/common"),l=t("./utils/strings"),i=t("./zlib/messages"),r=t("./zlib/zstream"),c=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});t=this.options;if(t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,(this.strm.avail_out=0)!==(e=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy)))throw new Error(i[e]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){var e,t="string"==typeof t.dictionary?l.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary;if(0!==(e=s.deflateSetDictionary(this.strm,t)))throw new Error(i[e]);this._dict_set=!0}}function h(t,e){e=new a(e);if(e.push(t,!0),e.err)throw e.msg||i[e.err];return e.result}a.prototype.push=function(t,e){var n,i,r=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=l.string2buf(t):"[object ArrayBuffer]"===c.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new o.Buf8(a),r.next_out=0,r.avail_out=a),1!==(n=s.deflate(r,i))&&0!==n)return this.onEnd(n),!(this.ended=!0)}while(0!==r.avail_out&&(0!==r.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(o.shrinkBuf(r.output,r.next_out))):this.onData(o.shrinkBuf(r.output,r.next_out))),(0<r.avail_in||0===r.avail_out)&&1!==n);return 4===i?(n=s.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),!(r.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=a,n.deflate=h,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,h(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,h(t,e)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,n){"use strict";var u=t("./zlib/inflate"),d=t("./utils/common"),p=t("./utils/strings"),f=t("./zlib/constants"),i=t("./zlib/messages"),r=t("./zlib/zstream"),a=t("./zlib/gzheader"),m=Object.prototype.toString;function s(t){if(!(this instanceof s))return new s(t);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options,t=(e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits)&&(e.windowBits=-15),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0,u.inflateInit2(this.strm,e.windowBits));if(t!==f.Z_OK)throw new Error(i[t]);this.header=new a,u.inflateGetHeader(this.strm,this.header)}function o(t,e){e=new s(e);if(e.push(t,!0),e.err)throw e.msg||i[e.err];return e.result}s.prototype.push=function(t,e){var n,i,r,a,s,o=this.strm,l=this.options.chunkSize,c=this.options.dictionary,h=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof t?o.input=p.binstring2buf(t):"[object ArrayBuffer]"===m.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new d.Buf8(l),o.next_out=0,o.avail_out=l),(n=u.inflate(o,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&c&&(s="string"==typeof c?p.string2buf(c):"[object ArrayBuffer]"===m.call(c)?new Uint8Array(c):c,n=u.inflateSetDictionary(this.strm,s)),n===f.Z_BUF_ERROR&&!0===h&&(n=f.Z_OK,h=!1),n!==f.Z_STREAM_END&&n!==f.Z_OK)return this.onEnd(n),!(this.ended=!0)}while(!o.next_out||0!==o.avail_out&&n!==f.Z_STREAM_END&&(0!==o.avail_in||i!==f.Z_FINISH&&i!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(s=p.utf8border(o.output,o.next_out),r=o.next_out-s,a=p.buf2string(o.output,s),o.next_out=r,o.avail_out=l-r,r&&d.arraySet(o.output,o.output,s,r,0),this.onData(a)):this.onData(d.shrinkBuf(o.output,o.next_out))),0===o.avail_in&&0===o.avail_out&&(h=!0),(0<o.avail_in||0===o.avail_out)&&n!==f.Z_STREAM_END);return(i=n===f.Z_STREAM_END?f.Z_FINISH:i)===f.Z_FINISH?(n=u.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===f.Z_OK):i!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(o.avail_out=0))},s.prototype.onData=function(t){this.chunks.push(t)},s.prototype.onEnd=function(t){t===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=s,n.inflate=o,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,o(t,e)},n.ungzip=o},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,r=(n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){if(t.length!==e){if(t.subarray)return t.subarray(0,e);t.length=e}return t},{arraySet:function(t,e,n,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+i),r);else for(var a=0;a<i;a++)t[r+a]=e[n+a]},flattenChunks:function(t){for(var e,n,i,r=0,a=0,s=t.length;a<s;a++)r+=t[a].length;for(i=new Uint8Array(r),a=e=0,s=t.length;a<s;a++)n=t[a],i.set(n,e),e+=n.length;return i}}),a={arraySet:function(t,e,n,i,r){for(var a=0;a<i;a++)t[r+a]=e[n+a]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(i)},{}],4:[function(t,e,n){var l=t("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var c=new l.Buf8(256),i=0;i<256;i++)c[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function h(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,l.shrinkBuf(t,e));for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n}c[254]=c[254]=1,n.string2buf=function(t){for(var e,n,i,r,a=t.length,s=0,o=0;o<a;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),s+=n<128?1:n<2048?2:n<65536?3:4;for(e=new l.Buf8(s),o=r=0;r<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[r++]=n:(n<2048?e[r++]=192|n>>>6:(n<65536?e[r++]=224|n>>>12:(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63),e[r++]=128|n>>>6&63),e[r++]=128|63&n);return e},n.buf2binstring=function(t){return h(t,t.length)},n.binstring2buf=function(t){for(var e=new l.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){for(var n,i,r=e||t.length,a=new Array(2*r),s=0,o=0;o<r;)if((n=t[o++])<128)a[s++]=n;else if(4<(i=c[n]))a[s++]=65533,o+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&o<r;)n=n<<6|63&t[o++],i--;1<i?a[s++]=65533:n<65536?a[s++]=n:(n-=65536,a[s++]=55296|n>>10&1023,a[s++]=56320|1023&n)}return h(a,s)},n.utf8border=function(t,e){for(var n=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=n&&128==(192&t[n]);)n--;return!(n<0)&&0!==n&&n+c[t[n]]>e?n:e}},{"./common":3}],5:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;a=a+(r=r+e[i++]|0)|0,--s;);r%=65521,a%=65521}return r|a<<16|0}},{}],6:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,n){"use strict";var o=function(){for(var t=[],e=0;e<256;e++){for(var n=e,i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t}();e.exports=function(t,e,n,i){var r=o,a=i+n;t^=-1;for(var s=i;s<a;s++)t=t>>>8^r[255&(t^e[s])];return-1^t}},{}],8:[function(t,$,e){"use strict";var o,u=t("../utils/common"),l=t("./trees"),d=t("./adler32"),p=t("./crc32"),B=t("./messages"),c=0,h=4,f=0,m=-2,R=-1,j=4,H=2,g=8,F=9,n=286,q=30,z=19,K=2*n+1,U=15,y=3,v=258,b=v+y+1,k=42,w=113,x=1,S=2,T=3,_=4;function I(t,e){return t.msg=B[e],e}function E(t){return(t<<1)-(4<t?9:0)}function C(t){for(var e=t.length;0<=--e;)t[e]=0}function A(t){var e=t.state,n=e.pending;0!==(n=n>t.avail_out?t.avail_out:n)&&(u.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending)&&(e.pending_out=0)}function M(t,e){l._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,A(t.strm)}function D(t,e){t.pending_buf[t.pending++]=e}function N(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function a(t,e){var n,i,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-b?t.strstart-(t.w_size-b):0,c=t.window,h=t.w_mask,u=t.prev,d=t.strstart+v,p=c[a+s-1],f=c[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(c[(n=e)+s]===f&&c[n+s-1]===p&&c[n]===c[a]&&c[++n]===c[a+1]){for(a+=2,n++;c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d;);if(i=v-(d-a),a=d-v,s<i){if(t.match_start=e,o<=(s=i))break;p=c[a+s-1],f=c[a+s]}}}while((e=u[e&h])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function O(t){var e,n,i,r,a,s,o,l,c,h=t.w_size;do{if(l=t.window_size-t.lookahead-t.strstart,t.strstart>=h+(h-b)){for(u.arraySet(t.window,t.window,h,h,0),t.match_start-=h,t.strstart-=h,t.block_start-=h,e=n=t.hash_size;i=t.head[--e],t.head[e]=h<=i?i-h:0,--n;);for(e=n=h;i=t.prev[--e],t.prev[e]=h<=i?i-h:0,--n;);l+=h}if(0===t.strm.avail_in)break;if(a=t.strm,s=t.window,o=t.strstart+t.lookahead,l=l,c=void 0,c=a.avail_in,n=0===(c=l<c?l:c)?0:(a.avail_in-=c,u.arraySet(s,a.input,a.next_in,c,o),1===a.state.wrap?a.adler=d(a.adler,s,c,o):2===a.state.wrap&&(a.adler=p(a.adler,s,c,o)),a.next_in+=c,a.total_in+=c,c),t.lookahead+=n,t.lookahead+t.insert>=y)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+y-1])&t.hash_mask,t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<y)););}while(t.lookahead<b&&0!==t.strm.avail_in)}function i(t,e){for(var n,i;;){if(t.lookahead<b){if(O(t),t.lookahead<b&&e===c)return x;if(0===t.lookahead)break}if(n=0,t.lookahead>=y&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+y-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-b&&(t.match_length=a(t,n)),t.match_length>=y)if(i=l._tr_tally(t,t.strstart-t.match_start,t.match_length-y),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=y){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+y-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(M(t,!1),0===t.strm.avail_out))return x}return t.insert=t.strstart<y-1?t.strstart:y-1,e===h?(M(t,!0),0===t.strm.avail_out?T:_):t.last_lit&&(M(t,!1),0===t.strm.avail_out)?x:S}function r(t,e){for(var n,i,r;;){if(t.lookahead<b){if(O(t),t.lookahead<b&&e===c)return x;if(0===t.lookahead)break}if(n=0,t.lookahead>=y&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+y-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=y-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-b&&(t.match_length=a(t,n),t.match_length<=5)&&(1===t.strategy||t.match_length===y&&4096<t.strstart-t.match_start)&&(t.match_length=y-1),t.prev_length>=y&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-y,i=l._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-y),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+y-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=y-1,t.strstart++,i&&(M(t,!1),0===t.strm.avail_out))return x}else if(t.match_available){if((i=l._tr_tally(t,0,t.window[t.strstart-1]))&&M(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return x}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=l._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<y-1?t.strstart:y-1,e===h?(M(t,!0),0===t.strm.avail_out?T:_):t.last_lit&&(M(t,!1),0===t.strm.avail_out)?x:S}function s(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*K),this.dyn_dtree=new u.Buf16(2*(2*q+1)),this.bl_tree=new u.Buf16(2*(2*z+1)),C(this.dyn_ltree),C(this.dyn_dtree),C(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(U+1),this.heap=new u.Buf16(2*n+1),C(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*n+1),C(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=H,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?k:w,t.adler=2===e.wrap?0:1,e.last_flush=c,l._tr_init(e),f):I(t,m)}function L(t){var e=P(t);return e===f&&((t=t.state).window_size=2*t.w_size,C(t.head),t.max_lazy_match=o[t.level].max_lazy,t.good_match=o[t.level].good_length,t.nice_match=o[t.level].nice_length,t.max_chain_length=o[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=y-1,t.match_available=0,t.ins_h=0),e}function W(t,e,n,i,r,a){if(!t)return m;var s=1;if(e===R&&(e=6),i<0?(s=0,i=-i):15<i&&(s=2,i-=16),r<1||F<r||n!==g||i<8||15<i||e<0||9<e||a<0||j<a)return I(t,m);8===i&&(i=9);var o=new G;return(t.state=o).strm=t,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+y-1)/y),o.window=new u.Buf8(2*o.w_size),o.head=new u.Buf16(o.hash_size),o.prev=new u.Buf16(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new u.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=a,o.method=n,L(t)}o=[new s(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(O(t),0===t.lookahead&&e===c)return x;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,M(t,!1),0===t.strm.avail_out))return x;if(t.strstart-t.block_start>=t.w_size-b&&(M(t,!1),0===t.strm.avail_out))return x}return t.insert=0,e===h?(M(t,!0),0===t.strm.avail_out?T:_):(t.strstart>t.block_start&&(M(t,!1),t.strm.avail_out),x)}),new s(4,4,8,4,i),new s(4,5,16,8,i),new s(4,6,32,32,i),new s(4,4,16,16,r),new s(8,16,32,32,r),new s(8,16,128,128,r),new s(8,32,128,256,r),new s(32,128,258,1024,r),new s(32,258,258,4096,r)],e.deflateInit=function(t,e){return W(t,e,g,15,8,0)},e.deflateInit2=W,e.deflateReset=L,e.deflateResetKeep=P,e.deflateSetHeader=function(t,e){return!t||!t.state||2!==t.state.wrap?m:(t.state.gzhead=e,f)},e.deflate=function(t,e){var n,i,r,a;if(!t||!t.state||5<e||e<0)return t?I(t,m):m;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&e!==h)return I(t,0===t.avail_out?-5:m);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===k&&(2===i.wrap?(t.adler=0,D(i,31),D(i,139),D(i,8),i.gzhead?(D(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),D(i,255&i.gzhead.time),D(i,i.gzhead.time>>8&255),D(i,i.gzhead.time>>16&255),D(i,i.gzhead.time>>24&255),D(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),D(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(D(i,255&i.gzhead.extra.length),D(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=p(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(D(i,0),D(i,0),D(i,0),D(i,0),D(i,0),D(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),D(i,3),i.status=w)):(s=g+(i.w_bits-8<<4)<<8,s|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(s|=32),s+=31-s%31,i.status=w,N(i,s),0!==i.strstart&&(N(i,t.adler>>>16),N(i,65535&t.adler)),t.adler=1)),69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),A(t),r=i.pending,i.pending!==i.pending_buf_size));)D(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),A(t),r=i.pending,i.pending===i.pending_buf_size)){a=1;break}}while(a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,D(i,a),0!==a);i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),0===a&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),A(t),r=i.pending,i.pending===i.pending_buf_size)){a=1;break}}while(a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,D(i,a),0!==a);i.gzhead.hcrc&&i.pending>r&&(t.adler=p(t.adler,i.pending_buf,i.pending-r,r)),0===a&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&A(t),i.pending+2<=i.pending_buf_size&&(D(i,255&t.adler),D(i,t.adler>>8&255),t.adler=0,i.status=w)):i.status=w),0!==i.pending){if(A(t),0===t.avail_out)return i.last_flush=-1,f}else if(0===t.avail_in&&E(e)<=E(n)&&e!==h)return I(t,-5);if(666===i.status&&0!==t.avail_in)return I(t,-5);if(0!==t.avail_in||0!==i.lookahead||e!==c&&666!==i.status){var s=2===i.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(O(t),0===t.lookahead)){if(e===c)return x;break}if(t.match_length=0,n=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(M(t,!1),0===t.strm.avail_out))return x}return t.insert=0,e===h?(M(t,!0),0===t.strm.avail_out?T:_):t.last_lit&&(M(t,!1),0===t.strm.avail_out)?x:S}(i,e):3===i.strategy?function(t,e){for(var n,i,r,a,s=t.window;;){if(t.lookahead<=v){if(O(t),t.lookahead<=v&&e===c)return x;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=y&&0<t.strstart&&(i=s[r=t.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){for(a=t.strstart+v;i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a;);t.match_length=v-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=y?(n=l._tr_tally(t,1,t.match_length-y),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(M(t,!1),0===t.strm.avail_out))return x}return t.insert=0,e===h?(M(t,!0),0===t.strm.avail_out?T:_):t.last_lit&&(M(t,!1),0===t.strm.avail_out)?x:S}(i,e):o[i.level].func(i,e);if(s!==T&&s!==_||(i.status=666),s===x||s===T)return 0===t.avail_out&&(i.last_flush=-1),f;if(s===S&&(1===e?l._tr_align(i):5!==e&&(l._tr_stored_block(i,0,0,!1),3===e)&&(C(i.head),0===i.lookahead)&&(i.strstart=0,i.block_start=0,i.insert=0),A(t),0===t.avail_out))return i.last_flush=-1,f}return e!==h||!(i.wrap<=0)&&(2===i.wrap?(D(i,255&t.adler),D(i,t.adler>>8&255),D(i,t.adler>>16&255),D(i,t.adler>>24&255),D(i,255&t.total_in),D(i,t.total_in>>8&255),D(i,t.total_in>>16&255),D(i,t.total_in>>24&255)):(N(i,t.adler>>>16),N(i,65535&t.adler)),A(t),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending)?f:1},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==k&&69!==e&&73!==e&&91!==e&&103!==e&&e!==w&&666!==e?I(t,m):(t.state=null,e===w?I(t,-3):f):m},e.deflateSetDictionary=function(t,e){var n,i,r,a,s,o,l,c=e.length;if(!t||!t.state)return m;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==k||n.lookahead)return m;for(1===a&&(t.adler=d(t.adler,e,c,0)),n.wrap=0,c>=n.w_size&&(0===a&&(C(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new u.Buf8(n.w_size),u.arraySet(l,e,c-n.w_size,n.w_size,0),e=l,c=n.w_size),l=t.avail_in,s=t.next_in,o=t.input,t.avail_in=c,t.next_in=0,t.input=e,O(n);n.lookahead>=y;){for(i=n.strstart,r=n.lookahead-(y-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+y-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--r;);n.strstart=i,n.lookahead=y-1,O(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=y-1,n.match_available=0,t.next_in=s,t.input=o,t.avail_in=l,n.wrap=a,f},e.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(t,e,n){"use strict";e.exports=function(t,e){var n,i,r,a,s,o,l=t.state,c=t.next_in,h=t.input,u=c+(t.avail_in-5),d=t.next_out,p=t.output,f=d-(e-t.avail_out),m=d+(t.avail_out-257),g=l.dmax,y=l.wsize,v=l.whave,b=l.wnext,k=l.window,w=l.hold,x=l.bits,S=l.lencode,T=l.distcode,_=(1<<l.lenbits)-1,I=(1<<l.distbits)-1;t:do{for(x<15&&(w+=h[c++]<<x,x+=8,w+=h[c++]<<x,x+=8),n=S[w&_];;){if(w>>>=i=n>>>24,x-=i,0===(i=n>>>16&255))p[d++]=65535&n;else{if(!(16&i)){if(0==(64&i)){n=S[(65535&n)+(w&(1<<i)-1)];continue}if(32&i){l.mode=12;break t}t.msg="invalid literal/length code",l.mode=30;break t}for(r=65535&n,(i&=15)&&(x<i&&(w+=h[c++]<<x,x+=8),r+=w&(1<<i)-1,w>>>=i,x-=i),x<15&&(w+=h[c++]<<x,x+=8,w+=h[c++]<<x,x+=8),n=T[w&I];;){if(w>>>=i=n>>>24,x-=i,!(16&(i=n>>>16&255))){if(0==(64&i)){n=T[(65535&n)+(w&(1<<i)-1)];continue}t.msg="invalid distance code",l.mode=30;break t}if(a=65535&n,x<(i&=15)&&(w+=h[c++]<<x,(x+=8)<i)&&(w+=h[c++]<<x,x+=8),g<(a+=w&(1<<i)-1)){t.msg="invalid distance too far back",l.mode=30;break t}if(w>>>=i,x-=i,(i=d-f)<a){if(v<(i=a-i)&&l.sane){t.msg="invalid distance too far back",l.mode=30;break t}if(o=k,(s=0)===b){if(s+=y-i,i<r){for(r-=i;p[d++]=k[s++],--i;);s=d-a,o=p}}else if(b<i){if(s+=y+b-i,(i-=b)<r){for(r-=i;p[d++]=k[s++],--i;);if(s=0,b<r){for(r-=i=b;p[d++]=k[s++],--i;);s=d-a,o=p}}}else if(s+=b-i,i<r){for(r-=i;p[d++]=k[s++],--i;);s=d-a,o=p}for(;2<r;)p[d++]=o[s++],p[d++]=o[s++],p[d++]=o[s++],r-=3;r&&(p[d++]=o[s++],1<r)&&(p[d++]=o[s++])}else{for(s=d-a;p[d++]=p[s++],p[d++]=p[s++],p[d++]=p[s++],2<(r-=3););r&&(p[d++]=p[s++],1<r)&&(p[d++]=p[s++])}break}}break}}while(c<u&&d<m);w&=(1<<(x-=(r=x>>3)<<3))-1,t.next_in=c-=r,t.next_out=d,t.avail_in=c<u?u-c+5:5-(c-u),t.avail_out=d<m?m-d+257:257-(d-m),l.hold=w,l.bits=x}},{}],11:[function(t,e,n){"use strict";var D=t("../utils/common"),N=t("./adler32"),O=t("./crc32"),P=t("./inffast"),L=t("./inftrees"),$=1,B=2,R=0,j=-2,H=1,i=852,r=592;function F(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new D.Buf16(320),this.work=new D.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=H,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new D.Buf32(i),e.distcode=e.distdyn=new D.Buf32(r),e.sane=1,e.back=-1,R):j}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,s(t)):j}function l(t,e){var n,i;return!t||!t.state||(i=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e))?j:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,o(t))}function c(t,e){var n;return t?(n=new a,(t.state=n).window=null,(n=l(t,e))!==R&&(t.state=null),n):j}var q,z,K=!0;function U(t,e,n,i){var r,t=t.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new D.Buf8(t.wsize)),i>=t.wsize?(D.arraySet(t.window,e,n-t.wsize,t.wsize,0),t.wnext=0,t.whave=t.wsize):(i<(r=t.wsize-t.wnext)&&(r=i),D.arraySet(t.window,e,n-i,r,t.wnext),(i-=r)?(D.arraySet(t.window,e,n-i,i,0),t.wnext=i,t.whave=t.wsize):(t.wnext+=r,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=r))),0}n.inflateReset=o,n.inflateReset2=l,n.inflateResetKeep=s,n.inflateInit=function(t){return c(t,15)},n.inflateInit2=c,n.inflate=function(t,e){var n,i,r,a,s,o,l,c,h,u,d,p,f,m,g,y,v,b,k,w,x,S,T,_,I=0,E=new D.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return j;12===(n=t.state).mode&&(n.mode=13),s=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,c=n.hold,h=n.bits,u=o,d=l,S=R;t:for(;;)switch(n.mode){case H:if(0===n.wrap)n.mode=13;else{for(;h<16;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(2&n.wrap&&35615===c)E[n.check=0]=255&c,E[1]=c>>>8&255,n.check=O(n.check,E,2,0),h=c=0,n.mode=2;else if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31)t.msg="incorrect header check",n.mode=30;else if(8!=(15&c))t.msg="unknown compression method",n.mode=30;else{if(h-=4,x=8+(15&(c>>>=4)),0===n.wbits)n.wbits=x;else if(x>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<x,t.adler=n.check=1,n.mode=512&c?10:12,h=c=0}}break;case 2:for(;h<16;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(n.flags=c,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=O(n.check,E,2,0)),h=c=0,n.mode=3;case 3:for(;h<32;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.head&&(n.head.time=c),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,n.check=O(n.check,E,4,0)),h=c=0,n.mode=4;case 4:for(;h<16;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=O(n.check,E,2,0)),h=c=0,n.mode=5;case 5:if(1024&n.flags){for(;h<16;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=O(n.check,E,2,0)),h=c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=o<(p=n.length)?o:p)&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),D.arraySet(n.head.extra,i,a,p,x)),512&n.flags&&(n.check=O(n.check,i,p,a)),o-=p,a+=p,n.length-=p),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===o)break t;for(p=0;x=i[a+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x)),x&&p<o;);if(512&n.flags&&(n.check=O(n.check,i,p,a)),o-=p,a+=p,x)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===o)break t;for(p=0;x=i[a+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x)),x&&p<o;);if(512&n.flags&&(n.check=O(n.check,i,p,a)),o-=p,a+=p,x)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;h<16;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(c!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}h=c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;h<32;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}t.adler=n.check=F(c),h=c=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=c,n.bits=h,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last)c>>>=7&h,h-=7&h,n.mode=27;else{for(;h<3;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}switch(n.last=1&c,--h,3&(c>>>=1)){case 0:n.mode=14;break;case 1:A=M=void 0;var A,M=n;if(K){for(q=new D.Buf32(512),z=new D.Buf32(32),A=0;A<144;)M.lens[A++]=8;for(;A<256;)M.lens[A++]=9;for(;A<280;)M.lens[A++]=7;for(;A<288;)M.lens[A++]=8;for(L($,M.lens,0,288,q,0,M.work,{bits:9}),A=0;A<32;)M.lens[A++]=5;L(B,M.lens,0,32,z,0,M.work,{bits:5}),K=!1}if(M.lencode=q,M.lenbits=9,M.distcode=z,M.distbits=5,n.mode=20,6!==e)break;c>>>=2,h-=2;break t;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}c>>>=2,h-=2}break;case 14:for(c>>>=7&h,h-=7&h;h<32;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&c,h=c=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(p=n.length){if(0===(p=l<(p=o<p?o:p)?l:p))break t;D.arraySet(r,i,a,p,s),o-=p,a+=p,l-=p,s+=p,n.length-=p}else n.mode=12;break;case 17:for(;h<14;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(n.nlen=257+(31&c),c>>>=5,h-=5,n.ndist=1+(31&c),c>>>=5,h-=5,n.ncode=4+(15&c),c>>>=4,h-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;h<3;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.lens[C[n.have++]]=7&c,c>>>=3,h-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},S=L(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,S){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;y=(I=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&I,!((g=I>>>24)<=h);){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(v<16)c>>>=g,h-=g,n.lens[n.have++]=v;else{if(16===v){for(_=g+2;h<_;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(c>>>=g,h-=g,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}x=n.lens[n.have-1],p=3+(3&c),c>>>=2,h-=2}else if(17===v){for(_=g+3;h<_;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}x=0,p=3+(7&(c>>>=g)),c>>>=3,h=h-g-3}else{for(_=g+7;h<_;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}x=0,p=11+(127&(c>>>=g)),c>>>=7,h=h-g-7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;p--;)n.lens[n.have++]=x}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,T={bits:n.lenbits},S=L($,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,S){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},S=L(B,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,S){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(6<=o&&258<=l){t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=c,n.bits=h,P(t,d),s=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,c=n.hold,h=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;y=(I=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&I,!((g=I>>>24)<=h);){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(y&&0==(240&y)){for(b=g,k=y,w=v;y=(I=n.lencode[w+((c&(1<<b+k)-1)>>b)])>>>16&255,v=65535&I,!(b+(g=I>>>24)<=h);){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}c>>>=b,h-=b,n.back+=b}if(c>>>=g,h-=g,n.back+=g,n.length=v,0===y){n.mode=26;break}if(32&y){n.back=-1,n.mode=12;break}if(64&y){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&y,n.mode=22;case 22:if(n.extra){for(_=n.extra;h<_;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;y=(I=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&I,!((g=I>>>24)<=h);){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(0==(240&y)){for(b=g,k=y,w=v;y=(I=n.distcode[w+((c&(1<<b+k)-1)>>b)])>>>16&255,v=65535&I,!(b+(g=I>>>24)<=h);){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}c>>>=b,h-=b,n.back+=b}if(c>>>=g,h-=g,n.back+=g,64&y){t.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&y,n.mode=24;case 24:if(n.extra){for(_=n.extra;h<_;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break t;if(n.offset>(p=d-l)){if((p=n.offset-p)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}f=p>n.wnext?(p-=n.wnext,n.wsize-p):n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=s-n.offset,p=n.length;for(l-=p=l<p?l:p,n.length-=p;r[s++]=m[f++],--p;);0===n.length&&(n.mode=21);break;case 26:if(0===l)break t;r[s++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;h<32;){if(0===o)break t;o--,c|=i[a++]<<h,h+=8}if(d-=l,t.total_out+=d,n.total+=d,d&&(t.adler=n.check=(n.flags?O:N)(n.check,r,d,s-d)),d=l,(n.flags?c:F(c))!==n.check){t.msg="incorrect data check",n.mode=30;break}h=c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;h<32;){if(0===o)break t;o--,c+=i[a++]<<h,h+=8}if(c!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}h=c=0}n.mode=29;case 29:S=1;break t;case 30:S=-3;break t;case 31:return-4;default:return j}return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=c,n.bits=h,(n.wsize||d!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&U(t,t.output,t.next_out,d-t.avail_out)?(n.mode=31,-4):(u-=t.avail_in,d-=t.avail_out,t.total_in+=u,t.total_out+=d,n.total+=d,n.wrap&&d&&(t.adler=n.check=(n.flags?O:N)(n.check,r,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==u&&0===d||4===e)&&S===R?-5:S)},n.inflateEnd=function(t){var e;return t&&t.state?((e=t.state).window&&(e.window=null),t.state=null,R):j},n.inflateGetHeader=function(t,e){return!t||!t.state||0==(2&(t=t.state).wrap)?j:((t.head=e).done=!1,R)},n.inflateSetDictionary=function(t,e){var n,i=e.length;return!t||!t.state||0!==(n=t.state).wrap&&11!==n.mode?j:11===n.mode&&N(1,e,i,0)!==n.check?-3:U(t,e,i,i)?(n.mode=31,-4):(n.havedict=1,R)},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,n){"use strict";var P=t("../utils/common"),L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],$=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],R=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,i,r,a,s,o){for(var l,c,h,u,d,p,f,m,g,y=o.bits,v=0,b=0,k=0,w=0,x=0,S=0,T=0,_=0,I=0,E=0,C=null,A=0,M=new P.Buf16(16),D=new P.Buf16(16),N=null,O=0,v=0;v<=15;v++)M[v]=0;for(b=0;b<i;b++)M[e[n+b]]++;for(x=y,w=15;1<=w&&0===M[w];w--);if(w<x&&(x=w),0===w)r[a++]=20971520,r[a++]=20971520,o.bits=1;else{for(k=1;k<w&&0===M[k];k++);for(x<k&&(x=k),v=_=1;v<=15;v++)if((_=(_<<=1)-M[v])<0)return-1;if(0<_&&(0===t||1!==w))return-1;for(D[1]=0,v=1;v<15;v++)D[v+1]=D[v]+M[v];for(b=0;b<i;b++)0!==e[n+b]&&(s[D[e[n+b]]++]=b);if(p=0===t?(C=N=s,19):1===t?(C=L,A-=257,N=$,O-=257,256):(C=B,N=R,-1),v=k,d=a,T=b=E=0,h=-1,u=(I=1<<(S=x))-1,1===t&&852<I||2===t&&592<I)return 1;for(;;){for(g=s[b]<p?(m=0,s[b]):s[b]>p?(m=N[O+s[b]],C[A+s[b]]):(m=96,0),l=1<<(f=v-T),k=c=1<<S;r[d+(E>>T)+(c-=l)]=f<<24|m<<16|g|0,0!==c;);for(l=1<<v-1;E&l;)l>>=1;if(E=0!==l?(E&l-1)+l:0,b++,0==--M[v]){if(v===w)break;v=e[n+s[b]]}if(x<v&&(E&u)!==h){for(d+=k,_=1<<(S=v-(T=0===T?x:T));S+T<w&&!((_-=M[S+T])<=0);)S++,_<<=1;if(I+=1<<S,1===t&&852<I||2===t&&592<I)return 1;r[h=E&u]=x<<24|S<<16|d-a|0}}0!==E&&(r[d+E]=v-T<<24|64<<16|0),o.bits=x}return 0}},{"../utils/common":3}],13:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(n,a,t){"use strict";var s=n("../utils/common"),h=0,u=1;function e(t){for(var e=t.length;0<=--e;)t[e]=0}var o,l,c,d=29,p=256,f=p+1+d,m=30,g=19,_=2*f+1,I=15,i=16,j=7,y=256,v=16,b=17,k=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=new Array(2*(f+2)),E=(e(T),new Array(2*m)),C=(e(E),new Array(512)),A=(e(C),new Array(256)),M=(e(A),new Array(d)),D=(e(M),new Array(m));function N(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function O(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function P(t){return t<256?C[t]:C[256+(t>>>7)]}function r(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function L(t,e,n){t.bi_valid>i-n?(t.bi_buf|=e<<t.bi_valid&65535,r(t,t.bi_buf),t.bi_buf=e>>i-t.bi_valid,t.bi_valid+=n-i):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function $(t,e,n){L(t,n[2*e],n[2*e+1])}function F(t,e){for(var n=0;n|=1&t,t>>>=1,n<<=1,0<--e;);return n>>>1}function q(t,e,n){for(var i,r=new Array(I+1),a=0,s=1;s<=I;s++)r[s]=a=a+n[s-1]<<1;for(i=0;i<=e;i++){var o=t[2*i+1];0!==o&&(t[2*i]=F(r[o]++,o))}}function z(t){for(var e=0;e<f;e++)t.dyn_ltree[2*e]=0;for(e=0;e<m;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*y]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function K(t){8<t.bi_valid?r(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function U(t,e,n,i){var r=2*e,a=2*n;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[n]}function B(t,e,n){for(var i=t.heap[n],r=n<<1;r<=t.heap_len&&(r<t.heap_len&&U(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!U(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i}function G(t,e,n){var i,r,a,s,o=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],r=t.pending_buf[t.l_buf+o],o++,0==i?$(t,r,e):($(t,(a=A[r])+p+1,e),0!==(s=w[a])&&L(t,r-=M[a],s),$(t,a=P(--i),n),0!==(s=x[a])&&L(t,i-=D[a],s)),o<t.last_lit;);$(t,y,e)}function R(t,e){var n,i,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=_,n=0;n<l;n++)0!==a[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):a[2*n+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=c,n=t.heap_len>>1;1<=n;n--)B(t,a,n);for(r=l;n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],B(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,a[2*r]=a[2*n]+a[2*i],t.depth[r]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,a[2*n+1]=a[2*i+1]=r,t.heap[1]=r++,B(t,a,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1];for(var h,u,d,p,f,m=t,g=e.dyn_tree,y=e.max_code,v=e.stat_desc.static_tree,b=e.stat_desc.has_stree,k=e.stat_desc.extra_bits,w=e.stat_desc.extra_base,x=e.stat_desc.max_length,S=0,T=0;T<=I;T++)m.bl_count[T]=0;for(g[2*m.heap[m.heap_max]+1]=0,h=m.heap_max+1;h<_;h++)x<(T=g[2*g[2*(u=m.heap[h])+1]+1]+1)&&(T=x,S++),g[2*u+1]=T,y<u||(m.bl_count[T]++,p=0,w<=u&&(p=k[u-w]),f=g[2*u],m.opt_len+=f*(T+p),b&&(m.static_len+=f*(v[2*u+1]+p)));if(0!==S){do{for(T=x-1;0===m.bl_count[T];)T--}while(m.bl_count[T]--,m.bl_count[T+1]+=2,m.bl_count[x]--,0<(S-=2));for(T=x;0!==T;T--)for(u=m.bl_count[T];0!==u;)y<(d=m.heap[--h])||(g[2*d+1]!==T&&(m.opt_len+=(T-g[2*d+1])*g[2*d],g[2*d+1]=T),u--)}q(a,c,t.bl_count)}function W(t,e,n){var i,r,a=-1,s=e[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=s,s=e[2*(i+1)+1],++o<l&&r===s||(o<c?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*v]++):o<=10?t.bl_tree[2*b]++:t.bl_tree[2*k]++,a=r,c=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4))}function Y(t,e,n){var i,r,a=-1,s=e[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),i=0;i<=n;i++)if(r=s,s=e[2*(i+1)+1],!(++o<l&&r===s)){if(o<c)for(;$(t,r,t.bl_tree),0!=--o;);else 0!==r?(r!==a&&($(t,r,t.bl_tree),o--),$(t,v,t.bl_tree),L(t,o-3,2)):o<=10?($(t,b,t.bl_tree),L(t,o-3,3)):($(t,k,t.bl_tree),L(t,o-11,7));a=r,c=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4)}}e(D);var X=!1;function V(t,e,n,i){L(t,0+(i?1:0),3),i=e,e=n,n=!0,K(t=t),n&&(r(t,e),r(t,~e)),s.arraySet(t.pending_buf,t.window,i,e,t.pending),t.pending+=e}t._tr_init=function(t){if(!X){for(var e,n,i,r=new Array(I+1),a=0,s=0;s<d-1;s++)for(M[s]=a,e=0;e<1<<w[s];e++)A[a++]=s;for(A[a-1]=s,s=i=0;s<16;s++)for(D[s]=i,e=0;e<1<<x[s];e++)C[i++]=s;for(i>>=7;s<m;s++)for(D[s]=i<<7,e=0;e<1<<x[s]-7;e++)C[256+i++]=s;for(n=0;n<=I;n++)r[n]=0;for(e=0;e<=143;)T[2*e+1]=8,e++,r[8]++;for(;e<=255;)T[2*e+1]=9,e++,r[9]++;for(;e<=279;)T[2*e+1]=7,e++,r[7]++;for(;e<=287;)T[2*e+1]=8,e++,r[8]++;for(q(T,f+1,r),e=0;e<m;e++)E[2*e+1]=5,E[2*e]=F(e,5);o=new N(T,w,p+1,f,I),l=new N(E,x,0,m,I),c=new N(new Array(0),H,0,g,j),X=!0}t.l_desc=new O(t.dyn_ltree,o),t.d_desc=new O(t.dyn_dtree,l),t.bl_desc=new O(t.bl_tree,c),t.bi_buf=0,t.bi_valid=0,z(t)},t._tr_stored_block=V,t._tr_flush_block=function(t,e,n,i){var r,a,s=0;if(0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){for(var e=4093624447,n=0;n<=31;n++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*n])return h;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return u;for(n=32;n<p;n++)if(0!==t.dyn_ltree[2*n])return u;return h}(t)),R(t,t.l_desc),R(t,t.d_desc),s=function(t){var e;for(W(t,t.dyn_ltree,t.l_desc.max_code),W(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=g-1;3<=e&&0===t.bl_tree[2*S[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=n+5,n+4<=r&&-1!==e)V(t,e,n,i);else if(4===t.strategy||a===r)L(t,2+(i?1:0),3),G(t,T,E);else{L(t,4+(i?1:0),3);var o,l=t,e=t.l_desc.max_code+1,n=t.d_desc.max_code+1,c=s+1;for(L(l,e-257,5),L(l,n-1,5),L(l,c-4,4),o=0;o<c;o++)L(l,l.bl_tree[2*S[o]+1],3);Y(l,l.dyn_ltree,e-1),Y(l,l.dyn_dtree,n-1),G(t,t.dyn_ltree,t.dyn_dtree)}z(t),i&&K(t)},t._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(A[n]+p+1)]++,t.dyn_dtree[2*P(e)]++),t.last_lit===t.lit_bufsize-1},t._tr_align=function(t){L(t,2,3),$(t,y,T),16===(t=t).bi_valid?(r(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":3}],15:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(t,e,n){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}),define("exceptions",[],function(){return{LootException:Class.extend({init:function(t){this.message=t}})}}),define("text!data/../../shared/data/appearance.json",function(){return'[\n\t{\n\t\t"name": "Sword 1",\n\t\t"type": "weapon",\n\t\t"sprite": "sword1",\n\t\t"buy": 0\n\t},\n\t{\n\t\t"name": "Sword 2",\n\t\t"type": "weapon",\n\t\t"sprite": "sword2",\n\t\t"buy": 500\n\n\t},\n\t{\n\t\t"name": "Axe",\n\t\t"type": "weapon",\n\t\t"sprite": "axe",\n\t\t"buy": 1000\n\t},\n\t{\n\t\t"name": "Morning Star",\n\t\t"type": "weapon",\n\t\t"sprite": "morningstar",\n\t\t"buy": 1500\n\t},\n\t{\n\t\t"name": "Blue Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "bluesword",\n\t\t"buy": 2000\n\n\t},\n\t{\n\t\t"name": "Red Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "redsword",\n\t\t"buy": 2500\n\t},\n\t{\n\t\t"name": "Golden Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "goldensword",\n\t\t"buy": 3000\n\t},\n\t{\n\t\t"name": "Side Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "sidesword",\n\t\t"buy": 3500\n\t},\n\t{\n\t\t"name": "Spear",\n\t\t"type": "weapon",\n\t\t"sprite": "spear",\n\t\t"buy": 4000\n\t},\n\t{\n\t\t"name": "Scimitar",\n\t\t"type": "weapon",\n\t\t"sprite": "scimitar",\n\t\t"buy": 4500\n\t},\n\t{\n\t\t"name": "Trident",\n\t\t"type": "weapon",\n\t\t"sprite": "trident",\n\t\t"buy": 5000\n\t},\n\t{\n\t\t"name": "Blue Scimitar",\n\t\t"type": "weapon",\n\t\t"sprite": "bluescimitar",\n\t\t"buy": 5500\n\t},\n\t{\n\t\t"name": "Hammer",\n\t\t"type": "weapon",\n\t\t"sprite": "hammer",\n\t\t"buy": 6000\n\t},\n\t{\n\t\t"name": "Green Light Saber",\n\t\t"type": "weapon",\n\t\t"sprite": "greenlightsaber",\n\t\t"buy": 6500\n\t},\n\t{\n\t\t"name": "Sky Light Saber",\n\t\t"type": "weapon",\n\t\t"sprite": "skylightsaber",\n\t\t"buy": 7000\n\t},\n\t{\n\t\t"name": "Red Light Saber",\n\t\t"type": "weapon",\n\t\t"sprite": "redlightsaber",\n\t\t"buy": 7500\n\t},\n\t{\n\t\t"name": "Bastard Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "bastardsword",\n\t\t"buy": 8000\n\t},\n\t{\n\t\t"name": "Red Metal Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "redmetalsword",\n\t\t"buy": 8500\n\t},\n\t{\n\t\t"name": "Justice Hammer",\n\t\t"type": "weapon",\n\t\t"sprite": "justicehammer",\n\t\t"buy": 9000\n\t},\n\t{\n\t\t"name": "Rose",\n\t\t"type": "weapon",\n\t\t"sprite": "rose",\n\t\t"buy": 9500\n\t},\n\t{\n\t\t"name": "Ice Rose",\n\t\t"type": "weapon",\n\t\t"sprite": "icerose",\n\t\t"buy": 10000\n\t},\n\t{\n\t\t"name": "Halberd",\n\t\t"type": "weapon",\n\t\t"sprite": "halberd",\n\t\t"buy": 10500\n\t},\n\t{\n\t\t"name": "Whip",\n\t\t"type": "weapon",\n\t\t"sprite": "whip",\n\t\t"buy": 11000\n\t},\n\t{\n\t\t"name": "Forest Guardian Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "forestguardiansword",\n\t\t"buy": 11500\n\t},\n\t{\n\t\t"name": "Sickle",\n\t\t"type": "weapon",\n\t\t"sprite": "sickle",\n\t\t"buy": 12000\n\t},\n\t{\n\t\t"name": "Plunger",\n\t\t"type": "weapon",\n\t\t"sprite": "plunger",\n\t\t"buy": 12500\n\t},\n\t{\n\t\t"name": "Red Sickle",\n\t\t"type": "weapon",\n\t\t"sprite": "redsickle",\n\t\t"buy": 13000\n\t},\n\t{\n\t\t"name": "Day Walker",\n\t\t"type": "weapon",\n\t\t"sprite": "daywalker",\n\t\t"buy": 13500\n\t},\n\t{\n\t\t"name": "Purple Cloud Kallege",\n\t\t"type": "weapon",\n\t\t"sprite": "purplecloudkallege",\n\t\t"buy": 14000\n\t},\n\t{\n\t\t"name": "Sea Rage",\n\t\t"type": "weapon",\n\t\t"sprite": "searage",\n\t\t"buy": 14500\n\t},\n\t{\n\t\t"name": "Breaker",\n\t\t"type": "weapon",\n\t\t"sprite": "breaker",\n\t\t"buy": 15000\n\t},\n\t{\n\t\t"name": "Enel Trident",\n\t\t"type": "weapon",\n\t\t"sprite": "eneltrident",\n\t\t"buy": 15500\n\t},\n\t{\n\t\t"name": "Rainbow Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "rainbowsword",\n\t\t"buy": 16000\n\t},\n\t{\n\t\t"name": "Typhoon",\n\t\t"type": "weapon",\n\t\t"sprite": "typhoon",\n\t\t"buy": 16500\n\t},\n\t{\n\t\t"name": "Memme",\n\t\t"type": "weapon",\n\t\t"sprite": "memme",\n\t\t"buy": 17000\n\t},\n\t{\n\t\t"name": "Candybar",\n\t\t"type": "weapon",\n\t\t"sprite": "candybar",\n\t\t"buy": 17500\n\t},\n\t{\n\t\t"name": "Butcher Knife",\n\t\t"type": "weapon",\n\t\t"sprite": "butcherknife",\n\t\t"buy": 18000\n\t},\n\t{\n\t\t"name": "Fire Shot",\n\t\t"type": "weapon",\n\t\t"sprite": "fireshot",\n\t\t"buy": 18500\n\t},\n\t{\n\t\t"name": "Comb",\n\t\t"type": "weapon",\n\t\t"sprite": "comb",\n\t\t"buy": 19000\n\t},\n\t{\n\t\t"name": "Squeaky Hammer",\n\t\t"type": "weapon",\n\t\t"sprite": "squeakyhammer",\n\t\t"buy": 19500\n\t},\n\t{\n\t\t"name": "Fire Play",\n\t\t"type": "weapon",\n\t\t"sprite": "fireplay",\n\t\t"buy": 20000\n\t},\n\t{\n\t\t"name": "Wea Staff",\n\t\t"type": "weapon",\n\t\t"sprite": "weastaff",\n\t\t"buy": 20500\n\t},\n\t{\n\t\t"name": "Pink Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "pinksword",\n\t\t"buy": 21000\n\t},\n\t{\n\t\t"name": "Conference Call",\n\t\t"type": "weapon",\n\t\t"sprite": "conferencecall",\n\t\t"buy": 21500\n\t},\n\t{\n\t\t"name": "Cactus Axe",\n\t\t"type": "weapon",\n\t\t"sprite": "cactusaxe",\n\t\t"buy": 22000\n\t},\n\t{\n\t\t"name": "Devil Kazya Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "devilkazyasword",\n\t\t"buy": 22500\n\t},\n\t{\n\t\t"name": "Bamboo Spear",\n\t\t"type": "weapon",\n\t\t"sprite": "bamboospear",\n\t\t"buy": 23000\n\t},\n\t{\n\t\t"name": "Paewoldo",\n\t\t"type": "weapon",\n\t\t"sprite": "paewoldo",\n\t\t"buy": 23500\n\t},\n\t{\n\t\t"name": "Magic Spear",\n\t\t"type": "weapon",\n\t\t"sprite": "magicspear",\n\t\t"buy": 24000\n\t},\n\t{\n\t\t"name": "Fire Sword",\n\t\t"type": "weapon",\n\t\t"sprite": "firesword",\n\t\t"buy": 24500\n\t},\n\n\t{\n\t\t"name": "Wooden Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "woodenbow",\n\t\t"buy": 0\n\t},\n\t{\n\t\t"name": "Plastic Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "plasticbow",\n\t\t"buy": 500\n\t},\n\t{\n\t\t"name": "Iron Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "ironbow",\n\t\t"buy": 1000\n\t},\n\t{\n\t\t"name": "Red Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "redbow",\n\t\t"buy": 1500\n\t},\n\t{\n\t\t"name": "Violet Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "violetbow",\n\t\t"buy": 2000\n\t},\n\t{\n\t\t"name": "Death Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "deathbow",\n\t\t"buy": 2500\n\t},\n\t{\n\t\t"name": "Golden Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "goldenbow",\n\t\t"buy": 3000\n\t},\n\t{\n\t\t"name": "Watermelon Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "watermelonbow",\n\t\t"buy": 3500\n\t},\n\t{\n\t\t"name": "Green Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "greenbow",\n\t\t"buy": 4000\n\t},\n\t{\n\t\t"name": "Redenel Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "redenelbow",\n\t\t"buy": 4500\n\t},\n\t{\n\t\t"name": "Mermaid Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "mermaidbow",\n\t\t"buy": 5000\n\t},\n\t{\n\t\t"name": "Seahorse Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "seahorsebow",\n\t\t"buy": 5500\n\t},\n\t{\n\t\t"name": "Hunter Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "hunterbow",\n\t\t"buy": 6000\n\t},\n\t{\n\t\t"name": "Green Light Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "greenlightbow",\n\t\t"buy": 6500\n\t},\n\t{\n\t\t"name": "Sky Light Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "skylightbow",\n\t\t"buy": 7000\n\t},\n\t{\n\t\t"name": "Red Light Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "redlightbow",\n\t\t"buy": 7500\n\t},\n\t{\n\t\t"name": "Captain Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "captainbow",\n\t\t"buy": 8000\n\t},\n\t{\n\t\t"name": "Red Metal Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "redmetalbow",\n\t\t"buy": 8500\n\t},\n\t{\n\t\t"name": "Justice Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "justicebow",\n\t\t"buy": 9000\n\t},\n\t{\n\t\t"name": "Rose Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "rosebow",\n\t\t"buy": 9500\n\t},\n\t{\n\t\t"name": "Marine Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "marinebow",\n\t\t"buy": 10000\n\t},\n\t{\n\t\t"name": "Crystal Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "crystalbow",\n\t\t"buy": 10500\n\t},\n\t{\n\t\t"name": "Colorful Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "gaybow",\n\t\t"buy": 11000\n\t},\n\t{\n\t\t"name": "Forest Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "forestbow",\n\t\t"buy": 11500\n\t},\n\t{\n\t\t"name": "Sickle Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "sicklebow",\n\t\t"buy": 12000\n\t},\n\t{\n\t\t"name": "Blood Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "bloodbow",\n\t\t"buy": 12500\n\t},\n\t{\n\t\t"name": "Red Sickle Bow",\n\t\t"type": "weaponarcher",\n\t\t"sprite": "redsicklebow",\n\t\t"buy": 13000\n\t},\n\n\t{\n\t\t"name": "Cloth Armor",\n\t\t"type": "armor",\n\t\t"sprite": "clotharmor",\n\t\t"buy": 0\n\t},\n\t{\n\t\t"name": "Leather Armor",\n\t\t"type": "armor",\n\t\t"sprite": "leatherarmor",\n\t\t"buy": 500\n\t},\n\t{\n\t\t"name": "Mail Armor",\n\t\t"type": "armor",\n\t\t"sprite": "mailarmor",\n\t\t"buy": 1000\n\t},\n\t{\n\t\t"name": "Plate Armor",\n\t\t"type": "armor",\n\t\t"sprite": "platearmor",\n\t\t"buy": 1500\n\t},\n\t{\n\t\t"name": "Red Armor",\n\t\t"type": "armor",\n\t\t"sprite": "redarmor",\n\t\t"buy": 2000\n\t},\n\t{\n\t\t"name": "Golden Armor",\n\t\t"type": "armor",\n\t\t"sprite": "goldenarmor",\n\t\t"buy": 2500\n\t},\n\t{\n\t\t"name": "Green Armor",\n\t\t"type": "armor",\n\t\t"sprite": "greenarmor",\n\t\t"buy": 3000\n\t},\n\t{\n\t\t"name": "Green Wing Armor",\n\t\t"type": "armor",\n\t\t"sprite": "greenwingarmor",\n\t\t"buy": 3500\n\t},\n\t{\n\t\t"name": "Guard Armor",\n\t\t"type": "armor",\n\t\t"sprite": "guardarmor",\n\t\t"buy": 4000\n\t},\n\t{\n\t\t"name": "Red Guard Armor",\n\t\t"type": "armor",\n\t\t"sprite": "redguardarmor",\n\t\t"buy": 4500\n\t},\n\t{\n\t\t"name": "White Armor",\n\t\t"type": "armor",\n\t\t"sprite": "whitearmor",\n\t\t"buy": 5000\n\t},\n\t{\n\t\t"name": "Rat Armor",\n\t\t"type": "armor",\n\t\t"sprite": "ratarmor",\n\t\t"buy": 5500\n\t},\n\t{\n\t\t"name": "Blue Pirate Armor",\n\t\t"type": "armor",\n\t\t"sprite": "bluepiratearmor",\n\t\t"buy": 6000\n\t},\n\t{\n\t\t"name": "Cheoli Armor",\n\t\t"type": "armor",\n\t\t"sprite": "cheoliarmor",\n\t\t"buy": 6500\n\t},\n\t{\n\t\t"name": "Dovakin Armor",\n\t\t"type": "armor",\n\t\t"sprite": "dovakinarmor",\n\t\t"buy": 7000\n\t},\n\t{\n\t\t"name": "GB Wing Armor",\n\t\t"type": "armor",\n\t\t"sprite": "gbwingarmor",\n\t\t"buy": 7500\n\t},\n\t{\n\t\t"name": "Red Wing Armor",\n\t\t"type": "armor",\n\t\t"sprite": "redwingarmor",\n\t\t"buy": 8000\n\t},\n\t{\n\t\t"name": "Snow Fox Armor",\n\t\t"type": "armor",\n\t\t"sprite": "snowfoxarmor",\n\t\t"buy": 8500\n\t},\n\t{\n\t\t"name": "Wolf Armor",\n\t\t"type": "armor",\n\t\t"sprite": "wolfarmor",\n\t\t"buy": 9000\n\t},\n\t{\n\t\t"name": "Blue Wing Armor",\n\t\t"type": "armor",\n\t\t"sprite": "bluewingarmor",\n\t\t"buy": 9500\n\t},\n\t{\n\t\t"name": "Thief Armor",\n\t\t"type": "armor",\n\t\t"sprite": "thiefarmor",\n\t\t"buy": 10000\n\t},\n\t{\n\t\t"name": "Ninja Armor",\n\t\t"type": "armor",\n\t\t"sprite": "ninjaarmor",\n\t\t"buy": 10500\n\t},\n\t{\n\t\t"name": "Dragon Armor",\n\t\t"type": "armor",\n\t\t"sprite": "dragonarmor",\n\t\t"buy": 11000\n\t},\n\t{\n\t\t"name": "Fallen Armor",\n\t\t"type": "armor",\n\t\t"sprite": "fallenarmor",\n\t\t"buy": 11500\n\t},\n\t{\n\t\t"name": "Paladin Armor",\n\t\t"type": "armor",\n\t\t"sprite": "paladinarmor",\n\t\t"buy": 12000\n\t},\n\t{\n\t\t"name": "Crystal Armor",\n\t\t"type": "armor",\n\t\t"sprite": "crystalarmor",\n\t\t"buy": 12500\n\t},\n\t{\n\t\t"name": "Adherer Robe",\n\t\t"type": "armor",\n\t\t"sprite": "adhererrobe",\n\t\t"buy": 13000\n\t},\n\t{\n\t\t"name": "Frost Armor",\n\t\t"type": "armor",\n\t\t"sprite": "frostarmor",\n\t\t"buy": 13500\n\t},\n\t{\n\t\t"name": "Strap Armor",\n\t\t"type": "armor",\n\t\t"sprite": "gayarmor",\n\t\t"buy": 14000\n\t},\n\t{\n\t\t"name": "School Uniform",\n\t\t"type": "armor",\n\t\t"sprite": "schooluniform",\n\t\t"buy": 14500\n\t},\n\t{\n\t\t"name": "Beautiful Life",\n\t\t"type": "armor",\n\t\t"sprite": "beautifullife",\n\t\t"buy": 15000\n\t},\n\t{\n\t\t"name": "Region Armor",\n\t\t"type": "armor",\n\t\t"sprite": "regionarmor",\n\t\t"buy": 15500\n\t},\n\t{\n\t\t"name": "Ghost Rider",\n\t\t"type": "armor",\n\t\t"sprite": "ghostrider",\n\t\t"buy": 16000\n\t},\n\t{\n\t\t"name": "Taekwondo",\n\t\t"type": "armor",\n\t\t"sprite": "taekwondo",\n\t\t"buy": 16500\n\t},\n\t{\n\t\t"name": "Rabbit Armor",\n\t\t"type": "armor",\n\t\t"sprite": "rabbitarmor",\n\t\t"buy": 17000\n\t},\n\t{\n\t\t"name": "Portal Armor",\n\t\t"type": "armor",\n\t\t"sprite": "portalarmor",\n\t\t"buy": 17500\n\t},\n\t{\n\t\t"name": "Pirate King",\n\t\t"type": "armor",\n\t\t"sprite": "pirateking",\n\t\t"buy": 18000\n\t},\n\t{\n\t\t"name": "Sea Dragon Armor",\n\t\t"type": "armor",\n\t\t"sprite": "seadragonarmor",\n\t\t"buy": 18500\n\t},\n\t{\n\t\t"name": "Shadow Region Armor",\n\t\t"type": "armor",\n\t\t"sprite": "shadowregionarmor",\n\t\t"buy": 19000\n\t},\n\t{\n\t\t"name": "Enel Armor",\n\t\t"type": "armor",\n\t\t"sprite": "enelarmor",\n\t\t"buy": 19500\n\t},\n\t{\n\t\t"name": "Mini Sea Dragon Armor",\n\t\t"type": "armor",\n\t\t"sprite": "miniseadragonarmor",\n\t\t"buy": 20000\n\t},\n\t{\n\t\t"name": "Huni Armor",\n\t\t"type": "armor",\n\t\t"sprite": "huniarmor",\n\t\t"buy": 20500\n\t},\n\t{\n\t\t"name": "Dambo Armor",\n\t\t"type": "armor",\n\t\t"sprite": "damboarmor",\n\t\t"buy": 21000\n\t},\n\t{\n\t\t"name": "Squid Armor",\n\t\t"type": "armor",\n\t\t"sprite": "squidarmor",\n\t\t"buy": 21500\n\t},\n\t{\n\t\t"name": "Bee Armor",\n\t\t"type": "armor",\n\t\t"sprite": "beearmor",\n\t\t"buy": 22000\n\t},\n\t{\n\t\t"name": "Blue Dambo Armor",\n\t\t"type": "armor",\n\t\t"sprite": "bluedamboarmor",\n\t\t"buy": 22500\n\t},\n\t{\n\t\t"name": "Rudolf Armor",\n\t\t"type": "armor",\n\t\t"sprite": "rudolfarmor",\n\t\t"buy": 23000\n\t},\n\t{\n\t\t"name": "Christmas Armor",\n\t\t"type": "armor",\n\t\t"sprite": "christmasarmor",\n\t\t"buy": 23500\n\t},\n\t{\n\t\t"name": "Robocop Armor",\n\t\t"type": "armor",\n\t\t"sprite": "robocoparmor",\n\t\t"buy": 24000\n\t},\n\t{\n\t\t"name": "Pink Cockroach Armor",\n\t\t"type": "armor",\n\t\t"sprite": "pinkcockroacharmor",\n\t\t"buy": 24500\n\t},\n\t{\n\t\t"name": "Cockroach Suit",\n\t\t"type": "armor",\n\t\t"sprite": "cockroachsuit",\n\t\t"buy": 25000\n\t},\n\t{\n\t\t"name": "Dinosaur Armor",\n\t\t"type": "armor",\n\t\t"sprite": "dinosaurarmor",\n\t\t"buy": 25500\n\t},\n\t{\n\t\t"name": "Cat Armor",\n\t\t"type": "armor",\n\t\t"sprite": "catarmor",\n\t\t"buy": 26000\n\t},\n\t{\n\t\t"name": "Snowman Armor",\n\t\t"type": "armor",\n\t\t"sprite": "snowmanarmor",\n\t\t"buy": 26500\n\t},\n\t{\n\t\t"name": "Beetle Armor",\n\t\t"type": "armor",\n\t\t"sprite": "beetlearmor",\n\t\t"buy": 27000\n\t},\n\t{\n\t\t"name": "Hongcheol Armor",\n\t\t"type": "armor",\n\t\t"sprite": "hongcheolarmor",\n\t\t"buy": 27500\n\t},\n\t{\n\t\t"name": "Tiger Armor",\n\t\t"type": "armor",\n\t\t"sprite": "tigerarmor",\n\t\t"buy": 28000\n\t},\n\t{\n\t\t"name": "Wizard Rob",\n\t\t"type": "armor",\n\t\t"sprite": "wizardrobe",\n\t\t"buy": 28500\n\n\t},\n\t{\n\t\t"name": "Iron Knight Armor",\n\t\t"type": "armor",\n\t\t"sprite": "ironknightarmor",\n\t\t"buy": 29000\n\t},\n\t{\n\t\t"name": "Evil Armor",\n\t\t"type": "armor",\n\t\t"sprite": "evilarmor",\n\t\t"buy": 29500\n\n\t},\n\t{\n\t\t"name": "Green Dambo Armor",\n\t\t"type": "armor",\n\t\t"sprite": "greendamboarmor",\n\t\t"buy": 30000\n\t},\n\t{\n\t\t"name": "Red Dambo Armor",\n\t\t"type": "armor",\n\t\t"sprite": "reddamboarmor",\n\t\t"buy": 30500\n\t},\n\t{\n\t\t"name": "Devil Kazya Armor",\n\t\t"type": "armor",\n\t\t"sprite": "devilkazyaarmor",\n\t\t"buy": 31000\n\t},\n\t{\n\t\t"name": "Bridal Mask",\n\t\t"type": "armor",\n\t\t"sprite": "bridalmask",\n\t\t"buy": 31500\n\t},\n\t{\n\t\t"name": "Black Spider Armor",\n\t\t"type": "armor",\n\t\t"sprite": "blackspiderarmor",\n\t\t"buy": 32000\n\t},\n\t{\n\t\t"name": "Frog Armor",\n\t\t"type": "armor",\n\t\t"sprite": "frogarmor",\n\t\t"buy": 32500\n\t},\n\t{\n\t\t"name": "Bearseonbi Armor",\n\t\t"type": "armor",\n\t\t"sprite": "bearseonbiarmor",\n\t\t"buy": 33000\n\t},\n\t{\n\t\t"name": "Raindow A Pro",\n\t\t"type": "armor",\n\t\t"sprite": "rainbowapro",\n\t\t"buy": 33500\n\t},\n\t{\n\t\t"name": "Coke Armor",\n\t\t"type": "armor",\n\t\t"sprite": "cokearmor",\n\t\t"buy": 34000\n\n\t},\n\t{\n\t\t"name": "Fried Potato Armor",\n\t\t"type": "armor",\n\t\t"sprite": "friedpotatoarmor",\n\t\t"buy": 34500\n\t},\n\t{\n\t\t"name": "Burger Armor",\n\t\t"type": "armor",\n\t\t"sprite": "burgerarmor",\n\t\t"buy": 35000\n\t},\n\t{\n\t\t"name": "Halloween JK Armor",\n\t\t"type": "armor",\n\t\t"sprite": "halloweenjkarmor",\n\t\t"buy": 35500\n\t},\n\t{\n\t\t"name": "Frankenstein Armor",\n\t\t"type": "armor",\n\t\t"sprite": "frankensteinarmor",\n\t\t"buy": 36000\n\t},\n\t{\n\t\t"name": "Admin armor",\n\t\t"type": "armor",\n\t\t"sprite": "adminarmor",\n\t\t"buy": 36500\n\t},\n\n\t{\n\t\t"name": "Cloth Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "clotharmor",\n\t\t"buy": 0\n\t},\n\t{\n\t\t"name": "Leather Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "leatherarcherarmor",\n\t\t"buy": 500\n\t},\n\t{\n\t\t"name": "Mail Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "mailarcherarmor",\n\t\t"buy": 1000\n\t},\n\t{\n\t\t"name": "Plate Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "platearcherarmor",\n\t\t"buy": 1500\n\t},\n\t{\n\t\t"name": "Red Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "redarcherarmor",\n\t\t"buy": 2000\n\t},\n\t{\n\t\t"name": "Golden Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "goldenarcherarmor",\n\t\t"buy": 2500\n\t},\n\t{\n\t\t"name": "Green Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "greenarcherarmor",\n\t\t"buy": 3000\n\t},\n\t{\n\t\t"name": "Green Wing Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "greenwingarcherarmor",\n\t\t"buy": 3500\n\t},\n\t{\n\t\t"name": "Guard Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "guardarcherarmor",\n\t\t"buy": 4000\n\t},\n\t{\n\t\t"name": "Red Guard Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "redguardarcherarmor",\n\t\t"buy": 4500\n\t},\n\t{\n\t\t"name": "White Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "whitearcherarmor",\n\t\t"buy": 5000\n\t},\n\t{\n\t\t"name": "Pirate Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "piratearcherarmor",\n\t\t"buy": 5500\n\t},\n\t{\n\t\t"name": "Cheoli Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "cheoliarcherarmor",\n\t\t"buy": 6000\n\t},\n\t{\n\t\t"name": "Dovakin Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "dovakinarcherarmor",\n\t\t"buy": 6500\n\t},\n\t{\n\t\t"name": "GB Wing Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "gbwingarcherarmor",\n\t\t"buy": 7000\n\t},\n\t{\n\t\t"name": "Red Wing Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "redwingarcherarmor",\n\t\t"buy": 7500\n\t},\n\t{\n\t\t"name": "Snow Fox Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "snowfoxarcherarmor",\n\t\t"buy": 8000\n\t},\n\t{\n\t\t"name": "Wolf Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "wolfarcherarmor",\n\t\t"buy": 8500\n\t},\n\t{\n\t\t"name": "Blue Wing Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "bluewingarcherarmor",\n\t\t"buy": 9000\n\t},\n\t{\n\t\t"name": "Fallen Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "fallenarcherarmor",\n\t\t"buy": 9500\n\t},\n\t{\n\t\t"name": "Crystal Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "crystalarcherarmor",\n\t\t"buy": 10000\n\t},\n\t{\n\t\t"name": "Legolas Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "legolasarmor",\n\t\t"buy": 10500\n\t},\n\t{\n\t\t"name": "Adherer Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "adhererarcherarmor",\n\t\t"buy": 11000\n\t},\n\t{\n\t\t"name": "School Uniform",\n\t\t"type": "armorarcher",\n\t\t"sprite": "archerschooluniform",\n\t\t"buy": 11500\n\t},\n\t{\n\t\t"name": "Combat Uniform",\n\t\t"type": "armorarcher",\n\t\t"sprite": "combatuniform",\n\t\t"buy": 12000\n\t},\n\t{\n\t\t"name": "Strap Armor",\n\t\t"type": "armorarcher",\n\t\t"sprite": "gayarcherarmor",\n\t\t"buy": 12500\n\t}\n]\n'}),define("data/appearancedata",["text!../../shared/data/appearance.json"],function(t){var n=[],t=JSON.parse(t);return $.each(t,function(t,e){n[t]={name:e.name,type:e.type,sprite:e.sprite,buy:e.buy}}),n});var STATE_IDLE=0,STATE_MOVING=1,STATE_ATTACKING=2,getSkillEffects=(define("entity/player",["./entity","./character","../exceptions","data/appearancedata"],function(t,e,n,i){return e.extend({init:function(t,e,n,i,r){this._super(t,e,n,i);this.name=r,this.nameOffsetY=-10,this.rights=0,this.spriteName="clotharmor",this.armorName="clotharmor",this.weaponName="sword1",this.moveSpeed=500,this.setMoveRate(this.moveSpeed),this.setAttackRate(64),this.exp={},this.level={},this.sprites=new Array(2),this.stats={},this.orientation=Types.Orientations.DOWN,this.keyMove=!1,this.joystickTime=0,this.fsm="IDLE"},setItems:function(){this.equipment={},this.inventory={},this.equipment.rooms=game.equipmentHandler.equipment,this.inventory.rooms=game.inventoryHandler.inventory},isMovingAll:function(){return!this.freeze&&(this.isMoving()||this.orientation!==Types.Orientations.NONE)},setSkill:function(t,e){this.skillHandler.add(t,e)},setSkills:function(t){this.skillHandler.addAll(t)},setConsumable:function(t){},isMovingToLoot:function(){return this.isLootMoving},getSpriteName:function(){return this.getArmorSprite().name},getArmorSprite:function(){var t=this.spriteName;return game.sprites.hasOwnProperty(t)?game.sprites[t]:null},getWeaponSprite:function(){var t=this.weaponName;return game.sprites.hasOwnProperty(t)?game.sprites[t]:null},isArcher:function(){var t;return!!this.equipment&&!(!(t=this.equipment.rooms[4])||!ItemTypes.isArcherWeapon(t.itemKind))},setArmorSprite:function(t){this._setArmorSprite(t)},setWeaponSprite:function(t){this._setWeaponSprite(t)},_setArmorSprite:function(t){var e;t||(e=this.sprites[0],t=game.sprites[i[e].sprite]),t&&(this.armorSprite=t,this.spriteName=t.name,this.setSprite(t))},_setWeaponSprite:function(t){var e;t||(e=this.sprites[1],t=game.sprites[i[e].sprite]),t&&(this.weaponName=t.name,this.weaponSprite=t,this.pjsWeaponSprite?this.pjsWeaponSprite=game.renderer.changeSprite(t,this.pjsWeaponSprite):this.pjsWeaponSprite=game.renderer.createSprite(t))},hasWeapon:function(){return null!==this.weaponName},flagPVP:function(t){this.pvpFlag=t},setRange:function(){this.setAttackRange(1),this.isArcher()&&this.setAttackRange(10)},setPvpSide:function(t){this.pvpSide=t},canKeyMove:function(){var t=this.x,e=this.y;switch(this.orientation){case Types.Orientations.UP:e--;break;case Types.Orientations.DOWN:e++;break;case Types.Orientations.LEFT:t--;break;case Types.Orientations.RIGHT:t++}var n=game.isOverlapping(this,t,e),i=(n&&log.info("isOverlapping."),game.mapContainer.isColliding(t,e));return i&&log.info("isColliding."),!(n||i)},move:function(t,e,n,i,r){var a=this;this.orientation=e,1==n&&e!=Types.Orientations.NONE?(t=(t=G_LATENCY-(getWorldTime()-t)).clamp(G_UPDATE_INTERVAL,G_LATENCY),console.warn("lockStepTime="+t),t+=G_LATENCY,clearTimeout(this.moving_callback),this.moving_callback=setTimeout(function(){a.forceStop(),a.setPosition(i,r),a.ex=-1,a.ey=-1,a.moving_callback=null,a.walk(e),a.freeze=!1,a.keyMove=!0},t)):0==n||e==Types.Orientations.NONE?(this.ex=i,this.ey=r,this.movement.inProgress&&!this.moving_callback||(this.forceStop(),this.setPosition(i,r),clearTimeout(this.moving_callback),this.moving_callback=null)):2==n&&e!=Types.Orientations.NONE&&(this.forceStop(),this.setPosition(i,r),this.ex=-1,this.ey=-1,clearTimeout(this.moving_callback),this.moving_callback=null)},baseHit:function(){return 0},baseHitDef:function(){return 0},baseCrit:function(){var t=2*this.level.base,e=this.equipment.rooms[4],e=(e&&(t=3*ItemTypes.getData(e.itemKind).modifier+2*e.itemNumber),this.stats.attack+2*this.stats.luck),e=Utils.clamp(0,500,~~(e+t));return log.info("player - baseCrit: "+e),(e/5).toFixed(0)+"%"},baseCritDef:function(){var t,e,n=2*this.level.base;for(t in this.equipment.rooms)4!=t&&(e=this.equipment.rooms[t])&&(n+=3*ItemTypes.getData(e.itemKind).modifier+2*e.itemNumber);var i=this.stats.defense+2*this.stats.luck,i=Utils.clamp(0,500,~~(i+n));return log.info("player - baseCritDef: "+i),(i/5).toFixed(0)+"%"},getWeapon:function(){return this.equipment.rooms[4]},getWeaponLevel:function(){var t=this.getWeapon();return t?(t=ItemTypes.KindData[t.itemKind],Types.getWeaponLevel(this.exp[t.type])):0},hasHarvestWeapon:function(t){var e,n;return!(!t||"any"!=t)||!!(e=this.getWeapon())&&(n=ItemTypes.KindData[e.itemKind],t?n.type==t:ItemTypes.isHarvestWeapon(e.itemKind))},getWeaponType:function(){var t=this.getWeapon();return t?ItemTypes.KindData[t.itemKind].type:null},baseDamage:function(){var t=this.equipment.rooms[4],e=this.level.base,n=~~(t?3*ItemTypes.getData(t.itemKind).modifier+2*t.itemNumber:e),i=this.level.attack/50+1,t=(i*=this.getWeaponLevel()/50+1,t&&(n=~~(n*(t.itemDurability/t.itemDurabilityMax*.5+.5))),this.mod?this.mod.attack:0),t=(n+=3*(this.stats.attack+t)+this.stats.luck,~~(e*i)),e=~~(3*t),i=(Utils.randomRangeInt(t,e),1.15+Math.max(0,.05*(10-this.level.base)));return[~~((t+n)*i),~~((e+n)*i)]},baseDamageDef:function(){var t,e=0,n=this.level.base+3;for(t in log.info("baseDamageDef:"),e=n,this.equipment.rooms){var i,r=this.equipment.rooms[t];r&&(i=1==t?4:2,e+=~~((ItemTypes.getData(r.itemKind).modifier*i+r.itemNumber*i)*(r.itemDurability/r.itemDurabilityMax*.5+.5)))}log.info("dealt="+e);var a=this.level.defense/50+1,n=(log.info("power="+a),~~(n*a)),a=~~(2*n),s=(log.info("dealtrange="+e),this.mod?this.mod.defense:0);return e+=~~(3*(this.stats.defense+s))+this.stats.luck,log.info("dealtstats="+e),Utils.randomRangeInt(n,a),[n+=e,a+=e]},onKeyMove:function(t){this.key_move_callback=t},hit:function(t){this.fsm="ATTACK",this.forceStop(),this._super(t)},revive:function(){this.isDead=!1,this.isDying=!1,this.freeze=!1,this.stats.hp=this.stats.hpMax,this.stats.ep=this.stats.epMax,this.setArmorSprite(),this.forceStop(),this.disengage()},respawn:function(){this.setArmorSprite(),this.orientation=Types.Orientations.DOWN,this.idle(this.orientation),this.fsm="IDLE"},setPosition:function(t,e){var n;this._super(t,e),this.holdingBlock&&(t=[[t,e],[t,e-(n=G_TILESIZE)],[t,e+n],[t-n,e],[t+n,e]][this.orientation],this.holdingBlock.setPosition(t[0],t[1]))},followPath:function(t){this._followPath(t)},_followPath:function(t){1<t.length&&(this.path=t,this.step=1,this.start_pathing_callback&&(this.start_pathing_callback(t),this.updateMovement()),this.before_move_callback)&&this.before_move_callback()},harvestOn:function(t){function e(){n.setOrientation(n.orientation),n.fsm="HARVEST",n.animate("atk",n.atkSpeed,1,function(){n.idle(n.orientation)}),"any"==i&&(n.hideWeapon=!0)}var n=this,i=t;e(),clearInterval(this.harvestTimeout),this.harvestTimeout=setInterval(function(){!n.harvestTimeout||n.target&&n.target.type!=Types.EntityTypes.NODE?n.harvestOff():e()},1e3),this.startHarvestTime=Date.now()},harvestOff:function(){"HARVEST"==this.fsm&&(clearInterval(this.harvestTimeout),this.harvestTimeout=null,this.forceStop(),this.startHarvestTime=0,this.hideWeapon=!1)},forceStop:function(){this._super(),this.key_move_callback&&this.key_move_callback(!1)}})}),define("text!data/../../shared/data/quests.json",function(){return'{\n"1": {\n\t"npcKind": 0,\n\t"name": "Intro 1",\n\t"type": 1,\n\t"level": 0,\n\t"object": {"type": 2, "kind": 1, "count": 10}\n},\n"2": {\n\t"npcKind": 1,\n\t"name": "Intro 2",\n\t"type": 2,\n\t"level": 0,\n\t"object": {"type": 2, "kind": 1, "level": [0,5]},\n\t"object2": {"type": 4, "kind": 1, "count": 3, "chance": 20}\n},\n"3": {\n\t"npcKind": 2,\n\t"name": "Intro 3",\n\t"type": 2,\n\t"level": 0,\n\t"object": {"type": 2, "kind": 1, "level": [0,5]},\n\t"object2": {"type": 4, "kind": 41, "count": 5, "chance": 20}\n},\n"4": {\n\t"npcKind": 3,\n\t"name": "Intro 4",\n\t"type": 2,\n\t"level": 0,\n\t"object": {"type": 2, "kind": 2, "level": [3,5]},\n\t"object2": {"type": 4, "kind": 43, "count": 1, "chance": 5}\n},\n"5": {\n\t"npcKind": 4,\n\t"name": "Intro 5",\n\t"type": 1,\n\t"level": 0,\n\t"object": {"type": 2, "kind": 2, "count": 10}\n},\n"6": {\n\t"npcKind": 5,\n\t"name": "Intro 6",\n\t"type": 5,\n\t"level": 0,\n\t"data1": 1,\n\t"object": {"type": 10, "kind": 3, "count": 5}\n},\n"7": {\n\t"npcKind": 6,\n\t"name": "Intro 7",\n\t"type": 5,\n\t"level": 0,\n\t"data1": 2,\n\t"object": {"type": 10, "kind": 3, "count": 5}\n}\n\n}\n'}),define("data/questdata",["text!../../shared/data/quests.json"],function(t){function i(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n}var r={},t=JSON.parse(t),a=0;return _.each(t,function(t,e){var n=i(t.type,2)+i(t.npcId,4)+i(a,3);r[n]=t,r[n].id=n,r[n].objectId=t.objectId||0,r[n].objectCount=t.objectCount||0,a++}),r}),define("text!data/../../shared/data/itemloot.json",function(){return'[\r\n{\r\n  "name": "Scrolls",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,0], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Dice",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,1], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Book",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,2], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Key",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,3], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Bell",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,4], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Padlock",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,5], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Candle",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,6], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Drumstick",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,7], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "IronHelmet",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,8], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Gumnut",\r\n  "sprite": "itemloot.png",\r\n  "offset": [0,9], "staticsheet":3,\r\n  "rarity": "1"\r\n},\r\n{\r\n  "name": "Fireball",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,0], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "WitchHat",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,1], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "Chest",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,2], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "Shield",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,3], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "Log",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,4], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "RingOne",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,5], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "DreamCatcher",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,6], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "SealedScroll",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,7], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "Spider",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,8], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "MeltedCandles",\r\n  "sprite": "itemloot.png",\r\n  "offset": [1,9], "staticsheet":3,\r\n  "rarity": "2"\r\n},\r\n{\r\n  "name": "Feather",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,0], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "Compass",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,1], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "PinkFireball",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,2], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "Gem",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,3], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "FireEye",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,4], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "TotemFace",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,5], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "Gadget",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,6], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "Frog",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,7], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "ThrowingDagger",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,8], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name": "UrnOne",\r\n  "sprite": "itemloot.png",\r\n  "offset": [2,9], "staticsheet":3,\r\n  "rarity": "3"\r\n},\r\n{\r\n  "name":  "NecklaceOne",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,0], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name":  "Squid",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,1], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name":  "ClubOne",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,2], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name":  "Crystals",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,3], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name":  "Mace",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,4], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name":  "CoinPouch",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,5], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name": "NecklaceTwo",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,6], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name": "Bones",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,7], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name": "RingTwo",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,8], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name": "AnimalSkull",\r\n  "sprite": "itemloot.png",\r\n  "offset": [3,9], "staticsheet":3,\r\n  "rarity": "4"\r\n},\r\n{\r\n  "name": "Leaf",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,0], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name": "Cheese",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,1], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "Mushrooms",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,2], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "FeatherQuill",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,3], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "BoneEaring",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,4], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name": "Crate",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,5], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "Bat",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,6], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "PoisonVial",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,7], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "ScrollsThree",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,8], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "Bug",\r\n  "sprite": "itemloot.png",\r\n  "offset": [4,9], "staticsheet":3,\r\n  "rarity": "5"\r\n},\r\n{\r\n  "name":  "Anvil",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,0], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "BrokenGlass",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,1], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "Goblet",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,2], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "SkullRingTwo",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,3], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "MonsterClaw",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,4], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "PoisonVialTwo",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,5], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name": "BronzeHelmet",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,6], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "BasicKnife",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,7], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "Worms",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,8], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "AutumnLeaf",\r\n  "sprite": "itemloot.png",\r\n  "offset": [5,9], "staticsheet":3,\r\n  "rarity": "6"\r\n},\r\n{\r\n  "name":  "Drum",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,0], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Acorns",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,1], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Pendant",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,2], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Lute",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,3], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "RingThree",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,4], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "BattleAxe",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,5], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "AncientShield",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,6], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Broach",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,7], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Maul",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,8], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "SmokePipe",\r\n  "sprite": "itemloot.png",\r\n  "offset": [6,9], "staticsheet":3,\r\n  "rarity": "7"\r\n},\r\n{\r\n  "name":  "Lizard",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,0], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "DragonEgg",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,1], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "MarbleJar",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,2], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "OldBottle",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,3], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "ShortSword",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,4], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "BookTwo",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,5], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "Bread",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,6], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "Mirror",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,7], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "Cards",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,8], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "PotOfGold",\r\n  "sprite": "itemloot.png",\r\n  "offset": [7,9], "staticsheet":3,\r\n  "rarity": "8"\r\n},\r\n{\r\n  "name":  "FaceMask",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,0], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "Bomb",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,1], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "HandBag",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,2], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "ToothNecklace",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,3], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "NecklaceThree",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,4], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "LeafWreath",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,5], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "Eyeball",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,6], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "CrudeDagger",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,7], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "SapJewel",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,8], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "Clever",\r\n  "sprite": "itemloot.png",\r\n  "offset": [8,9], "staticsheet":3,\r\n  "rarity": "9"\r\n},\r\n{\r\n  "name":  "MortAndPestle",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,0], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "WoodHorn",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,1], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "Pumpkin",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,2], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "HumanSkull",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,3], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "Thorns",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,4], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "FineComb",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,5], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "Cauldron",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,6], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "MagicBall",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,7], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "Mushroom",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,8], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "Hook",\r\n  "sprite": "itemloot.png",\r\n  "offset": [9,9], "staticsheet":3,\r\n  "rarity": "10"\r\n},\r\n{\r\n  "name":  "NordicCup",\r\n  "sprite": "itemloot.png",\r\n  "offset": [10,0], "staticsheet":3,\r\n  "rarity": "10"\r\n}\r\n]\r\n'}),define("data/itemlootdata",["text!../../shared/data/itemloot.json"],function(t){var e,n=[],t=JSON.parse(t),i=($.each(t,function(t,e){n[t]={name:e.name,rarity:e.rarity,sprite:e.sprite,offset:e.offset,staticsheet:0<e.staticsheet?e.staticsheet:0,include:e.include||null}}),console.info(JSON.stringify(n)),0);for(e of n)e&&console.info(i+": "+JSON.stringify(e)),i++;return n}),define("questhandler",["data/npcdata","data/questdata","data/mobdata","data/itemlootdata"],function(t,e,h,u){return Class.extend({init:function(t){this.game=t,this.hideDelay=5e3,this.progressHideDelay=1e3,this.showlog=!1;var e=this;this.closeButton=$("#questCloseButton"),this.closeButton.click(function(t){e.toggleShowLog()})},show:function(){this.quests=this.game.player.quests},getNPCQuest:function(e){return _.find(this.quests,function(t){return t.id===e})},toggleShowLog:function(){this.showlog=!this.showlog,this.showlog?(this.questReloadLog(),this.questShowLog()):this.questHideLog()},questReloadLog:function(){this.quests=game.player.quests;$("#questLogInfo tbody").find("tr:gt(0)").remove();for(var t=Object.keys(this.quests),e=0;e<t.length;++e){var n,i,r,a,s,o,l,c=this.quests[t[e]];2==c.status?$("#questLogInfo .qd"+c.id).remove():(n=c.count+" / "+c.object.count,s=(c.type==QuestType.GETITEMKIND&&(n=c.count+" / "+c.object2.count),c.type==QuestType.GETITEMKIND&&(i=c.object2.kind,r=(i=u[i]).sprite,r=game.sprites.itemloot.file,a=i.name.toLowerCase()),c.type==QuestType.KILLMOBKIND&&(a=(r=h.Kinds[c.object.kind].spriteName).toLowerCase()),c.type==QuestType.USENODE&&(a=(r="nodeset"+c.object.kind).toLowerCase()+"_node"+c.data1),this.game.spritesets[0][r]),o='<div class="img quest-img-%idName%"></div>',c.type==QuestType.USENODE?o='<div class="img quest-img-%idName%" style="background-image: url(\''+s.filepath+"')\"></div>":c.type==QuestType.GETITEMKIND?o='<div class="img quest-img-%idName%" style="background-image: url(\'img/2/sprites/%sprite%\')"></div>':c.type==QuestType.KILLMOBKIND&&(o='<div class="img quest-img-%idName%" style="background-image: url(\''+s.filepath+"')\"></div>"),o=(o=o.replace(/%idName%/g,a)).replace(/%sprite%/g,r),$("#questLogInfo tbody").append("<tr id='qd"+c.id+"'><td class='frame-stroke1'>"+o+"</td><td class='frame-stroke1'>"+c.summary+"</td><td class='frame-stroke1'>"+n+"</td></tr>"),c.type==QuestType.GETITEMKIND&&$(".quest-img-"+a).css({"background-position":"-"+32*i.offset[0]+"px -"+32*i.offset[1]+"px",width:"32px",height:"32px"}),c.type==QuestType.KILLMOBKIND&&(l="-"+((s.animationData.idle_down.length-1)*s.width*2+s.width/2)+"px -"+(s.animationData.idle_down.row*s.height*2+s.height/2)+"px",$(".quest-img-"+a).css({"background-position":l,width:s.width+"px",height:s.height+"px"})),c.type==QuestType.USENODE&&(o="node"+c.data1,l="-"+((s.animationData[o].length-1)*s.width*2+s.width/2)+"px -"+(s.animationData[o].row*s.height*2+s.height/2)+"px",$(".quest-img-"+a).css({"background-position":l,width:s.width+"px",height:s.height+"px"})))}},questShowLog:function(){$("#questlog").css("display","block"),$("#questCloseButton").css("display","block")},questHideLog:function(){$("#questlog").css("display","none"),$("#questCloseButton").css("display","none")},handleQuest:function(t){this.quests=this.game.player.quests;var e=t.status,n="";0===e?(n="<p><h2>Quest Found</h2></p><p>"+t.summary+"</p>",game.userAlarm.alarm(n,this.hideDelay),this.questReloadLog()):2===e&&(n="<p><h2>Quest Completed</h2></p><p>"+t.summary+"</p>",game.userAlarm.alarm(n,this.hideDelay),delete t,this.questReloadLog()),this.showlog&&(this.questReloadLog(),this.questShowLog())},talkToNPC:function(t){this.game.client.sendTalkToNPC(t.type,t.id)}})}),define("entity/npcstatic",["./character","../questhandler","data/npcdata"],function(t,e,a){return t.extend({init:function(t,e,n,i,r){this._super(t,e,n,i,1),this.talkIndex=0,log.info("Npc.title: "+a.Kinds[this.kind].title),log.info("Npc.name: "+a.Kinds[this.kind].name),this.name=r||a.Kinds[this.kind].title},getSpriteName:function(){return a.Kinds[this.kind].uid},getAnimationByName:function(){return this._super("idle_down")}})}),define("sprites",[],function(){return Class.extend({init:function(t){var n=this;JSZipUtils.getBinaryContent("sprites/sprites.zip",function(t,e){if(t)throw t;JSZip.loadAsync(e).then(function(t){try{t.file("sprites.json").async("string").then(function(t){n.makeSprites(t),game.setSpriteJSON()})}catch(t){console.error(JSON.stringify(t))}})})},makeSprites:function(t){var e,n={},i=JSON.parse(t);for(e in i){var r=i[e];n[r.id]=r}return this.sprites=n}})}),define("entity/npcmove",["./character","data/appearancedata","../sprites"],function(t,e,n){return t.extend({init:function(t,e,n,i,r){this._super(t,e,n,i),this.mapIndex=n,this.talkIndex=0,this.name=r},getSprite:function(){if(0<this.sprite[0])return n[this.sprite[0]].sprite},getSpriteName:function(){return game.spriteNames[this.sprite[0]]}})}),define("entity/chest",["./entity"],function(t){return t.extend({init:function(t,e){this._super(t,37)},getSpriteName:function(){return"chest"},isMoving:function(){return!1},open:function(){this.open_callback&&this.open_callback()},onOpen:function(t){this.open_callback=t}})}),define("entity/block",["./entitymoving","../timer"],function(t,e){return t.extend({init:function(t,e,n,i,r,a,s){this._super(t,e,i,n,a,s),this.name=r},pickup:function(t){t.holdingBlock=this,game.client.sendBlock(0,this.id,this.x,this.y)},place:function(t){var e=G_TILESIZE,n=t.nextTile();n[0]=n[0].roundTo(e),n[1]=n[1].roundTo(e),game.mapContainer.isColliding(n[0],n[1])||(this.setPosition(n[0],n[1]),t.holdingBlock=null,game.client.sendBlock(1,this.id,this.x,this.y))}})}),define("entity/node",["./entity"],function(t){return t.extend({init:function(t,e,n){this._super(t,Types.EntityTypes.NODE,e,n),this.level=0,this.stats={},this.idleSpeed=150+random(150)},resetHP:function(){this.stats.hp=this.stats.hpMax},setHP:function(t){t=t||this.stats.hpMax,this.stats.hp=t},setMaxHP:function(t){this.stats.hpMax=t,this.stats.hp=t},die:function(){this.death_callback&&this.death_callback()},onDeath:function(t){this.death_callback=t},getAnimationByName:function(){return this.isDying?this._super("death"):this._super(this.name)}})}),define("entityfactory",["entity/entity","entity/item","entity/mob","entity/npcstatic","entity/npcmove","entity/player","entity/chest","entity/block","entity/node"],function(s,o,l,c,h,u,t,d,p){var e={createEntity:function(t,e,n,i,r,a=0){return n?t==Types.EntityTypes.PLAYER?new u(n,t,i,e,r):t==Types.EntityTypes.MOB?new l(n,t,i,e,r,a):t==Types.EntityTypes.NPCSTATIC?new c(n,t,i,e):t==Types.EntityTypes.ITEM||t==Types.EntityTypes.ITEMLOOT?new o(n,t,i,e,"item"):t==Types.EntityTypes.BLOCK?new d(n,t,i,e,r):t==Types.EntityTypes.TRAP?new s(n,t,i,e,r):t==Types.EntityTypes.NPCMOVE?new h(n,t,i,e,r):t==Types.EntityTypes.NODE?new p(n,i,e):null:(log.info("ERROR - kind is undefined: "+e+" "+n+" "+r,!0),null)}};return e}),!function(){for(var t=String.fromCharCode,c=new Array(65536),e=0;e<65536;e++)c[e]=t(e);var h="";function n(t){return function t(e,n){if("number"==typeof e){var i,r,a=0|e;a!==e?(i=(i=100*(e-a))<(r=0)?1<=(r=(i+1|0)-i)&&r<=1.5?0|i:i-1|0:.5<=i-(r=0|i)?i+1|0:r,e<(r=0)&&(a=0-a,i=0-i,r=1),h+=a<65536?0===a?c[13+r]+c[i+128]:c[13+r]+c[i]+c[a]:c[15+r]+c[a>>16&65535]+c[65535&a]+c[i]):(e<=(r=0)?(e=0-e,r=1):e--,h+=e<116?c[17+e+116*r]:e<65536?c[1+r]+c[e]:c[3+r]+c[e>>16&65535]+c[65535&e])}else if("string"==typeof e){var s=e.length;for(h+=c[7];65535<=s;)s-=65535,h+=c[65535];h+=c[s]+e}else if(!0===e)h+=c[5];else if(!1===e)h+=c[6];else if(null===e)h+=c[0];else if(e instanceof Array){h+=c[8];for(var o=0,s=e.length;o<s;o++)t(e[o],!1);n||(h+=c[9])}else if(e instanceof Object){for(var l in h+=c[10],e)h+=c[17+l.length]+l,t(e[l],!1);n||(h+=c[11])}}(t,!(h="")),h}function i(t){for(var e=0,n=t.length,i=[],r=void 0,a=null,s=0,o=-1,l=!1,c=!1,h="",u=null,d=0;e<n;)if(s=t.charCodeAt(e++),a=i[o],l&&c&&16<s)h=t.substring(e,e+s-17),e+=s-17,c=!1;else if(8===s||10===s)u=new(8===s?Array:Object),c=l=10===s,void 0!==r?a instanceof Array?a.push(u):a[h]=u:r=u,i.push(u),o++;else if(11===s||9===s)i.pop(),c=l=!(i[--o]instanceof Array);else if(16<s)s=115<(s-=17)?0-s+116:s+1,a instanceof Array?a.push(s):a[h]=s,c=!0;else if(0<s&&s<5)0==((s-1)/2|0)?(u=t.charCodeAt(e),e++):(u=(t.charCodeAt(e)<<16)+t.charCodeAt(e+1),e+=2),u=s%2?u+1:0-u,a instanceof Array?a.push(u):a[h]=u,c=!0;else if(12<s&&s<17)0==((s-13)/2|0)?127<(d=t.charCodeAt(e))?(u=0,d-=128,e++):(u=t.charCodeAt(e+1),e+=2):(u=(t.charCodeAt(e)<<16)+t.charCodeAt(e+1),d=t.charCodeAt(e+2),e+=3),u=s%2?u+.01*d:0-(u+.01*d),a instanceof Array?a.push(u):a[h]=u,c=!0;else if(4<s&&s<7)a instanceof Array?a.push(5===s):a[h]=5===s,c=!0;else if(0===s)a instanceof Array?a.push(null):a[h]=null,c=!0;else if(7===s){for(u=0;65535===t.charCodeAt(e);)u+=65535,e++;u+=t.charCodeAt(e++),a instanceof Array?a.push(t.substr(e,u)):a[h]=t.substr(e,u),e+=u,c=!0}return r}"undefined"==typeof window?(exports.encode=n,exports.decode=i):window.BISON={encode:n,decode:i}}(),define("lib/bison",function(){}),define("config",[],function(t){var e={};return fetch("./config/config_build.json").then(t=>t.json()).then(t=>e.build=t),e.waitForConfig=function(t){return e.hasOwnProperty("build")?(t(),!0):(setTimeout(function(){e.waitForConfig(t)},100),!1)},e}),define("chathandler",[],function(){return Class.extend({init:function(t){this.game=t,this.chatLog=$("#chatLog"),this.bumpOffDelay=3e4},show:function(){$("#chatLog").css("display","flex")},processSendMessage:function(t){return this.processSenders(null,t)},processReceiveMessage:function(t,e){return this.processRecievers(t,e)},handleAddSpawn:function(t){log.info("sendAddSpawn");var e=this.game.getMouseGridPosition();2==t.length&&this.game.client.sendAddSpawn(parseInt(t[1]),e.x,e.y)},handleSaveSpawns:function(t){this.game.client.sendSaveSpawns()},handleIdEntity:function(t){var e=this.game.getMouseGridPosition(),n=this.game.getEntityAt(e.x,e.y);n&&this.addToChatLog("entity name: "+n.name+", id: "+n.id+", kind: "+n.kind+", pos: ("+e.x+","+e.y+")")},handleWarp:function(t){var e=this.game.player;e.warpX&&e.warpY&&this.teleportTo(e.warpX,e.warpY)},handlePartyInvite:function(t){this.game.client.sendPartyInvite(t[0],0)},handlePartyLeader:function(t){this.game.client.sendPartyLeader(t[0])},handlePartyLeave:function(t){this.game.client.sendPartyLeave()},handlePartyKick:function(t){this.game.client.sendPartyKick(t[0])},handleAutoPotion:function(t){this.game.useAutoPotion=parseInt(t[0])},processSenders:function(t,e){var n=e.split(" ",5);switch(n||(n[0]=e),n.shift()){case"/as":return this.handleAddSpawn(n),!0;case"/savespawns":return this.handleSaveSpawns(n),!0;case"/id":return this.handleIdEntity(n),!0;case"/warp":return this.handleWarp(n),!0;case"/party":case"/invite":return this.handlePartyInvite(n),!0;case"/leader":return this.handlePartyLeader(n),!0;case"/leave":return this.handlePartyLeave(n),!0;case"/kick":return this.handlePartyKick(n),!0;case"/autopotion":return this.handleAutoPotion(n),!0}var i,r=e.match(/^\/guild\ (invite|create|accept)\s+([^\s]*)|(guild:)\s*(.*)$|^\/guild\ (leave)$/i);if(null!=r){switch(r[1]){case"invite":this.game.player.hasGuild()?this.game.client.sendGuildInvite(r[2]):this.addNotification("You are not in a guild.");break;case"create":this.game.client.sendNewGuild(r[2]);break;case void 0:"leave"===r[5]?this.game.client.sendLeaveGuild():this.game.player.hasGuild()?this.game.client.talkToGuild(r[4]):this.addNotification("You got no-one to talk to");break;case"accept":"yes"===r[2]?!1===(i=this.game.player.checkInvite())?this.addNotification("You were not invited anyway"):i<0?(this.addNotification("Sorry to say it's too late"),setTimeout(function(){s.addNotification("Find someone and ask for another invite.")},2500)):this.game.client.sendGuildInviteReply(this.game.player.invite.guildId,!0):"no"===r[2]?!1!==(i=this.game.player.checkInvite())?(this.game.client.sendGuildInviteReply(this.game.player.invite.guildId,!1),this.game.player.deleteInvite()):this.addNotification("Whatever"):this.addNotification("guild accept is a YES or NO question!!")}return!0}var a=e.substring(0,3),s=this,o={"/g ":function(t){return s.game.player.hasGuild()?s.game.client.talkToGuild(t):s.addNotification("You got no-one to talk to"),!0},"/w ":function(t){var e=s.game.player.name;switch(s.game.player.rights){case 2:e="[Admin]"+e;break;case 1:e="[Moderator]"+e}return s.game.client.sendChat("/s "+e+": "+t),!0},"// ":function(t){return s.game.client.sendChat("// "+s.game.player.name+": "+t),!0},"///":function(t){return s.game.client.sendChat("/// "+s.game.player.name+": "+t),!0}};return a in o&&"function"==typeof o[a]&&o[a](e.substring(3))},processRecievers:function(t,e){var n,a,i;return 0===e.indexOf("/")&&((n=e.split(" ",5))||(n[0]=e),"/rn"===n[0]?(this.addRatingNotification(e.substr(4)),!0):(n=e.substring(0,3),a=this,n in(i={"/1 ":function(t,e){return a.addToChatLog(e),!0},"// ":function(t,e){return a.addToChatLog('<font color="#00BFFF">'+e+"</font>"),!0},"///":function(t,e){for(var n=0,i=e.split(" "),r="",n=0;n<i.length;n++)3!==n&&(r+=i[n]+" ");return a.addToChatLog('<font color="#FFA500">'+r+"</font>"),!0}})&&"function"==typeof i[n]&&i[n](t,e.substring(3))))},bumpOffLog:function(t){t=t||this.bumpOffDelay;$(this.chatLog).scrollTop(999999),setTimeout(function(){$(this.chatLog).find("p:first").remove()},t)},addToChatLog:function(t){t=$('<p style="color: white">'+t+"</p>");$(t).appendTo(this.chatLog),this.bumpOffLog()},addNotification:function(t){t=$('<p style="color: rgba(128, 255, 128, 1)">'+t+"</p>");$(t).appendTo(this.chatLog),this.bumpOffLog()},addNormalChat:function(t,e){t&&(t=$('<p style="color: rgba(255, 255, 0, 1)">'+t.name+": "+e+"</p>"),$(t).appendTo(this.chatLog),this.bumpOffLog())},addGameNotification:function(t,e){t=$('<p style="color: rgba(255, 255, 0, 1)">'+t+": "+e+"</p>");$(t).appendTo(this.chatLog),this.bumpOffLog()},addRatingNotification:function(t){t=$('<p style="color: rgba(255, 255, 0, 1)">'+t+"</p>");$(t).appendTo(this.chatLog),this.bumpOffLog()}})}),define("gameclient",["lib/pako","entity/player","entityfactory","entity/mob","entity/item","data/mobdata","lib/bison","config","chathandler","timer","util"],function(r,t,h,e,n,i,a,s,o,l){return Class.extend({init:function(t,e){var i=this;this.game=t,this.connection=e.connection,this.connection.removeListener("message",e.onMessage),this.connection.on("message",function(t){return i.processMessage(t),!1}),this.useBison=!1,this.enable(),this.tablet=Detect.isTablet(window.innerWidth),this.mobile=Detect.isMobile(),this.handlers={};this.processMessage=function(t){if("2"==t.charAt(0)){var e=_base64ToArrayBuffer(t.substr(1));try{var n=r.inflate(e,{gzip:!0,to:"string"});i.isListening&&(t=i.useBison?a.decode(n):JSON.parse(n))instanceof Array&&(t[0]instanceof Array?i.receiveActionBatch(t):i.receiveAction(t))}catch(t){console.log(t)}}else{n=t.substr(1);i.isListening&&(t=i.useBison?a.decode(n):JSON.parse(n))instanceof Array&&(t[0]instanceof Array?i.receiveActionBatch(t):i.receiveAction(t))}},log.info("Starting client/server handshake")},setHandlers:function(){this.handlers[Types.Messages.SC_AUCTIONOPEN]=this.auction_callback,this.handlers[Types.Messages.SC_CHANGEPOINTS]=this.change_points_callback,this.handlers[Types.Messages.SC_CHAT]=this.chat_callback,this.handlers[Types.Messages.SC_DAMAGE]=this.dmg_callback,this.handlers[Types.Messages.SC_DESTROY]=this.destroy_callback,this.handlers[Types.Messages.SC_GOLD]=this.gold_callback,this.handlers[Types.Messages.SC_ITEMSLOT]=this.itemslot_callback,this.handlers[Types.Messages.SC_ITEMLEVELUP]=this.itemlevelup_callback,this.handlers[Types.Messages.SC_STAT]=this.stat_callback,this.handlers[Types.Messages.SC_LEVELUP]=this.levelup_callback,this.handlers[Types.Messages.SC_DESPAWN]=this.despawn_callback,this.handlers[Types.Messages.SC_SWAPSPRITE]=this.swapsprite_callback,this.handlers[Types.Messages.SC_APPEARANCE]=this.appearance_callback,this.handlers[Types.Messages.SC_MOVE]=this.move_callback,this.handlers[Types.Messages.SC_MOVEPATH]=this.movepath_callback,this.handlers[Types.Messages.SC_NOTIFY]=this.notify_callback,this.handlers[Types.Messages.SC_QUEST]=this.quest_callback,this.handlers[Types.Messages.SC_ACHIEVEMENT]=this.achievement_callback,this.handlers[Types.Messages.SC_SKILLEFFECTS]=this.skilleffects_callback,this.handlers[Types.Messages.SC_SKILLLOAD]=this.skillLoad_callback,this.handlers[Types.Messages.SC_SKILLXP]=this.skillxp_callback,this.handlers[Types.Messages.SC_SPAWN]=this.receiveSpawn,this.handlers[Types.Messages.SC_SPEECH]=this.speech_callback,this.handlers[Types.Messages.SC_DIALOGUE]=this.dialogue_callback,this.handlers[Types.Messages.SC_STATINFO]=this.statInfo_callback,this.handlers[Types.Messages.SC_TELEPORT_MAP]=this.teleportmap_callback,this.handlers[Types.Messages.SC_BLOCK_MODIFY]=this.block_callback,this.handlers[Types.Messages.SC_PARTY]=this.party_callback,this.handlers[Types.Messages.SC_LOOKS]=this.looks_callback,this.handlers[Types.Messages.SC_PLAYERINFO]=this.playerinfo_callback,this.handlers[Types.Messages.SC_HARVEST]=this.harvest_callback,this.handlers[Types.Messages.SC_SET_SPRITE]=this.set_sprite_callback,this.handlers[Types.Messages.SC_SET_ANIMATION]=this.set_animation_callback},enable:function(){this.isListening=!0},disable:function(){this.isListening=!1},sendMessage:function(t){if(!0===this.connection.connected){t=this.useBison?a.encode(t):JSON.stringify(t);try{this.connection.send("1"+t)}catch(t){console.log(t)}}},receiveAction:function(t){var e=t.shift();this.handlers[e]&&_.isFunction(this.handlers[e])?this.handlers[e].call(this,t):log.error("Unknown action : "+e)},receiveActionBatch:function(t){var e=this;_.each(t,function(t){e.receiveAction(t)})},receiveSpawn:function(t){var e,n,i=parseInt(t[0]),r=parseInt(t[1]),a=parseInt(t[2]),s=0<t[3].length?t[3]:null,o=parseInt(t[4]),l=parseInt(t[5]),c=parseInt(t[6]);game.mapContainer.ready&&game.mapContainer.mapIndex==parseInt(o)&&i!=game.player.id&&(this.game.entityIdExists(i)&&(n=this.game.getEntityById(i),game.removeEntity(n)),r==Types.EntityTypes.ITEM||r==Types.EntityTypes.ITEMLOOT?((e=h.createEntity(r,a,i,o,s)).orientation=parseInt(t[7]),e.count=parseInt(t[8]),e.setPosition(l,c),this.spawn_item_callback&&this.spawn_item_callback(t,e)):r==Types.EntityTypes.CHEST?((e=h.createEntity(r,a,i,o,s)).setPosition(l,c),this.spawn_chest_callback&&this.spawn_chest_callback(t,e)):(e=parseInt(t[8]),(n=h.createEntity(r,a,i,o,s,e)).setPosition(l,c),this.spawn_character_callback&&this.spawn_character_callback(t,n)))},onParty:function(t){this.party_callback=t},onLooks:function(t){this.looks_callback=t},onPlayerInfo:function(t){this.playerinfo_callback=t},onDispatched:function(t){this.dispatched_callback=t},onDisconnected:function(t){this.disconnected_callback=t},onLogin:function(t){this.login_callback=t},onSpawnCharacter:function(t){this.spawn_character_callback=t},onSpawnItem:function(t){this.spawn_item_callback=t},onSpawnChest:function(t){this.spawn_chest_callback=t},onDespawnEntity:function(t){this.despawn_callback=t},onEntityMove:function(t){this.move_callback=t},onEntityMovePath:function(t){this.movepath_callback=t},onPlayerTeleportMap:function(t){this.teleportmap_callback=t},onChatMessage:function(t){this.chat_callback=t},onCharacterDamage:function(t){this.dmg_callback=t},onPlayerStat:function(t){this.stat_callback=t},onPlayerLevelUp:function(t){this.levelup_callback=t},onPlayerItemLevelUp:function(t){this.itemlevelup_callback=t},onEntityDestroy:function(t){this.destroy_callback=t},onCharacterChangePoints:function(t){this.change_points_callback=t},onNotify:function(t){this.notify_callback=t},onDialogue:function(t){this.dialogue_callback=t},onQuest:function(t){this.quest_callback=t},onAchievement:function(t){this.achievement_callback=t},onItemSlot:function(t){this.itemslot_callback=t},onSkillInstall:function(t){this.skillInstall_callback=t},onSkillLoad:function(t){this.skillLoad_callback=t},onSkillXP:function(t){this.skillxp_callback=t},onSkillEffects:function(t){this.skilleffects_callback=t},onStatInfo:function(t){this.statInfo_callback=t},onAuction:function(t){this.auction_callback=t},onWanted:function(t){this.wanted_callback=t},onAggro:function(t){this.aggro_callback=t},onSpeech:function(t){this.speech_callback=t},onMapStatus:function(t){this.mapstatus_callback=t},onSetSprite:function(t){this.set_sprite_callback=t},onSetAnimation:function(t){this.set_animation_callback=t},onGold:function(t){this.gold_callback=t},onProducts:function(t){this.products_callback=t},onSwapSprite:function(t){this.swapsprite_callback=t},onAppearance:function(t){this.appearance_callback=t},onBlockModify:function(t){this.block_callback=t},onHarvest:function(t){this.harvest_callback=t},sendMoveEntity:function(t,e){this.sendMessage([Types.Messages.CS_MOVE,getWorldTime(),t.id,e,t.orientation,t.x,t.y])},sendMovePath:function(t,e,n){var i=n;t.followingMode&&i.pop();n=(n=[Types.Messages.CS_MOVEPATH,getWorldTime(),t.id,t.getOrientation(n[0],n[1]),t.interrupted?1:0]).concat(i);this.sendMessage(n)},sendDropItem:function(t,e,n){this.sendMessage([Types.Messages.CS_DROP,e,n,t.id])},sendAttack:function(t,e,n){this.sendMessage([Types.Messages.CS_ATTACK,getWorldTime(),e.id,t.orientation,n])},sendChat:function(t){this.sendMessage([Types.Messages.CS_CHAT,t])},sendLoot:function(t){this.sendMessage([Types.Messages.CS_LOOT].concat(_.pluck(t,"id")))},sendTeleportMap:function(t){this.sendMessage([Types.Messages.CS_TELEPORT_MAP,t[0],t[1],t[2],t[3]])},sendWho:function(t){(t=t||[]).unshift(0<t.length?2:1),t.unshift(Types.Messages.CS_WHO),this.sendMessage(t)},sendDelist:function(t){t.unshift(Types.Messages.CS_DELIST),this.sendMessage(t)},sendTalkToNPC:function(t,e){this.sendMessage([Types.Messages.CS_TALKTONPC,t,e])},sendQuest:function(t,e,n){this.sendMessage([Types.Messages.CS_QUEST,t,e,n])},sendItemSlot:function(t){this.sendMessage([Types.Messages.CS_ITEMSLOT].concat(t))},sendSkill:function(t,e){this.sendMessage([Types.Messages.CS_SKILL,t,e])},sendShortcut:function(t,e,n){this.sendMessage([Types.Messages.CS_SHORTCUT,t,e,n])},sendSkillLoad:function(){this.sendMessage([Types.Messages.CS_SKILLLOAD])},sendStoreSell:function(t,e){this.sendMessage([Types.Messages.CS_STORESELL,t,e])},sendStoreBuy:function(t,e,n){this.sendMessage([Types.Messages.CS_STOREBUY,t,e,n])},sendStoreCraft:function(t,e){this.sendMessage([Types.Messages.CS_CRAFT,t,e])},sendPlayerInfo:function(){this.sendMessage([Types.Messages.CS_REQUEST,2])},sendAuctionOpen:function(t){this.sendMessage([Types.Messages.CS_AUCTIONOPEN,t])},sendAuctionSell:function(t,e){this.sendMessage([Types.Messages.CS_AUCTIONSELL,t,e])},sendAuctionBuy:function(t,e){this.sendMessage([Types.Messages.CS_AUCTIONBUY,t,e])},sendAuctionDelete:function(t,e){this.sendMessage([Types.Messages.CS_AUCTIONDELETE,t,e])},sendStoreEnchant:function(t,e){this.sendMessage([Types.Messages.CS_STORE_MODITEM,1,t,e])},sendStoreRepair:function(t,e){this.sendMessage([Types.Messages.CS_STORE_MODITEM,0,t,e])},sendGold:function(t,e,n){this.sendMessage([Types.Messages.CS_GOLD,parseInt(t),parseInt(e),parseInt(n)])},sendMapStatus:function(t,e){this.sendMessage([Types.Messages.CS_MAP_STATUS,t,e])},sendPlayerRevive:function(){this.sendMessage([Types.Messages.CS_REQUEST,1])},sendColorTint:function(t,e){this.sendMessage([Types.Messages.CS_COLOR_TINT,t,e])},sendAppearanceList:function(){this.sendMessage([Types.Messages.CS_REQUEST,0])},sendAppearanceUnlock:function(t,e){e=e||0,this.sendMessage([Types.Messages.CS_APPEARANCEUNLOCK,t,e])},sendLook:function(t,e){this.sendMessage([Types.Messages.CS_LOOKUPDATE,t,e])},sendAddStat:function(t,e){this.sendMessage([Types.Messages.CS_STATADD,t,e])},sendLootMove:function(t){this.sendMessage([Types.Messages.CS_LOOT,t.id,t.x,t.y])},sendBlock:function(t,e,n,i){this.sendMessage([Types.Messages.CS_BLOCK_MODIFY,t,e,n,i])},sendPartyInvite:function(t,e){this.sendMessage([Types.Messages.CS_PARTY,1,t,e])},sendPartyKick:function(t){this.sendMessage([Types.Messages.CS_PARTY,2,t,0])},sendPartyLeader:function(t){this.sendMessage([Types.Messages.CS_PARTY,3,t,0])},sendPartyLeave:function(){this.sendMessage([Types.Messages.CS_PARTY,4,"",0])},sendHarvest:function(t,e){this.sendMessage([Types.Messages.CS_HARVEST,t,e])},sendHarvestEntity:function(t){this.sendMessage([Types.Messages.CS_USE_NODE,t.id])}})}),define("text!data/../../shared/data/skills2.json",function(){return'[\r\n{\r\n    "name":"Beserker",\r\n    "skillType":0,\r\n    "recharge": 30,\r\n    "iconOffset": [1,7],\r\n    "detail": "Beserker [l] - Boosts your attack by 3xlevel for 10 seconds,",\r\n    "targetType": 0,\r\n    "duration": 10,\r\n    "effects": [[0, 0, 2, 3],[0, 1, 2, -3]]\r\n},\r\n{\r\n    "name":"Explosive Attack",\r\n    "skillType":2,\r\n    "recharge":10,\r\n    "iconOffset": [3,12],\r\n    "detail": "Explosive Attack [l] - AOE NOT IMPLEMENTED",\r\n    "targetType": 1,\r\n    "countTotal": 1,\r\n    "aoe": 3,\r\n    "effects": [[1, 0, 4, 50]]\r\n},\r\n{\r\n    "name":"Deadly Attack",\r\n    "skillType":2,\r\n    "recharge":10,\r\n    "iconOffset": [4,7],\r\n    "detail": "Deadly Attack [l] - Does an attack of 150 damage per level.",\r\n    "targetType": 1,\r\n    "countTotal": 1,\r\n    "effects": [[1, 0, 4, 150]]\r\n},\r\n{\r\n    "name":"Daze",\r\n    "skillType":1,\r\n    "recharge":30,\r\n    "iconOffset": [0,12],\r\n    "detail": "Daze [l] - Dazes the target for [dpl]% seconds.",\r\n    "targetType": 1,\r\n    "durationPL": 1,\r\n    "effects": [[1, 0, 5, 1],[1, 1, 5, 0]]\r\n},\r\n{\r\n    "name":"Slow",\r\n    "skillType":1,\r\n    "recharge":20,\r\n    "iconOffset": [3,5],\r\n    "detail": "Slow [l] - Slows target for [dpl]% seconds.",\r\n    "targetType": 1,\r\n    "durationPL": 1,\r\n    "effects": [[1, 0, 6, 100],[1, 1, 6, -100]]\r\n}\r\n\r\n]\r\n'}),EffectType=Class.extend({init:function(t,e,n,i){this.entity=null,this.isTarget=t,this.phase=e,this.stat=n,this.modValue=i||0,this.active=!1}}),function(t){var e=[];for(rec in t)e.push(new EffectType(1==rec[0],rec[1],rec[2],rec[3]))});function PlayerSummary(t,e){return this.index=t,this.name=e.name,this.exp=e.exp||0,this.colors=e.colors||[0,0],this.sprites=e.sprites||[0,0],this}define("data/skilldata",["text!../../shared/data/skills2.json"],function(t){Skill={Data:[]};var e,n=JSON.parse(t);for(e in n){var i=n[e];console.info(JSON.stringify(i)),Skill.Data.push({name:i.name,iconOffset:i.iconOffset,detail:i.detail,skillType:i.skillType,targetType:i.targetType||0,duration:i.duration||0,durationPL:i.durationPL||0,recharge:i.recharge?1e3*i.recharge:0,aoe:i.aoe||0,countTotal:i.countTotal||0,effectTypes:getSkillEffects(i.effects)})}return Skill.jqShowSkill=function(t,e,n){e=Skill.Data[e].iconOffset;t.css({"background-size":"auto","background-image":'url("img/3/misc/skillicons.png")',"background-position":24*-e[0]*3+"px "+24*-e[1]*3+"px","background-repeat":"no-repeat"}),n&&n.html("")},log.info(JSON.stringify(Skill)),Skill}),define("skillhandler",["entity/mob","data/skilldata","entity/character"],function(t,a,e){for(var n=Class.extend({init:function(t){this.level=0,this.slots=[],this.skillId=t,this.data=a.Data[t]},getName:function(){return this.skillData.name},getLevel:function(){return this.level},setLevel:function(t){this.level=t},clear:function(){},add:function(t){this.slots.push(t)},remove:function(t){t=this.slots.indexOf(t);0<=t&&this.slots.splice(t,1)}}),r=(n.extend({}),n.extend({init:function(t){this._super(t),this.cooltime=this.data.recharge/1e3,this.cooltimeCounter=0,this.cooltimeTickHandle=null,this.cooltimeDoneHandle=null,this.executingHandler=null},clear:function(){this.cooltimeTickHandle&&(clearInterval(this.cooltimeTickHandle),this.cooltimeTickHandle=null),this.cooltimeDoneHandle&&(clearTimeout(this.cooltimeDoneHandle),this.cooltimeDoneHandle=null)},execute:function(){if(!this.cooltimeDoneHandle){if(2==this.data.skillType){if(!(!this.cooltimeDoneHandle&&game.player.hasTarget()&&game.player.target instanceof e))return game.chathandler.addNotification("No target chosen."),!1;this.execute_callback?this.execute_callback(this,game):game.makePlayerAttack(game.player.target,this.skillId)}else if(1==this.data.skillType){if(!(!this.cooltimeDoneHandle&&game.player.hasTarget()&&game.player.target instanceof e))return game.chathandler.addNotification("No target chosen."),!1;this.execute_callback?this.execute_callback(this,game):game.client.sendSkill(this.skillId,game.player.target.id)}else 0!=this.data.skillType||this.cooltimeDoneHandle||(this.execute_callback?(log.info("execute_callback"),this.execute_callback(this,game)):game.client.sendSkill(this.skillId,0));return this.cooldown(this.cooltime),game.player.skillHandler.pushActiveSkill(this),!0}game.chathandler.addNotification("Wait for cooldown.")},cooldown:function(t){function e(){if(0<=n.cooltimeCounter){--n.cooltimeCounter;for(var t of n.slots)t.tick(n),0==n.cooltimeCounter&&t.done()}else clearInterval(n.cooltimeTickHandle),n.cooltimeTickHandle=null}var n=this;this.cooltimeCounter=t;clearTimeout(this.cooltimeTickHandle),this.cooltimeTickHandle=setInterval(e,1e3),e()},tick:function(t){},done:function(t){self.cooltimeCounter=0},onExecuting:function(t){this.executingHandler=t}})),s={make:function(t){return t in s.Skills?new s.Skills[t](t):null},Skills:{}},i=0;i<a.Data.length;++i){a.Data[i].name;s.Skills[i]=r}log.info("SKillFactory.Skills:"+JSON.stringify(s.Skills));Class.extend({init:function(t,e,n){this.parent=t,this.index=parseInt(e),this.skillId=parseInt(n),this.background=$("#skill"+e),this.body=$("#skill"+e+"Body"),this.cooltime=$("#skill"+e+"Cooltime"),this.levels=[],this.data=a.Data[n],(game.renderer.tablet||game.renderer.mobile)&&this.body.html("");function i(t){var e;ShortcutData&&(e=ShortcutData.index,t=parseInt(t),e=parseInt(e),game.shortcuts.install(2,t,e),game.skillDialog.page.clearHighlight(),ShortcutData=null)}var r=this;this.body.data("slot",this.index),this.background.bind("click tap"),this.assign(n);this.body.on("click tap",function(t){log.info("click"),ShortcutData?i($(this).data("slot")):r.execute(),t.stopPropagation()}),this.body.unbind("dragover").bind("dragover",function(t){t.preventDefault()}),this.body.unbind("drop").bind("drop",function(t){i($(this).data("slot"))})},clear:function(){this.skill&&(this.skill.clear(),this.cooltime.css("display","none"))},hideShortcut:function(){this.body.css({"background-image":"","background-position":""}),this.body.attr("title","")},displayShortcut:function(){var t,e;this.skill&&(t=game.renderer.mobile?1:game.renderer.getUiScaleFactor(),e=this.data.iconOffset,log.info("this.name="+this.data.name),this.body.css({"background-image":'url("img/'+t+'/misc/skillicons.png")',"background-position":24*-e[0]*t+"px "+24*-e[1]*t+"px","background-repeat":"no-repeat"}))},assign:function(t){this.skill&&this.skill.remove(this),this.skill=this.parent.getSkill(t),this.skill?(this.skill.add(this),game.renderer.getScaleFactor(),this.displayShortcut(),this.body.attr("title",name),this.setLevel(this.skill.level)):(this.body.css({"background-image":"","background-position":""}),this.body.attr("title",""))},execute:function(){return!!this.skill&&(this.skill&&this.skill instanceof r?this.skill.execute(this.parent.game):void 0)},execute_:function(t){},tick:function(t){},done:function(){}});return Class.extend({init:function(t){this.game=t,this.skills=[],this.container=$("#skillcontainer"),this.activeSkills=[];var e=this;e.isDragging=!1,this.container.bind("touchstart",function(t){e.isClicked=!0}),this.container.mousedown(function(){e.isClicked=!0}),this.container.mousemove(function(){e.isDragging=!0}),this.container.mouseup(function(t){e.isDragging=!1,e.isClicked=!1}),this.container.bind("touchend",function(t){e.isDragging=!1,e.isClicked=!1})},moveShortcuts:function(){this.container.css({left:this.game.mouse.x+"px",top:this.game.mouse.y+"px"})},displayShortcuts:function(){},hideShortcuts:function(){},getSkill:function(t){return log.info("skillId="+t),this.skills.In(t)?this.skills[t]:null},clear:function(){},addAll:function(t){sl=t.length;for(var e=0;e<sl;++e)this.add(e,t[e])},add:function(t,e){var n,i=null;t in this.skills?i=this.skills[t]:(i=s.make(t))&&(i instanceof r&&(n=this,i.onExecuting(function(t){n.game.chathandler.addNotification("You have to wait for "+t.name+" to cool down.")})),this.skills[t]=i),i&&i.setLevel(Types.getSkillLevel(e))},pushActiveSkill:function(t){this.activeSkills.push(t)},showActiveSkill:function(){}})}),define("quest",["data/npcdata","data/questdata","data/mobdata","data/itemlootdata"],function(i,t,r,a){function e(t){var e={toArray:function(t){return[t.type,t.kind,t.count]},toClient:function(t){return[t.type,t.kind,t.count]}};return e.type=t[0],e.kind=t[1]||0,e.count=t[2]||0,e}return Class.extend({init:function(t){this.update(t)},update:function(t){t=t.parseInt();this.id=t[0],this.type=t[1],this.npcQuestId=t[2],this.count=t[3],this.status=t[4],this.data1=t[5],this.data2=t[6],isNaN(t[7])||(this.object=e([t[7],t[8],t[9]])),this.object2=null,13!=t.length||isNaN(t[10])||(this.object2=e([t[10],t[11],t[12]])),this.setDesc()},setDesc:function(t){var e,n,i=lang.data.QUESTS[parseInt(this.id).toString()];if(i)t=t||i[this.status];else{switch(this.type){case QuestType.HIDEANDSEEK:e="QUESTS_FIND",n="HIDEANDSEEK";break;case QuestType.KILLMOBKIND:e="QUESTS_MOB",n="KILLMOBKIND";break;case QuestType.GETITEMKIND:e="QUESTS_ITEM",n="GETITEMKIND";break;case QuestType.USENODE:e="QUESTS_NODE",n="USENODE"}i=lang.data[e];t=t||i[0][this.status]}if(t){var r,a=0;for(r of t=Array.isArray(t)?t:[[0,t]]){var s=Array.isArray(r)?r[1]:r,s=this.setTextTemplate(s);t[a++]=[Array.isArray(r)?r[0]:0,s]}this.desc=t;i=lang.data.QUEST_SUMMARY,i=i.hasOwnProperty(this.id)?i[this.id]:i[n];this.summary=this.setTextTemplate(i)}else this.desc=""},setTextTemplate:function(t){var e,n;return this.type==QuestType.GETITEMKIND&&(this.object2&&(n=a[this.object2.kind],t=(t=t.replace(/%name%/g,n.name.capitalizeFirstLetter())).replace(/%count%/g,this.object2.count)),this.object)&&(e=r.Kinds[this.object.kind])&&(t=t.replace(/%name2%/g,e.key.capitalizeFirstLetter())),this.type==QuestType.KILLMOBKIND&&this.object&&(e=r.Kinds[this.object.kind],t=(t=t.replace(/%name%/g,e.key.capitalizeFirstLetter())).replace(/%count%/g,this.object.count)),this.type==QuestType.HIDEANDSEEK&&this.object&&(n=i.Kinds[this.object.kind],t=t.replace("%name%",n.name)),t=(t=this.type==QuestType.USENODE&&this.object?t.replace(/%count%/g,this.object.count):t).replace("%count2%",this.count)}})}),define("achievement",[],function(){return Class.extend({init:function(t){this.update(t)},update:function(t){t=t.parseInt(),this.index=t[0],this.type=t[1],this.rank=t[2]||0,this.objectType=t[3]||0,this.objectKind=t[4]||0,this.count=t[5]||0,this.objectCount=t[6]||0,t=this.objectCount;1e6<=t?t=Number(t/1e6).toFixed(1).replace(/[.,]0$/,"")+"M":1e3<=t&&(t=Number(t/1e3).toFixed(1).replace(/[.,]0$/,"")+"K"),this.summary=lang.data["ACHIEVEMENTS_"+this.index].format(t)}})}),define("userclient",["gameclient","skillhandler","quest","config","achievement"],function(t,y,v,n,b){return Class.extend({init:function(t,e){this.connection=null,this.config=t,this.handlers={},this.handlers[Types.Messages.BI_SYNCTIME]=this.onSyncTime,this.handlers[Types.Messages.SC_ERROR]=this.onError,this.handlers[Types.Messages.SC_VERSION]=this.onVersion,this.handlers[Types.Messages.SC_PLAYER]=this.onPlayer,this.handlers[Types.Messages.SC_PLAYER_SUM]=this.onPlayerSummary,this.handlers[Types.Messages.SC_WORLDS]=this.onWorlds,this.useBison=!1,this.versionChecked=!1,this.useServer=e,this.enable(),this.connect()},enable:function(){this.isListening=!0},disable:function(){this.isListening=!1},connect:function(){var e=this,t=this.config.protocol+"://"+this.config.host+":"+this.config.port+"/";log.info("Trying to connect to server : "+t),app.$loginInfo.text("Connecting to RRO2 server..."),(e=this).connection=io(t,{forceNew:!0,reconnection:!1,timeout:1e4,transports:["websocket"]}),e.connection.on("connect",function(){log.info("Connected to server "+e.config.host+":"+e.config.port),e.onConnected()}),e.connection.on("connect_error",function(t){e._onError(["There has been an error connecting to RSO server try again soon."]),log.error(t,!0)}),e.onMessage=function(t){console.warn("recv: "+t);t=t.split(",");e.receiveAction(t)},e.connection.on("message",this.onMessage),e.connection.on("error",function(t){e._onError(["There has been an error connecting to RSO server try again soon."]),log.error(t,!0)}),e.connection.on("disconnect",function(){log.debug("Connection closed"),e.disconnected_callback&&(e.isTimeout?e._onError(["You have been disconnected for being inactive for too long"]):e._onError(["The connection to RRO2 has been lost."]))})},receiveAction:function(t){var e=t.shift();this.handlers[e]&&_.isFunction(this.handlers[e])?this.handlers[e].call(this,t):log.error("Unknown action : "+e)},sendMessage:function(t){if(!0===this.connection.connected){console.warn("sent="+JSON.stringify(t)),t=this.useBison?BISON.encode(t):JSON.stringify(t);try{this.connection.send("1"+t)}catch(t){console.log(t)}}},onConnected:function(){log.info("Starting client/server handshake"),this.sendSyncTime()},onPlayerSummary:function(t){user.setPlayerSummary(t);for(var e=user.playerSum.length,n=0;n<e;++n){var i=user.playerSum[n],i=i.name+" Lv"+Types.getLevel(i.exp),i=new Option(i,n);$("#player_select").append(i)}app.loadWindow("user_window","player_window"),$("#player_select").focus(),0<e&&($('#player_select option[value="'+(e-1)+'"]').attr("selected",!0),app.showPlayerLoad()),0==e?app.showPlayerCreate():$("#player_create_form").hide()},onWorlds:function(t){for(var e=0;e<t.length;e+=4)$("#player_server").append("<option value="+t[e]+">"+t[e+1]+" "+t[e+2]+"/"+t[e+3]+"</option");$("#user_create").removeClass("loading"),$("#user_load").removeClass("loading"),app.$loginInfo.text("Connected.")},_onError:function(t){t=t[0];$("#container").addClass("error"),$("#errorwindow .errordetails").html("<p>"+t+"</p>"),app.loadWindow("loginwindow","errorwindow")},onVersion:function(t){this.versionChecked=!0;var e=t[0],t=t[1];this.hashChallenge=t,log.info("onVersion: hash="+t),log.info("config.build.version="+n.build.version),e!=n.build.version&&($("#container").addClass("error"),t="Please download the new version of RRO2.<br/>",game.renderer.isMobile?t+="<br/>For mobile see: "+n.build.updatepage:t+="<br/>For most browsers press Ctrl+F5 to reload the game cache files.",game.clienterror_callback(t),this.tablet||this.mobile)&&window.location.replace(n.build.updatepage)},onSyncTime:function(t){setWorldTime(parseInt(t[0]),parseInt(t[1]))},onError:function(t){switch(t[0]){case"full":case"invalidlogin":case"userexists":case"playerexists":case"loggedin":case"invalidusername":case"ban":case"passwordChanged":case"timeout":return void app.info_callback(t);case"timeout":return app.info_callback(t),void(self.isTimeout=!0)}this._onError(t)},onPlayer:function(t){t.shift(),t.shift();var e=game.player,n=(e.id=parseInt(t.shift()),e.name=t.shift(),e.mapIndex=parseInt(t.shift()),e.orientation=Types.Orientations.DOWN,e.x=parseInt(t.shift()),e.y=parseInt(t.shift()),e.setPositionSpawn(e.x,e.y),e.setMaxHP(parseInt(t.shift())),e.setMaxEP(parseInt(t.shift())),e.exp={base:parseInt(t.shift()),attack:parseInt(t.shift()),defense:parseInt(t.shift()),move:parseInt(t.shift()),sword:parseInt(t.shift()),bow:parseInt(t.shift()),hammer:parseInt(t.shift()),axe:parseInt(t.shift()),logging:parseInt(t.shift()),mining:parseInt(t.shift())},e.level={base:Types.getLevel(e.exp.base),attack:Types.getAttackLevel(e.exp.attack),defense:Types.getDefenseLevel(e.exp.defense),move:Types.getMoveLevel(e.exp.move),sword:Types.getWeaponLevel(e.exp.sword),bow:Types.getWeaponLevel(e.exp.bow),hammer:Types.getWeaponLevel(e.exp.hammer),axe:Types.getWeaponLevel(e.exp.axe)},e.colors=[],e.colors[0]=parseInt(t.shift()),e.colors[1]=parseInt(t.shift()),e.gold=[],e.gold[0]=parseInt(t.shift()),e.gold[1]=parseInt(t.shift()),e.gems=parseInt(t.shift()),game.inventoryHandler.setCurrency(e.gold[0],e.gems),game.bankHandler.setGold(e.gold[1]),e.setMoveRate(500-e.level.move),e.stats.attack=parseInt(t.shift()),e.stats.defense=parseInt(t.shift()),e.stats.health=parseInt(t.shift()),e.stats.energy=parseInt(t.shift()),e.stats.luck=parseInt(t.shift()),e.stats.free=parseInt(t.shift()),parseInt(t.shift()));if(0<n){for(var i=[],r=t.splice(0,6*n).parseInt(),a=0;a<n;++a){var s=new ItemRoom(r[(c=6*a)+0],r[c+1],r[c+2],r[c+3],r[c+4],r[c+5]);i.push(s)}game.equipmentHandler.setEquipment(i)}if(e.sprites=[],e.sprites[0]=parseInt(t.shift()),e.sprites[1]=parseInt(t.shift()),e.setWeaponSprite(),e.setArmorSprite(),e.setRange(),0<(n=parseInt(t.shift()))){for(i=[],r=t.splice(0,6*n).parseInt(),a=0;a<n;++a){s=new ItemRoom(r[(c=6*a)+0],r[c+1],r[c+2],r[c+3],r[c+4],r[c+5]);i.push(s)}game.inventoryHandler.initInventory(i)}if(0<(n=parseInt(t.shift()))){for(i=[],r=t.splice(0,6*n).parseInt(),a=0;a<n;++a){s=new ItemRoom(r[(c=6*a)+0],r[c+1],r[c+2],r[c+3],r[c+4],r[c+5]);i.push(s)}game.bankHandler.initBank(i)}e.quests={};var o=parseInt(t.shift());if(0<o){var l=t.splice(0,13*o);l.parseInt();for(a=0;a<o;++a){var c=13*a;e.quests[l[c]]=new v(l.slice(c,c+13))}}e.achievements=[];var h=parseInt(t.shift());if(0<h){for(var u=t.splice(0,7*h),a=(u.parseInt(),0);a<h;++a){var c=7*a,d=new b(u.slice(c,c+7));e.achievements.push(d)}game.achievementHandler.achievementReloadLog()}e.skillHandler=new y(self);var p=parseInt(t.shift()),p=t.splice(0,p),f=(p.parseInt(),e.setSkills(p),game.skillDialog.page.setSkills(p),parseInt(t.shift()));if(0<f){for(var m=t.splice(0,3*f),g=(m.parseInt(),[]),a=0;a<f;++a){c=3*a;g.push(m.slice(c,c+3))}game.shortcuts.installAll(g)}game.onPlayerLoad(e)},sendSyncTime:function(){log.info("sendSyncTime"),this.sendMessage([Types.Messages.BI_SYNCTIME,Date.now()])},sendLoginUser:function(t){this.sendMessage([Types.Messages.CS_LOGIN_USER,t.username,t.hash])},sendCreateUser:function(t){this.sendMessage([Types.Messages.CS_CREATE_USER,t.username,t.hash])},sendRemoveUser:function(t){this.sendMessage([Types.Messages.CS_REMOVE_USER,t.username,t.hash])},sendLoginPlayer:function(t,e){this.sendMessage([Types.Messages.CS_LOGIN_PLAYER,t,e])},sendCreatePlayer:function(t,e){this.sendMessage([Types.Messages.CS_CREATE_PLAYER,t,e])}})}),!function(){function y(t){throw t}function v(t,e){for(var n=[],i=(1<<e)-1,r=t.length*e,a=0;a<r;a+=e)n[a>>>5]|=(t.charCodeAt(a/e)&i)<<32-e-a%32;return{value:n,binLen:r}}function b(t){var e,n,i=[],r=t.length;for(0!=r%2&&y("String of HEX type must be in byte increments"),e=0;e<r;e+=2)n=parseInt(t.substr(e,2),16),isNaN(n)&&y("String of HEX type contains invalid characters"),i[e>>>3]|=n<<24-e%8*4;return{value:i,binLen:4*r}}function k(t){var e,n,i,r,a,s=[],o=0;for(-1===t.search(/^[a-zA-Z0-9=+\/]+$/)&&y("Invalid character in base-64 string"),e=t.indexOf("="),t=t.replace(/\=/g,""),-1!==e&&e<t.length&&y("Invalid '=' found in base-64 string"),n=0;n<t.length;n+=4){for(a=t.substr(n,4),i=r=0;i<a.length;i+=1)r|=(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[i]))<<18-6*i;for(i=0;i<a.length-1;i+=1)s[o>>2]|=(r>>>16-8*i&255)<<24-o%4*8,o+=1}return{value:s,binLen:8*o}}function w(t,e){for(var n,i="",r=4*t.length,a=0;a<r;a+=1)n=t[a>>>2]>>>8*(3-a%4),i+="0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n);return e.outputUpper?i.toUpperCase():i}function x(t,e){for(var n,i,r="",a=4*t.length,s=0;s<a;s+=3)for(i=(t[s>>>2]>>>8*(3-s%4)&255)<<16|(t[s+1>>>2]>>>8*(3-(s+1)%4)&255)<<8|t[s+2>>>2]>>>8*(3-(s+2)%4)&255,n=0;n<4;n+=1)r=8*s+6*n<=32*t.length?r+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-n)&63):r+e.b64Pad;return r}function S(t){var e={outputUpper:!1,b64Pad:"="};try{t.hasOwnProperty("outputUpper")&&(e.outputUpper=t.outputUpper),t.hasOwnProperty("b64Pad")&&(e.b64Pad=t.b64Pad)}catch(t){}return"boolean"!=typeof e.outputUpper&&y("Invalid outputUpper formatting option"),"string"!=typeof e.b64Pad&&y("Invalid b64Pad formatting option"),e}function f(t,e){var n=(65535&t)+(65535&e);return((t>>>16)+(e>>>16)+(n>>>16)&65535)<<16|65535&n}function m(t,e,n,i,r){var a=(65535&t)+(65535&e)+(65535&n)+(65535&i)+(65535&r);return((t>>>16)+(e>>>16)+(n>>>16)+(i>>>16)+(r>>>16)+(a>>>16)&65535)<<16|65535&a}function T(t,e){var n,i,r,a,s,o,l,c,h,u=[],d=[1732584193,4023233417,2562383102,271733878,3285377520],p=[1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782];for(t[e>>>5]|=128<<24-e%32,t[15+(e+65>>>9<<4)]=e,h=t.length,l=0;l<h;l+=16){for(n=d[0],i=d[1],r=d[2],a=d[3],s=d[4],c=0;c<80;c+=1)u[c]=c<16?t[c+l]:(u[c-3]^u[c-8]^u[c-14]^u[c-16])<<1|(u[c-3]^u[c-8]^u[c-14]^u[c-16])>>>31,o=m(n<<5|n>>>27,c<20?i&r^~i&a:!(c<40)&&c<60?i&r^i&a^r&a:i^r^a,s,p[c],u[c]),s=a,a=r,r=i<<30|i>>>2,i=n,n=o;d[0]=f(n,d[0]),d[1]=f(i,d[1]),d[2]=f(r,d[2]),d[3]=f(a,d[3]),d[4]=f(s,d[4])}return d}window.jsSHA=function(t,e,n){var f,s=null,m=0,g=[0],i=null;8!==(f=void 0!==n?n:8)&&16!==f&&y("charSize must be 8 or 16"),"HEX"===e?(0!=t.length%2&&y("srcString of HEX type must be in byte increments"),i=b(t),m=i.binLen,g=i.value):"ASCII"===e||"TEXT"===e?(i=v(t,f),m=i.binLen,g=i.value):"B64"===e?(i=k(t),m=i.binLen,g=i.value):y("inputFormat must be HEX, TEXT, ASCII, or B64"),this.getHash=function(t,e,n){var i=null,r=g.slice(),a="";switch(e){case"HEX":i=w;break;case"B64":i=x;break;default:y("format must be HEX or B64")}return"SHA-1"===t?a=i(s=null===s?T(r,m):s,S(n)):y("Chosen SHA variant is not supported"),a},this.getHMAC=function(t,e,n,i,r){var a,s,o,l,c,h,u=[],d=[],p=null;switch(i){case"HEX":a=w;break;case"B64":a=x;break;default:y("outputFormat must be HEX or B64")}for("SHA-1"===n?(o=64,h=160):y("Chosen SHA variant is not supported"),"HEX"===e?(c=(p=b(t)).binLen,s=p.value):"ASCII"===e||"TEXT"===e?(c=(p=v(t,f)).binLen,s=p.value):"B64"===e?(c=(p=k(t)).binLen,s=p.value):y("inputFormat must be HEX, TEXT, ASCII, or B64"),t=8*o,e=o/4-1,o<c/8?("SHA-1"===n?s=T(s,c):y("Unexpected error in HMAC implementation"),s[e]&=4294967040):c/8<o&&(s[e]&=4294967040),o=0;o<=e;o+=1)u[o]=909522486^s[o],d[o]=1549556828^s[o];return"SHA-1"===n?l=T(d.concat(T(u.concat(g),t+m)),t+h):y("Unexpected error in HMAC implementation"),a(l,S(r))}}}(),define("lib/sha1",function(){}),PlayerSummary.prototype.toArray=function(){return[this.index,this.name,this.exp,this.colors[0],this.colors[1],this.sprites[0],this.sprites[1]]},PlayerSummary.prototype.toString=function(){return this.toArray().join(",")},define("user",["userclient","entity/player","data/appearancedata","lib/sha1"],function(t,e,n){return Class.extend({init:function(t,e,n){this.client=t,this.username=e.toLowerCase(),this.password=n,this.playerSum=[];t=new jsSHA(this.username+this.password,"ASCII").getHash("SHA-1","HEX"),this.regHash=t,log.info("User init: hash="+void 0),log.info("User init: hashChallenge="+this.client.hashChallenge),e=CryptoJS.AES.encrypt(JSON.stringify(t),this.client.hashChallenge).toString();this.hash=this.hash||btoa(e)},setPlayerSummary:function(t){for(var e=parseInt(t.shift()),n=0;n<e;++n){j=7*n;var i=new PlayerSummary(parseInt(t[j]),{name:t[j+1],exp:parseInt(t[j+2]),colors:[t[j+3],t[j+4]],sprites:[t[j+5],t[j+6]]});this.playerSum.push(i)}},createPlayer:function(t){this.playerSum[t.index]=t;t=new e(0,1,0,0,t.name);return t.user=this,t.keyMove=!1,t.setItems(),t.forceStop=function(){this.keyMove&&this.key_move_callback&&this.key_move_callback(!1),this.keyMove=!1,this.freeze=!1,this._forceStop(),this.idle(),this.fsm="IDLE"},t.canAttack=function(t){return!(0!=this.isDead||!this.attackCooldown.isOver(t))},t.lookAtEntity=function(t){this.isMoving()&&this.forceStop(),this._lookAtEntity(t)},t.hit=function(t){t=t||this.orientation;var e=this;if("MOVEPATH"!=this.fsm)return this.harvestOff(),this.setOrientation(t||0),this.forceStop(),this.fsm="ATTACK",this.animate("atk",this.atkSpeed,1,function(){e.idle(e.orientation),e.forceStop()}),!0},t.canMove=function(t){t=t||this.orientation;var e=this.nextMove(this.x,this.y,t);return 0==t||game.moveCharacter(this,e[0],e[1])},t.sendMove=function(t){!t&&this.sentMove==t||(game.client.sendMoveEntity(this,t),this.sentMove=t)},t.moveTo_=function(t,e,n){if("MOVEPATH"!=this.fsm&&"ATTACK"!=this.fsm)return this.forceStop(),this.harvestOff(),log.info("background - free delay ="+G_LATENCY),this.fsm="MOVEPATH",this.walk(),this._moveTo(t,e,n)},t.move=function(t,e){if(!this.isDying&&!this.isDead&&"ATTACK"!=this.fsm&&"MOVEPATH"!=this.fsm){if(e&&t!=Types.Orientations.NONE){if(this.keyMove&&t==this.orientation)return;if(!this.canMove(t))return;this.setOrientation(t),this.harvestOff(),this.forceStop(),this.fsm="MOVING",this.walk(),this.keyMove=!0}if(!e){if(t!=this.orientation&&this.isMoving())return;this.forceStop()}this.key_move_callback&&this.key_move_callback(e)}},t.setArmorSprite=function(t){var e;t||(e=this.sprites[0],t=game.sprites[n[e].sprite]),this._setArmorSprite(t)},t.setWeaponSprite=function(t){var e;t||(e=this.sprites[1],t=game.sprites[n[e].sprite]),this._setWeaponSprite(t)},game.addPlayerCallbacks(t),t}})}),define("app",["lib/localforage","entity/mob","entity/item","data/mobdata","user","userclient","config"],function(r,t,e,n,a,i,s){return Class.extend({init:function(){(app=this).currentPage=1,this.blinkInterval=null,this.ready=!1,this.initFormFields(),this.dropDialogPopuped=!1,this.auctionsellDialogPopuped=!1,this.inventoryNumber=0,this.classNames=["user_window","player_window"],this.loadWindow(this.classNames[1],this.classNames[0]),r.getItem("user_hash",function(t,e){log.info("val="+e),$("#user_hash").value=e}),r.getItem("user_name",function(t,e){log.info("val="+e),$("#user_name").value=e}),$("#user_password").value="";var e=this;this.$loginInfo=$("#loginInfo"),$("#error_refresh").click(function(t){location.reload()}),$("#cmdQuit").click(function(t){navigator.app.exitApp()}),$("#user_remove").click(function(t){$("#remove_window").show()}),$("#user_close").click(function(t){$("#remove_window").hide()}),$("#user_remove_confirm").click(function(t){"YES"===$("#remove_confirm").val()&&(confirm("DANGER - Remove your account PERMANENTLY?")&&confirm("DANGER - Are you really sure to remove your account FOREVER?")&&app.tryUserAction(3),$("#remove_window").hide())}),$("#player_window").ready(function(){$("#player_create_form").hide(),$("#player_load").hide(),$("#player_create").show()}),$("#player_select").change(function(){-1==$(this).val()?($("#player_load").hide(),$("#player_create").show(),$("#player_create_form").show()):($("#player_load").show(),$("#player_create_form").hide())}),$("#player_create").click(function(){$("#player_create_form").is(":visible")&&e.tryPlayerAction(4),""==$("#player_name").val()&&(app.showPlayerCreate(),$("#player_name").focus())}),this.info_callback=function(t){switch(t[0]){case"timeout":e.addValidationError(null,"Timeout whilst attempting to establish connection to RSO servers.");break;case"invalidlogin":e.addValidationError(null,"The username or password you entered is incorrect.");break;case"userexists":e.$loginInfo.text("Disconnected."),e.addValidationError(null,"The username you entered is not available.");break;case"playerexists":e.addValidationError(null,"The playername you entered is not available.");break;case"invalidusername":e.addValidationError(null,"The username you entered contains invalid characters.");break;case"loggedin":e.addValidationError(null,"A player with the specified username is already logged in.");break;case"ban":e.addValidationError(null,"You have been banned.");break;case"full":e.addValidationError(null,"All RRO2 gameservers are currently full.");break;default:e.addValidationError(null,"Failed to launch the game: "+(result.reason||"(reason unknown)"))}},this.start(),this.connect()},connect:function(){s.waitForConfig(this.userClient.bind(this))},userClient:function(){this.userclient=new i(s.build,this.useServer),this.userclient.fail_callback=function(t){self.info_callback({success:!1,reason:t}),self.started=!1}},setGame:function(t){t.client=t.client,this.isMobile=t.renderer.mobile,this.isTablet=t.renderer.tablet,this.isDesktop=!(this.isMobile||this.isTablet),this.supportsWorkers=!!window.Worker,this.ready=!0,this.initMenuButton(),this.initCombatBar()},initFormFields:function(){this.getLoadUserButton=function(){return $("#user_load")},this.getCreateUserButton=function(){return $("#user_create")},this.getLoadPlayerButton=function(){return $("#player_load")},this.getCreatePlayerButton=function(){return $("#player_create")},this.getBackButton=function(){return $("#player_cancel")},this.$usernameinput=$("#user_name"),this.$userpasswordinput=$("#user_password"),this.userFormFields=[this.$usernameinput,this.$userpasswordinput],this.$playernameinput=$("#player_name"),this.playerFormFields=[this.$playernameinput]},center:function(){window.scrollTo(0,1)},tryUserAction:function(t){var e,n,i;this.starting||0<t&&(e=this.$usernameinput.val(),i=null,""==(n=(3==t?$("#remove_password"):this.$userpasswordinput).val())&&(i=$("#user_hash").val()),log.info("hash="+i),this.validateUserForm(e,n))&&(user=this.user=new a(this.userclient,e,n),this.userclient.user=this.user,$("#user_save").is(":checked")&&(r.setItem("user_name",e),r.setItem("user_hash",this.user.hash)),1==t&&this.userclient.sendLoginUser(this.user),2==t&&this.userclient.sendCreateUser(this.user),3==t)&&this.userclient.sendRemoveUser(this.user)},tryPlayerAction:function(t){var e,n,i,r;this.starting||3!=t&&4!=t||(e=this.$playernameinput.val(),n=parseInt($("#player_select").val()),(4!=t||this.validatePlayerForm(e))&&(i=parseInt($("#player_server").val()),r=null,3==t&&(this.userclient.sendLoginPlayer(i,n),r=user.playerSum[n]),4==t&&(this.userclient.sendCreatePlayer(i,e),r=new PlayerSummary(user.playerSum.length,{name:e})),r)&&this.startGame(i,r))},startGame:function(t,e){$("#gameheading").css("display","none"),game.started||(log.debug("Starting game with build config."),game.useServer=t,this.center(),game.run(t,e),game.start())},start:function(){var t=this;this.getLoadUserButton().click(function(){$("#user_load").hasClass("loading")||t.tryUserAction(1)}),this.getCreateUserButton().click(function(){$("#user_create").hasClass("loading")||t.tryUserAction(2)}),this.getLoadPlayerButton().click(function(){t.tryPlayerAction(3)}),this.getBackButton().click(function(){$("#player_load").is(":visible")?t.loadWindow("player_window","user_window"):t.showPlayerLoad()})},showPlayerLoad:function(){$("#player_load").show(),$("#player_select").show(),$("#lbl_player_select").show(),$("#player_create_form").hide()},showPlayerCreate:function(){$("#player_load").hide(),$("#player_select").hide(),$("#lbl_player_select").hide(),$("#player_create_form").show()},userFormActive:function(){return $("#user_window").is(":visible")},playerFormActive:function(){return $("#player_window").is(":visible")},validateUserForm:function(t,e){if(this.clearValidationErrors(),!t)return this.addValidationError(this.$usernameinput,"Please enter a username."),!1;if(t.length<2&&16<t.length)return this.addValidationError(this.$usernameinput,"Please enter a username between 2 and 16 characters."),!1;if(t===t.replace(/^[A-Za-z0-9]+$/,""))return this.addValidationError(this.$usernameinput,"Please enter username alpha numeric characters only."),!1;if(0<e.length){if(e.length<6&&16<e.length)return this.addValidationError(this.$userpasswordinput,"Please enter a username between 6 and 16 characters."),!1;if(e===e.replace(/^[A-Za-z0-9@!#\$\^%&*()+=\-\[\]\\\';\.\/\{\}\|\":<>\? ]+$/,""))return this.addValidationError(this.$userpasswordinput,"Please enter password alpha numeric, and special characters only."),!1}return!0},validatePlayerForm:function(t){return this.clearValidationErrors(),t?t.length<2&&16<t.length?(this.addValidationError(this.$playernameinput,"Please enter a player name between 2 and 16 characters."),!1):t!==t.replace(/^[A-Za-z0-9]+$/,"")||(this.addValidationError(this.$playernameinput,"Please enter player name alpha numeric characters only."),!1):(this.addValidationError(this.$playernameinput,"Please enter a player name."),!1)},addValidationError:function(e,t){$("<span/>",{class:"validation-error blink",text:t}).appendTo(".validation-summary"),e&&(e.addClass("field-error").select(),e.keypress(function(t){e.removeClass("field-error"),$(".validation-error").remove(),$(this).unbind(t)}))},clearValidationErrors:function(){var t;this.userFormActive()?t=this.userFormFields:this.playerFormActive()&&(t=this.playerFormFields),t&&($.each(t,function(t,e){e.hasClass("field-error")&&e.removeClass("field-error")}),$(".validation-error").remove())},getZoom:function(){return game.renderer.zoom*game.renderer.scaleHUD},setMouseCoordinates:function(t,e){$("#game");var n=game.renderer.scale,i=game.renderer.innerWidth,r=game.renderer.innerHeight,a=game.mouse,s=1/game.renderer.resolution,r=~~(r/s)-1;a.x=~~(clamp(t,0,~~(i/s)-1)*s/n),a.y=~~(clamp(e,0,r)*s/n)},initPlayerBar:function(){game.renderer.tilesize;var t,e,n,i,r=game.player;r&&!Detect.isMobile()&&(t=r.getWeaponSprite(),r=r.getArmorSprite(),width1=t?2*t.width*1.5:0,height1=t?2*t.height*1.5:0,width2=r?2*r.width*1.5:0,height2=r?2*r.height*1.5:0,width3=Math.max(width1,width2),height3=Math.max(height1,height2),e=$("#characterLook2"),n=$("#characterLookArmor2"),i=$("#characterLookWeapon2"),e.css("left",-parseInt(width3/2)+"px"),e.css("top",-parseInt(height3/2)+"px"),e.css("width",width3+"px"),e.css("height",height3+"px"),n.css("left",parseInt((width3-width2)/2)+"px"),n.css("top",parseInt((height3-height2)/2)+"px"),n.css("width",width2+"px"),n.css("height",height2+"px"),n.css("background-size",5*width2+"px"),n.css("background-position","0px -"+8*height2+"px"),i.css("left",parseInt((width3-width1)/2)+"px"),i.css("top",parseInt((height3-height1)/2)+"px"),i.css("width",width1+"px"),i.css("height",height1+"px"),i.css("background-size",5*width1+"px"),i.css("background-position","0px -"+8*height1+"px"),n.css("background-image",'url("'+r.filepath+'")'),i.css("background-image",'url("'+t.filepath+'")'))},npcDialoguePic:function(t){var e=$("#npcDialoguePic"),n=t.sprite,t=t.sprite.animations.idle_down,i=t.col*t.width*2,t=t.row*t.height*2;width2=n?2*n.width:0,height2=n?2*n.height:0,e.css("width",~~width2+"px"),e.css("height",~~(.75*height2)+"px"),e.css("background-position","-"+~~i+"px -"+~~t+"px"),e.css("transform","scale(1.5)"),e.css("background-image",'url("'+n.filepath+'")')},initTargetHud:function(){game.renderer.getScaleFactor();var a=game.renderer.getUiScaleFactor();game.renderer.zoom,game.renderer.tilesize;game.player&&game.player.onSetTarget(function(t,e,n,i){var r="#target";t.title?$(r+" .name").text(t.title):$(r+" .name").text(e+"Lv"+n),$(r+" .name").css("text-transform","capitalize"),t.healthPoints?$(r+" .health").css("width",Math.round(t.healthPoints/t.maxHp*40*a)+"px"):$(r+" .health").css("width",40*a+"px"),$(r).fadeIn("fast")}),game.onUpdateTarget(function(t){log.info("targetHealth: "+t.healthPoints+" "+t.maxHp),$("#target .health").css("width",Math.round(t.healthPoints/t.maxHp*40*a)+"px")}),game.player&&game.player.onRemoveTarget(function(t){$("#target").fadeOut("fast"),$("#target .health").css("width",40*a+"px"),$("#combatContainer").fadeOut("fast")})},initEnergyBar:function(){var i;$("#statbars").width();game.onPlayerEnergyChange(function(t,e){i=$("#statbars").width();var n=Math.round(i/e*(0<t?t:0));$("#energy").css("width",n+"px"),$("#energytext").html("<p>Energy: "+t+"/"+e+"</p>")})},initExpBar:function(){parseInt($("#expbar").width());game.onPlayerExpChange(function(t,e){var n=Types.expForLevel[t-1],e=e-n,n=Types.expForLevel[t]-n;e||n?(parseInt($("#expbar").width()),1<(e=e/n)?e=1:e<0&&(e=0),$("#exp").css("width",100*e+"%"),$("#expbar").attr("title","Exp: "+(100*e).toFixed(0)+"%"),$("#expbar").html("Exp: "+(100*e).toFixed(0)+"%"),$("#explevel").html(t)):($("#exp").css("width","0px"),$("#expbar").attr("title","Exp: 0%"),$("#expbar").html("Exp: 0%"))})},initHealthBar:function(){var i=$("#statbars").width();log.info("healthMaxWidth="+i),game.onPlayerHealthChange(function(t,e){i=$("#statbars").width();var n=Math.round(i/e*(0<t?t:0));$("#health").css("width",n+"px"),$("#healthtext").html("<p>HP: "+t+"/"+e+"</p>")}),game.onPlayerHurt(this.blinkHealthBar.bind(this))},blinkHealthBar:function(){var t=$("#health");t.addClass("white"),setTimeout(function(){t.removeClass("white")},500)},initMenuButton:function(){log.info("initMenuButton"),$(document).ready(function(){$("#menucontainer").css("display","none")}),$("#charactermenu").click(function(t){$("#menucontainer").is(":visible")?$("#menucontainer").fadeOut():$("#menucontainer").show()}),$(window).resize(function(){app.resizeUi()}),$(document).ready(function(){$("#menucontainer").on("click","div",function(t){$("#menucontainer").fadeOut()})}),$("#menucontainer").click(function(t){$("#menucontainer").fadeOut()})},initCombatBar:function(){var e="#combatContainer";$(e).children().click(function(t){$(e).children().removeClass("lightup"),$(this).addClass("lightup")}),$(e).children().eq(1).addClass("lightup")},hideIntro:function(){clearInterval(this.watchNameInputInterval),$("body").removeClass("intro"),setTimeout(function(){$("body").addClass("game")},500)},showChat:function(){game.started&&($("#chatbox").addClass("active"),$("#chatinput").focus(),$("#chatbutton").addClass("active"))},hideChat:function(){game.started&&($("#chatbox").removeClass("active"),$("#chatinput").blur(),$("#chatbutton").removeClass("active"))},showChatLog:function(){game.started&&($("#chatbutton").addClass("active"),$("#chatLog").css("display","none"))},hideChatLog:function(){game.started&&($("#chatbutton").removeClass("active"),$("#chatLog").css("display","flex"))},showDropDialog:function(t){game.started&&($("#dropDialog").show(),$("#dropCount").focus(),$("#dropCount").select(),this.inventoryNumber=t,this.dropDialogPopuped=!0)},hideDropDialog:function(){game.started&&($("#dropDialog").hide(),this.dropDialogPopuped=!1)},showAuctionSellDialog:function(t){game.started&&($("#auctionSellDialog").show(),$("#auctionSellCount").focus(),$("#auctionSellCount").select(),this.inventoryNumber=t,this.auctionsellDialogPopuped=!0)},hideAuctionSellDialog:function(){game.started&&($("#auctionSellDialog").hide(),this.auctionsellDialogPopuped=!1)},hideWindows:function(){},loadWindow:function(t,e){$("#"+t).hide(),$("#"+e).show(),"player_window"==e&&$("#user_remove").show(),this.initFormFields()},resizeUi:function(){var t;game&&(game.started?(game.resize(),this.initHealthBar(),this.initTargetHud(),this.initExpBar(),this.initPlayerBar(),game.updateBars()):(t=game.renderer.getScaleFactor(),game.renderer.rescale(t)))}})}),define("entrypoint",["lib/sha1","util"],function(){return Class.extend({init:function(){this.hashes={"Obda3tBpL9VXsXsSsv5xB4QKNo4=":function(t){t.player.switchArmor(t.sprites.firefox),t.showNotification("You enter the game as a fox, but not invincible")}}},execute:function(t){var e=!1,n=getUrlVars().entrance;return null!=n&&(n=new jsSHA(n,"TEXT").getHash("SHA-1","B64"),null==this.hashes[n]?t.showNotification("Nice try little scoundrel bad code, though"):(this.hashes[n](t),e=!0)),e}})}),define("text!data/../../shared/data/lang.json",function(){return'{\r\n  "EN": {\r\n    "BANK_FULL": "Bank is full.",\r\n    "EQUIPMENT_FULL": "Equipment is full.",\r\n    "INVENTORY_FULL": "Inventory is full.",\r\n    "ITEM_ADDED": "{0} added",\r\n    "GOLD_ADDED": "{0} gold added",\r\n    "GOLD_REMOVED": "{0} gold removed",\r\n\r\n    "EQUIPMENT_LEVEL": "You need to be level {0} to equip this.",\r\n    "EQUIPMENT_WRONGCLASS": "Your class cannot use this Item.",\r\n\r\n    "CHAT_MUTED": "You are currently muted.",\r\n\r\n    "MAP_ENTERED": "{0} has entered the {1} map.",\r\n\r\n    "NOTICE_1": "Go to the Google Play Store and rate Retro RPG Online!",\r\n\r\n    "TRADE_REQUESTED": "You requested a trade with {0}.",\r\n    "TRADE_REQUEST": "{0} has requested to trade you.",\r\n\r\n    "TUTORIAL_MOVE": "Click or Tap on land to move.",\r\n    "TUTORIAL_ATTACK": "Now click or tap on a Monster to attack",\r\n    "TUTORIAL_ATTACK2": "Thats it now kill more Monsters.",\r\n    "TUTORIAL_EQUIP": "Now I want to equip my brought gear by going into Menu Backpack and selecting it.",\r\n    "TUTORIAL_SHOPBUY": "I should find the Beginner Store by going to the menu and pressing Town.",\r\n    "TUTORIAL_SHOPBUY2": "I want to buy my first Armor and Weapon that is Level 10.",\r\n    "TUTORIAL_STATS": "You can now assign custom Stats in Menu >> Character >> 3rd Page (Character Stats),",\r\n    "TUTORIAL_PORTAL": "In the Town House move to the blue Portal near the bottom left.",\r\n\r\n    "SHOP_REPAIRED": "{0} item repaired.",\r\n    "SHOP_REMOVED": "{0} item removed.",\r\n    "SHOP_SOLD": "{0} has been sold.",\r\n    "SHOP_BUY": "{0} has been bought.",\r\n    "SHOP_ENCHANTED": "{0} has been enchanted.",\r\n    "SHOP_NOGOLD": "You don\'t have enough Gold.",\r\n    "SHOP_NOGEMS": "You don\'t have enough Gems.",\r\n    "SHOP_NOSPACE": "There is not enough space in your inventory.",\r\n    "SHOP_MISMATCH": "The price has been changed, please try again.",\r\n    "AUCTION_ADDED": "The auction item you listed has been added.",\r\n    "SHOP_NOCRAFTITEMS": "You do not have enough craft Items.",\r\n    "SHOP_MISSINGITEMS": "You are missing {0} {1}\'s",\r\n\r\n    "COMBAT_PLAYERKILLED": "/1 {0} killed {1} in combat.",\r\n    "COMBAT_TARGETINVINCIBLE": "Target is invincible.",\r\n\r\n    "GROUP_PLAYERLEFT": "{0} has left your group.",\r\n    "ATTACK_TOOFAR": "You are too far away to attack.",\r\n\r\n    "TUTORIAL": "TUTORIAL",\r\n    "TUTORIAL_1": "To Move, Mouse click on the Map or an Object, or use the WASD or arrow keys.",\r\n    "TUTORIAL_2": "To Attack, Mouse click on the Object or get in attack range and press Space bar.",\r\n    "TUTORIAL_3": "To Cycle Targets, use keys T to target the closest Object or Y to reverse target.",\r\n    "TUTORIAL_4": "You can use Keys 1-4 for Skill Shortcuts, and Keys 5-8 for consumables like Potions.",\r\n    "TUTORIAL_5": "If you need to buy items you can select Menu >> Town to instantly warp to Town.",\r\n    "TUTORIAL_6": "At level 10 you can equip Items in Menu >> Equipment, and at level 20 you can assign Stat Points.",\r\n\r\n    "ACHIEVEMENTS_0": "Kill {0} Monsters.",\r\n    "ACHIEVEMENTS_1": "Collect {0} Items.",\r\n    "ACHIEVEMENTS_2": "Do {0} Damage to Monsters.",\r\n    "ACHIEVEMENTS_3": "Mine {0} Nodes.",\r\n    "ACHIEVEMENTS_4": "Log {0} Trees.",\r\n    "ACHIEVEMENTS_5": "Interact with {0} Objects.",\r\n    "ACHIEVEMENTS_0_COMPLETE": "Achievement - Kill {0} Monsters Completed. {1}XP Added.",\r\n    "ACHIEVEMENTS_1_COMPLETE": "Achievement - Collect {0} Items Completed. {1}XP Added.",\r\n    "ACHIEVEMENTS_2_COMPLETE": "Achievement - Do {0} Damage to Monsters Completed. {1}XP Added.",\r\n    "ACHIEVEMENTS_3_COMPLETE": "Achievement - Mine {0} Nodes Completed. {1}XP Added.",\r\n    "ACHIEVEMENTS_4_COMPLETE": "Achievement - Log {0} Trees Completed. {1}XP Added.",\r\n    "ACHIEVEMENTS_5_COMPLETE": "Achievement - Interact with {0} Objects Completed. {1}XP Added.",\r\n\r\n    "PARTY_PLAYER_INVITE_SENT": "Party invite sent to player {0}",\r\n    "PARTY_MAX_PLAYERS": "Max players reached in party.",\r\n    "PARTY_PLAYER_JOINED": "{0} joined your party.",\r\n    "PARTY_PLAYER_ADDED": "You are now partied with {0}",\r\n    "PARTY_YOU_REJECTED_INVITE": "You rejected {0}\'s invite.",\r\n    "PARTY_THEY_REJECTED_INVITE": "{0} rejected your invite.",\r\n    "PARTY_CANNOT_KICK": "You cannot kick as you are not in a party or leader.",\r\n    "PARTY_PLAYER_KICKED": "You have been kicked from the party.",\r\n    "PARTY_NOT_LEADER": "You cannot set the leader as you are not in a party.",\r\n    "PARTY_YOU_LEADER": "You are now the leader.",\r\n    "PARTY_PLAYER_LEADER": "{0} is now leader.",\r\n    "PARTY_IS_LEADER": "{0} is already leader.",\r\n    "PARTY_NOT_IN": "You cannot leave as you are not in a party.",\r\n    "PARTY_PLAYER_LEFT": "{0} has left your party.",\r\n    "PARTY_YOU_LEFT": "You have left {0}\'s party.",\r\n    "PARTY_ALL_LEFT": "The party has been disbanded.",\r\n    "NO_PLAYER_EXIST": "Player {0} does not exist.",\r\n\r\n    "HARVEST_INVALID": "You cannot harvest at this point, use the right weapon, try somewhere else or again later.",\r\n    "HARVEST_ADDED": "{0} has been added to your inventory",\r\n    "HARVEST_WRONG_TYPE": "You cannot use this with a {0}.",\r\n    "HARVEST_NO_WEAPON": "You do not have a harvest item equipped.",\r\n\r\n    "DIALOGUE_1": [\r\n      [0, "You look lost young boy..."],\r\n      [1, "Where am I?"],\r\n      [0, "What do you mean where you are? Anyway I need help son."],\r\n      [0, "You see, young one, my house, well, it\'s not quite the welcoming place it used to be."],\r\n      [0, "It\'s overrun by rats, scurrying through every nook and cranny, making themselves right at home."],\r\n      [0, "It\'s a bit of a mess, I\'m afraid. Can you kill 10 rats for me, Sonny?"],\r\n      [0, "That way I can get into my home again.", "QUEST_1"]\r\n    ],\r\n    "DIALOGUE_2": [\r\n      [0, "Rats have stolen my 3 dice I need you to kill some Rats to get them.", "QUEST_2"]\r\n    ],\r\n    "DIALOGUE_3": [\r\n      [0, "Rats have stolen my tasty cheese.", "QUEST_3"]\r\n    ],\r\n    "DIALOGUE_4": [\r\n      [0, "Hello I was writing my memiors earlier.."],\r\n      [0, "When a pesky Crab stole my Feather Quilt."],\r\n      [0, "The problem is I don\'t know which one stole it"],\r\n      [0, "So I need you to kill and search all of them until it\'s found.", "QUEST_4"]\r\n    ],\r\n    "DIALOGUE_5": [\r\n      [0, "Crabs have overrun the place..", "QUEST_5"]\r\n    ],\r\n    "DIALOGUE_6": [\r\n      [0, "Fires were started by Goblins after they left the area"],\r\n      [0, "I need you to put out some fires so they don\'t get out of control.", "QUEST_6"]\r\n    ],\r\n\r\n    "DIALOGUE_7": [\r\n      [0, "The graveyard is overrun with Skeletons."],\r\n      [0, "I need you to remove the tombstones."],\r\n      [0, "This will prevent the evil wizards resurrecting people in graves.", "QUEST_7"]\r\n    ],\r\n\r\n    "QUESTS_NONE": [\r\n      [0, "I have no more quests for you, head {0} and look for {1}."],\r\n      [1, "Thanks {2}."]\r\n    ],\r\n\r\n    "QUESTS": {\r\n      "1": [\r\n          [\r\n            [0, "Thank you when you have completed this return to me."]\r\n          ],\r\n          ["Kill %count% %name%\'s"]\r\n      ],\r\n      "2": [\r\n        [\r\n          [0, "Please get the dice and return to me when complete."]\r\n        ],\r\n        ["Come back when you have my %count% %name%."],\r\n        [\r\n          [0, "Thank-you for returning my dice."],\r\n          [0, "I can now gamble hardcore with my lucky dice."],\r\n          [1, "Err, your welcome I guess..."]\r\n        ]\r\n      ],\r\n      "3": [\r\n          [\r\n            [0, "Can you please kill rats and return my cheese?"],\r\n            [0, "I need %count% pieces back to me."]\r\n          ],\r\n          ["Get %count% pieces of cheese."],\r\n          ["Thank-you for returning my cheese."]\r\n      ],\r\n      "4": [\r\n          [\r\n            [0, "Can you please kill Crabs and return my Feather Quill?"]\r\n          ],\r\n          ["Return my Feather Quill."],\r\n          [\r\n            [0,"Thank-you for returning my Feather Quill."],\r\n            [0,"I can now resume writing my memiors."]\r\n          ]\r\n      ],\r\n      "5": [\r\n          [\r\n            [0, "Kill %count% Crabs for me?"]\r\n          ],\r\n          ["Kill %count% Crabs."]\r\n      ],\r\n      "6": [\r\n          [\r\n            [0, "Can you destroy %count% fires?"]\r\n          ],\r\n          ["Destroy %count% fires."]\r\n      ],\r\n      "7": [\r\n          [\r\n            [0, "Can you destroy %count% tombstones for me?"]\r\n          ],\r\n          ["Destroy %count% tombstones."]\r\n      ]\r\n    },\r\n\r\n    "QUESTS_MOB": [\r\n        ["Kill %count% %name%\'s for me.",\r\n         "Have you killed %count% %name%s for me yet?"]\r\n    ],\r\n    "QUESTS_ITEM": [\r\n      ["%name2%\'s have stolen my %count% %name%s\'. I need you to kill %name2%\'s and get my %name%s\' back.",\r\n       "Have you got my %count% %name%\'s?",\r\n       "Thank you for returning my %name%\'s now I can use them."]\r\n\r\n    ],\r\n    "QUEST_SUMMARY": {\r\n      "HIDEANDSEEK": "Find %name%",\r\n      "KILLMOBKIND": "Kill %count% %name%s",\r\n      "GETITEMKIND": "Get %count% pieces of %name% from %name2%s",\r\n      "USENODE": "Use %count% %name%.",\r\n      "1": "Kill %count% %name%s",\r\n      "2": "Retrieve %count% %name%\'s from %name2%s",\r\n      "3": "Get %count% pieces of %name% from %name2%s",\r\n      "4": "Get the Feather Quill from %name%s",\r\n      "5": "Kill %count% %name%s",\r\n      "6": "Destroy %count% Fires.",\r\n      "7": "Destroy %count% Tombstones."\r\n    }\r\n  }\r\n}\r\n'}),define("data/langdata",["text!../../shared/data/lang.json"],function(t){var e=JSON.parse(t);return Class.extend({init:function(t){this.lang=t,this.data=e[t]}})}),define("button2",[],function(){function l(t){return void 0===t}function c(t){return"object"==typeof t}var h=Class.extend({init:function(t,e){this.id=t+"button",this.id2=t+"text",this.background={};for(var n,i=this.background,r=e.background,a=h.configure.background,s=["left","top","width"],o=0;o<s.length;o++)n=s[o],c(r)&&!l(r[n])?i[n]=r[n]:c(a)&&!l(a[n])&&(i[n]=a[n]);this.kinds=c(e.kinds)?e.kinds:c(h.configure.kinds)?h.configure.kinds:[0],this.visible=!!l(e.visible)||e.visible,this.enabled=!!l(e.enabled)||e.enabled,this.downed=!l(e.downed)&&e.downed,this.overed=!1,this.blinked=!1,this.blinkFlag=!1,this.blinkHandle=null,this.body=$(this.id),this.bodytext=$(this.id2),this.kind=-1,this.clickHandler=null,this.refresh(),this.body.bind("click",function(t){this.enabled&&this.clickHandler&&this.clickHandler(this,t)}.bind(this)),this.bodytext.bind("click",function(t){this.enabled&&this.clickHandler&&this.clickHandler(this,t)}.bind(this)),0<=this.kinds.indexOf(3)&&(this.body.unbind("mouseover").bind("mouseover",function(t){this.overed=!0,this.refresh()}.bind(this)),this.body.unbind("mouseout").bind("mouseout",function(t){this.overed=!1,this.refresh()}.bind(this)))},setBackground:function(t){this.background=t,this.kind=this.kind||0,this.setBackgroundPosition(this.kind)},getBackgroundPosition:function(t){var e,n=l(this.background.left)?0:this.background.left,i=l(this.background.top)?0:this.background.top,r=l(this.background.width)?25:this.background.width;return e=this.kinds,"-"+(n+r*((n=0)<=(e=e.indexOf(t))?e:n))+"px -"+i+"px"},setBackgroundPosition:function(t){this.kind=t,this.body.css("background-position",this.getBackgroundPosition(t))},refresh:function(){this.visible&&this.setBackgroundPosition(this.enabled?this.overed?3:this.downed?2:this.blinked&&this.blinkFlag?4:0:1)},show:function(){this.visible=!0,this.body.show()},hide:function(){this.visible=!1,this.body.hide()},enable:function(){this.enabled=!0,this.refresh()},disable:function(){this.blinked&&this.blink(!1),this.enabled=!1,this.refresh()},down:function(){this.downed=!0,this.enabled&&this.refresh()},up:function(){this.downed=!1,this.enabled&&this.refresh()},blink:function(t){this.enabled&&(t?0<=this.kinds.indexOf(4)&&!this.blinked&&(this.blinkFlag=!1,this.blinkHandle=setInterval(function(){this.blinkFlag=!this.blinkFlag,this.refresh()}.bind(this),500),this.blinked=!0):this.blinked&&(clearInterval(this.blinkHandle),this.blinkHandle=null,this.blinked=!1,this.refresh()))},onClick:function(t){this.clickHandler=t}});return h.configure={},h}),define("dialog/dialog",[],function(){return Class.extend({init:function(t,e){this.id=e,this.body=$(e),this.visible=!1},addClose:function(t){this.closeButton=$(this.id+" .frame-close-button"),this.closeEvent=t},show:function(){var e=this;this.showHandler&&this.showHandler(this),this.body.show(),this.visible=!0,this.showing=!0,game.gamepad&&game.gamepad.dialogOpen(),this.closeButton&&this.closeButton.click(function(t){game.gamepad&&game.gamepad.dialogClose(),e.closeEvent&&e.closeEvent(t),e.hide()})},hide:function(){this.visible=!1,this.showing=!1,this.body.hide(),this.hideHandler&&this.hideHandler(this)},onShow:function(t){this.showHandler=t},onHide:function(t){this.hideHandler=t}})}),define("text!../shared/data/sprites.json",function(){return'[\r\n\t["adhererarcherarmor","armor/adhererarcherarmor.png"],\r\n\t["adhererrobe","armor/adhererrobe.png"],\r\n\t["adminarmor","armor/adminarmor.png"],\r\n\t["archerarmor","armor/archerarmor.png"],\r\n\t["archerschooluniform","armor/archerschooluniform.png"],\r\n\t["armorarcher1","armor/armorarcher1.png"],\r\n\t["bearseonbiarmor","armor/bearseonbiarmor.png"],\r\n\t["beearmor","armor/beearmor.png"],\r\n\t["beetlearmor","armor/beetlearmor.png"],\r\n\t["blackspiderarmor","armor/blackspiderarmor.png"],\r\n\t["bluedamboarmor","armor/bluedamboarmor.png"],\r\n\t["bluepiratearmor","armor/bluepiratearmor.png"],\r\n\t["bluewingarcherarmor","armor/bluewingarcherarmor.png"],\r\n\t["bluewingarmor","armor/bluewingarmor.png"],\r\n\t["burgerarmor","armor/burgerarmor.png"],\r\n\t["catarmor","armor/catarmor.png"],\r\n\t["cheoliarcherarmor","armor/cheoliarcherarmor.png"],\r\n\t["cheoliarmor","armor/cheoliarmor.png"],\r\n\t["christmasarmor","armor/christmasarmor.png"],\r\n\t["clotharmor","armor/clotharmor.png"],\r\n\t["cockroachsuit","armor/cockroachsuit.png"],\r\n\t["cokearmor","armor/cokearmor.png"],\r\n\t["combatuniform","armor/combatuniform.png"],\r\n\t["crystalarcherarmor","armor/crystalarcherarmor.png"],\r\n\t["crystalarmor","armor/crystalarmor.png"],\r\n\t["cursedhahoemask","armor/cursedhahoemask.png"],\r\n\t["damboarmor","armor/damboarmor.png"],\r\n\t["devilkazyaarmor","armor/devilkazyaarmor.png"],\r\n\t["dinosaurarmor","armor/dinosaurarmor.png"],\r\n\t["dovakinarcherarmor","armor/dovakinarcherarmor.png"],\r\n\t["dovakinarmor","armor/dovakinarmor.png"],\r\n\t["dragonarmor","armor/dragonarmor.png"],\r\n\t["enelarmor","armor/enelarmor.png"],\r\n\t["evilarmor","armor/evilarmor.png"],\r\n\t["fallenarcherarmor","armor/fallenarcherarmor.png"],\r\n\t["fallenarmor","armor/fallenarmor.png"],\r\n\t["firefox","armor/firefox.png"],\r\n\t["frankensteinarmor","armor/frankensteinarmor.png"],\r\n\t["friedpotatoarmor","armor/friedpotatoarmor.png"],\r\n\t["frogarmor","armor/frogarmor.png"],\r\n\t["frostarmor","armor/frostarmor.png"],\r\n\t["gayarcherarmor","armor/gayarcherarmor.png"],\r\n\t["gayarmor","armor/gayarmor.png"],\r\n\t["gbwingarcherarmor","armor/gbwingarcherarmor.png"],\r\n\t["gbwingarmor","armor/gbwingarmor.png"],\r\n\t["goldenarcherarmor","armor/goldenarcherarmor.png"],\r\n\t["goldenarmor","armor/goldenarmor.png"],\r\n\t["greenarcherarmor","armor/greenarcherarmor.png"],\r\n\t["greenarmor","armor/greenarmor.png"],\r\n\t["greendamboarmor","armor/greendamboarmor.png"],\r\n\t["greenwingarcherarmor","armor/greenwingarcherarmor.png"],\r\n\t["greenwingarmor","armor/greenwingarmor.png"],\r\n\t["guardarcherarmor","armor/guardarcherarmor.png"],\r\n\t["guardarmor","armor/guardarmor.png"],\r\n\t["halloweenjkarmor","armor/halloweenjkarmor.png"],\r\n\t["hongcheolarmor","armor/hongcheolarmor.png"],\r\n\t["huniarmor","armor/huniarmor.png"],\r\n\t["ironknightarmor","armor/ironknightarmor.png"],\r\n\t["leatherarcherarmor","armor/leatherarcherarmor.png"],\r\n\t["leatherarmor","armor/leatherarmor.png"],\r\n\t["legolasarmor","armor/legolasarmor.png"],\r\n\t["livingarmor","armor/livingarmor.png"],\r\n\t["mailarcherarmor","armor/mailarcherarmor.png"],\r\n\t["mailarmor","armor/mailarmor.png"],\r\n\t["miniseadragonarmor","armor/miniseadragonarmor.png"],\r\n\t["ninjaarmor","armor/ninjaarmor.png"],\r\n\t["paladinarmor","armor/paladinarmor.png"],\r\n\t["pinkcockroacharmor","armor/pinkcockroacharmor.png"],\r\n\t["piratearcherarmor","armor/piratearcherarmor.png"],\r\n\t["platearcherarmor","armor/platearcherarmor.png"],\r\n\t["platearmor","armor/platearmor.png"],\r\n\t["portalarmor","armor/portalarmor.png"],\r\n\t["powerarmour","armor/powerarmour.png"],\r\n\t["rabbitarmor","armor/rabbitarmor.png"],\r\n\t["radisharmor","armor/radisharmor.png"],\r\n\t["ratarcherarmor","armor/ratarcherarmor.png"],\r\n\t["ratarmor","armor/ratarmor.png"],\r\n\t["redarcherarmor","armor/redarcherarmor.png"],\r\n\t["redarmor","armor/redarmor.png"],\r\n\t["reddamboarmor","armor/reddamboarmor.png"],\r\n\t["redguardarcherarmor","armor/redguardarcherarmor.png"],\r\n\t["redguardarmor","armor/redguardarmor.png"],\r\n\t["redwingarcherarmor","armor/redwingarcherarmor.png"],\r\n\t["redwingarmor","armor/redwingarmor.png"],\r\n\t["regionarmor","armor/regionarmor.png"],\r\n\t["robocoparmor","armor/robocoparmor.png"],\r\n\t["rudolfarmor","armor/rudolfarmor.png"],\r\n\t["schooluniform","armor/schooluniform.png"],\r\n\t["seadragonarmor","armor/seadragonarmor.png"],\r\n\t["shadowregionarmor","armor/shadowregionarmor.png"],\r\n\t["snowfoxarcherarmor","armor/snowfoxarcherarmor.png"],\r\n\t["snowfoxarmor","armor/snowfoxarmor.png"],\r\n\t["snowmanarmor","armor/snowmanarmor.png"],\r\n\t["squidarmor","armor/squidarmor.png"],\r\n\t["taekwondo","armor/taekwondo.png"],\r\n\t["thiefarmor","armor/thiefarmor.png"],\r\n\t["tigerarmor","armor/tigerarmor.png"],\r\n\t["whitearcherarmor","armor/whitearcherarmor.png"],\r\n\t["whitearmor","armor/whitearmor.png"],\r\n\t["wizardrobe","armor/wizardrobe.png"],\r\n\t["wolfarcherarmor","armor/wolfarcherarmor.png"],\r\n\t["wolfarmor","armor/wolfarmor.png"],\r\n\t["item-bigflask","item/item-bigflask.png"],\r\n\t["item-blackpotion","item/item-blackpotion.png"],\r\n\t["item-burger","item/item-burger.png"],\r\n\t["item-firepotion","item/item-firepotion.png"],\r\n\t["item-flask","item/item-flask.png"],\r\n\t["chest","misc/chest.png"],\r\n\t["criticaleffect","misc/criticaleffect.png"],\r\n\t["cursors","misc/cursors.png"],\r\n\t["death","misc/death.png"],\r\n\t["firebenef","misc/firebenef.png"],\r\n\t["flaredanceeffect","misc/flaredanceeffect.png"],\r\n\t["goldmedal","misc/goldmedal.png"],\r\n\t["healeffect","misc/healeffect.png"],\r\n\t["provocationeffect","misc/provocationeffect.png"],\r\n\t["shadow16","misc/shadow16.png"],\r\n\t["shieldbenef","misc/shieldbenef.png"],\r\n\t["silvermedal","misc/silvermedal.png"],\r\n\t["sparks","misc/sparks.png"],\r\n\t["stuneffect","misc/stuneffect.png"],\r\n\t["supercateffect","misc/supercateffect.png"],\r\n\t["talk","misc/talk.png"],\r\n\t["target","misc/target.png"],\r\n\t["adherer","mob/adherer.png"],\r\n\t["ant","mob/ant.png"],\r\n\t["babyspider","mob/babyspider.png"],\r\n\t["bat","mob/bat.png"],\r\n\t["beautifullife","mob/beautifullife.png"],\r\n\t["bee","mob/bee.png"],\r\n\t["beetle","mob/beetle.png"],\r\n\t["blackpirateskeleton","mob/blackpirateskeleton.png"],\r\n\t["blackwizard","mob/blackwizard.png"],\r\n\t["blazespider","mob/blazespider.png"],\r\n\t["bluecockroach","mob/bluecockroach.png"],\r\n\t["bluepreta","mob/bluepreta.png"],\r\n\t["boss","mob/boss.png"],\r\n\t["breaker","mob/breaker.png"],\r\n\t["bridalmask","mob/bridalmask.png"],\r\n\t["brownmouse","mob/brownmouse.png"],\r\n\t["cactus","mob/cactus.png"],\r\n\t["cat","mob/cat.png"],\r\n\t["clam","mob/clam.png"],\r\n\t["cobra","mob/cobra.png"],\r\n\t["crab","mob/crab.png"],\r\n\t["crystalscolpion","mob/crystalscolpion.png"],\r\n\t["cursedjangseung","mob/cursedjangseung.png"],\r\n\t["darkogre","mob/darkogre.png"],\r\n\t["darkregionillusion","mob/darkregionillusion.png"],\r\n\t["darkregion","mob/darkregion.png"],\r\n\t["darkscolpion","mob/darkscolpion.png"],\r\n\t["darkskeleton","mob/darkskeleton.png"],\r\n\t["deathknight","mob/deathknight.png"],\r\n\t["desertscolpion","mob/desertscolpion.png"],\r\n\t["devilkazya","mob/devilkazya.png"],\r\n\t["earthworm","mob/earthworm.png"],\r\n\t["eliminator","mob/eliminator.png"],\r\n\t["enel","mob/enel.png"],\r\n\t["eye","mob/eye.png"],\r\n\t["firespider","mob/firespider.png"],\r\n\t["flaredeathknight","mob/flaredeathknight.png"],\r\n\t["fluffy","mob/fluffy.png"],\r\n\t["forestdragon","mob/forestdragon.png"],\r\n\t["frog","mob/frog.png"],\r\n\t["frostqueen","mob/frostqueen.png"],\r\n\t["ghostrider","mob/ghostrider.png"],\r\n\t["goblin","mob/goblin.png"],\r\n\t["goldgolem","mob/goldgolem.png"],\r\n\t["golem","mob/golem.png"],\r\n\t["greenfish","mob/greenfish.png"],\r\n\t["greenpirateskeleton","mob/greenpirateskeleton.png"],\r\n\t["hellspider","mob/hellspider.png"],\r\n\t["hermitcrab","mob/hermitcrab.png"],\r\n\t["hobgoblin","mob/hobgoblin.png"],\r\n\t["hongcheol","mob/hongcheol.png"],\r\n\t["icegolem","mob/icegolem.png"],\r\n\t["iceknight","mob/iceknight.png"],\r\n\t["icevulture","mob/icevulture.png"],\r\n\t["infectedguard","mob/infectedguard.png"],\r\n\t["ironogre","mob/ironogre.png"],\r\n\t["jirisanmoonbear","mob/jirisanmoonbear.png"],\r\n\t["kaonashi","mob/kaonashi.png"],\r\n\t["lightningguardian","mob/lightningguardian.png"],\r\n\t["mantis","mob/mantis.png"],\r\n\t["mermaid","mob/mermaid.png"],\r\n\t["mimic","mob/mimic.png"],\r\n\t["minidragon","mob/minidragon.png"],\r\n\t["miniemperor","mob/miniemperor.png"],\r\n\t["miniiceknight","mob/miniiceknight.png"],\r\n\t["miniknight","mob/miniknight.png"],\r\n\t["miniseadragon","mob/miniseadragon.png"],\r\n\t["moleking","mob/moleking.png"],\r\n\t["nightmareregion","mob/nightmareregion.png"],\r\n\t["ogrelord","mob/ogrelord.png"],\r\n\t["ogre","mob/ogre.png"],\r\n\t["oldogre","mob/oldogre.png"],\r\n\t["orc","mob/orc.png"],\r\n\t["pain","mob/pain.png"],\r\n\t["penguin","mob/penguin.png"],\r\n\t["pierrot","mob/pierrot.png"],\r\n\t["pinkelf","mob/pinkelf.png"],\r\n\t["piratecaptain","mob/piratecaptain.png"],\r\n\t["pirateking","mob/pirateking.png"],\r\n\t["pirateskeleton","mob/pirateskeleton.png"],\r\n\t["poisonspider","mob/poisonspider.png"],\r\n\t["preta","mob/preta.png"],\r\n\t["purplepreta","mob/purplepreta.png"],\r\n\t["queenant","mob/queenant.png"],\r\n\t["queenspider","mob/queenspider.png"],\r\n\t["rat","mob/rat.png"],\r\n\t["redcockroach","mob/redcockroach.png"],\r\n\t["redelf","mob/redelf.png"],\r\n\t["redfish","mob/redfish.png"],\r\n\t["redguard","mob/redguard.png"],\r\n\t["redmouse","mob/redmouse.png"],\r\n\t["redpirateskeleton","mob/redpirateskeleton.png"],\r\n\t["regionhenchman","mob/regionhenchman.png"],\r\n\t["rhaphidophoridae","mob/rhaphidophoridae.png"],\r\n\t["rudolf","mob/rudolf.png"],\r\n\t["santaelf","mob/santaelf.png"],\r\n\t["santa","mob/santa.png"],\r\n\t["seadragon","mob/seadragon.png"],\r\n\t["shadowregion","mob/shadowregion.png"],\r\n\t["skeleton2","mob/skeleton2.png"],\r\n\t["skeletonking","mob/skeletonking.png"],\r\n\t["skeleton","mob/skeleton.png"],\r\n\t["skydinosaur","mob/skydinosaur.png"],\r\n\t["skyelf","mob/skyelf.png"],\r\n\t["slime","mob/slime.png"],\r\n\t["smalldevil","mob/smalldevil.png"],\r\n\t["snek","mob/snek.png"],\r\n\t["snowelf","mob/snowelf.png"],\r\n\t["snowlady","mob/snowlady.png"],\r\n\t["snowman","mob/snowman.png"],\r\n\t["snowrabbit","mob/snowrabbit.png"],\r\n\t["snowwolf","mob/snowwolf.png"],\r\n\t["soldierant","mob/soldierant.png"],\r\n\t["soybeanbug","mob/soybeanbug.png"],\r\n\t["spectre","mob/spectre.png"],\r\n\t["spider","mob/spider.png"],\r\n\t["squid","mob/squid.png"],\r\n\t["suicideghost","mob/suicideghost.png"],\r\n\t["vulture","mob/vulture.png"],\r\n\t["whitebear","mob/whitebear.png"],\r\n\t["whitemouse","mob/whitemouse.png"],\r\n\t["whitetiger","mob/whitetiger.png"],\r\n\t["windguardian","mob/windguardian.png"],\r\n\t["wizard","mob/wizard.png"],\r\n\t["wolf","mob/wolf.png"],\r\n\t["yellowbat","mob/yellowbat.png"],\r\n\t["yellowfish","mob/yellowfish.png"],\r\n\t["yellowmouse","mob/yellowmouse.png"],\r\n\t["yellowpreta","mob/yellowpreta.png"],\r\n\t["zombie","mob/zombie.png"],\r\n\t["axe","weapon/axe.png"],\r\n\t["bamboospear","weapon/bamboospear.png"],\r\n\t["bastardsword","weapon/bastardsword.png"],\r\n\t["bloodbow","weapon/bloodbow.png"],\r\n\t["bluescimitar","weapon/bluescimitar.png"],\r\n\t["bluesword","weapon/bluesword.png"],\r\n\t["butcherknife","weapon/butcherknife.png"],\r\n\t["cactusaxe","weapon/cactusaxe.png"],\r\n\t["candybar","weapon/candybar.png"],\r\n\t["captainbow","weapon/captainbow.png"],\r\n\t["comb","weapon/comb.png"],\r\n\t["conferencecall","weapon/conferencecall.png"],\r\n\t["crystalbow","weapon/crystalbow.png"],\r\n\t["daywalker","weapon/daywalker.png"],\r\n\t["deathbow","weapon/deathbow.png"],\r\n\t["devilkazyasword","weapon/devilkazyasword.png"],\r\n\t["eneltrident","weapon/eneltrident.png"],\r\n\t["fireplay","weapon/fireplay.png"],\r\n\t["fireshot","weapon/fireshot.png"],\r\n\t["firesword","weapon/firesword.png"],\r\n\t["forestbow","weapon/forestbow.png"],\r\n\t["forestguardiansword","weapon/forestguardiansword.png"],\r\n\t["gaybow","weapon/gaybow.png"],\r\n\t["goldenbow","weapon/goldenbow.png"],\r\n\t["goldensword","weapon/goldensword.png"],\r\n\t["greenbow","weapon/greenbow.png"],\r\n\t["greenlightbow","weapon/greenlightbow.png"],\r\n\t["greenlightsaber","weapon/greenlightsaber.png"],\r\n\t["halberd","weapon/halberd.png"],\r\n\t["hammer","weapon/hammer.png"],\r\n\t["hunterbow","weapon/hunterbow.png"],\r\n\t["icerose","weapon/icerose.png"],\r\n\t["ironbow","weapon/ironbow.png"],\r\n\t["justicebow","weapon/justicebow.png"],\r\n\t["justicehammer","weapon/justicehammer.png"],\r\n\t["machete","weapon/machete.png"],\r\n\t["magicspear","weapon/magicspear.png"],\r\n\t["marinebow","weapon/marinebow.png"],\r\n\t["memme","weapon/memme.png"],\r\n\t["mermaidbow","weapon/mermaidbow.png"],\r\n\t["morningstar","weapon/morningstar.png"],\r\n\t["paewoldo","weapon/paewoldo.png"],\r\n\t["pinksword","weapon/pinksword.png"],\r\n\t["plasticbow","weapon/plasticbow.png"],\r\n\t["plunger","weapon/plunger.png"],\r\n\t["powersword","weapon/powersword.png"],\r\n\t["purplecloudkallege","weapon/purplecloudkallege.png"],\r\n\t["rainbowapro","weapon/rainbowapro.png"],\r\n\t["rainbowsword","weapon/rainbowsword.png"],\r\n\t["redbow","weapon/redbow.png"],\r\n\t["redenelbow","weapon/redenelbow.png"],\r\n\t["redlightbow","weapon/redlightbow.png"],\r\n\t["redlightsaber","weapon/redlightsaber.png"],\r\n\t["redmetalbow","weapon/redmetalbow.png"],\r\n\t["redmetalsword","weapon/redmetalsword.png"],\r\n\t["redsicklebow","weapon/redsicklebow.png"],\r\n\t["redsickle","weapon/redsickle.png"],\r\n\t["redsword","weapon/redsword.png"],\r\n\t["rosebow","weapon/rosebow.png"],\r\n\t["rose","weapon/rose.png"],\r\n\t["scimitar","weapon/scimitar.png"],\r\n\t["seahorsebow","weapon/seahorsebow.png"],\r\n\t["searage","weapon/searage.png"],\r\n\t["sicklebow","weapon/sicklebow.png"],\r\n\t["sickle","weapon/sickle.png"],\r\n\t["sidesword","weapon/sidesword.png"],\r\n\t["skylightbow","weapon/skylightbow.png"],\r\n\t["skylightsaber","weapon/skylightsaber.png"],\r\n\t["spear","weapon/spear.png"],\r\n\t["squeakyhammer","weapon/squeakyhammer.png"],\r\n\t["sword1","weapon/sword1.png"],\r\n\t["sword2","weapon/sword2.png"],\r\n\t["trident","weapon/trident.png"],\r\n\t["typhoon","weapon/typhoon.png"],\r\n\t["violetbow","weapon/violetbow.png"],\r\n\t["watermelonbow","weapon/watermelonbow.png"],\r\n\t["weastaff","weapon/weastaff.png"],\r\n\t["whip","weapon/whip.png"],\r\n\t["woodenbow","weapon/woodenbow.png"],\r\n\r\n\t["agent","npc/npc0.png"],\r\n\t["ancientmanumentnpc","npc/npc0.png"],\r\n\t["angelnpc","npc/npc0.png"],\r\n\t["beachnpc","npc/npc0.png"],\r\n\t["bluebikinigirlnpc","npc/npc0.png"],\r\n\t["bluestoremannpc","npc/npc0.png"],\r\n\t["boxingman","npc/npc0.png"],\r\n\t["coder","npc/npc0.png"],\r\n\t["desertnpc","npc/npc0.png"],\r\n\t["doctor","npc/npc0.png"],\r\n\t["elfnpc","npc/npc0.png"],\r\n\t["fairynpc","npc/npc0.png"],\r\n\t["firstsonangelnpc","npc/npc0.png"],\r\n\t["fisherman","npc/npc0.png"],\r\n\t["forestnpc","npc/npc0.png"],\r\n\t["guard","npc/npc0.png"],\r\n\t["iamverycoldnpc","npc/npc0.png"],\r\n\t["iceelfnpc","npc/npc0.png"],\r\n\t["king","npc/npc0.png"],\r\n\t["lavanpc","npc/npc0.png"],\r\n\t["mermaidnpc","npc/npc0.png"],\r\n\t["mojojojonpc","npc/npc0.png"],\r\n\t["momangelnpc","npc/npc0.png"],\r\n\t["nyan","npc/npc0.png"],\r\n\t["octocat","npc/npc0.png"],\r\n\t["octopus","npc/npc0.png"],\r\n\t["oddeyecat","npc/npc0.png"],\r\n\t["pirategirlnpc","npc/npc0.png"],\r\n\t["priest","npc/npc0.png"],\r\n\t["redbikinigirlnpc","npc/npc0.png"],\r\n\t["redstoremannpc","npc/npc0.png"],\r\n\t["rick","npc/npc0.png"],\r\n\t["scientist","npc/npc0.png"],\r\n\t["secondsonangelnpc","npc/npc0.png"],\r\n\t["shepherdboy","npc/npc0.png"],\r\n\t["snowshepherdboy","npc/npc0.png"],\r\n\t["soldier","npc/npc0.png"],\r\n\t["sorcerer","npc/npc0.png"],\r\n\t["sponge","npc/npc0.png"],\r\n\t["superiorangelnpc","npc/npc0.png"],\r\n\t["vampire","npc/npc0.png"],\r\n\t["vendingmachine","npc/npc0.png"],\r\n\t["villagegirl","npc/npc0.png"],\r\n\t["villager","npc/npc0.png"],\r\n\t["zombiegf","npc/npc0.png"],\r\n\t["items","misc/mainweaponarmor.png"],\r\n\t["itemloot","misc/itemloot.png"],\r\n\t["npc1_1",""],\r\n\t["npc1_2",""],\r\n\t["npc1_3",""],\r\n\t["npc1_4",""],\r\n\t["npc1_5",""],\r\n\t["npc1_6",""],\r\n\t["npc1_7",""],\r\n\t["npc1_8",""],\r\n\t["npc2_1",""],\r\n\t["npc2_2",""],\r\n\t["npc2_3",""],\r\n\t["npc2_4",""],\r\n\t["npc2_5",""],\r\n\t["npc2_6",""],\r\n\t["npc2_7",""],\r\n\t["npc2_8",""]\r\n]\r\n'}),define("hoveringinfo",[],function(){var t=Class.extend({DURATION:1e3,init:function(t,e,n,i,r,a){this.id=t,this.value=e,this.duration=2*r,this.x=n,this.y=i,this.opacity=1,this.lastTime=0,this.speed=s[a].speed,this.interval=s[a].interval||0,this.fillColor=s[a].fill,this.strokeColor=s[a].stroke,this.fontSize=s[a].fontSize,this.angle=randomInt(20,160)/180*Math.PI,this.infoData=s[a],this.effect=s[a].effect||0},isTimeToAnimate:function(t){return t-this.lastTime>this.speed},isTimeToShow:function(t){return t-this.showTime>this.interval},isTimeToDestroy:function(t){return t-this.showTime>this.interval+this.duration},update:function(t){this.isTimeToAnimate(t)&&(this.lastTime=t,this.tick(t))},tick:function(t){0==this.effect?--this.y:1==this.effect&&(this.y-=Math.sin(this.angle),this.x-=Math.cos(this.angle)),this.opacity-=100/this.duration,this.isTimeToDestroy(t)&&this.destroy()},onDestroy:function(t){this.destroy_callback=t},destroy:function(){this.destroy_callback&&this.destroy_callback(this.id)}}),s={levelUp:{fill:65535,stroke:0,fontSize:10,speed:100,effect:0},minorLevelUp:{fill:65535,stroke:0,fontSize:8,speed:100,effect:0},received:{fill:16728128,stroke:0,fontSize:6,speed:25,effect:1},inflicted:{fill:16728128,stroke:0,fontSize:6,speed:25,effect:1},healed:{fill:6356832,stroke:0,fontSize:6,speed:25,effect:1},health:{fill:16777215,stroke:0,fontSize:6,speed:25,effect:1},crit:{fill:16776960,stroke:0,fontSize:6,speed:25,effect:1},experience:{fill:65535,stroke:0,fontSize:6,speed:50,effect:0}};return t}),define("infomanager",["hoveringinfo"],function(o){return Class.extend({init:function(t){this.game=t,this.infos={},this.destroyQueue=[],this.infoQueue=[],this.index=1;var n=this;setInterval(function(){var t,e;0<n.infoQueue.length&&(t=n.game.currentTime,(e=n.infoQueue[0]).showTime||(e.showTime=t),(n.infos[e.id]=e).isTimeToShow(t))&&n.infoQueue.shift()},50)},addDamageInfo:function(t,e,n,i,r){this.index=this.index>=Number.MAX_SAFE_INTEGER?1:this.index+1;var a=this.game.currentTime,s=this.index;self=this,(info=new o(s,t,e,n,r||1e3,i)).onDestroy(function(t){t&&self.destroyQueue&&self.destroyQueue.push(t)}),0<info.interval?self.infoQueue.push(info):(info.showTime=a,self.infos[s]=info)},addInfo:function(t){var e=this.game.currentTime,n=this;t.onDestroy(function(t){(t=t||this.id)&&n.destroyQueue&&n.destroyQueue.push(t)}),0<t.interval?n.infoQueue.push(t):(t.showTime=e,n.infos[t.id]=t)},forEachInfo:function(n){_.each(this.infos,function(t,e){n(t)})},update:function(e){var n=this;this.forEachInfo(function(t){t.update(e)}),_.each(this.destroyQueue,function(t){game.renderer.removeSprite(Container.HUD,"ci_"+t),delete n.infos[t]}),this.destroyQueue=[]}})}),define("bubble",["timer"],function(r){var a=Class.extend({init:function(t,e,n,i){this.id=t,this.entity=e,this.content=n,this.timer=new r(5e3,i),game.renderer.drawBubble(this)},isOver:function(t){return!!this.timer.isOver(t)},destroy:function(){game.renderer.removeBubble(this)},reset:function(t){this.timer.lastTime=t}});return Class.extend({init:function(){this.bubbles={}},getBubbleById:function(t){return t in this.bubbles?this.bubbles[t]:null},create:function(t,e,n){var i;void 0!==e&&""!=e&&(i=t.id,n=n||Date.now(),this.bubbles[i]=new a(i,t,e,n))},update:function(e){var n=this,i=[];_.each(this.bubbles,function(t){t.isOver(e)&&(t.destroy(),i.push(t.id))}),_.each(i,function(t){delete n.bubbles[t]})},clean:function(){var e=this,n=[];_.each(this.bubbles,function(t){t.destroy(),n.push(t.id)}),_.each(n,function(t){delete e.bubbles[t]}),this.bubbles={}},destroyBubble:function(t){var e=this.getBubbleById(t);e&&(e.destroy(),delete this.bubbles[t])},destroyEntityBubbles:function(e){var n=this;_.each(this.bubbles,function(t){t.entity===e&&(t.destroy(),delete n.bubbles[t.id])})},forEachBubble:function(e){_.each(this.bubbles,function(t){e(t)})}})}),define("camera",["entity/entity"],function(i){return Class.extend({init:function(t,e){this.game=t,this.renderer=e,this.x=0,this.y=0,this.tilesize=this.renderer.tilesize,this.rescale(),this.entities={},this.outEntities={},this.scrollX=!0,this.scrollY=!0},rescale:function(t,e){var n=this.renderer.gameScale,i=this.renderer.innerWidth,r=this.renderer.innerHeight,a=(log.debug("camera: w="+i+",h="+r),this.tilesize),s=a*n,i=(this.gridW=Math.ceil(i/s),this.gridH=Math.ceil(r/s),this.gridW+=this.gridW%2?1:0,this.gridH+=this.gridH%2?1:0,this.gridWE=this.gridW+2,this.gridHE=this.gridH+2,this.screenW=i,this.screenH=r,this.screenWE=~~(this.gridWE*s*1),this.screenHE=~~(this.gridHE*s*1),log.debug("camera: this.screenW="+this.screenW+",this.screenH="+this.screenH),this.screenX=~~(this.screenW/n),this.screenY=~~(this.screenH/n),this.tScreenW=this.gridWE*s,this.tScreenH=this.gridHE*s,this.wOffX=~~((this.tScreenW-this.screenW)/(2*n)),this.wOffY=~~((this.tScreenH-this.screenH)/(2*n)),log.debug("camera: this.wOffX="+this.wOffX+",this.wOffY="+this.wOffY),this.eOffX=this.wOffX-a,this.eOffY=this.wOffY-a,log.debug("---------"),log.debug("W:"+this.gridW+" H:"+this.gridH),game.mapContainer);i&&(i._initGrids(),i.moveGrid(!0))},setRealCoords:function(){var t,e,n=game.mapContainer,i=this.focusEntity,r=~~(this.screenX/2),a=~~(this.screenY/2);i&&(r=i.x-r,i=i.y-a,this.x=r.clamp(n.gcsx,n.gcex),this.y=i.clamp(n.gcsy,n.gcey),this.rx=r,this.ry=i,a=this.wOffX,t=n.gcex+this.wOffX,e=this.wOffY,n=n.gcey+this.wOffY,this.scrollX=a<r&&r<=t,this.scrollY=e<i&&i<=n,this.sx=r.clamp(a,t),this.sy=i.clamp(e,n),this.gx=this.x>>4,this.gy=this.y>>4)},getGridPos:function(t){var e,n=game.tilesize,i=game.renderer;if(game.mapContainer)return e=t[0],y=t[1],t=-i.hOffX,i=-i.hOffY,[(e-this.x+t)/n,(y-this.y+i)/n]},forEachVisibleValidPosition:function(t){if(this.gridWE&&this.gridHE)for(var e=this.gridHE,n=this.gridWE,i=0;i<e;++i)for(var r=0;r<n;++r)t(r,i)},isVisible:function(t,e){return e=e||0,t.mapIndex==game.mapIndex&&!!t&&this.isVisiblePosition(t.x,t.y,e)},isVisiblePosition:function(t,e,n){n=n*this.tilesize||0;var i=Math.max(0,this.x-n),r=Math.max(0,this.y-n),a=Math.min(game.mapContainer.widthX,this.x+this.screenX+n),n=Math.min(game.mapContainer.heightY,this.y+this.screenY+n);return!(!e.between(r,n)||!t.between(i,a))},forEachInScreenArray:function(e){var n=[],e=e||this.focusEntity,t=G_TILESIZE>>1,i=(this.gridW-1)*t,r=(this.gridH-1)*t;return this.forEachInScreen(function(t){t!=e&&Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<r&&n.push(t)}),n},forEachInScreen:function(t){for(var e in this.entities){var n=this.entities[e];n&&n instanceof i&&t(n,e)}},forEachInOuterScreen:function(t){for(var e in this.entities){var n=this.outEntities[e];n&&n instanceof i&&t(n,e)}}})}),define("text!data/../../shared/data/items2.json",function(){return'[\r\n\t{\r\n\t\t"id":1,\r\n\t\t"name": "Crude Club",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[3,10]\r\n\t},\r\n\t{\r\n\t\t"id":2,\r\n\t\t"name": "Crude Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[5,9]\r\n\t},\r\n\t{\r\n\t\t"id":3,\r\n\t\t"name": "Beginnner Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[8,11]\r\n\t},\r\n\t{\r\n\t\t"id":4,\r\n\t\t"name": "Iron Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,0]\r\n\t},\r\n\t{\r\n\t\t"id":5,\r\n\t\t"name": "Steel Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,1]\r\n\t},\r\n\t{\r\n\t\t"id":6,\r\n\t\t"name": "Bronze Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,2]\r\n\t},\r\n\t{\r\n\t\t"id":7,\r\n\t\t"name": "Golden Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,3]\r\n\t},\r\n\t{\r\n\t\t"id":8,\r\n\t\t"name": "Glass Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,4]\r\n\t},\r\n\t{\r\n\t\t"id":9,\r\n\t\t"name": "Adamantite Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,5]\r\n\t},\r\n\t{\r\n\t\t"id":10,\r\n\t\t"name": "Plate Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,6]\r\n\t},\r\n\t{\r\n\t\t"id":11,\r\n\t\t"name": "Draconian Sword",\r\n\t\t"type":"weapon",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":110,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[4,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":12,\r\n\t\t"name": "Slingshot",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[1,10]\r\n\t},\r\n\t{\r\n\t\t"id":13,\r\n\t\t"name": "Crude Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,8]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":14,\r\n\t\t"name": "Beginner Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[9,11]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":15,\r\n\t\t"name": "Iron Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,0]\r\n\t},\r\n\t{\r\n\t\t"id":16,\r\n\t\t"name": "Steel Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,1]\r\n\t},\r\n\t{\r\n\t\t"id":17,\r\n\t\t"name": "Bronze Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,2]\r\n\t},\r\n\t{\r\n\t\t"id":18,\r\n\t\t"name": "Gold Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,3]\r\n\t},\r\n\t{\r\n\t\t"id":19,\r\n\t\t"name": "Glass Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,4]\r\n\t},\r\n\t{\r\n\t\t"id":20,\r\n\t\t"name": "Adamantite Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,5]\r\n\t},\r\n\t{\r\n\t\t"id":21,\r\n\t\t"name": "Plate Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,6]\r\n\t},\r\n\t{\r\n\t\t"id":22,\r\n\t\t"name": "Draconian Bow",\r\n\t\t"type":"weaponarcher",\r\n\t\t"typemod":"attack",\r\n\t\t"modifier":110,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy": 1,\r\n\t\t"offset":[7,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":23,\r\n\t\t"name": "Fur Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,12]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":24,\r\n\t\t"name": "Padded Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,11]\r\n\t},\r\n\t{\r\n\t\t"id":25,\r\n\t\t"name": "Leather Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,10]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":26,\r\n\t\t"name": "Iron Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,0]\r\n\t},\r\n\t{\r\n\t\t"id":27,\r\n\t\t"name": "Steel Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,1]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":28,\r\n\t\t"name": "Bronze Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,2]\r\n\t},\r\n\t{\r\n\t\t"id":29,\r\n\t\t"name": "Golden Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,3]\r\n\t},\r\n\t{\r\n\t\t"id":30,\r\n\t\t"name": "Glass Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,4]\r\n\t},\r\n\t{\r\n\t\t"id":31,\r\n\t\t"name": "Adamantite Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,5]\r\n\t},\r\n\t{\r\n\t\t"id":32,\r\n\t\t"name": "Plate Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,6]\r\n\t},\r\n\t{\r\n\t\t"id":33,\r\n\t\t"name": "Draconian Armor",\r\n\t\t"type":"armor",\r\n\t\t"typemod":"defense",\r\n\t\t"modifier":110,\r\n\t\t"staticsheet":2,\r\n\t\t"legacy":1,\r\n\t\t"offset":[11,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":34,\r\n\t\t"name": "Flask +500 HP",\r\n\t\t"type":"object",\r\n\t\t"typemod":"health",\r\n\t\t"modifier":500,\r\n\t\t"sprite":"item/item-flask.png",\r\n\t\t"spriteName":"item-flask",\r\n\t\t"offset":[0,0],\r\n\t\t"buy": 10,\r\n\t\t"buycount":10\r\n\t},\r\n\t{\r\n\t\t"id":35,\r\n\t\t"name": "Burger +500 Energy",\r\n\t\t"type":"object",\r\n\t\t"typemod":"energy",\r\n\t\t"modifier":500,\r\n\t\t"sprite":"item/item-burger.png",\r\n\t\t"spriteName":"item-burger",\r\n\t\t"offset":[0,0],\r\n\t\t"buy": 30,\r\n\t\t"buycount":10\r\n\t},\r\n\t{\r\n\t\t"id":36,\r\n\t\t"name": "Big Flask +25% HP",\r\n\t\t"type":"object",\r\n\t\t"typemod":"healthpercent",\r\n\t\t"modifier":25,\r\n\t\t"sprite":"item/item-bigflask.png",\r\n\t\t"spriteName":"item-bigflask",\r\n\t\t"offset":[0,0],\r\n\t\t"buy": 50,\r\n\t\t"buycount":10\r\n\t},\r\n\r\n\t{\r\n\t\t"id":100,\r\n\t\t"name": "Leather Chest 1",\r\n\t\t"type":"chest",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 10,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[0,5]\r\n\t},\r\n\t{\r\n\t\t"id":101,\r\n\t\t"name": "Leather Helmet 1",\r\n\t\t"type":"helm",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 12,\r\n\t\t"modifier":5,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[0,4]\r\n\t},\r\n\t{\r\n\t\t"id":102,\r\n\t\t"name": "Leather Gloves 1",\r\n\t\t"type":"gloves",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 14,\r\n\t\t"modifier":5,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[0,6]\r\n\t},\r\n\t{\r\n\t\t"id":103,\r\n\t\t"name": "Leather Boots 1",\r\n\t\t"type":"boots",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 16,\r\n\t\t"modifier":5,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[0,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":104,\r\n\t\t"name": "Leather Chest 2",\r\n\t\t"type":"chest",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 20,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[1,5]\r\n\t},\r\n\t{\r\n\t\t"id":105,\r\n\t\t"name": "Leather Helmet 2",\r\n\t\t"type":"helm",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 22,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[1,4]\r\n\t},\r\n\t{\r\n\t\t"id":106,\r\n\t\t"name": "Leather Gloves 2",\r\n\t\t"type":"gloves",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 24,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[1,6]\r\n\t},\r\n\t{\r\n\t\t"id":107,\r\n\t\t"name": "Leather Boots 2",\r\n\t\t"type":"boots",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 26,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[1,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":108,\r\n\t\t"name": "Leather Chest 3",\r\n\t\t"type":"chest",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 30,\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[2,5]\r\n\t},\r\n\t{\r\n\t\t"id":109,\r\n\t\t"name": "Leather Helmet 3",\r\n\t\t"type":"helm",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 32,\r\n\t\t"modifier":15,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[2,4]\r\n\t},\r\n\t{\r\n\t\t"id":110,\r\n\t\t"name": "Leather Gloves 3",\r\n\t\t"type":"gloves",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 34,\r\n\t\t"modifier":15,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[2,6]\r\n\t},\r\n\t{\r\n\t\t"id":111,\r\n\t\t"name": "Leather Boots 3",\r\n\t\t"type":"boots",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 36,\r\n\t\t"modifier":15,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[2,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":112,\r\n\t\t"name": "Leather Chest 4",\r\n\t\t"type":"chest",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 40,\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[3,5]\r\n\t},\r\n\t{\r\n\t\t"id":113,\r\n\t\t"name": "Leather Helmet 4",\r\n\t\t"type":"helm",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 42,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[3,4]\r\n\t},\r\n\t{\r\n\t\t"id":114,\r\n\t\t"name": "Leather Gloves 4",\r\n\t\t"type":"gloves",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 44,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[3,6]\r\n\t},\r\n\t{\r\n\t\t"id":115,\r\n\t\t"name": "Leather Boots 4",\r\n\t\t"type":"boots",\r\n\t\t"typemod":"defense",\r\n\t\t"level": 46,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":1,\r\n\t\t"spriteName":"armors",\r\n\t\t"offset":[3,7]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":200,\r\n\t\t"name": "Sword 1",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 10,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[0,0]\r\n\t},\r\n\t{\r\n\t\t"id":201,\r\n\t\t"name": "Sword 2",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 20,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[1,0]\r\n\t},\r\n\t{\r\n\t\t"id":202,\r\n\t\t"name": "Sword 3",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 30,\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[2,0]\r\n\t},\r\n\t{\r\n\t\t"id":203,\r\n\t\t"name": "Sword 4",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 40,\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[3,0]\r\n\t},\r\n\t{\r\n\t\t"id":204,\r\n\t\t"name": "Sword 5",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 50,\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[4,0]\r\n\t},\r\n\t{\r\n\t\t"id":205,\r\n\t\t"name": "Sword 6",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 60,\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[5,0]\r\n\t},\r\n\t{\r\n\t\t"id":206,\r\n\t\t"name": "Sword 7",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 70,\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[6,0]\r\n\t},\r\n\t{\r\n\t\t"id":207,\r\n\t\t"name": "Sword 8",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 80,\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[7,0]\r\n\t},\r\n\t{\r\n\t\t"id":208,\r\n\t\t"name": "Sword 9",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 90,\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[8,0]\r\n\t},\r\n\t{\r\n\t\t"id":209,\r\n\t\t"name": "Sword 10",\r\n\t\t"type":"sword",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 100,\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[9,0]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":210,\r\n\t\t"name": "Bow 1",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 10,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[0,3]\r\n\t},\r\n\t{\r\n\t\t"id":211,\r\n\t\t"name": "Bow 2",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 20,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[1,3]\r\n\t},\r\n\t{\r\n\t\t"id":212,\r\n\t\t"name": "Bow 3",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 30,\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[2,3]\r\n\t},\r\n\t{\r\n\t\t"id":213,\r\n\t\t"name": "Bow 4",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 40,\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[3,3]\r\n\t},\r\n\t{\r\n\t\t"id":214,\r\n\t\t"name": "Bow 5",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 50,\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[4,3]\r\n\t},\r\n\t{\r\n\t\t"id":215,\r\n\t\t"name": "Bow 6",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 60,\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[5,3]\r\n\t},\r\n\t{\r\n\t\t"id":216,\r\n\t\t"name": "Bow 7",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 70,\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[6,3]\r\n\t},\r\n\t{\r\n\t\t"id":217,\r\n\t\t"name": "Bow 8",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 80,\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[7,3]\r\n\t},\r\n\t{\r\n\t\t"id":218,\r\n\t\t"name": "Bow 9",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 90,\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[8,3]\r\n\t},\r\n\t{\r\n\t\t"id":219,\r\n\t\t"name": "Bow 10",\r\n\t\t"type":"bow",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 100,\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[9,3]\r\n\t},\r\n\r\n\t{\r\n\t\t"id":220,\r\n\t\t"name": "Hammer 1",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 10,\r\n\t\t"modifier":10,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[0,5]\r\n\t},\r\n\t{\r\n\t\t"id":221,\r\n\t\t"name": "Hammer 2",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 20,\r\n\t\t"modifier":20,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[1,5]\r\n\t},\r\n\t{\r\n\t\t"id":222,\r\n\t\t"name": "Hammer 3",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 30,\r\n\t\t"modifier":30,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[2,5]\r\n\t},\r\n\t{\r\n\t\t"id":223,\r\n\t\t"name": "Hammer 4",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 40,\r\n\t\t"modifier":40,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[3,5]\r\n\t},\r\n\t{\r\n\t\t"id":224,\r\n\t\t"name": "Hammer 5",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 50,\r\n\t\t"modifier":50,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[4,5]\r\n\t},\r\n\t{\r\n\t\t"id":225,\r\n\t\t"name": "Hammer 6",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 60,\r\n\t\t"modifier":60,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[5,5]\r\n\t},\r\n\t{\r\n\t\t"id":226,\r\n\t\t"name": "Hammer 7",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 70,\r\n\t\t"modifier":70,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[6,5]\r\n\t},\r\n\t{\r\n\t\t"id":227,\r\n\t\t"name": "Hammer 8",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 80,\r\n\t\t"modifier":80,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[7,5]\r\n\t},\r\n\t{\r\n\t\t"id":228,\r\n\t\t"name": "Hammer 9",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 90,\r\n\t\t"modifier":90,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[8,5]\r\n\t},\r\n\t{\r\n\t\t"id":229,\r\n\t\t"name": "Hammer 10",\r\n\t\t"type":"hammer",\r\n\t\t"typemod":"attack",\r\n\t\t"level": 100,\r\n\t\t"modifier":100,\r\n\t\t"staticsheet":4,\r\n\t\t"spriteName":"weapons",\r\n\t\t"offset":[9,5]\r\n\t},\r\n\r\n\r\n\t\t{\r\n\t\t\t"id":230,\r\n\t\t\t"name": "Axe 1",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 10,\r\n\t\t\t"modifier":10,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[0,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":231,\r\n\t\t\t"name": "Axe 2",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 20,\r\n\t\t\t"modifier":20,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[1,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":232,\r\n\t\t\t"name": "Axe 3",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 30,\r\n\t\t\t"modifier":30,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[2,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":233,\r\n\t\t\t"name": "Axe 4",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 40,\r\n\t\t\t"modifier":40,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[3,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":234,\r\n\t\t\t"name": "Axe 5",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 50,\r\n\t\t\t"modifier":50,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[4,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":235,\r\n\t\t\t"name": "Axe 6",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 60,\r\n\t\t\t"modifier":60,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[5,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":236,\r\n\t\t\t"name": "Axe 7",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 70,\r\n\t\t\t"modifier":70,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[6,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":237,\r\n\t\t\t"name": "Axe 8",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 80,\r\n\t\t\t"modifier":80,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[7,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":238,\r\n\t\t\t"name": "Axe 9",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 90,\r\n\t\t\t"modifier":90,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[8,8]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":239,\r\n\t\t\t"name": "Axe 10",\r\n\t\t\t"type":"axe",\r\n\t\t\t"typemod":"attack",\r\n\t\t\t"level": 100,\r\n\t\t\t"modifier":100,\r\n\t\t\t"staticsheet":4,\r\n\t\t\t"spriteName":"weapons",\r\n\t\t\t"offset":[9,8]\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\t"id":300,\r\n\t\t\t"name": "Stone",\r\n\t\t\t"type":"craft",\r\n\t\t\t"level": 10,\r\n\t\t\t"staticsheet":5,\r\n\t\t\t"spriteName":"gather1",\r\n\t\t\t"offset":[1,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":301,\r\n\t\t\t"name": "Coal",\r\n\t\t\t"type":"craft",\r\n\t\t\t"level": 20,\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[1,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":302,\r\n\t\t\t"name": "Light Iron",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[1,1]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":303,\r\n\t\t\t"name": "Medium Iron",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[1,2]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":304,\r\n\t\t\t"name": "Hard Iron",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[1,3]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":305,\r\n\t\t\t"name": "Iron Ingot 1",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[2,1]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":306,\r\n\t\t\t"name": "Iron Ingot 2",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[2,2]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":307,\r\n\t\t\t"name": "Iron Ingot 3",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":8,\r\n\t\t\t"spriteName":"nodeset2",\r\n\t\t\t"offset":[2,3]\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\t"id":310,\r\n\t\t\t"name": "Leather 1",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":6,\r\n\t\t\t"spriteName":"craft1",\r\n\t\t\t"offset":[0,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":311,\r\n\t\t\t"name": "Leather 2",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":6,\r\n\t\t\t"spriteName":"craft1",\r\n\t\t\t"offset":[1,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":312,\r\n\t\t\t"name": "Leather 3",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":6,\r\n\t\t\t"spriteName":"craft1",\r\n\t\t\t"offset":[2,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":313,\r\n\t\t\t"name": "Leather 4",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":6,\r\n\t\t\t"spriteName":"craft1",\r\n\t\t\t"offset":[3,0]\r\n\t\t},\r\n\t\t{\r\n\t\t\t"id":320,\r\n\t\t\t"name": "Wood",\r\n\t\t\t"type":"craft",\r\n\t\t\t"staticsheet":7,\r\n\t\t\t"spriteName":"craft2",\r\n\t\t\t"offset":[0,0]\r\n\t\t}\r\n\r\n]\r\n'}),define("text!data/../../shared/data/craft.json",function(){return'[\r\n  {"i": [[310,16]],"o": 104},\r\n  {"i": [[310,4]],"o": 105},\r\n  {"i": [[310,4]],"o": 106},\r\n  {"i": [[310,4]],"o": 107},\r\n  {"i": [[311,16]],"o": 108},\r\n  {"i": [[311,4]],"o": 109},\r\n  {"i": [[311,4]],"o": 110},\r\n  {"i": [[311,4]],"o": 111},\r\n  {"i": [[312,16]],"o": 112},\r\n  {"i": [[312,4]],"o": 113},\r\n  {"i": [[312,4]],"o": 114},\r\n  {"i": [[312,4]],"o": 115},\r\n\r\n  {"i": [[301,1],[302,3]],"o": 305},\r\n  {"i": [[301,1],[303,3]],"o": 306},\r\n  {"i": [[301,1],[304,3]],"o": 307},\r\n\r\n  {"i": [[301,6],[305,10]],"o": 201},\r\n  {"i": [[301,6],[305,10]],"o": 211},\r\n  {"i": [[301,6],[305,10]],"o": 221},\r\n  {"i": [[301,6],[305,10]],"o": 231},\r\n  {"i": [[301,6],[306,10]],"o": 202},\r\n  {"i": [[301,6],[306,10]],"o": 212},\r\n  {"i": [[301,6],[306,10]],"o": 222},\r\n  {"i": [[301,6],[306,10]],"o": 232},\r\n  {"i": [[301,6],[307,10]],"o": 203},\r\n  {"i": [[301,6],[307,10]],"o": 213},\r\n  {"i": [[301,6],[307,10]],"o": 223},\r\n  {"i": [[301,6],[307,10]],"o": 233}\r\n]\r\n'}),define("text!data/../../shared/data/staticsheet.json",function(){return'[\r\n  {\r\n    "id": 0\r\n  },\r\n  {\r\n    "id": 1,\r\n    "sheet":"misc/armoricons.png",\r\n    "width": 320,\r\n    "height": 320,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1.5\r\n  },\r\n  {\r\n    "id": 2,\r\n    "sheet":"misc/mainweaponarmor.png",\r\n    "width": 768,\r\n    "height": 624,\r\n    "spritewidth": 48,\r\n    "spriteheight": 48,\r\n    "scale": 1\r\n  },\r\n  {\r\n    "id": 3,\r\n    "sheet":"misc/itemloot.png",\r\n    "width": 352,\r\n    "height": 320,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1\r\n  },\r\n  {\r\n    "id": 4,\r\n    "sheet":"misc/weaponicons.png",\r\n    "width": 320,\r\n    "height": 320,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1.5\r\n  },\r\n  {\r\n    "id": 5,\r\n    "sheet":"misc/nodeset1.png",\r\n    "width": 96,\r\n    "height": 736,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1\r\n  },\r\n  {\r\n    "id": 6,\r\n    "sheet":"misc/craft1.png",\r\n    "width": 128,\r\n    "height": 32,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1.5\r\n  },\r\n  {\r\n    "id": 7,\r\n    "sheet":"misc/craft2.png",\r\n    "width": 528,\r\n    "height": 528,\r\n    "spritewidth": 48,\r\n    "spriteheight": 48,\r\n    "scale": 1\r\n  },\r\n  {\r\n    "id": 8,\r\n    "sheet":"misc/nodeset2.png",\r\n    "width": 96,\r\n    "height": 128,\r\n    "spritewidth": 32,\r\n    "spriteheight": 32,\r\n    "scale": 1\r\n  }\r\n\r\n]\r\n'}),define("data/items",["text!../../shared/data/items2.json","text!../../shared/data/craft.json","text!../../shared/data/staticsheet.json","../entity/item","data/itemlootdata"],function(t,e,n,f,m){var i,g={},r=JSON.parse(e),a=0;for(i of r)i.id=a++;var y=JSON.parse(n),s={0:null},e=JSON.parse(t);return $.each(e,function(e,n){var t=n.id;"weapon"==n.type||"weaponarcher"==n.type?g[e+1]=f.extend({init:function(t){this._super(t,parseInt(e),n.type)}}):!ItemTypes.isArmor(t)&&"object"!=n.type&&"craft"!=n.type||(g[e+1]=f.extend({init:function(t){this._super(t,parseInt(e),n.type)}})),s[t]={name:n.name,type:n.type||"object",damageType:n.damageType||"none",typemod:n.typemod||"none",modifier:n.modifier||0,hand:n.hand||0,sprite:n.sprite||"",spriteName:n.spriteName||"",offset:n.offset||[0,0],buy:n.buy||0,buycount:n.buycount||1,staticsheet:0<n.staticsheet?n.staticsheet:0,level:n.level||n.modifier,legacy:n.legacy||0,craft:function(t){var e,n=[];for(e of r)e.o==t&&n.push(e);return n}(t)}}),ItemTypes.setKindData(s),g.getStaticSheet=function(){return y},g.itemLoad={},g.jqShowItem=function(e,t,n,i){i=i||1;var r,a,s,o,l,c,h,u=t.itemKind,d=t.itemNumber,p=ItemTypes.KindData[u];t.sprite&&(p={sprite:s="item/item-"+t.sprite+".png",offset:[0,0]}),1e3<=u&&u<2e3&&(p=m[u-1e3]);0<p.staticsheet?(r=y[p.staticsheet],1<i&&(r.scale=i),c=p.offset[0]*r.spritewidth*r.scale,a=p.offset[1]*r.spriteheight*r.scale,o=56-r.spritewidth*r.scale>>1,e.css({"background-image":"url('img/2/sprites/"+r.sheet+"')","background-size":~~(r.width*r.scale)+"px "+~~(r.height*r.scale)+"px","background-position":"-"+c+"px -"+a+"px",margin:o+"px","line-height":51-(o<<1)+"px"}),e.width(r.spritewidth*r.scale),e.height(r.spriteheight*r.scale)):(s=p.sprite,1e3<=u&&u<2e3?s=game.sprites.itemloot.file:ItemTypes.isEquippable(u)&&(s=game.sprites.items.file),l=function(t){e.css({"background-size":~~(t.width*i)+"px "+~~(t.height*i)+"px","background-position":"-"+3*p.offset[0]*16*i+"px -"+3*p.offset[1]*16*i+"px"}),e.width(48*i),e.height(48*i)},e.css({"background-image":"url('"+(c="img/3/"+s)+"')","background-size":"auto","background-position":"-"+3*p.offset[0]*16+"px -"+3*p.offset[1]*16+"px",margin:(o=4)+"px","line-height":51-(o<<1)+"px"}),e.width(48*i),e.height(48*i),1<i&&(h=null,g.itemLoad[c]?(h=g.itemLoad[c],l(h)):((h=new Image).src="img/3/"+s,h.onload=function(){l(h)},g.itemLoad[c]=h))),e.attr("title",f.getInfoMsgEx(t)),e.html(d),n&&(ItemTypes.isEquippable(u)?n.html(ItemTypes.getLevelByKind(u)+"+"+d):1<d&&n.html(d))},g}),define("loaddata",["lib/class"],function(){return Class.extend({init:function(){var n=this,t=(this.loaded=!1,this.tilesets=[],new PIXI.Loader);t.add("ts-1-1","img/common/ts-1-1.png"),t.add("ts-1-2","img/common/ts-1-2.png"),t.load(function(t,e){n.tilesets=[e["ts-1-1"].texture,e["ts-1-2"].texture]}),t.onComplete.add(()=>{n.loaded=!0})}})}),define("renderer",["camera","entity/item","data/items","data/itemlootdata","entity/entity","entity/character","entity/player","timer","entity/mob","entity/npcmove","entity/npcstatic","entity/block","loaddata"],function(t,l,e,h,i,f,c,n,u,m,r,a,s){function o(t){t.announcement=null;var e=t.pxSprite.announcement_0;e&&Container.HUD2.removeChild(e),0<t.announcements.length&&(t.announcement=t.announcements.shift()),setTimeout(function(){o(t)},t.announcement?t.announcement[1]:5e3)}return Class.extend({init:function(t){this.game=t,this.loadData=new s,PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.HARD_EDGE,PIXI.settings.ROUND_PIXELS=!1,PIXI.settings.SORTABLE_CHILDREN=!0,PIXI.tilemap.Constant={maxTextures:16,bufferSize:8192,boundSize:4096,boundCountPerBuffer:4,use32bitIndex:!0,SCALE_MODE:PIXI.SCALE_MODES.LINEAR},WebFont.load({custom:{families:["KomikaHand","GraphicPixel","AdvoCut"]},loading:function(){console.log("Font(s) Loading")},active:function(){console.log("Font(s) Loaded")},inactive:function(){console.log("Font(s) Failure")}}),this.scale=this.getScaleFactor(),this.resolution=1,this.gameZoom=this.getGameZoom(),this.calcScreenSize();t=new PIXI.autoDetectRenderer(this.innerWidth,this.innerHeight,{width:this.innerWidth,height:this.innerHeight,antialias:!1,transparent:!1,resolution:this.resolution,autoResize:!0,class:"clickable"});this.renderer=t,this.canvas=$("#canvas"),this.canvas.css({cursor:"none"}),this.centerStage(),console.warn(this.renderer.type),this.renderer.type==PIXI.WEBGL_RENDERER?console.warn("Using WebGL"):console.warn("Using Canvas"),this.renderer.view.style.position="absolute",this.renderer.view.style.display="block",this.renderer.view.id="game",this.docCanvas=document.getElementById("canvas"),this.docCanvas.appendChild(this.renderer.view),this.docCanvas.firstElementChild.getContext("2d",{willReadFrequently:!0}),Container.STAGE.addChild(Container.BACKGROUND),Container.STAGE.addChild(Container.ENTITIES),Container.STAGE.addChild(Container.FOREGROUND),Container.STAGE.addChild(Container.COLLISION),Container.STAGE.addChild(Container.COLLISION2),Container.STAGE.addChild(Container.HUD),Container.STAGE.addChild(Container.HUD2),Container.ENTITIES.sortableChildren=!0,Container.BACKGROUND.zIndex=1,Container.ENTITIES.zIndex=2,Container.FOREGROUND.zIndex=3,Container.COLLISION.zIndex=4,Container.COLLISION2.zIndex=5,Container.HUD.zIndex=6,Container.HUD2.zIndex=7,this.guiScale=3,this.scaleHUD=1,this.gameScale=3,Container.BACKGROUND.scale.x=this.gameScale,Container.BACKGROUND.scale.y=this.gameScale,Container.ENTITIES.scale.x=this.gameScale,Container.ENTITIES.scale.y=this.gameScale,Container.FOREGROUND.scale.x=this.gameScale,Container.FOREGROUND.scale.y=this.gameScale,Container.COLLISION.scale.x=this.gameScale,Container.COLLISION.scale.y=this.gameScale,Container.COLLISION2.scale.x=1,Container.COLLISION2.scale.y=1,Container.HUD.scale.x=this.scaleHUD,Container.HUD.scale.y=this.scaleHUD,Container.HUD2.scale.x=1,Container.HUD2.scale.y=1,this.resources={},this.tiles={},this.initFPS(),this.tilesize=16,this.upscaledRendering=!0,this.rescaling=!0,this.supportsSilhouettes=this.upscaledRendering,this.isFirefox=Detect.isFirefox(),this.isCanary=Detect.isCanaryOnWindows(),this.isEdge=Detect.isEdgeOnWindows(),this.isSafari=Detect.isSafari(),this.tablet=Detect.isTablet(window.innerWidth),this.mobile=Detect.isMobile(),this.isTablet=this.tablet,this.isMobile=this.mobile,this.isDesktop=!(this.isTablet||this.isMobile),this.lastTime=0,this.frameCount=0,this.maxFPS=this.FPS,this.realFPS=0,this.movingFPS=this.FPS,this.fullscreen=!0,this.isDebugInfoVisible=!1,this.animatedTileCount=0,this.highTileCount=0,this.forceRedraw=!0,this.delta=0,this.last=Date.now(),this.announcements=[],this.createCamera(),this.guiScale=this.getUiScaleFactor(),this.textures={},this.sprite={},this.spriteTextures={},this.blankFrame=!1,this.pxSprite={},this.colTotal=0,this.hitbarWidth=0,this.tw=window.innerWidth,this.th=window.innerHeight,this.pushAnnouncement("this is a test",5e3),this.hitbar=document.getElementById("combathitbar-slider")},calcScreenSize:function(){this.gameWidth=Math.min(window.innerWidth,1920),this.gameHeight=Math.min(window.innerHeight,1080),this.fourKZoom=window.innerWidth>this.gameWidth?window.innerWidth/this.gameWidth:1,this.screenZoom=Math.min(screen.width/this.gameWidth,screen.height/this.gameHeight),this.renderZoom=this.gameZoom*this.screenZoom*this.fourKZoom,this.innerWidth=~~(this.gameWidth*this.gameZoom),this.innerHeight=~~(this.gameHeight*this.gameZoom),this.resolution=this.gameZoom/this.renderZoom},getScaleFactor:function(){window.innerWidth,window.innerHeight;return 3},getUiScaleFactor:function(){window.innerWidth,window.innerHeight;return 3},getGameZoom:function(){var t=window.innerWidth,e=window.innerHeight,t=t<1e3?1.25:t<=1500||e<=870?1:.85;return t},getIconScaleFactor:function(){window.innerWidth,window.innerHeight;return 3},getProportionFactor:function(){var t=window.innerWidth,e=window.innerHeight;return e<t?t/e:e/t},rescale:function(){this.scale=this.getScaleFactor(),this.initFPS(),this.game.ready&&this.game.renderer&&(this.game.setSpriteScale(this.scale),this.game.inventoryHandler.scale=this.getUiScaleFactor()),this.scale=this.getScaleFactor(),this.calcScreenSize(),this.renderer.resize(this.innerWidth,this.innerHeight),this.renderer.resolution=this.resolution,this.forceRedraw=!0},centerStage:function(){var t=~~(1/this.gameZoom*this.fourKZoom*100)/100,e=Math.max(window.innerWidth-this.renderer.width*t,0),n=Math.max(window.innerHeight-this.renderer.height*t,0),i=~~(this.renderer.width*t),r=~~(this.renderer.height*t);this.canvas.css({left:~~(e/2)+"px",top:~~(n/2)+"px",width:i+"px !important",height:r+"px !important",transform:"scale("+t+")"}),this.forceRedraw=!0},createCamera:function(){this.camera=new t(game,this),this.camera.focusEntity=game.player},resizeCanvases:function(){this.zoomExact=1,this.zoom=1,zoom1=Math.min(3840,1920)/window.innerWidth,zoom2=Math.min(this.innerHeight,1080)/window.innerHeight,this.zoom=Math.min(zoom1,zoom2);window.innerWidth,window.innerHeight,this.gui=document.getElementById("gui"),this.zoom;this.guizoom=1.25,this.isMobile?this.guizoom=.75:this.isTablet&&(this.guizoom=1);var t=Math.round($(window).width()/this.guizoom),e=Math.round($(window).height()/this.guizoom);this.gui.width=t,this.gui.height=e,this.gui.style.width=t+"px",this.gui.style.height=e+"px",log.debug("#gui set to "+this.gui.width+" x "+this.gui.height),this.gui.style.transform="scale("+this.guizoom*this.fourKZoom+")",this.camera.rescale(),this.rescale(),this.centerStage(),this.forceRedraw=!0},initFPS:function(){this.FPS=60},initPIXI:function(){this.tilesets=this.loadData.tilesets,this.tiles.BACKGROUND=new PIXI.tilemap.CompositeRectTileLayer(0,this.tilesets),this.tiles.FOREGROUND=new PIXI.tilemap.CompositeRectTileLayer(0,this.tilesets),Container.BACKGROUND.addChild(this.tiles.BACKGROUND),Container.FOREGROUND.addChild(this.tiles.FOREGROUND),this.textStyleName=new PIXI.TextStyle({fontFamily:"KomikaHand",stroke:"black",strokeThickness:1})},pushAnnouncement:function(t,e){this.announcements.push([t,e]),o(this)},drawAnnouncement:function(){var t,e="announcement_0",n=this.pxSprite[e],i=this.announcement;i&&(n||(t=new PIXI.TextStyle({fontFamily:"KomikaHand",fill:"#FFFF00",fontSize:6*self.scale,align:"center"}),(n=new PIXI.Text(i[0],t)).anchor.set(.5,.5),n.zIndex=1e6,Container.HUD2.addChild(n),this.pxSprite[e]=n),n.position.x=this.renderer.width/2,n.position.y=this.renderer.height/4)},drawText:function(t,e,n,i,r,a,s,o){switch(this.strokeSize=3,this.scale){case 1:this.strokeSize=1;break;case 2:this.strokeSize=2}var l;e&&n&&i&&(l=this.defaultFont,r&&(l.align="center"),l.stroke=s||"#373737",l.strokeThickness=this.strokeSize,l.fill=a||"white",(r=new PIXI.Text(e,l)).x=n*this.scale*3,r.y=i*this.scale*3)},drawCursor:function(){var t=this.game.mouse.x,e=this.game.mouse.y,n=this.game.currentCursor.currentAnimation,i=n.currentFrame;this.game.currentCursor&&this.drawSpriteHUD(this.game.currentCursor.pjsSprite,i.x,i.y,n.width,n.height,t,e,n.width,n.height)},getTexture:function(t){return this.textures[t]||(this.textures[t]=new PIXI.Texture.from(t)),this.textures[t]},createSprite:function(t){var e=this.getTexture(t.filepath).clone(),e=new PIXI.Sprite(e);return e.width=t.width*this.gameScale,e.height=t.height*this.gameScale,e.flipX=!1,e.flipY=!1,e.visible=!1,t.container.addChild(e),e},changeSprite:function(t,e){var n=this.getTexture(t.filepath);return e.texture=n,e.width=t.width*this.gameScale,e.height=t.height*this.gameScale,e.flipX=!1,e.flipY=!1,e.visible=!1,e},drawSpriteHUD:function(t,e,n,i,r,a,s,o,l,c,h){var u=this.gameScale;this.drawSprite([t,2*e,2*n,2*i,2*r,a*u,s*u,o*u,l*u,c,h,0,0,0])},drawSprite:function(t){var e,n,i=t[0];i.texture.baseTexture.valid&&(i.texture.frame=new PIXI.Rectangle(t[1],t[2],t[3],t[4]),i.x=t[5],i.y=t[6],i.width=t[7],i.height=t[8],e=t[9]||!1,n=t[10]||!1,e?0<i.scale.x&&(i.scale.x*=-1):i.scale.x<0&&(i.scale.x*=-1),n?0<i.scale.y&&(i.scale.y*=-1):i.scale.y<0&&(i.scale.y*=-1),i.zIndex=t[11]||0,i.anchor.x=t[12]||0,i.anchor.y=t[13]||0,i.visible=!(14<t.length)||t[14],i.opacity=t[15]||1)},drawTile:function(t){var e=G_TILESIZE,n=(t[4]*=e,t[5]*=e,t[2][0]),i=(n.frame=new PIXI.Rectangle(0,0,e,e),n.frame.x=getX(t[1],t[3])*e,n.frame.y=~~(t[1]/t[3])*e,this.tiles.BACKGROUND);(i=1===t[0]?this.tiles.FOREGROUND:i).addFrame(n,t[4],t[5],e,e)},drawItem:function(t){t.spriteChanged=game.player.isMoving();var e=ItemTypes.KindData[t.kind],n=(ItemTypes.isLootItem(t.kind)&&(e=h[t.kind-1e3]),G_TILESIZE),i=t.sprite.width,r=t.sprite.height,a=e.offset[0]*i*2,e=e.offset[1]*r*2,s=this.getEntityOffset(),o=t.x+s[0],s=t.y+s[1],l=i,c=r,n=2*(t.y*(game.camera.gridW*n)+t.x);(ItemTypes.isLootItem(t.kind)||ItemTypes.isCraftItem(t.kind))&&(l/=2,c/=2);try{this.drawSprite([t.pjsSprite,a,e,2*i,2*r,o,s,l,c,0,0,n,.5,.5])}catch(t){log.info(t.message),log.info(t.stack)}},drawEntityTargetPos:function(t,e,n){var i,r,a=this.pxSprite["etp_"+t];a||(i=new PIXI.Graphics,r=this.tilesize>>1,this.drawTarget(i,0,0,16711680,r,1),r=this.renderer.generateTexture(i),a=new PIXI.Sprite(r),Container.ENTITIES.addChild(a),(this.pxSprite["etp_"+t]=a).anchor.set(.5)),a.x=e,a.y=n},drawCenter:function(){var t=this.pxSprite.center_,e=(t||(e=new PIXI.Graphics,this.drawTarget(e,0,0,16776960,16,3),e=this.renderer.generateTexture(e),t=new PIXI.Sprite(e),Container.HUD.addChild(t),t.anchor.set(.5,.5),t.zIndex=999999999,this.pxSprite.center_=t),window.innerHeight,window.innerWidth,game.camera),n=game.player,i=this.gameScale,r=(n.x-e.x)*i,n=(n.y-e.y)*i;t.x=r,t.y=n},drawEntityTile:function(t,e,n){var i,r,a=this.tilesize,s=this.pxSprite["et_"+t];s||(i=new PIXI.Graphics,r=this.tilesize>>1,i.lineStyle(2,65280).drawRoundedRect(e-r,n-r,r<<1,r<<1,4),r=this.renderer.generateTexture(i),s=new PIXI.Sprite(r),Container.ENTITIES.addChild(s),(this.pxSprite["et_"+t]=s).anchor.set(.5),s.z=n*(this.camera.gridW*a)+e,s.alpha=.6),s.x=e,s.y=n},drawBubbles:function(){var e=this;_.each(game.bubbleManager.bubbles,function(t){e.drawBubble(t)})},showHarvestBar:function(t){var e,n,i,r,a,s,o=G_TILESIZE,l=t.harvestDuration;l&&(e=Date.now()-t.startHarvestTime,1!=(e=Math.min(e,l)/l))&&(l="harvestbar_ol_"+t.id,n=this.pxSprite[l],a=this.gameScale,r=this.getEntityOffset(),i=(t.x+r[0])*a,r=(t.y+r[1]-o-(o>>1))*a,a="harvestbar_il_"+t.id,s=this.pxSprite[a],n||(n=this.createBarOutline(i,r),this.pxSprite[l]=n,s=this.createBarInner(i,r,e,65280),this.pxSprite[a]=s),s.zindex=n.zIndex=t.y*(this.camera.gridW*o)+t.x,s.mod=e,s.x=n.x=i,s.y=n.y=r,l=this.gameScale,s.x=i-o*(l/2),s.y=r,s.width=o*l*e)},showHealthBar:function(t){var e,n,i,r,a,s,o,l;t.stats&&t.stats.hp&&(1==(e=t.stats.hp/t.stats.hpMax)?this.removeHealthBar(t.id):(n=G_TILESIZE,l="healthbar_ol_"+t.id,i=this.pxSprite[l],s=this.gameScale,a=this.getEntityOffset(),r=(t.x+a[0])*s,a=(t.y+a[1]-n-(n>>1))*s,s="healthbar_il_"+t.id,o=this.pxSprite[s],i||(i=this.createBarOutline(r,a),this.pxSprite[l]=i,o=this.createBarInner(r,a,e,16711680),this.pxSprite[s]=o),o.zindex=i.zIndex=t.y*(this.camera.gridW*n)+t.x,o.mod=e,o.x=i.x=r,o.y=i.y=a,l=this.gameScale,o.x=r-n*(l/2),o.y=a,o.width=n*l*e))},createBarOutline:function(t,e){var n=new PIXI.Graphics,t=(this.drawBarOutline(n,t,e),this.renderer.generateTexture(n)),e=new PIXI.Sprite(t);return e.anchor.set(.5,.5),e.alpha=.75,Container.HUD.addChild(e),e},createBarInner:function(t,e,n,i){var r=new PIXI.Graphics,t=(this.drawBarInner(r,t,e,i),this.renderer.generateTexture(r)),e=new PIXI.Sprite(t);return e.anchor.set(0,.5),e.alpha=.75,Container.HUD.addChild(e),e},drawBubble:function(t){var e,n,i=this.getEntityOffset(),r=G_TILESIZE,a=(game.camera,this.scale),s="bub_"+t.id,o=this.pxSprite[s],l=(t.entity.x+i[0])*a,c=(t.entity.y+i[1])*a,h=(o||((e=new PIXI.Graphics).beginFill(16777215),e.lineStyle(2,0),h=Math.min(12*t.content.length*a,80*a),n=new PIXI.TextStyle({fontFamily:"KomikaHand",fill:0,fontSize:5*this.scale,align:"center",wordWrap:!0,wordWrapWidth:~~(1.3*h),fontWeight:900,strokeThickness:0}),n=new PIXI.Text(t.content,n),l=(t.entity.x+i[0]-r/2)*a,c=(t.entity.y+i[1]-h/2)*a,t=~~(1.25*n.height),e.drawEllipse(l,c,h=~~(.75*h),t),e.endFill(),e.beginFill(16777215),e.moveTo(l,c+1.5*t),e.lineTo(l-r/3,c+t),e.lineTo(l+r/3,c+t),e.lineTo(l,c+1.5*t),e.endFill(),e.lineStyle(2,16777215),e.moveTo(l-r/3,c+t),e.lineTo(l+r/3,c+t),i=this.renderer.generateTexture(e),(o=new PIXI.Sprite(i)).anchor.set(.5,.5),o.alpha=.85,n.anchor.set(.5,.35),n.position.y=-t/2,o.addChild(n),Container.HUD.addChild(o),this.pxSprite[s]=o),o.anchor.set(.5,.5),r/2*a);c-=o.height/2+2*h,o.x=l-=h,o.y=c},removeBubble:function(t){var e=this.pxSprite["bub_"+t.id];Container.HUD.removeChild(e),this.pxSprite["bub_"+t.id]=null},getEntityOffset:function(){var t=this.getCameraView();game.camera;return[t[0],t[1]]},drawEntity:function(t){var e=t.sprite,n=t.currentAnimation;if(t.spriteChanged=!0,n&&e){var i=this.getEntityOffset(),r=game.camera,a=n.currentFrame,s=2*a.x,o=2*a.y,l=e.width,c=e.height,h=(e.width,e.height,this.tilesize),e=(e.offsetX,e.offsetY,t.x),u=t.y,d=l,p=c,r=2*(t.y*(r.gridW*h)+t.x),e=e+i[0],u=u+i[1];t==game.player&&(this.pex=e,this.pey=u),t==game.player.target?this.drawEntityTile(t.id,e,u):this.removeSprite(Container.ENTITIES,"et_"+t.id),t.fadeRatio=t.getFadeRatio(this.game.currentTime);try{t instanceof m&&(u-=h>>1),this.drawSprite([t.pjsSprite,s,o,2*l,2*c,e,u,d,p,t.flipSpriteX,t.flipSpriteY,r,.5,.5])}catch(t){log.info(t.message),log.info(t.stack)}t instanceof f&&!t.isDead&&!t.isDying&&t.hasWeapon()&&(t.pjsWeaponSprite||t.setWeaponSprite(),i=t.getWeaponSprite())&&(s=(h=i.animationData[n.name])?a.index<h.length?a.index:a.index%h.length:0,o=i.width*s*2,l=i.height*n.row*2,c=i.width,d=i.height,p=!t.hideWeapon,this.drawSprite([t.pjsWeaponSprite,o,l,2*c,2*d,e,u,c,d,t.flipSpriteX,t.flipSpriteY,1+r,.5,.5,p]))}},removeEntityStuff:function(t){this.removeHealthBar(t.id),this.removeEntityName(t.id),t instanceof c&&(Container.ENTITIES.removeChild(t.pjsWeaponSprite),t.pjsWeaponSprite=null)},drawEntities:function(t){var n=this;game.player&&0<game.player.startHarvestTime?this.showHarvestBar(game.player):this.removeHarvestBar(game.player.id),n.camera.forEachInScreen(function(t,e){t&&(t.isDying||t.isDead?n.removeEntityStuff(t):(n.drawEntityName(t),t!=game.player&&n.showHealthBar(t)),t instanceof l&&n.drawItem(t),t instanceof i)&&(t.isDead||n.drawEntity(t))})},drawEntityName:function(t){var e="#FFFFFF",n="",i=(t instanceof c&&t.isMoving&&!t.isDead?(e=t.id==this.game.playerId?"#ffff00":t.admin?"#ff0000":"#fcda5c",n=t.name):t instanceof u?(t.level,e="#FFFF00",t.data.isAggressive&&(e="#FF3333"),n="Level "+t.level):t.type===Types.EntityTypes.NPCSTATIC?(e="#FFFFFF",n=t.name):t.type===Types.EntityTypes.NPCMOVE?(e="#00FFFF",n=t.name):t instanceof l&&(ItemTypes.isLootItem((i=t).kind)?(1<i.count&&(n=i.count+"x "),n+=h[i.kind-1e3].name,offsetY=0):ItemTypes.isConsumableItem(i.kind)||ItemTypes.isCraftItem(i.kind)?(1<i.count&&(n=i.count+"x "),n+=ItemTypes.KindData[i.kind].name):n=ItemTypes.KindData[i.kind].modifier+"+"+i.count),this.gameScale),r=this.getEntityOffset(),a=this.pxSprite["en_"+t.id],s=this.tilesize,o=(t.x+r[0])*i,r=(t.y+r[1]-s)*i;a||(i=new PIXI.TextStyle({fontFamily:"KomikaHand",fill:e,fontSize:5*this.scale,align:"center"}),(a=new PIXI.Text(n,i)).anchor.set(.5,.5),Container.HUD.addChild(a),this.pxSprite["en_"+t.id]=a),a.zIndex=t.y*(this.camera.gridW*s)+t.x,a.x=o,a.y=r},removeEntityName:function(t){this.removeSprite(Container.HUD,"en_"+t)},removeHealthBar:function(t){this.removeSprite(Container.HUD,"healthbar_ol_"+t),this.removeSprite(Container.HUD,"healthbar_il_"+t)},removeHarvestBar:function(t){this.removeSprite(Container.HUD,"harvestbar_ol_"+t),this.removeSprite(Container.HUD,"harvestbar_il_"+t)},removeEntity:function(t){Container.ENTITIES.removeChild(t.pjsSprite),t instanceof c&&Container.ENTITIES.removeChild(t.pjsWeaponSprite),this.removeEntityName(t.id),Container.ENTITIES.removeChild(this.pxSprite["et_"+t.id]),Container.ENTITIES.removeChild(this.pxSprite["etp_"+t.id]),this.removeHealthBar(t.id)},drawTerrain:function(t){var i=this,r=(this.game.player,this.game.mapContainer),a=this.tilesets[0].baseTexture.width/r.tilesize,e=this.game,n=this.game.map;e.started&&e.camera.forEachVisibleValidPosition(function(e,n){var t;_.isArray(r.tileGrid[n][e])?_.each(r.tileGrid[n][e],function(t){r.isHighTile(t)||i.drawTile([0,t,i.tilesets,a,e,n])}):(t=r.tileGrid[n][e])&&!r.isHighTile(t)&&i.drawTile([0,t,i.tilesets,a,e,n])},0,n)},drawHighTerrain:function(){this.drawHighTiles()},drawAnimatedTiles:function(){},drawHighTiles:function(){var i=this,r=this.game.mapContainer,a=this.tilesets[0].baseTexture.width/this.tilesize;this.game.camera.forEachVisibleValidPosition(function(e,n){var t;_.isArray(r.tileGrid[n][e])?_.each(r.tileGrid[n][e],function(t){r.isHighTile(t)&&i.drawTile([1,t,i.tilesets,a,e,n])}):(t=r.tileGrid[n][e])&&r.isHighTile(t)&&i.drawTile([1,t,i.tilesets,a,e,n])},0,!1)},getFPS:function(){return 1e3<=getTime()-this.lastTime&&(this.game.player.isMoving()&&(this.movingFPS=this.frameCount),this.realFPS=this.frameCount,this.frameCount=0,this.lastTime=getTime()),this.frameCount++,"FPS: "+this.realFPS},getCoordinates:function(){this.tilesize;var t=game.player.gx,e=game.player.gy;game.player.x,game.player.y;return this.game.player?"gx:"+t+",gy:"+e:""},drawCombatHitBar:function(){var t;game.player&&(t=~~(228*(Math.min(game.currentTime-game.player.attackTime,ATTACK_MAX)/ATTACK_MAX)),2<Math.abs(t-this.hitbarWidth))&&(this.hitbar.style.width=t+"px",this.hitbarWidth=t)},drawDebugInfo:function(){game.camera;var t,e="",n=(e=(e+=this.getFPS()+"\n")+(this.getCoordinates()+"\n"),this.scale,this.pxSprite.pc_coords);n||(t=new PIXI.TextStyle({fontFamily:"GraphicPixel",fill:"white",fontSize:18,align:"right",stroke:"black",strokeThickness:4}),(n=new PIXI.Text(e,t)).anchor.set(1,0),n.zIndex=999,Container.HUD.addChild(n),this.pxSprite.pc_coords=n),n.text=e,n.x=~~(this.renderer.screen.width/Container.HUD.scale.x),n.y=~~(this.renderer.screen.height/Container.HUD.scale.y*.06)},drawCombatInfo:function(){var r=this;this.game.infoManager.forEachInfo(function(t){var e="ci_"+t.id,n=r.pxSprite[e],i=(n||(i=new PIXI.TextStyle({fontFamily:"KomikaHand",fill:t.fillColor,fontSize:t.fontSize*r.scale,align:"center"}),(n=new PIXI.Text(t.value,i)).anchor.set(.5,0),Container.HUD.addChild(n),r.pxSprite[e]=n),~~(3*(t.x-r.camera.x))),e=~~(3*(t.y-r.camera.y-r.tilesize));n.text=t.value,n.x=i,n.y=e,n.alpha=t.opacity})},removeSprite:function(t,e){var n=this.pxSprite[e];n&&(t.removeChild(n),this.pxSprite[e]=null)},getScreenOffset:function(){var t=this.camera,e=(this.gameScale,this.getCameraView());return[e[0]+t.wOffX,e[1]+t.wOffY]},getCameraView:function(){var t=this.camera;return[-t.x,-t.y]},drawBarOutline:function(t,e,n){var i=this.gameScale,r=G_TILESIZE,a=r*i,r=(r>>2)*i,e=e-(a>>1),n=n-(r>>1);return t.lineStyle(2,"#000000").moveTo(e,n).lineTo(e+a,n).lineTo(e+a,n+r).lineTo(e,n+r).lineTo(e,n),t},drawBarInner:function(t,e,n,i){var r=this.gameScale,a=G_TILESIZE,s=a*r,a=(a>>2)*r;return e+=1,n+=1,s-=2,a-=2,t.beginFill(i).drawRect(e,n,s,a).endFill(),t},drawTarget:function(t,e,n,i,r,a){r=r||this.tilesize*this.scale>>1,t.lineStyle(a=a||2,i).moveTo(e-r,n).lineTo(e+r,n).lineStyle(a,i).moveTo(e,n-r).lineTo(e,n+r)},drawSquare:function(t,e,n,i,r,a){r=r||this.tilesize*this.scale>>1,t.lineStyle(a=a||2,i).drawRect(e-r,n-r,r<<1,r<<1)},drawCollision:function(){var n=this,i=this.game.mapContainer,t=this.game;if(t.started){var r=0;t.camera.forEachVisibleValidPosition(function(t,e){i.collisionGrid[e][t]&&n.drawCollisionTile(r++,t,e,16711680)});for(var e=r;e<this.colTotal;++e)Container.COLLISION.removeChild(this.pxSprite["tc_"+e]),this.pxSprite["tc_"+e]=null;this.colTotal=r}},drawCollisionTile:function(t,e,n,i){var r,a,s=this.tilesize,s=(e*=s,n*=s,this.pxSprite["tc_"+t]);s||(r=new PIXI.Graphics,a=this.tilesize>>1,this.drawSquare(r,e,n,i,a,1),i=this.renderer.generateTexture(r),s=new PIXI.Sprite(i),Container.COLLISION.addChild(s),this.pxSprite["tc_"+t]=s),s.x=e,s.y=n},renderStaticCanvases:function(){var t=this.camera,e=game.mapContainer,t=(t.focusEntity,t.setRealCoords(),e&&e.moveGrid(),this.setGridOffset());this.setTilesOffset(t[0],t[1]),this.forceRedraw&&this.refreshGrid()},showCutScene:function(){var t,e=~~($("#container").width()*this.gameZoom),n=~~($("#container").height()*this.gameZoom),i=Math.floor(n/8),r=n-i,a=-i,s=this.pxSprite.cutscene_1,o=this.pxSprite.cutscene_2;s||((t=new PIXI.Graphics).beginFill(0).drawRect(0,0,e,i).endFill(),e=this.renderer.generateTexture(t),s=new PIXI.Sprite(e),Container.HUD.addChild(s),this.pxSprite.cutscene_1=s,o=new PIXI.Sprite(e),Container.HUD.addChild(o),this.pxSprite.cutscene_2=o,s.y=a,o.y=n),s.y<0&&s.y++,o.y>r&&o.y--},setGridOffset:function(){var t,e,n=this.camera,i=(game.mapContainer,n.focusEntity),r=this.tilesize;if(i)return t=i.x>>4,e=i.y>>4,this.sox=i.x-t*r,this.soy=i.y-e*r,n.scrollX||(this.sox=0),n.scrollY||(this.soy=0),[this.sox,this.soy]},refreshGrid:function(){this.clearTiles(),this.drawTerrain(),this.drawHighTerrain()},setTilesOffset:function(t,e){this.tilesize;var n,i=game.camera,r=(game.player,this.gameScale),a=(game.mapContainer,t=-t,e=-e,Math.abs(i.rx-i.sx)),s=Math.abs(i.ry-i.sy),o=-i.wOffX,l=-i.wOffY;i.rx<i.sx&&(o=Math.min(o+a,0)),i.ry<i.sy&&(l=Math.min(l+s,0)),i.rx>i.sx&&(n=2*-i.wOffX,o=Math.max(o-a,n)),i.ry>i.sy&&(n=2*-i.wOffY,l=Math.max(l-s,n)),e+=l,this.hOffX=t+=o,this.hOffY=e,this.tiles.BACKGROUND.position.set(t,e),this.tiles.FOREGROUND.position.set(t,e),t*=r,e*=r,Container.COLLISION.x=t,Container.COLLISION.y=e,Container.COLLISION2.x=t,Container.COLLISION2.y=e},clearTiles:function(){this.tiles.BACKGROUND&&this.tiles.BACKGROUND.clear(),this.tiles.FOREGROUND&&this.tiles.FOREGROUND.clear()},clearFullTiles:function(){Container.BACKGROUND.children[0].clear(),this.tiles.BACKGROUND&&this.tiles.BACKGROUND.clear(),Container.FOREGROUND.children[0].clear(),this.tiles.FOREGROUND&&this.tiles.FOREGROUND.clear()},clearEntities:function(){var n=this;n.camera.forEachInScreen(function(t,e){t&&t!=game.player&&n.removeEntity(t)})},renderFrame:function(){!game.ready||this.blankFrame?(Container.HUD.removeChildren(),Container.HUD2.removeChildren(),Container.COLLISION.removeChildren(),this.pxSprite={},this.clearFullTiles(),this.renderer.render(Container.STAGE),this.blankFrame=!1,this.forceRedraw=!0,this.drawEntity(game.player),game.initCursors(),game.setCursor("hand")):game.ready&&game.player&&!(game.mapStatus<2)&&game.mapContainer.gridReady&&0!=this.tilesets.length&&this.loadData.loaded?(this.delta=Date.now()-this.last,this.renderStaticCanvases(),this.drawEntities(),this.drawAnnouncement(),this.drawBubbles(),this.drawCombatInfo(),this.drawDebugInfo(),this.drawCombatHitBar(),this.drawCursor(),this.renderer.render(Container.STAGE),this.last=Date.now(),this.forceRedraw=!1):this.forceRedraw=!0}})});var Detect={};function generateCollisionGrid(){mapData.grid=[];for(var t,e=0;e<mapData.height;e++)for(mapData.grid[e]=[],t=0;t<mapData.width;t++)mapData.grid[e][t]=!1;_.each(mapData.collisions,function(t){t=tileIndexToGridPosition(t+1);t.y<mapData.grid.length&&t.x<mapData.grid[0].length&&(mapData.grid[t.y][t.x]=!0)}),_.each(mapData.blocking,function(t){t=tileIndexToGridPosition(t+1);void 0!==mapData.grid[t.y]&&(mapData.grid[t.y][t.x]=!0)})}function generatePlateauGrid(){var t=0;mapData.plateauGrid=[];for(var e,n=0;n<mapData.height;n++)for(mapData.plateauGrid[n]=[],e=0;e<mapData.width;e++)_.include(mapData.plateau,t)?mapData.plateauGrid[n][e]=!0:mapData.plateauGrid[n][e]=!1,t+=1}function tileIndexToGridPosition(t){var e,n;return e=--t+1,n=mapData.width,{x:0==e?0:e%n==0?n-1:e%n-1,y:Math.floor(t/mapData.width)}}Detect.supportsWebSocket=function(){return window.WebSocket||window.MozWebSocket},Detect.userAgentContains=function(t){return-1!=navigator.userAgent.indexOf(t)},Detect.isTablet=function(t){return!!(720<t&&(Detect.userAgentContains("Android")||Detect.userAgentContains("Mobile")||Detect.userAgentContains("iPad")))},Detect.isMobile=function(){return!(!Detect.userAgentContains("Mobile")&&!Detect.userAgentContains("iPhone"))},Detect.isWindows=function(){return Detect.userAgentContains("Windows")},Detect.isChromeOnWindows=function(){return Detect.userAgentContains("Chrome")&&Detect.userAgentContains("Windows")},Detect.isCanaryOnWindows=function(){return Detect.userAgentContains("Chrome/52")&&Detect.userAgentContains("Windows")},Detect.isEdgeOnWindows=function(){return Detect.userAgentContains("Edge")&&Detect.userAgentContains("Windows")},Detect.isFirefox=function(){return Detect.userAgentContains("Firefox")},Detect.canPlayMP3=function(){return Modernizr.audio.mp3},Detect.isSafari=function(){return Detect.userAgentContains("Safari")&&!Detect.userAgentContains("Chrome")},Detect.isOpera=function(){return Detect.userAgentContains("Opera")},Detect.isFirefoxAndroid=function(){return Detect.userAgentContains("Android")&&Detect.userAgentContains("Firefox")},define("detect",function(){}),onmessage=function(t){"undefined"!=typeof mapData&&(generateCollisionGrid(),generatePlateauGrid(),postMessage(mapData))},define("mapworker",function(){}),define("map",["detect","mapworker"],function(t,e){return Class.extend({init:function(t,e,n){var i=this,t=(this.game=t,this.mapContainer=e,this.isLoaded=!1,this.tilesetsLoaded=!1,this.mapLoaded=!1,this.mapSubIndex=n,this.mapName=e.mapName,this.focusOffset={x1:-1,x2:-1,y1:-1,y2:-1},this.gridUpdated=!1,this.dimensions=this.game.mapContainer.getSubMapIndexDimensions(this.mapSubIndex),this.mapContainer);try{var r=t.mapName+"_"+this.mapSubIndex+".json";t.zip.file(r).async("string").then(function(t){i.loadMapData(JSON.parse(t))})}catch(t){console.error(JSON.stringify(t))}},loadMapData:function(t){this.isLoaded=!1,this.data=t,this._initMap(this.data),this._generate(),this.mapLoaded=!0,this._isReady(),this._initTilesets()},_isReady:function(){this.isLoaded=!0,this.ready_func&&this.ready_func(this)},_generate:function(){this._generateCollisionGrid(),this._generateTileGrid()},_initTilesets:function(){this.tilesetCount=1,this._loadTilesets()},_initMap:function(t){this.width=t.width,this.height=t.height,this.tileData=t.data,this.collisionData=t.collision},_loadTilesets:function(){this.tilesets=game.renderer.tilesets,this.tilesetsLoaded=!0},ready:function(t){this.ready_func=t},tileIndexToGridPosition:function(t){var e,n,i=0;return e=--t+1,n=this.width,i=0==e?0:e%n==0?n-1:e%n-1,e=Math.floor(t/this.width),{x:i*TILESIZE,y:e*TILESIZE}},GridPositionToTileIndex:function(t,e){return e*this.width+t},_generateCollisionGrid:function(){this.collision=new Array(this.height);for(var t=0;t<this.height;t++)this.collision[t]=this.collisionData.slice(t*this.width,(t+1)*this.width);delete this.collisionData,log.debug("Collision grid generated.")},_generateTileGrid:function(){this.tile=new Array(this.height);for(var t=0;t<this.height;t++)this.tile[t]=this.tileData.slice(t*this.width,(t+1)*this.width);delete this.tileData,log.debug("tile grid generated.")},isColliding:function(t,e){return 1===this.collision[e][t]}})}),define("area",[],function(){return Class.extend({init:function(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i},contains:function(t){return!!t&&t.gx>=this.x&&t.gy>=this.y&&t.gx<this.x+this.width&&t.gy<this.y+this.height}})}),define("mapcontainer",["area","detect","mapworker","map"],function(i,t,e,n){return Class.extend({init:function(t,e,n){var i=this,t=(this.game=t,this.mapIndex=e,this.mapName=n,this.isLoaded=!1,this.mapLoaded=!1,this.gridReady=!1,this.maps={},this.collisionGrid=[],this.tileGrid=[],this.itemGrid=[],this.count=0,this.inc=0,"./maps/"+this.mapName+".zip");JSZipUtils.getBinaryContent(t,function(t,e){if(t)throw t;JSZip.loadAsync(e).then(function(t){i.zip=t;try{var e=i.mapName+"_GO.json";t.file(e).async("string").then(function(t){i.loadMap(JSON.parse(t))})}catch(t){console.error(JSON.stringify(t))}})})},loadMap:function(t){this.isLoaded=!1,this.data=t,this._initMap(this.data),this.mapLoaded=!0,this._isReady()},_isReady:function(){this.ready_func&&this.ready_func()},_initGrids:function(){for(var t=game.camera,e=0;e<t.gridHE;++e){this.collisionGrid[e]=[],this.itemGrid[e]=[],this.tileGrid[e]=[];for(var n=0;n<t.gridWE;++n)this.collisionGrid[e][n]=!1,this.tileGrid[e][n]=0,this.itemGrid[e][n]={}}},_initMap:function(t){var e,n=game.camera,i=game.renderer.gameScale,r=game.tilesize;this.width=t.width,this.height=t.height,this.chunkWidth=128,this.chunkHeight=128,this.chunksX=Math.ceil(t.width/t.chunkWidth),this.chunksY=Math.ceil(t.height/t.chunkHeight),this.indexes=t.indexes,this.widthX=(t.width-1)*this.game.tilesize,this.heightY=(t.height-1)*this.game.tilesize,this.tilesize=t.tilesize,this.musicAreas=t.musicAreas||[],this.high=t.high||[],this.high={};for(e of t.high)this.high[e]=!0;this.animated=t.animated,this.doors=this._getDoors(t),this.checkpoints=this._getCheckpoints(t),this.gridWidth=128,this.gridHeight=128,this.edgeX=this.gridWidth>>1,this.edgeY=this.gridHeight>>1,this.gcsx=0,this.gcsy=0,this.gcex=this.width*r-~~(n.screenW/i),this.gcey=this.height*r-~~(n.screenH/i),this._initGrids()},_getDoors:function(t){var n=[];return _.each(t.doors,function(t){t.width=t.width||1,t.height=t.height||1;var e=new i(t.x,t.y,t.width,t.height);switch(e.minLevel=t.tminLevel,e.maxLevel=t.tmaxLevel,e.map=t.tmap,e.difficulty=t.tdifficulty,e.portal=1===t.p,e.quest=t.tq,e.admin=t.a,t.to){case"u":e.orientation=Types.Orientations.UP;break;case"d":e.orientation=Types.Orientations.DOWN;break;case"l":e.orientation=Types.Orientations.LEFT;break;case"r":e.orientation=Types.Orientations.RIGHT;break;default:e.orientation=Types.Orientations.DOWN}n.push(e)}),n},ready:function(t){this.ready_func=t},OnAllReady:function(){this.all_ready_func(),this.gridReady=!0},allReady:function(t){this.all_ready_func=t},isHighTile:function(t){return this.high[t]},isAnimatedTile:function(t){return t+1 in this.animated},getTileAnimationLength:function(t){return this.animated[t+1].l},getTileAnimationDelay:function(t){t=this.animated[t+1];return t.d||100},isDoor:function(e,n){return _.detect(this.doors,function(t){return null!=t.contains({gx:e,gy:n})})},getDoor:function(e){return _.detect(this.doors,function(t){return t.contains(e)})},_getCheckpoints:function(t){var n=[];return _.each(t.checkpoints,function(t){var e=new i(t.x,t.y,t.w,t.h);e.id=t.id,n.push(e)}),n},getCurrentCheckpoint:function(e){return _.detect(this.checkpoints,function(t){return t.contains(e)})},getSubCoordinate:function(t,e){return[t%=this.chunkWidth*this.tilesize,e%=this.chunkHeight*this.tilesize]},getSubIndex:function(t,e){t=t.clamp(0,this.width-1);e=~~((e=e.clamp(0,this.height-1))/this.chunkHeight)*this.chunksX+~~(t/this.chunkWidth);return e<0||e>this.indexes?null:e},getSubIndexRelative:function(t,e){return this.getSubIndex(t>>4,e>>4)},getSubMapIndexDimensions:function(t){this.maps[t];var e=~~(t/this.chunksX)*this.chunkHeight,t=t%this.chunksX*this.chunkWidth;return{x1:t,x2:t+this.chunkWidth,y1:e,y2:e+this.chunkHeight}},GridPositionToTileIndex:function(t,e){return e*this.width+t},GetMap:function(t){var e;return this.maps[t]?e=this.maps[t]:((e=new n(this.game,this,t)).ready(function(){e.gridUpdated=!0,game.renderer.forceRedraw=!0}),this.maps[t]=e,this.count++),e},LoadMaps:function(){var t,e=this;game.tilesize;for(t in this.maps)this.maps[t].ready(function(){this.gridUpdated=!0,++e.inc==e.count&&(e.OnAllReady(),e.inc=0,e.moveGrid(!0),game.renderer.forceRedraw=!0,e.gridReady=!0)})},reloadMaps:function(t){game.tilesize;var e=game.camera.focusEntity;if(!e)return!1;for(var n=e.gx,i=e.gy,r=0;r<this.indexes;r++){var a=this.getSubMapIndexDimensions(r),s=(a.x1+a.x2)/2,a=(a.y1+a.y2)/2,s=Math.abs(s-n),a=Math.abs(a-i);s+a<2*this.chunkHeight?this.maps[r]||this.GetMap(r):s+a>4*this.chunkHeight&&this.maps.hasOwnProperty(r)&&(this.maps[r]=null)}t&&this.LoadMaps()},moveGrid:function(t){game.renderer;var e,n,i,r=game.tilesize,a=game.camera;if(!a.focusEntity||!this.gridReady)return!1;for(e in this.reloadMaps(),this.maps)(map=this.maps[e])&&map.isLoaded&&(i=this.getSubMapIndexDimensions(e),n={x1:a.x,y1:a.y,x2:a.x+a.gridWE*r,y2:a.y+a.gridHE*r},i={x1:i.x1*r,y1:i.y1*r,x2:i.x2*r,y2:i.y2*r},RectContains(n,i))&&this._updateGrid(map);return game.renderer.forceRedraw=!0},_updateGrid:function(t){game.renderer;for(var e,n=game.camera,i=(game.renderer.gameScale,G_TILESIZE,n.gridWE,n.gridHE,n.focusEntity),r=(t.dimensions,n.gridWE),a=(e=n.gridHE)>>1,n=(n.screenW,n.screenH,this.chunkWidth),s=this.chunkHeight,o=i.x>>4,i=i.y>>4,l=this.width,c=this.height,l=(o=(o-(r>>1)).clamp(0,l-r))%n,n=(i=(i-a).clamp(0,c-e))%s,c=(a=t.dimensions).x1-o,s=a.y1-i,h=Math.max(c,0),u=Math.max(s,0),d=Math.min(a.x2-o,r),p=Math.min(a.y2-i,e),f=0<c?0:l,m=u,g=0<s?0:n,y=f;m<p;++m,++g)for(var y=f,v=h;v<d;++v,++y)this.collisionGrid[m][v]=t.collision[g][y],this.tileGrid[m][v]=t.tile[g][y]},isColliding:function(t,e){var t=~~(t>>4),e=~~(e>>4),n=~~(.5+t),i=~~(.5+e),t=[[t,e],[t,i],[n,e],[n,i]],r=t[0];if(this.isOutOfBounds(r[0],r[1]))return!0;if(this.isOutOfBounds((r=t[3])[0],r[1]))return!0;r=null;for(r of t)if(this.isCollidingGrid(r[0],r[1]))return!0;return!1},isCollidingGrid:function(t,e){var n=this.getSubIndex(t,e),n=this.maps[n];return!n||(t-=n.dimensions.x1,e-=n.dimensions.y1,n.isColliding(t,e))},isOutOfBounds:function(t,e){return!isInt(t)||!isInt(e)||t<0||t>=this.width||e<0||e>=this.height},isOutOfCameraBounds:function(t,e){var n=game.tilesize,i=game.tilesize>>1;return!isInt(t)||!isInt(e)||t<i||t>=this.width*n-i||e<i||e>=this.height*n-i},isHarvestTile:function(t,e){var n=this.getTiles(t.gx,t.gy);if(!n||0==n.length)return!1;log.info("tiles="+JSON.stringify(n));t={axe:[678,679,698,699,855,875,274,275,294,295]};return!!t.hasOwnProperty(e)&&t[e].some(function(t){return n.includes(t)})},getTiles:function(t,e){var n=this.getSubIndex(t,e),n=this.maps[n],t=t%this.chunkWidth,e=e%this.chunkHeight;return n.tile[e][t]}})}),define("animation",[],function(){return Class.extend({init:function(t,e,n,i,r,a){this.name=t,this.length=e,this.col=n,this.row=i,this.width=r,this.height=a,this.reset()},tick:function(){var t=(t=this.currentFrame.index)<this.length-1?t+1:0;0<this.count&&0===t&&(--this.count,0===this.count)?(this.currentFrame.index=0,this.endcount_callback()):(this.currentFrame.x=this.width*(t+this.col),this.currentFrame.y=this.height*this.row,this.currentFrame.i=t+this.col,this.currentFrame.j=this.row,this.currentFrame.index=t)},setSpeed:function(t){this.speed=t},setCount:function(t,e){this.count=t,this.endcount_callback=e},isTimeToAnimate:function(t){return t-this.lastTime>this.speed},update:function(t){return 0===this.lastTime&&"atk"===this.name.substr(0,3)&&(this.lastTime=t),!!this.isTimeToAnimate(t)&&(this.lastTime=t,this.tick(),!0)},reset:function(){this.lastTime=0,this.currentFrame={index:0,x:this.col*this.width,y:this.row*this.height,i:this.col,j:this.row}}})}),define("sprite",["animation"],function(n){return Class.extend({init:function(t,e,n){this.name=t.id,this.file=t.file,this.scale=e,this.container=n,this.isLoaded=!1,this.offsetX=0,this.offsetY=0,this.data=t,this.loadJSON(t),this.whiteSprite={isLoaded:!0},this.silhouetteSprite={isLoaded:!0},this.rsprite=null},loadJSON:function(t){this.id=t.id,this.file?this.filepath="img/"+this.scale+"/sprites/"+this.file:t.file?this.filepath="img/"+this.scale+"/sprites/"+t.file:this.filepath="img/"+this.scale+"/sprites/"+this.id+".png",this.animationData=t.animations,this.width=t.width,this.height=t.height,this.offsetX=void 0!==t.offset_x?t.offset_x:-16,this.offsetY=void 0!==t.offset_y?t.offset_y:-16},createAnimations:function(){for(var t in this.animations={},this.animationData){var e=this.animationData[t];e.hasOwnProperty("col")||(e.col=0),this.animations[t]=new n(t,e.length,e.col,e.row,this.width,this.height)}return this.animations},getAnimationByName:function(t){var e,n=null;return t in this.animations?n=this.animations[t]:(e=new Error,log.error(e.stack),log.error("No animation called "+t)),n},setAnimation:function(t,e,n,i){this.currentAnimation&&this.currentAnimation.name===t||(this.sprite,(t=this.getAnimationByName(t))&&(this.currentAnimation=t,this.currentAnimation.setSpeed(e),this.currentAnimation.setCount(n||0,i)))}})}),define("tile",[],function(){return Class.extend({}).extend({init:function(t,e,n,i){this.startId=t,this.id=t,this.length=e,this.speed=n,this.index=i,this.lastTime=0},tick:function(){this.id-this.startId<this.length-1?this.id+=1:this.id=this.startId},animate:function(t){return t-this.lastTime>this.speed&&(this.tick(),this.lastTime=t,!0)}})}),define("audio",["area"],function(a){return Class.extend({init:function(t){t.renderer.mobile||"undefined"!=typeof Native?this.enabled=!1:this.enabled=!0,this.extension="ogg",this.sounds={},this.game=t,this.currentMusic=null,this.areas=[],this.loadedMusic={map0:!1,map1:!1,map2:!1,map3:!1},this.loadedSound={loot:!1,hit1:!1,hit2:!1,hurt:!1,heal:!1,chat:!1,revive:!1,death:!1,firefox:!1,achievement:!1,kill1:!1,kill2:!1,noloot:!1,teleport:!1,chest:!1,npc:!1,"npc-end":!1},Detect.isSafari()&&Detect.isWindows()&&(this.enabled=!1)},toggle:function(t){return this.enabled=t,this.enabled?this.currentMusic&&this.resetMusic(this.currentMusic):this.stopMusic(this.currentMusic),this.enabled},load:function(t,e,n,i){var r=t+e+"."+this.extension,a=document.createElement("audio"),s=this;a.addEventListener("canplaythrough",function(t){this.removeEventListener("canplaythrough",arguments.callee,!1),log.debug(r+" is ready to play."),n&&n()},!1),a.addEventListener("error",function(t){log.error("Error: "+r+" could not be loaded."),s.sounds[e]=null},!1),a.preload="auto",a.autobuffer=!0,a.src=r,a.load(),this.sounds[e]=[a],_.times(i-1,function(){s.sounds[e].push(a.cloneNode(!0))})},loadSound:function(t,e){this.load("audio/sounds/",t,e,4)},loadMusic:function(t,e){this.load("audio/music/",t,e,1);var n=this.sounds[t][0];n.loop=!0,n.addEventListener("ended",function(){n.play()},!1)},getSound:function(t){var e;return this.sounds[t]?((e=_.detect(this.sounds[t],function(t){return t.ended||t.paused}))&&e.ended?e.currentTime=0:e=this.sounds[t][0],e):null},playSound:function(t){this.enabled&&(t in this.loadedSound&&0==this.loadedSound[t]&&(this.loadSound(t),this.loadedSound[t]=!0),t=this.getSound(t))&&t.play()},addArea:function(t,e,n,i,r){t=new a(t,e,n,i);t.musicName=r,this.areas.push(t)},getSurroundingMusic:function(t){return null},updateMusic:function(){var t;this.enabled&&(t=this.getSurroundingMusic(this.game.player))?this.isCurrentMusic(t)||(this.currentMusic&&this.fadeOutCurrentMusic(),this.playMusic(t)):this.fadeOutCurrentMusic()},isCurrentMusic:function(t){return this.currentMusic&&t.name===this.currentMusic.name},playMusic:function(t){t.name in this.loadedMusic&&0==this.loadedMusic[t.name]&&(this.loadMusic(t.name),this.loadMusic[t.name]=!0),this.enabled&&t&&t.sound&&(t.sound.fadingOut?this.fadeInMusic(t):(t.sound.volume=.75,t.sound.play()),this.currentMusic=t)},resetMusic:function(t){t&&t.sound&&0<t.sound.readyState&&(t.sound.pause(),t.sound.currentTime=0,t.sound.play())},stopMusic:function(t){t&&t.sound&&0<t.sound.readyState&&(t.sound.pause(),t.sound.currentTime=0)},fadeOutMusic:function(t,e){var n=this;t&&!t.sound.fadingOut&&(this.clearFadeIn(t),t.sound.fadingOut=setInterval(function(){volume=t.sound.volume-.02,n.enabled&&.02<=volume?t.sound.volume=volume:(t.sound.volume=0,n.clearFadeOut(t),e(t))},50))},fadeInMusic:function(t){var e=this;t&&!t.sound.fadingIn&&(this.clearFadeOut(t),t.sound.fadingIn=setInterval(function(){volume=t.sound.volume+.01,e.enabled&&volume<.74?t.sound.volume=volume:(t.sound.volume=.75,e.clearFadeIn(t))},30))},clearFadeOut:function(t){t.sound.fadingOut&&(clearInterval(t.sound.fadingOut),t.sound.fadingOut=null)},clearFadeIn:function(t){t.sound.fadingIn&&(clearInterval(t.sound.fadingIn),t.sound.fadingIn=null)},fadeOutCurrentMusic:function(){var e=this;this.currentMusic&&(this.fadeOutMusic(this.currentMusic,function(t){e.resetMusic(t)}),this.currentMusic=null)}})}),define("updater",["entity/character","timer","entity/player","entity/entitymoving"],function(n,t,i,r){return Class.extend({init:function(i){var n=this;this.game=i,this.performanceTime=0,this.lastUpdateTime=Date.now(),this.checkStopDanger=function(t){var e=t.orientation,n=!1;if(-1==t.ex&&-1==t.ey)return!1;t.x==t.ex&&t.y==t.ey&&(log.info("checkStopDanger - coordinates equal"),n=!0);var i=t.x,r=t.y;return e==Types.Orientations.LEFT&&t.x<t.ex||e==Types.Orientations.RIGHT&&t.x>t.ex||e==Types.Orientations.UP&&t.y<t.ey||e==Types.Orientations.DOWN&&t.y>t.ey||(n&&(t.setPosition(t.ex,t.ey),log.info("WARN - PLAYER "+t.id+" not stopping."),log.info("x :"+i+",y :"+r),log.info("ex:"+t.ex+",ey:"+t.ey)),n)},this.charPathXF=function(t,e){e=t.x+e;return!t.hasChangedItsPath()&&(t.setPosition(e,t.y),t.nextStep())},this.charPathYF=function(t,e){e=t.y+e;return!t.hasChangedItsPath()&&(t.setPosition(t.x,e),t.nextStep())},this.charKeyXF=function(t,e){e=t.x+e;return e==t.ex||n.checkStopDanger(t)?(t.forceStop(),!0):(t.setPosition(e,t.y),!1)},this.charKeyYF=function(t,e){e=t.y+e;return e==t.ey||n.checkStopDanger(t)?(t.forceStop(),!0):(t.setPosition(t.x,e),!1)},this.playerKeyXF=function(t,e){var e=t.x+e,n=i.moveCharacter(t,e,t.y);return n?t.setPosition(e,t.y):t.forceStop(),!n},this.playerKeyYF=function(t,e){var e=t.y+e,n=i.moveCharacter(t,t.x,e);return n?t.setPosition(t.x,e):t.forceStop(),!n},this.playerPathXF=function(t,e){e=t.x+e;return t.setPosition(e,t.y),t.nextStep()},this.playerPathYF=function(t,e){e=t.y+e;return t.setPosition(t.x,e),t.nextStep()},this.stopTransition=function(t){}},update:function(){game.tilesize;game.mapStatus<2||(this.looping=!0,this.updateCharacters(),this.updateTransitions(),this.updateAnimations(),this.updateChatBubbles(),this.updateInfos(),this.looping=!1,this.lastUpdateTime=Date.now())},updateCharacters:function(){var e=this;game.mapContainer;game.forEachEntity(function(t){e.game.updateCameraEntity(t.id,t),t instanceof r&&((t.tickFrames=0)<t.tick&&(t.tickFrames=t.tick),t instanceof i?t==game.player?(e.updatePlayerPathMovement(t),e.updatePlayerKeyMovement(t)):(e.updateCharacterKeyMovement(t),e.updateCharacterPathMovement(t)):t instanceof n&&e.updateCharacterPathMovement(t))})},updateTransitions:function(){var e=null;game.forEachEntity(function(t){!t||t.freeze||t.isDead||t.isDying||(e=t.movement)&&e.inProgress&&e.step()})},updateCharacterPathMovement:function(t){var e=t.tickFrames,n=t.orientation;t.freeze||t.isStunned||t.isDying||t.isDead||!1===t.movement.inProgress&&t.isMovingPath()&&(n==Types.Orientations.LEFT?t.movement.start(this.charPathXF,this.stopTransition,-e):n==Types.Orientations.RIGHT?t.movement.start(this.charPathXF,this.stopTransition,e):n==Types.Orientations.UP?t.movement.start(this.charPathYF,this.stopTransition,-e):n==Types.Orientations.DOWN&&t.movement.start(this.charPathYF,this.stopTransition,e))},updateCharacterKeyMovement:function(t){var e=t.tickFrames,n=t.orientation;t.freeze||t.isMovingPath()||t.isDying||t.isDead||!1===t.movement.inProgress&&t.keyMove&&0<n&&(n==Types.Orientations.LEFT?t.movement.start(this.charKeyXF,null,-e):n==Types.Orientations.RIGHT?t.movement.start(this.charKeyXF,null,e):n==Types.Orientations.UP?t.movement.start(this.charKeyYF,null,-e):n==Types.Orientations.DOWN&&t.movement.start(this.charKeyYF,null,e))},updatePlayerPathMovement:function(t){var e=t.tickFrames,n=t.orientation;t.isDying||t.isDead||t.freeze||t.isStunned||t.keyMove||!t.isMovingPath()||!1===t.movement.inProgress&&(n==Types.Orientations.LEFT?t.movement.start(this.playerPathXF,null,-e):n==Types.Orientations.RIGHT?t.movement.start(this.playerPathXF,null,e):n==Types.Orientations.UP?t.movement.start(this.playerPathYF,null,-e):n==Types.Orientations.DOWN&&t.movement.start(this.playerPathYF,null,e))},updatePlayerKeyMovement:function(t){var e,n;game.player&&(e=t.tickFrames,n=t.orientation,game.joystick&&game.usejoystick&&(game.joystick.isActive()||t.move(t.orientation,!1),game.joystick.right()?t.move(Types.Orientations.RIGHT,!0):game.joystick.left()?t.move(Types.Orientations.LEFT,!0):game.joystick.up()?t.move(Types.Orientations.UP,!0):game.joystick.down()&&t.move(Types.Orientations.DOWN,!0)),game.joystick&&game.joystick.isActive()&&clearInterval(game.autotalk),t.isDying||t.isDead||t.freeze||t.isStunned||t.isMovingPath()||!1===t.movement.inProgress&&t.keyMove&&(n==Types.Orientations.LEFT?t.movement.start(this.playerKeyXF,null,-e):n==Types.Orientations.RIGHT?t.movement.start(this.playerKeyXF,null,e):n==Types.Orientations.UP?t.movement.start(this.playerKeyYF,null,-e):n==Types.Orientations.DOWN&&t.movement.start(this.playerKeyYF,null,e)))},updateAnimations:function(){var n=game.currentTime,t=(game.camera.forEachInScreen(function(t){var e;t&&(e=t.currentAnimation)&&!t.isStun&&e.update(n)}),this.game.targetAnimation);t&&t.update(n),game.appearanceDialog.visible&&(t=game.appearanceDialog.playerAnim).currentAnimation&&(t.currentAnimation.name,t.currentAnimation.update(n),t.show())},updateAnimatedTiles:function(){var e=game.currentTime;game.forEachAnimatedTile(function(t){t.animate(e)})},updateChatBubbles:function(){var t=this.game.currentTime;game.bubbleManager.update(t)},updateInfos:function(){var t=this.game.currentTime;this.game.infoManager.update(t)}})}),define("lib/astar",[],function(){var z;function K(t,e,n,i,r,a,s,o,l,c,h,u,d){return t&&(n&&!l[r][s]&&(u[d++]={x:s,y:r}),i)&&!l[r][o]&&(u[d++]={x:o,y:r}),e&&(n&&!l[a][s]&&(u[d++]={x:s,y:a}),i)&&!l[a][o]&&(u[d++]={x:o,y:a}),u}function U(t,e,n,i,r,a,s,o,l,c,h,u,d){return t=-1<r,e=a<c,i=-1<o,s<h&&(t&&!l[r][s]&&(u[d++]={x:s,y:r}),e)&&!l[a][s]&&(u[d++]={x:s,y:a}),i&&(t&&!l[r][o]&&(u[d++]={x:o,y:r}),e)&&!l[a][o]&&(u[d++]={x:o,y:a}),u}function G(t,e,n,i,r,a,s,o,l,c,h,u,d){return u}function W(t){return z[~~t[0]][~~t[1]]}function Y(t,e,n,i){return i(n(t.x-e.x),n(t.y-e.y))}function X(t,e,n,i){var r=t.x-e.x,t=t.y-e.y;return i(r*r+t*t)}function V(t,e,n,i){return n(t.x-e.x)+n(t.y-e.y)}return{AStar:function(t,e,n,i){var r,a,s,o,l,c,h,u,d,p,f,m,g,y,$,v,b,k,w,x,S,T,_,I,E,C,A,M=(z=t)[0].length,B=t.length,R=M*B,j=Math.abs,D=Math.max,H={},N=[],O=[{x:~~e[0],y:~~e[1],f:0,g:0,v:e[0]+e[1]*M}],P=1,F={x:~~n[0],y:~~n[1],v:~~n[0]+~~n[1]*M};switch(i){case"Diagonal":s=K;case"DiagonalFree":a=Y;break;case"Euclidean":s=K;case"EuclideanFree":D=Math.sqrt,a=X;break;default:a=V,s=G}s=s||U;do{for(l=R,L=c=0;L<P;++L)(i=O[L].f)<l&&(l=i,c=L);if((h=O.splice(c,1)[0]).v!=F.v)for(--P,m=s,g=h.x,y=h.y,$=t,v=B,b=M,A=C=E=I=_=T=S=x=w=k=void 0,k=(y=.5+~~y)-1,w=y+1,x=(g=.5+~~g)+1,S=g-1,T=0<k&&!W([k,g]),_=w<v+1&&!W([w,g]),I=x<b+1&&!W([y,x]),E=0<S&&!W([y,S]),C=[],A=0,T&&(C[A++]={x:g,y:k}),I&&(C[A++]={x:x,y:y}),_&&(C[A++]={x:g,y:w}),E&&(C[A++]={x:S,y:y}),L=0,o=(u=m(T,_,I,E,k,w,x,S,$,v,b,C,A)).length;L<o;++L)(r=u[L]).p=h,r.f=r.g=0,r.v=Math.floor(r.x)+Math.floor(r.y)*M,r.v in H||(d=0,r.p&&(r.dir=(f=(p=r).p,p.x<f.x?1:p.x>f.x?2:p.y<f.y?3:p.y>f.y?4:0),r.p.dir)&&r.p.dir!=r.dir&&(d=2),r.f=(r.g=h.g+a(r,h,j,D))+a(r,F,j,D)+d,H[(O[P++]=r).v]=1);else{for(L=P=0;N[L++]=[h.x,h.y],h=h.p;);function q(t,e){e.shift(),e.unshift([t[0],t[1]]);var n,i=null;for(n of e){if(i)if(~~i[0]==~~n[0])n[0]=i[0];else{if(~~i[1]!=~~n[1])break;n[1]=i[1]}i=n}}q(n,N),N.reverse(),q(e,N)}}while(P);for(var L=2;L<N.length;++L)(0<Math.abs(N[L-2][0]-N[L][0])&&0==Math.abs(N[L-2][1]-N[L][1])||0<Math.abs(N[L-2][1]-N[L][1])&&0==Math.abs(N[L-2][0]-N[L][0]))&&N.splice(--L,1);return N}}}),define("pathfinder",["lib/astar"],function(o){return Class.extend({init:function(t,e){this.width=t,this.height=e,this.grid=null,this.blankGrid=[],this.initBlankGrid_(),this.ignored=[],this.included=[]},initBlankGrid_:function(){},checkValidPath:function(t){var e,n=null;if(!Array.isArray(t)||t.length<2)return!1;for(e of t){if(n)if(n[0]!=e[0]&&n[0]!=e[1]&&n[1]!=e[0]&&n[1]!=e[1])return!1;n=e}return!0},isValidPath:function(o,t){G_TILESIZE;function e(t,e,n,i){t=Math.floor(t),e=Math.floor(e),n=Math.floor(n);var r=Math.min(t,e),a=Math.max(t,e);if("x"==i){for(var s=r;s<a;s++)if(o[n][s])return!1}else for(s=r;s<a;s++)if(o[s][n])return!1;return!0}var n,i,r,a,s=o.length,l=o[0].length,c=null;for(n of t){if(n[1]<0||n[1]>=s)return!1;if(n[0]<0||n[0]>l)return!1;if(c){if(n[0]!=c[0]&&n[1]!=c[1])return!1;if(0<Math.abs(n[0]-c[0])){if(i=c[0],r=n[0],a=n[1],!e(i,r,a,"x"))return!1}else if(0<Math.abs(n[1]-c[1])&&(i=c[1],r=n[1],a=n[0],!e(i,r,a,"y")))return!1}c=n}return!0},getShortGrid:function(t,e,n,i){G_TILESIZE;e=[e[0],e[1]],n=[n[0],n[1]];for(var r=Math.max(Math.min(Math.floor(e[0]),Math.floor(n[0]))-i,0),a=Math.min(Math.max(Math.ceil(e[0]),Math.ceil(n[0]))+i,t[0].length-1),s=Math.max(Math.min(Math.floor(e[1]),Math.floor(n[1]))-i,0),o=Math.min(Math.max(Math.ceil(e[1]),Math.ceil(n[1]))+i,t.length-1),i=[e[0]-r,e[1]-s],e=[n[0]-r,n[1]-s],a=Math.min(t[0].length-1,a),o=Math.min(t.length-1,o),l=new Array(o-s),c=0,h=s;h<=o;++h)l[c++]=new Uint8Array(t[h].slice(r,a));return{crop:l,minX:r,minY:s,substart:i,subend:e}},findNeighbourPath:function(t,e){var n=G_TILESIZE;return Math.abs(t[0]-e[0])<=n&&0==Math.abs(t[1]-e[1])||Math.abs(t[1]-e[1])<=n&&0==Math.abs(t[0]-e[0])?[[t[0],t[1]],[e[0],e[1]]]:null},findShortPath:function(t,e,n,i,r){G_TILESIZE;t=o.AStar(t,i,r);return t&&0<t.length?(log.info(JSON.stringify(t)),t):null},findPath:function(t,e,n,i){return this.grid=t,this.applyIgnoreList_(this.grid,!0),this.applyIncludeList_(this.grid,!0),o.AStar(this.grid,e,n)},findIncompletePath_:function(t,e){for(var n,i,r=[],a=o.AStar(this.blankGrid,t,e),s=a.length-1;0<s;--s)if(n=a[s][0],i=a[s][1],0===this.grid[i][n]){r=o(this.grid,t,[n,i]);break}return r},ignoreEntity:function(t){t&&this.ignored.push(t)},includeEntity:function(t){t&&this.included.push(t)},applyIgnoreList_:function(e,n){var i,r;_.each(this.ignored,function(t){i=t.isMoving()?t.nextGridX:t.gx,r=t.isMoving()?t.nextGridY:t.gy,0<=i&&0<=r&&(e[r][i]=n?0:1)})},applyIncludeList_:function(e,n){var i,r;_.each(this.included,function(t){i=t.isMoving()?0<t.path.length?t.path[t.path.length-1][0]:t.nextGridX:t.gx,r=t.isMoving()?0<t.path.length?t.path[t.path.length-1][1]:t.nextGridY:t.gy,0<=i&&0<=r&&(e[r][i]=n?1:0)})},clearIgnoreList:function(t){this.applyIgnoreList_(t,!1),this.ignored=[]},clearIncludeList:function(t){this.applyIncludeList_(t,!1),this.ignored=[]}})}),define("tabbook",[],function(){return Class.extend({init:function(t){this.parent=parent,this.id=t,this.body=$(t),this.pages=[],this.pageIndex=-1,this.openHandler=null},getPageCount:function(){return this.pages.length},getPageIndex:function(){return this.pageIndex},setPageIndex:function(t){0<=this.pageIndex&&this.pages[this.pageIndex].setVisible(!1),0<=t&&t<this.pages.length?this.openHandler&&!this.openHandler(this,t)||(this.pageIndex=t,this.pages[this.pageIndex].setVisible(!0)):this.pageIndex=-1},getActivePage:function(){return 0<=this.pageIndex?this.pages[this.pageIndex]:null},setActivePage:function(t){t=this.pages.indexOf(t);0<=t&&this.setPageIndex(t)},add:function(t){t.setParent(this),this.pages.push(t)},onOpen:function(t){this.openHandler=t}})}),define("tabpage",[],function(){var i=Class.extend({init:function(t,e){var n=this;this.id=t,this.body=$(t),this.page=e,this.visibleChangeHandler=null,this.body.on("click",function(t){n.page.parent.parent.showing&&n.page.active()})},getVisible:function(){return"active"===this.body.attr("class")},setVisible:function(t){t?this.body.addClass("active"):this.body.removeClass("active")}});return Class.extend({init:function(t,e,n){this.parent,this.id=e,this.body=$(e),this.button=n?new i(n,this):null,this.activeHandler=null},getParent:function(){return this.parent},setParent:function(t){this.parent=t},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){this.button&&this.button.setVisible(t),this.body.css("display",t?"block":"none"),this.visibleChangeHandler&&this.visibleChangeHandler(self,t)},active:function(){this.parent&&this.parent.setActivePage(this)},onVisibleChange:function(t){this.visibleChangeHandler=t}})}),define("pageNavigator",[],function(){return Class.extend({init:function(t,e){this.name=e||"store",this.body=$("#"+this.name+"PageNav"),this.movePreviousButton=$("#"+this.name+"PageNavPrev"),this.numbers=[];for(var n=0;n<5;n++)this.numbers.push($("#"+this.name+"PageNavNumber"+n));this.moveNextButton=$("#"+this.name+"PageNavNext"),this.changeHandler=null,this.rescale(t);var i=this;this.movePreviousButton.click(function(t){1<i.index&&i.setIndex(i.index-1)}),this.moveNextButton.click(function(t){i.index<i.count&&i.setIndex(i.index+1)})},rescale:function(t){if(1==t)for(var e=0;e<this.numbers.length;e++)this.numbers[e].css({position:"absolute",left:12+12*e+"px",top:"0px"});else if(2==t)for(e=0;e<this.numbers.length;e++)this.numbers[e].css({position:"absolute",left:24+24*e+"px",top:"0px"});else if(3==t)for(e=0;e<this.numbers.length;e++)this.numbers[e].css({position:"absolute",left:36+36*e+"px",top:"0px"})},getCount:function(){return this.count},setCount:function(t){this.count=t,this.numbers[3].html(~~(t/10)),this.numbers[4].html(t%10)},getIndex:function(){return this.index},setIndex:function(t){this.pageChanged=this.index!=t,this.index=t,this.numbers[0].html(~~(t/10)),this.numbers[1].html(t%10),this.movePreviousButton.attr("class",1<this.index?"enabled":""),this.moveNextButton.attr("class",this.index<this.count?"enabled":""),this.pageChanged&&this.changeHandler&&this.changeHandler(this)},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){this.body.css("display",t?"block":"none")},onChange:function(t){this.changeHandler=t},open:function(){this.setIndex(1),this.index<this.count?this.setVisible(1):this.setVisible()}})}),define("playeranim",["sprite","animation","timer"],function(t,e,n){return Class.extend({init:function(){this.flipSpriteX=!1,this.flipSpriteY=!1,this.pjsSprite=null,this.animations=null,this.currentAnimation=null,this.isLoaded=!1,this.visible=!0,this.sprites=[],this.animations=[],this.speeds={attack:100,move:50,walk:150,idle:500}},loadAnimations:function(t){var e,n=t.createAnimations();for(e in n)this.animations[e]||(this.animations[e]=n[e]);this.isLoaded=!0,this.ready_func&&this.ready_func()},addSprite:function(t){if(!t)throw log.error(this.id+" : sprite is null",!0),"Sprite error";this.sprites.push(t),this.loadAnimations(t)},ready:function(t){this.ready_func=t},getSprite:function(t){return this.sprite[t]},getSpriteName:function(t){return this.sprite[t].name},getAnimationByName:function(t){var e;return t in this.animations?this.animations[t]:(e=new Error,log.error(e.stack),log.info("No animation called "+t),null)},setAnimation:function(t,e,n,i){var r,a=this;this.isLoaded?this.currentAnimation&&this.currentAnimation.name===t||(this.sprite,(r=this.getAnimationByName(t))&&(this.currentAnimation=r,0===t.indexOf("atk")&&this.currentAnimation.reset(),this.currentAnimation.setSpeed(e),this.currentAnimation.setCount(n||0,i||function(){a.idle()}))):this.log_error("Not ready for animation")},idle:function(t){this.orientation=t||0,this.animate("idle",this.speeds.idle)},hit:function(t){this.orientation=t||0,this.animate("atk",this.speeds.attack,1)},walk:function(t){this.orientation=t||0,this.animate("walk",this.speeds.walk)},animate:function(t,e,n,i){var r=this.orientation||Types.Orientations.DOWN;this.flipSpriteX=!1,this.flipSpriteY=!1,0<=_.indexOf(["atk","walk","idle"],t)&&(t+="_"+(r===Types.Orientations.LEFT?"right":Types.getOrientationAsString(r)),this.flipSpriteX=this.orientation===Types.Orientations.LEFT),this.setAnimation(t,e,n,i)},setHTML:function(t){this.html=t},show:function(){this.currentAnimation.name;var t,e=game.renderer.gameScale,n=0;for(t of this.sprites){var i=this.currentAnimation.currentFrame,r=$(this.html[n]),a=t.width*e,s=t.height*e,o=i.i*a,i=i.j*s;r.css("width",a+"px"),r.css("height",s+"px"),r.css("background-image","url('img/2/sprites/"+t.name+".png')"),r.css("background-size",5*a+"px "+9*s+"px "),r.css("background-position","-"+o+"px -"+i+"px"),n++}}})}),define("dialog/appearancedialog",["./dialog","../tabbook","../tabpage","data/appearancedata","../pageNavigator","../playeranim","data/items"],function(t,e,n,r,i,a,s){var o=Class.extend({init:function(t,e,n){this.parent=t,this.id=e,this.index=n,this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),this.item=null,this.rescale(),this.buyButton.text("Unlock")},rescale:function(){var t=this.parent.scale,e=this.id;this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),1==t?this.body.css({position:"absolute",left:"0px",top:18*this.index+"px"}):2==t?this.body.css({position:"absolute",left:"0px",top:36*this.index+"px"}):3==t&&this.body.css({position:"absolute",left:"0px",top:54*this.index+"px"}),this.item&&this.assign(this.item)},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){var n=this;this.body.css("display",!0===t?"block":"none"),this.buyButton.text("UNLOCK"),this.buyButton.off().on("click",function(t){log.info("buyButton");var e=game.appearanceDialog;game&&game.ready&&e.visible&&game.client.sendAppearanceUnlock(n.item.index,n.item.buyPrice)})},assign:function(t){(this.item=t).itemKind=t.index,this.scale=this.parent.scale,s.jqShowItem(this.basket,this.item,this.basket),this.extra.text(t.name),this.price.text(t.buyPrice);var n=this;this.body.off().on("click",function(t){var e=game.appearanceDialog;game&&game.ready&&e.visible&&(e.update(n.parent.itemType,game.sprites[r[n.item.index].sprite]),$("#appearanceDialog").show())})},clear:function(){this.basket.css("background-image","none"),this.basket.attr("title",""),this.extra.text(""),this.price.text("")}}),n=n.extend({init:function(t,e,n,i,r){this._super(t,e+"Page",e+r+"Button"),this.itemType=n,this.racks=[],this.items=[],this.scale=i,this.rackSize=5;for(var a=this.pageIndex=0;a<this.rackSize;a++)this.racks.push(new o(this,e+a,a))},rescale:function(t){this.scale=t;for(var e=0;e<this.rackSize;e++)this.racks[e].rescale()},getPageCount:function(){return this.items?Math.ceil(this.items.length/this.rackSize):0},getPageIndex:function(){return this.pageIndex},setPageIndex:function(t){this.pageIndex=t,this.onData()},open:function(){this.setPageIndex(0)},onData:function(){var t;if(this.items=[],game&&game.player){0==this.itemType&&(t="armor"),1==this.itemType&&(t="weapon"),game.player.isArcher()&&(0==this.itemType&&(t="armorarcher"),1==this.itemType)&&(t="weaponarcher");for(var e=0;e<r.length;++e){var n=r[e];n&&n.type==t&&0==game.player.appearances[e]&&0<n.buy&&this.items.push({index:e,name:n.name,sprite:n.sprite,buyPrice:n.buy})}this.reload(),this.parent.updateNavigator()}},reload:function(){for(var t=this.pageIndex*this.rackSize;t<Math.min((this.pageIndex+1)*this.rackSize,this.items.length);t++)(e=this.racks[t-this.pageIndex*this.rackSize]).assign(this.items[t]),e.setVisible(!0);for(var e,t=this.items.length;t<(this.pageIndex+1)*this.rackSize;t++)(e=this.racks[t-this.pageIndex*this.rackSize]).setVisible(!1)}}),l=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",0,e,1)}}),c=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",1,e,2)}}),h=e.extend({init:function(t){this._super("#storeDialogStore"),this.parent=t,this.scale=this.parent.scale,this.pageArmor=new l(t,this.scale),this.pageWeapon=new c(t,this.scale),this.add(this.pageArmor),this.add(this.pageWeapon),this.pageNavigator=new i(t.scale);var n=this;this.pageNavigator.onChange(function(t){var e=n.getActivePage();e&&game.appearanceDialog.visible&&e.setPageIndex(t.getIndex()-1)})},rescale:function(){this.scale=this.parent.scale,this.pageArmor.rescale(this.scale),this.pageWeapon.rescale(this.scale),this.pageNavigator.rescale(this.scale)},setPageIndex:function(t){game.appearanceDialog.visible&&(this._super(t),this.updateNavigator(),this.getActivePage().open())},updateNavigator:function(){var t=this.getActivePage();t&&(0<t.getPageCount()?(this.pageNavigator.setCount(t.getPageCount()),this.pageNavigator.setIndex(t.getPageIndex()+1),this.pageNavigator.setVisible(!0)):this.pageNavigator.setVisible(!1),t.reload())},open:function(){game.client.sendAppearanceList()}});return t.extend({init:function(e){this._super(e,"#storeDialog"),this.storeFrame=new h(this),this.closeButton=$("#storeDialogCloseButton"),this.modal=$("#storeDialogModal"),this.scale=this.setScale();function n(t){0<i.armorLooks.length&&(t=i.looksArmorIndex=(i.armorLooks.length+t)%i.armorLooks.length,0!=(t=i.armorLooks[t])&&1!=e.player.appearances[t]||(e.player.sprites[0]=t,e.player.setArmorSprite(),e.client.sendLook(0,t)),i.playerAnim.sprites[0]=e.sprites[r[t].sprite],i.updateLook(),e.app.initPlayerBar())}var i=this;this.closeButton.click(function(t){var e=i.storeFrame.getActivePage();e&&e.setVisible(!1),i.hide()}),e.player,this.playerAnim=new a;$("#changeLookArmorPrev").bind("click",function(t){n(--i.looksArmorIndex)}),$("#changeLookArmorNext").bind("click",function(t){n(++i.looksArmorIndex)})},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale(),this.storeFrame.rescale()},hide:function(){$("#storeDialogInventory").css("display","block"),$("#looksDialogPlayer").css("display","none"),$("#appearanceDialog").css("display","none"),this._super()},assign:function(t){game.player.appearances=HexToBin(t.shift());for(var e=0;e<r.length;e++)r[e].buy=parseInt(t.shift());this.storeFrame.pageArmor.onData(),this.storeFrame.pageWeapon.onData();var n="armor",i="weapon";game.player.isArcher()&&(n="armorarcher",i="weaponarcher"),this.armorLooks=[],this.weaponLooks=[],this.looksArmorIndex=0;for(e=this.looksWeaponIndex=0;e<r.length;e++)0!=game.player.appearances[e]&&(r[e].type==n?this.armorLooks.push(e):r[e].type==i&&this.weaponLooks.push(e));this.looksArmorIndex=this.armorLooks.indexOf(game.player.sprite[0]),this.looksWeaponIndex=this.weaponLooks.indexOf(game.player.sprite[0]),this.scale=game.renderer.getUiScaleFactor(),this.updateLook()},update:function(t,e){this.playerAnim.sprites[t]=e,this.updateLook()},updateLook:function(){var e=this.playerAnim,t=game.player,t=(0==e.sprites.length&&(e.addSprite(t.getArmorSprite()),e.addSprite(t.getWeaponSprite()),e.setHTML(["#characterLookArmor","#characterLookWeapon"])),e.sprites[0]),n=e.sprites[1],i=0,r=0,a=(this.paInterval&&clearInterval(this.paInterval),[e.walk,e.hit]);this.paInterval=setInterval(function(){var t;e.isLoaded&&(t=i%3+1,a[r%a.length].bind(e)(t),++r%a.length==0)&&i++},1500);switch(width1=n?2*n.width*1.5:0,height1=n?2*n.height*1.5:0,width2=t?2*t.width*1.5:0,height2=t?2*t.height*1.5:0,width3=Math.max(width1,width2),height3=Math.max(height1,height2),this.scale){case 1:$("#characterLook").css("left",90-parseInt(width3/2)+"px"),$("#characterLook").css("top","40px");break;case 2:$("#characterLook").css("left",180-parseInt(width3/2)+"px"),$("#characterLook").css("top","80px");break;case 3:$("#characterLook").css("left",270-parseInt(width3/2)+"px"),$("#characterLook").css("top","120px")}$("#characterLook").css("width",width3+"px"),$("#characterLook").css("height",height3+"px"),$("#characterLookArmor").css("left",parseInt((width3-width2)/2)+"px"),$("#characterLookArmor").css("top",parseInt((height3-height2)/2)+"px"),$("#characterLookWeapon").css("left",parseInt((width3-width1)/2)+"px"),$("#characterLookWeapon").css("top",parseInt((height3-height1)/2)+"px")},show:function(){this.rescale(),this.storeFrame.open(),game.client.sendAppearanceList(),$("#storeDialog .frameheadingtext").text("LOOKS"),$("#storeDialogStore0Button").hide(),$("#storeDialogStore2Button").hide(),$("#storeDialogStore3Button").text("LOOKS"),$("#storeDialogStore3Button").show(),$("#storeDialogStore3Button").off().on("click",function(t){$("#appearanceDialog").show()}),$("#appearanceCloseButton").off().on("click",function(t){$("#appearanceDialog").hide()}),$("#looksDialogPlayer").css("display","block"),this._super()}})}),define("text!data/../../shared/data/mobs_speech.json",function(){return'{\n\t"plot": [\n\t\t"You have awoken",\n\t\t"You\'re awake",\n\t\t"It\'s awake?",\n\t\t"You will die this time",\n\t\t"How could this happen?",\n\t\t"Is that you?",\n\t\t"It cant be..",\n\t\t"But, but I thought you were dead..",\n\t\t"This time you will not survive.",\n\t\t"I will kill you for good.",\n\t\t"None can survive me!",\n\t\t"Curses youre alive still.",\n\t\t"But, We destroyed you..",\n\t\t"We killed your father and well kill you.",\n\t\t"How can you be alive still?",\n\t\t"Your brother gasped as he died.",\n\t\t"Its, its you..",\n\t\t"The chosen one, ha you will pay in blood"\n\t],\n\t\n\t"battle": [\n\t\t"Argh",\n\t\t"Ugh",\n\t\t"Oooh",\n\t\t"Ahhh",\n\t\t"MMmm",\n\t\t"Eaat",\n\t\t"Delicious",\n\t\t"Die",\n\t\t"Kill it",\n\t\t"Kill",\n\t\t"Destroy",\n\t\t"Maimm",\n\t\t"Death",\n\t\t"Foood",\n\t\t"Starving",\n\t\t"Rawr",\n\t\t"Roar",\n\t\t"Yummy",\n\t\t"Grrr",\n\t\t"Growl"\n\t]\n}\n'}),define("data/mobspeech",["text!../../shared/data/mobs_speech.json"],function(t){var n={Speech:{}},t=JSON.parse(t);return $.each(t,function(t,e){n.Speech[t]=e}),n}),define("playerpopupmenu",[],function(){return Class.extend({init:function(t){this.width=parseInt($("#playerPopupMenuContainer").css("width")),this.height=parseInt($("#playerPopupMenuContainer").css("height")),this.game=t,this.selectedPlayer=null;var e=this;$("#playerPopupMenuPartyInvite").click(function(t){e.selectedPlayer&&(e.game.client.sendPartyInvite(e.selectedPlayer.name,0),e.close())}),$("#playerPopupMenuPartyLeader").click(function(t){e.selectedPlayer&&(e.game.client.sendPartyLeader(e.selectedPlayer.name),e.close())}),$("#playerPopupMenuPartyKick").click(function(t){e.selectedPlayer&&(e.game.client.sendPartyKick(e.selectedPlayer.name),e.close())}),$("#playerPopupMenuAttack").click(function(t){e.selectedPlayer&&(e.game.player.pvpTarget&&e.game.player.pvpTarget==e.selectedPlayer?$("#playerPopupMenuAttack").html("Attack"):(e.game.player.pvpTarget=e.selectedPlayer,setTimeout(function(){e.game.player&&(e.game.player.pvpTarget=null),clearInterval(e.game.makePlayerAttackAuto)},6e4))),e.close()})},click:function(t){var e=this.game.renderer.scale,n=(t.x-this.game.camera.x)*e-$("#playerPopupMenuContainer").width()/2,e=(t.y-this.game.camera.y)*e-$("#playerPopupMenuContainer").height()/2,i=this.game.socialHandler;this.selectedPlayer=t,i.isPartyLeader(this.game.player.name)&&i.isPartyMember(this.selectedPlayer.name)?($("#playerPopupMenuPartyKick").css("display","block"),$("#playerPopupMenuPartyLeader").css("display","block")):($("#playerPopupMenuPartyKick").css("display","none"),$("#playerPopupMenuPartyLeader").css("display","none")),i.isPartyLeader(this.game.player.name)&&!i.isPartyMember(this.selectedPlayer.name)||0==i.partymembers.length?($("#playerPopupMenuPartyInvite").show(),setTimeout(function(){$("#playerPopupMenuPartyInvite").hide()},1e4)):$("#playerPopupMenuPartyInvite").hide(),20<=this.selectedPlayer.level&&20<=this.game.player.level&&0!=this.game.mapIndex?$("#playerPopupMenuAttack").css("display","block"):$("#playerPopupMenuAttack").css("display","none"),$("#playerPopupMenuContainer").css("display","block"),$("#playerPopupMenuContainer").css("top",e+"px"),$("#playerPopupMenuContainer").css("left",n+"px"),$("#playerPopupMenuName").html(t.name)},close:function(){this.selectedPlayer=null,$("#playerPopupMenuContainer").css("display","none")}})}),define("classpopupmenu",[],function(){return Class.extend({init:function(){var e=this;$("#classSwitcherButton").click(function(t){game.player.skillHandler.hideShortcuts(),game.statDialog.page.clear(),game.client.sendClassSwitch($("#selectClassSwitch").val()),e.close(),e.show=!1})},close:function(){$("#classSwitcher").css("display","none")},open:function(){$("#classSwitcher").css("display","block")}})}),define("equipmenthandler",["entity/item","data/items"],function(t,i){return Class.extend({init:function(t){this.game=t,this.equipment=[],this.maxNumber=5,this.scale=3;for(var e=0;e<5;++e)$("#equipment"+e).attr("draggable",!0),$("#equipment"+e).draggable=!0,$("#equipment"+e).data("slot",e),$("#equipBackground"+e).data("slot",e)},selectItem:function(t,e){log.info("equipment - selectItem"+t),e?(this.selectedItem=t,$("#equipBackground"+t).css({border:this.scale+"px solid white"})):($("#equipBackground"+t).css({border:"none"}),this.selectedItem=-1)},clearItem:function(t){$("#equipment"+t).css({"background-image":"none","box-shadow":"none"}),$("#equipment"+t).html("")},setEquipment:function(t){for(var e=0;e<t.length;++e){this.clearItem(e);var n=t[e];-1==n.itemKind?this.equipment[n.slot]=null:n&&4==(this.equipment[n.slot]=n).slot&&game.player.setRange()}this.refreshEquipment()},refreshEquipment:function(){game.renderer.guiScale;for(var t=0;t<this.maxNumber;++t){var e=this.equipment[t],n="#equipment"+t;e&&0<e.itemKind&&e.itemKind<1e3&&(e.name=ItemTypes.KindData[e.itemKind].name),n&&e?i.jqShowItem($(n),e,$(n)):this.clearItem(t)}}})}),define("inventoryhandler",["button2","entity/item","data/itemlootdata","data/items"],function(e,t,l,c){return Class.extend({init:function(i){this.game=i,this.maxInventoryNumber=48,this.itemListCount=24,this.inventory=[],this.scale=this.game.renderer.getUiScaleFactor(),this.xscale=this.game.renderer.getIconScaleFactor(),log.info("this.scale="+this.scale),this.inventorybutton=new e("#inventorybutton",{background:{left:196*this.scale,top:314*this.scale,width:17*this.scale},kinds:[0,2],visible:!1}),this.healingCoolTimeCallback=null,this.isShowAllInventory=!1,this.selectedItem=-1,this.pageIndex=0,this.pageItems=24;for(var r=this,t=0;t<4;t++)$("#scinventorybackground"+t).bind("click",function(t){var e,n;r.game.ready&&($("#inventoryGearItems").trigger("click"),e=parseInt(this.id.slice(21)),log.info("inventoryNumber"+e),n=r.inventory[e])&&(n.slot=r.getRealSlot(e),ItemTypes.isConsumableItem(n.itemKind))&&i.useItem(n)});this.closeButton=$("#inventoryCloseButton"),this.closeButton.click(function(t){i.inventoryMode=InventoryMode.MODE_NORMAL,r.deselectItem(),r.hideInventory(),r.refreshInventory()}),$("#inventoryGearItems").click(function(t){r.pageIndex=0,r.deselectItem(),r.refreshInventory()}),$("#inventoryGear2Items").click(function(t){r.pageIndex=1,r.deselectItem(),r.refreshInventory()})},loadInventoryEvents:function(){var o=this;o.selectInventory=function(t){if(o.game&&o.game.ready){var e=$(t).data("itemSlot"),t=$(t).data("itemType"),n=(log.info("selectInventory - click, slot:"+e+", type:"+t),e),i=null,i=0==t?(n+=o.pageIndex*o.pageItems,o.inventory[n]):game.equipmentHandler.equipment[e];if($(".inventorySellGold").html("0"),i){var r=i.itemKind;if((game.inventoryMode==InventoryMode.MODE_ENCHANT||game.inventoryMode==InventoryMode.MODE_REPAIR)&&!ItemTypes.isEquipment(r))return;if((game.inventoryMode==InventoryMode.MODE_SELL||game.inventoryMode==InventoryMode.MODE_AUCTION)&&ItemTypes.isLootItem(r))return}i&&o.selectedItem!=n?($(".inventorySellGoldFrame").show(),o.selectItem(t,o.selectedItem,!1),o.selectItem(t,n,!0),$("#invActionButton").data("itemType",t),$("#invActionButton").data("itemSlot",n),r=i.itemKind,game.inventoryMode==InventoryMode.MODE_AUCTION?(r=~~(ItemTypes.getEnchantSellPrice(i)/2),$(".inventorySellGold").html(parseInt(r))):game.inventoryMode==InventoryMode.MODE_SELL?$(".inventorySellGold").html(parseInt(ItemTypes.getEnchantSellPrice(i))):game.inventoryMode==InventoryMode.MODE_REPAIR?$(".inventorySellGold").html(parseInt(ItemTypes.getRepairPrice(i))):game.inventoryMode==InventoryMode.MODE_ENCHANT?$(".inventorySellGold").html(parseInt(ItemTypes.getEnchantPrice(i))):game.inventoryMode!=InventoryMode.MODE_BANK&&game.inventoryMode!=InventoryMode.MODE_NORMAL||$(".inventorySellGoldFrame").hide()):i&&o.selectedItem==n&&(r=!1,game.inventoryMode==InventoryMode.MODE_AUCTION||game.inventoryMode==InventoryMode.MODE_SELL||game.inventoryMode==InventoryMode.MODE_REPAIR||game.inventoryMode==InventoryMode.MODE_ENCHANT||game.inventoryMode==InventoryMode.MODE_BANK?r=!0:(i.slot=n,game.useItem(i,t)),r&&($("#invActionButton").data("itemType",t),$("#invActionButton").data("itemSlot",e),$("#invActionButton").trigger("click")),o.deselectItem())}};for(var t=0;t<=4;t++){$("#equipment"+t).attr("draggable",!0),$("#equipment"+t).draggable=!0,$("#equipment"+t).data("itemType",2),$("#equipment"+t).data("itemSlot",t),$("#equipBackground"+t).data("itemType",2),$("#equipBackground"+t).data("itemSlot",t);function i(t){DragItem?(game.client.sendItemSlot([1,DragItem.type,DragItem.slot,1,2,t]),DragItem=null,o.deselectItem()):(DragItem={action:2,type:2}).slot=t}$("#equipBackground"+t).on("click",function(t){var e,n=$(this).data("itemSlot");0<=o.selectedItem?i(n):-1==o.selectedItem&&0<=n&&null==((e=n)<0?null:game.equipmentHandler.equipment[e])||(o.selectInventory(this),i(n))}),$("#equipment"+t).on("dragstart touchstart",function(t){o.selectedItem<0&&(o.selectInventory(this),i($(this).data("itemSlot")))}),$("#equipment"+t).on("dragover touchover",function(t){t.preventDefault()}),$("#equipBackground"+t).on("drop touchend",function(t){i($(this).data("itemSlot"))})}for(t=0;t<24;t++){$("#inventory"+t).attr("draggable",!0),$("#inventory"+t).draggable=!0,$("#inventorybackground"+t).data("itemType",0),$("#inventorybackground"+t).data("itemSlot",t);function r(t){var e;null===DragItem?(DragItem={type:0}).slot=t:(e=DragItem.action||2,game.client.sendItemSlot([e,DragItem.type,DragItem.slot,1,0,t]),DragItem=null,o.deselectItem())}function a(t){return t+o.pageIndex*o.pageItems}$("#inventorybackground"+t).on("click tap",function(t){var e=$(this).data("itemSlot"),n=a(e),i=-1==o.selectedItem;i||null!=o.getItem(e)?i?(e=o.selectedItem==n,!i&&e||o.selectInventory(this),game.renderer.isDesktop&&!e&&!i||r(n)):(o.selectInventory(this),game.gamepad.isActive()&&r(n)):(game.gamepad.isActive()&&r(n),o.deselectItem())}),$("#inventorybackground"+t).on("dragstart touchstart",function(t){-1==o.selectedItem&&o.selectInventory(this),DragItem||r(a($(this).data("itemSlot")))}),$("#inventory"+t).on("dragover touchover",function(t){t.preventDefault()}),$("#inventorybackground"+t).on("drop touchend",function(t){DragItem&&r(a($(this).data("itemSlot")))})}$("#game").on("dragover touchover",function(t){t.preventDefault()}),$("#game").on("drop touchend",function(t){o.game.app.setMouseCoordinates(t),DragItem&&0<=DragItem.slot&&(t=o.game.getMouseGridPosition(),o.game.dropItem(DragItem.slot,t.x,t.y),DragItem=null)}),this.sellButton=$("#invActionButton"),this.sellButton.off().on("click",function(t){var e,n,i=o.game,r=parseInt($(this).data("itemType")),a=parseInt($(this).data("itemSlot")),s=(log.info("invActionButton - click, type:"+r+", slot:"+a),o.inventory[a]);2===r&&(s=i.equipmentHandler.equipment[a]),o.deselectItem(),s&&(e=s.itemKind,i.inventoryMode==InventoryMode.MODE_AUCTION?ItemTypes.isLootItem(e)||ItemTypes.isConsumableItem(e)||(n=~~(ItemTypes.getEnchantSellPrice(s)/2),$("#auctionSellCount").val(n),i.app.showAuctionSellDialog(a)):i.inventoryMode==InventoryMode.MODE_SELL?ItemTypes.isLootItem(e)||i.client.sendStoreSell(r,a):i.inventoryMode==InventoryMode.MODE_REPAIR?ItemTypes.isEquipment(e)&&i.repairItem(r,s,a):i.inventoryMode==InventoryMode.MODE_ENCHANT?ItemTypes.isEquipment(e)&&i.enchantItem(r,s,a):i.inventoryMode!=InventoryMode.MODE_BANK||i.bankHandler.isBankFull()||i.client.sendItemSlot([2,r,a,1,1,-1]))}),$(".inventoryGoldFrame").off().on("click",function(t){o.game.bankDialog.visible&&o.game.app.showDropDialog(-1)})},deselectItem:function(){DragItem=null,this.selectItem(this.selectedType,this.selectedItem,!1)},selectItem:function(t,e,n){pageslot=e%this.pageItems,htmlItem=$("#inventorybackground"+pageslot),2==t&&(htmlItem=$("#equipBackground"+e)),this.selectedType=t,n?(this.selectedItem=e,htmlItem.css({border:this.scale+"px solid white"})):(this.selectedItem=-1,htmlItem.css({border:"none"}))},moveShortcuts:function(t,e){this.container.css({left:this.game.mouse.x+"px",top:this.game.mouse.y+"px"})},showInventoryButton:function(){var t=this.scale;this.inventorybutton.setBackground({left:196*t,top:314*t,width:17*t})},refreshInventory:function(){this.makeEmptyInventoryAll(),0===this.pageIndex?this.showInventoryItems(0,24):1===this.pageIndex&&this.showInventoryItems(24,48)},setCurrency:function(t,e){$(".inventoryGold").text(getGoldShortHand(t)),$(".inventoryGems").text(e)},initInventory:function(t){this.pageIndex=0,this.setInventory(t),this.refreshInventory()},setInventory:function(t){for(var e of t){var n,i=e.slot;-1==e.itemKind?(this.inventory[i]=null,this.makeEmptyInventory(i)):(n=(this.inventory[i]=e).itemKind,e.name=(1e3<=n&&n<2e3?l[n-1e3]:ItemTypes.KindData[n]).name,(e=this.pageIndex*this.pageItems)<=i&&i<e+this.pageItems&&this.showInventoryItems(i))}},hasItems:function(t,e){var n,i=0;for(n in this.inventory)if(this.inventory[n]&&this.inventory[n].itemKind===t&&e<=(i+=this.inventory[n].itemNumber))return!0;return!1},showInventoryItems:function(t,e){t=t||0,e=e||t+1,log.info("this.scale="+this.scale);this.scale;for(var n=t;n<e;++n){var i,r,a,s=this.inventory[n],o=n%this.pageItems;s?(i=s.itemKind,s.itemNumber,(1e3<=i&&i<2e3?l[i-1e3]:ItemTypes.KindData[i]).sprite,1e3<=i&&i<2e3?game.sprites.itemloot.file:ItemTypes.isEquippable(i)&&game.sprites.items.file,0<i&&(r=$("#inventory"+o),c.jqShowItem(r,s,r)),(a=(r=$("#inventoryHL"+o)).data("cooltime"))&&0<a&&r.css({"background-color":"#FF000077"}),game.inventoryMode==InventoryMode.MODE_SELL||game.inventoryMode==InventoryMode.MODE_AUCTION?ItemTypes.isEquippable(i)?r.css({"background-color":"transparent"}):r.css({"background-color":"#00000077"}):game.inventoryMode==InventoryMode.MODE_REPAIR?ItemTypes.isEquippable(i)&&s.itemDurability!=s.itemDurabilityMax?r.css({"background-color":"transparent"}):r.css({"background-color":"#00000077"}):game.inventoryMode!=InventoryMode.MODE_ENCHANT||ItemTypes.isEquippable(i)&&s.itemNumber<25?r.css({"background-color":"transparent"}):r.css({"background-color":"#00000077"})):this.makeEmptyInventory(o)}},setMaxInventoryNumber:function(t){this.maxInventoryNumber=t},makeEmptyInventory:function(t){t%=this.pageItems,$("#inventorybackground"+t).attr("class",""),0<=t&&t<6&&($("#scinventory"+t).css("background-image","none"),$("#scinventory"+t).attr("title",""),$("#scinventory"+t).html("")),$("#inventoryHL"+t).css({"background-color":"transparent"}),$("#inventory"+t).css({"background-image":"none"}),$("#inventory"+t).attr("title",""),$("#inventory"+t).html(""),$("#slot"+t).html("")},makeEmptyInventoryAll:function(){for(var t=0;t<24;t++)this.makeEmptyInventory(t)},toggleInventory:function(t){this.isShowAllInventory=t||!this.isShowAllInventory,$("#allinventorywindow").is(":visible")?this.hideInventory():(this.showInventory(),game.gamepad.dialogOpen())},showInventory:function(){this.pageIndex=0,$(".inventorySellGoldFrame").hide(),game.inventoryMode==InventoryMode.MODE_AUCTION?($("#invActionButton").text("LIST"),$("#invActionButton").show()):game.inventoryMode==InventoryMode.MODE_SELL?($("#invActionButton").text("SELL"),$("#invActionButton").show()):game.inventoryMode==InventoryMode.MODE_ENCHANT?($("#invActionButton").text("ENCHANT"),$("#invActionButton").show()):game.inventoryMode==InventoryMode.MODE_REPAIR?($("#invActionButton").text("REPAIR"),$("#invActionButton").show()):$("#invActionButton").hide(),this.refreshInventory(),$("#allinventorywindow").css("display","block")},hideInventory:function(){$("#allinventorywindow").css("display","none"),game.inventoryMode=0},decInventory:function(t){var e,n,i=this;return null===this.healingCoolTimeCallback&&((e=$("#inventoryHL"+t)).data("cooltime","5"),e.html("5"),this.healingCoolTimeCallback=setInterval(function(){var t=parseInt(e.data("cooltime"));e.data("cooltime",(--t).toString()),e.html(t),t<=0&&(clearInterval(i.healingCoolTimeCallback),e.css({"background-color":"transparent"}),i.healingCoolTimeCallback=null,e.html(""))},1e3),n=this.inventory[t].itemNumber,--n<=0&&(this.inventory[t]=null),!0)},getItemInventorSlotByKind:function(t){for(i=0;i<this.maxInventoryNumber;i++){var e=this.inventory[i];if(e&&t==e.itemKind)return i}},isInventoryFull:function(){for(var t=6;t<this.maxInventoryNumber;++t)if(null==this.inventory[t])return!1;return!0},hasItem:function(t,e){for(i=6;i<this.maxInventoryNumber;i++){var n=this.inventory[i];if(n&&t==n.itemKind&&n.itemNumber>=e)return!0}return!1},getItemCount:function(t){for(i=0;i<this.maxInventoryNumber;i++){var e=this.inventory[i];if(e&&t==e.itemKind)return e.itemNumber}return null},getItemTotalCount:function(t){var e=0;for(i=0;i<this.maxInventoryNumber;i++){var n=this.inventory[i];n&&t==n.itemKind&&(e+=n.itemNumber)}return e},getItemByKind:function(t){for(i=0;i<this.maxInventoryNumber;i++){var e=this.inventory[i];if(e&&t==e.itemKind)return e.slot=i,e}return null},getRealSlot:function(t){return t+this.pageIndex*this.pageItems},getItem:function(t){t+=this.pageIndex*this.pageItems;return!(t<0)&&this.inventory[t]||null}})}),define("bankhandler",[],function(){return Class.extend({init:function(t){this.game=t,this.maxNumber=96,this.banks={}},initBank:function(t){for(var e=0;e<t.length;++e){var n=t[e];n&&(this.banks[n.slot]=n)}},setBank:function(t){for(var e=0;e<t.length;++e){var n=t[e];-1==n.itemKind?this.banks[n.slot]=null:this.banks[n.slot]=n}},setGold:function(t){this.gold=parseInt(t),$(".bankGold").text(this.gold)},isBankFull:function(){if(Object.keys(this.banks).length<this.maxNumber)return!1;for(var t=0;t<this.maxBankNumber;t++)if(!this.banks[t])return!1;return!0}})}),define("socialhandler",[],function(){return Class.extend({init:function(t){var e=this;this.game=t,this.toggle=!1,this.partymembers=[],$("#partyleave").click(function(t){e.game.client.sendPartyLeave(),$("#partynames").html(""),e.show()}),$("#partyclose").click(function(t){e.show()}),this.guildmembers=[],$("#guildleave").click(function(t){e.game.client.sendLeaveGuild(),$("#guildnames").html(""),e.show()}),$("#socialclose").click(function(t){e.show()})},inviteParty:function(e){var n=this;$("#socialconfirmtitle").html("Party "+e.name+"?"),$("#socialconfirm").show(),$("#socialconfirmyes").on("click",function(t){n.game.client.sendPartyInvite(e.name,1),$("#socialconfirm").hide()}),$("#socialconfirmno").off().on("click",function(t){n.game.client.sendPartyInvite(e.name,2),$("#socialconfirm").hide()}),setTimeout(function(){$("#socialconfirm").hide()},1e4)},inviteGuild:function(e,t,n){var i=this;$("#socialconfirmtitle").html("Join Guild "+t+"?"),$("#socialconfirm").show(),$("#socialconfirmyes").on("click",function(t){i.game.client.sendGuildInviteReply(e,!0),$("#socialconfirm").hide()}),$("#socialconfirmno").on("click",function(t){i.game.client.sendGuildInviteReply(e,!1),$("#socialconfirm").hide()}),setTimeout(function(){$("#socialconfirm").hide()},1e4)},show:function(){this.toggle=!this.toggle,this.toggle?(this.displayParty(),this.displayGuild(),$("#socialwindow").css("display","block")):$("#socialwindow").css("display","none")},setPartyMembers:function(t){this.partymembers=t,this.displayParty()},setGuildMembers:function(t){this.guildmembers=t,this.displayGuild()},displayParty:function(){if(this.partymembers.length<=1)$("#partynames").html("No party.");else{$("#partyleave").show();var t="<table><tr><th>Name</th></tr>";t+="<tr><td>"+this.partymembers[0]+" (L)</td></tr>";for(var e=1;e<this.partymembers.length;++e)t+="<tr><td>"+this.partymembers[e]+"</td></tr>";t+="</table>",$("#partynames").html(t)}},displayGuild:function(){if(this.guildmembers.length<=0)$("#guildnames").html("No guild.");else{$("#guildleave").show();var t="<table><tr><th>Name</th></tr>";t+="<tr><td>"+this.guildmembers[0]+" (L)</td></tr>";for(var e=1;e<this.guildmembers.length;++e)t+="<tr><td>"+this.guildmembers[e]+"</td></tr>";t+="</table>",$("#guildnames").html(t)}},isPartyLeader:function(t){return t===this.partymembers[0]},isPartyMember:function(t){return-1<this.partymembers.indexOf(t)},isGuildLeader:function(t){return t===this.guildmembers[0]},isGuildMember:function(t){return-1<this.guildmembers.indexOf(t)}})}),define("leaderboardhandler",[],function(){return Class.extend({init:function(t){this.game=t,this.toggle=!1;var e=this;$("#leaderboardclose").click(function(t){e.show()})},show:function(){this.toggle=!this.toggle,this.toggle?($("#leaderboard").css("display","block"),this.display()):$("#leaderboard").css("display","none")},display:function(){function t(){var n=[];switch($("#lbselect").val()){case"xp":$.each(u,function(t,e){0<e.xp&&n.push({key:t,value:Types.getLevel(e.xp)})});break;case"pk":$.each(u,function(t,e){0<e.pk&&n.push({key:t,value:e.pk})});break;case"pkd":$.each(u,function(t,e){e=0<e.pd?Number(e.pk/e.pd).toFixed(2):0;0<e&&n.push({key:t,value:e})});break;case"pd":$.each(u,function(t,e){0<e.pd&&n.push({key:t,value:e.pd})});break;case"tk":$.each(u,function(t,e){0<e.tk&&n.push({key:t,value:e.tk})});break;case"td":$.each(u,function(t,e){0<e.td&&n.push({key:t,value:e.td})});break;case"tkd":$.each(u,function(t,e){e=0<e.td?Number(e.tk/e.td).toFixed(2):0;0<e&&n.push({key:t,value:e})})}n.sort(function(t,e){return e.value-t.value});for(var t,e=-1,i=n.length,r=0;r<i;++r){var a=n[r];if(d.game.player.name==a.key){e=r;break}}t=0<(s=0<parseInt($("#lbindex").val())?parseInt($("#lbindex").val()):0<=e?Math.ceil(e/p):1)?(s-1)*p:0;for(var s,o=Math.min(n.length,t+p),l="<table><tr><th>Rank</th><th>Name</th><th>Score</th></tr>",r=t;r<o;++r){a=n[r];l+=r==e?'<tr class="lbplayer"><td>'+(r+1)+"</td><td>"+a.key+"</td><td>"+a.value+"</td></tr>":"<tr><td>"+(r+1)+"</td><td>"+a.key+"</td><td>"+a.value+"</td></tr>"}l+="</table>",$("#lbdata").html(l);for(var c,h=Math.ceil(i/p),r=1;r<=h;++r)c+=s==r?'<option value="'+r+'" selected>'+r+"</option>":'<option value="'+r+'">'+r+"</option>";$("#lbindex").empty(),$("#lbindex").html(c)}var u,d=this,p=10;$("#lbselect").change(function(){$("#lbindex").val(""),t()}),$("#lbindex").change(function(){t()})}})});var VirtualJoystick=function(t){this._container=(t=t||{}).container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._stickEl=t.stickElement||this._buildJoystickStick(),this._baseEl=t.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._useCssTransform=void 0!==t.useCssTransform&&t.useCssTransform,this._game=t.game||null,this._deadzone=t.deadzone||20,this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,!(this._touchIdx=null)===this._stationaryBase&&(this._baseEl.style.left=this._baseX-this._baseEl.width/2+"px",this._baseEl.style.top=this._baseY-this._baseEl.height/2+"px"),this._transform=!!this._useCssTransform&&this._getTransformProperty(),this._has3d=this._check3D();function e(t,e){return function(){return t.apply(e,arguments)}}this._$onTouchStart=e(this._onTouchStart,this),this._$onTouchEnd=e(this._onTouchEnd,this),this._$onTouchMove=e(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=e(this._onMouseDown,this),this._$onMouseUp=e(this._onMouseUp,this),this._$onMouseMove=e(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document},!function(t){t.addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},t.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},t.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var i=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}}}(VirtualJoystick.prototype),VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX},VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY},VirtualJoystick.prototype.up=function(){var t,e;return!1!==this._pressed&&(t=this.deltaX(),!((e=this.deltaY())>=-this._deadzone||Math.abs(t)>Math.abs(e)))},VirtualJoystick.prototype.down=function(){var t,e;return!1!==this._pressed&&(t=this.deltaX(),!((e=this.deltaY())<=this._deadzone||Math.abs(t)>Math.abs(e)))},VirtualJoystick.prototype.right=function(){var t,e;return!1!==this._pressed&&(t=this.deltaX(),e=this.deltaY(),!(t<=this._deadzone||Math.abs(e)>Math.abs(t)))},VirtualJoystick.prototype.left=function(){var t,e;return!1!==this._pressed&&(t=this.deltaX(),e=this.deltaY(),!(t>=-this._deadzone||Math.abs(e)>Math.abs(t)))},VirtualJoystick.prototype.isActive=function(){return!!(this.right()||this.left()||this.up()||this.down())},VirtualJoystick.prototype.isWithinJoystick=function(t,e){t=Math.abs(t-this._baseX),e=Math.abs(e-this._baseY);return t<this._stickRadius&&e<this._stickRadius},VirtualJoystick.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",0==this._stationaryBase&&(this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0),Date.now(),this._pressTime},VirtualJoystick.prototype._onDown=function(t,e){var n;this._pressTime=Date.now(),this._pressed=!0,0==this._stationaryBase&&(this._baseX=t,this._baseY=e,this._baseEl.style.display="none",this._move(this._baseEl.style,this._baseX-this._baseEl.width/2,this._baseY-this._baseEl.height/2)),this._stickX=t,this._stickY=e,!0===this._limitStickTravel&&(t=this.deltaX(),e=this.deltaY(),(n=Math.sqrt(t*t+e*e))>this._stickRadius)&&(e=e/n,this._stickX=t/n*this._stickRadius+this._baseX,this._stickY=e*this._stickRadius+this._baseY),this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2),this._baseEl.style.display="none",this._stickEl.style.display="none"},VirtualJoystick.prototype._onMove=function(t,e){var n;!0===this._pressed&&(this._stickX=t,this._stickY=e,!0===this._limitStickTravel&&(t=this.deltaX(),e=this.deltaY(),(n=Math.sqrt(t*t+e*e))>this._stickRadius)&&(e=e/n,this._stickX=t/n*this._stickRadius+this._baseX,this._stickY=e*this._stickRadius+this._baseY),this._baseEl.style.display="block",this._stickEl.style.display="block",this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2))},VirtualJoystick.prototype._onMouseUp=function(t){return this._onUp()},VirtualJoystick.prototype._onMouseDown=function(t){var e=$("#canvas").offset().left,e=Math.round(t.pageX/this.getZoom()-e),t=Math.round(t.pageY/this.getZoom()-$("#canvas").offset().top);if(log.info("deltaX:"+this.deltaX()+",deltaY:"+this.deltaY()),this._game.usejoystick)return this._onDown(e,t)},VirtualJoystick.prototype._onMouseMove=function(t){var e=$("#canvas").offset().left,e=Math.round(t.pageX/this.getZoom()-e),t=Math.round(t.pageY/this.getZoom()-$("#canvas").offset().top);if(this._game.usejoystick)return this._onMove(e,t)},VirtualJoystick.prototype._onTouchStart=function(t){if(null===this._touchIdx){var e=this.dispatchEvent("touchStartValidation",t);if(!1!==e)return this.dispatchEvent("touchStart",t),t.preventDefault(),e=t.changedTouches[0],this._touchIdx=e.identifier,t=$("#canvas").offset().left,t=Math.round(e.pageX/this.getZoom()-t),e=Math.round(e.pageY/this.getZoom()-$("#canvas").offset().top),this._game.usejoystick?this._onDown(t,e):void 0}},VirtualJoystick.prototype._onTouchEnd=function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}},VirtualJoystick.prototype._onTouchMove=function(t){if(null!==this._touchIdx){for(var e,n=t.changedTouches,i=0;i<n.length&&n[i].identifier!==this._touchIdx;i++);if(i!==n.length)return e=n[i],t.preventDefault(),t=$("#canvas").offset().left,t=Math.round(e.pageX/this.getZoom()-t),e=Math.round(e.pageY/this.getZoom()-$("#canvas").offset().top),this._game.usejoystick?this._onMove(t,e):void 0}},VirtualJoystick.prototype.getZoom=function(){return 1/game.renderer.gameZoom},VirtualJoystick.prototype._buildJoystickBase=function(){var t=document.createElement("canvas"),e=(t.style.zIndex=100,t.width=126,t.height=126,t.getContext("2d"));return e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(t.width/2,t.width/2,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(t.width/2,t.width/2,30,0,2*Math.PI,!0),e.stroke(),t},VirtualJoystick.prototype._buildJoystickStick=function(){var t=document.createElement("canvas"),e=(t.style.zIndex=200,t.width=86,t.height=86,t.getContext("2d"));return e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(t.width/2,t.width/2,20,0,2*Math.PI,!0),e.stroke(),t},VirtualJoystick.prototype._move=function(t,e,n){this._transform?this._has3d?t[this._transform]="translate3d("+e+"px,"+n+"px, 0)":t[this._transform]="translate("+e+"px,"+n+"px)":(t.left=e+"px",t.top=n+"px")},VirtualJoystick.prototype._getTransformProperty=function(){for(var t,e=["webkitTransform","MozTransform","msTransform","OTransform","transform"],n=document.createElement("p"),i=0;i<e.length;i++)if(null!=n.style[t=e[i]])return t},VirtualJoystick.prototype._check3D=function(){var t,e=this._getTransformProperty();return e&&window.getComputedStyle?((t=document.createElement("div")).style[e]="translate3d(1px,1px,1px)",document.body.insertBefore(t,null),e=getComputedStyle(t).getPropertyValue({webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"}[e]),document.body.removeChild(t),null!=e&&e.length&&"none"!=e):module.exports=!1},define("lib/virtualjoystick",function(){}),define("settingshandler",["lib/localforage","lib/virtualjoystick"],function(h){return Class.extend({init:function(t,e){this.game=t,this.app=e,this.toggle=!1;var n=this;h.getSetting;$("#settingsclose").click(function(t){n.show()}),this.funcSound=function(t){n.game&&n.game.audioManager&&n.game.audioManager.toggle(t)};function i(t){n.game&&(t?e.hideChatLog():e.showChatLog())}$("#buttonsound").click(function(t){$(this).hasClass("active")?($(this).html("Off"),$(this).removeClass("active"),n.funcSound(!1),h.setItem("sound",0)):($(this).html("On"),$(this).addClass("active"),n.funcSound(!0),h.setItem("sound",1))});function r(t){n.game&&(t?(n.game.usejoystick=!0,log.info("Loading Joystick"),n.game.joystick=new VirtualJoystick({game:n.game,container:document.getElementById("canvas"),mouseSupport:!0})):(n.game.usejoystick=!1,n.game.joystick=null,VirtualJoystick._touchIdx=null))}var a=$("#buttonchat"),s=(h.getItem("chat",function(t,e){e?(a.html("On"),a.addClass("active"),i(!0)):(a.html("Off"),a.removeClass("active"),i(!1))}),a.click(function(t){$(this).hasClass("active")?($(this).html("Off"),$(this).removeClass("active"),i(!1),h.setItem("chat",!1)):($(this).html("On"),$(this).addClass("active"),i(!0),h.setItem("chat",!0))}),$("#buttonjoystick"));h.getItem("joystick",function(t,e){e?(s.html("On"),s.addClass("active"),r(!0)):(s.html("Off"),s.removeClass("active"),r(!1))}),s.click(function(t){$(this).hasClass("active")?($(this).html("Off"),$(this).removeClass("active"),r(!1),h.setItem("joystick",!1)):($(this).html("On"),$(this).addClass("active"),r(!0),h.setItem("joystick",!0))});function o(t){n.game&&(n.game.updateTick=t,"undefined"==typeof requestAnimFrame)&&(clearInterval(n.game.gameTick),n.game.gameTick=setInterval(n.game.tick,t))}$("#buttonoptimized").click(function(t){$(this).hasClass("active")?($(this).html("Off"),$(this).removeClass("active")):($(this).html("On"),$(this).addClass("active")),n.game&&(n.game.optimized=!n.game.optimized),h.setItem("optimized",n.game.optimized)});var t=$("#buttonGPU"),l=(n.game&&n.game.renderer,t.click(function(t){$(this).hasClass("active")?(h.setItem("gpu",32),$(this).html("Low"),$(this).removeClass("active"),o(32)):(h.setItem("gpu",16),$(this).html("High"),$(this).addClass("active"),o(16))}),$("#buttonmenucolor")),c=(h.getItem("menucolor",function(t,e){e&&l.val(e)}),$("#buttonbuttoncolor")),t=(h.getItem("buttoncolor",function(t,e){e&&($("div.frame-new-button").css("background-color",e),c.val(e))}),l.change(function(t){h.setItem("menucolor",this.value)}),$("#buttonbuttoncolor").change(function(t){h.setItem("buttoncolor",this.value),$("div.frame-new-button").css("background-color",this.value)}),this.changeZoom=function(t,e){n.game&&(val=0<(e=e||0)?e:n.zoomLevel||t,n.game.ready=!1,n.game.camera.rescale(val),n.game.renderer.rescaling=!0,n.game.renderer.calcZoom(),n.game.renderer.rescale(),n.game.renderer.resizeCanvases(),n.game.camera.setRealCoords(),n.game.moveEntityThreshold=1+~~(n.game.camera.gridW/2),n.game.ready=!0,n.game.renderer.forceRedraw=!0,n.game.renderer.rescaling=!1,$("#gamezoom option:selected").removeAttr("selected"),$('#gamezoom option[value="'+val+'"]').attr("selected",!0))},$(".cgamezoom"));n.game&&h.getItem("gamezoom",function(t,e){n.zoomLevel=e}),t.change(function(){var t=parseInt($("#gamezoom").val());h.setItem("gamezoom",t)})},apply:function(){var n=this,i=$("#buttonsound");h.getItem("sound",function(t,e){0==e?(i.html("Off"),i.removeClass("active"),n.funcSound(!1)):(i.html("On"),i.addClass("active"),n.funcSound(!0))})},show:function(){this.toggle=!this.toggle,this.toggle?$("#settings").css("display","block"):$("#settings").css("display","none")}})}),define("storehandler",["config"],function(t){return Class.extend({init:function(t,e){this.game=t,this.app=e,this.toggle=!1;$("#shopCloseButton").click(function(t){$("#shopDialog").hide(),this.toggle=!1}),$("#shopDialog").hide()},show:function(){$("#shopDialog").show(),$("#shopUsername").val(game.player.user.username)}})}),define("bools",[],function(){Class.extend({init:function(t){this.game=t,this.showExperimentalCanvas=!0,this.debug=!1}})}),define("inventorystore",["entity/item","data/items"],function(t,e){return Class.extend({init:function(t,e){this.parent=t,this.index=e,this.itemKind=null,this.itemName=null,this.itemNumber=0,this.skillKind=0,this.skillLevel=0,this.experience=0;t="#dialogInventory"+(t=this.index,e=2,(t="00000000"+t).substring(t.length-e));this.background=$(t+"Background"),this.body=$(t+"Body"),this.number=$(t+"Number"),this.rescale()},rescale:function(){this.scale=this.parent.parent.scale,1==this.scale?(this.background.css({position:"absolute",left:15+17*Math.floor(this.index%6)+"px",top:27+23*Math.floor(this.index/6)+"px",width:"16px",height:"16px","background-image":'url("img/1/storedialogsheet.png")',"background-position":"-300px -180px"}),this.body.css({position:"absolute",width:"16px",height:"15px",bottom:"1px","line-height":"16px","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",color:"rgba(255,255,0,1.0)","font-size":"6px","text-align":"center"}),this.number.css({"margin-top":"15px",color:"#fff","font-size":"6px","text-align":"center","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"})):2==this.scale?(this.background.css({position:"absolute",left:30+33*Math.floor(this.index%6)+"px",top:54+45*Math.floor(this.index/6)+"px",width:"32px",height:"32px","background-image":'url("img/2/storedialogsheet.png")',"background-position":"-600px -360px"}),this.body.css({position:"absolute",width:"32px",height:"30px",bottom:"2px","line-height":"32px","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",color:"rgba(255,255,0,1.0)","font-size":"12px","text-align":"center"}),this.number.css({"margin-top":"30px",color:"#fff","font-size":"12px","text-align":"center","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"})):3==this.scale&&(this.background.css({position:"absolute",left:45+50*Math.floor(this.index%6)+"px",top:81+68*Math.floor(this.index/6)+"px",width:"48px",height:"48px","background-image":'url("img/3/storedialogsheet.png")',"background-position":"-900px -540px"}),this.body.css({position:"absolute",width:"48px",height:"45px",bottom:"3px","line-height":"48px","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",color:"rgba(255,255,0,1.0)","font-size":"18px","text-align":"center"}),this.number.css({"margin-top":"45px",color:"#fff","font-size":"18px","text-align":"center","text-shadow":"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"})),this.itemKind&&this.restore()},getIndex:function(){return this.index},getItemKind:function(){return this.itemKind},setItemKind:function(t){null==t?(this.itemKind=null,this.itemName=""):(this.itemKind=t,this.itemName=ItemTypes.KindData[t].name)},getItemName:function(){return this.itemName},getComment:function(){return t.getInfoMsgEx(this.itemKind,this.enchantLevel,this.skillKind,this.skillLevel,this.itemDurability,this.itemDurabilityMax)},assign:function(t,e,n,i,r,a,s){this.setItemKind(t),this.itemNumber=e,this.skillKind=n,this.skillLevel=i,this.itemName=ItemTypes.KindData[t].name,this.spriteName=ItemTypes.KindData[t].sprite,this.itemDurability=r,this.itemDurabilityMax=a,this.itemDurabilityPercent=r/a*100,this.experience=s,this.restore()},clear:function(){this.setItemKind(null),this.itemNumber=0,this.skillKind=0,this.skillLevel=0,this.release()},release:function(){this.body.css("background-image",""),this.body.html(""),this.body.attr("title",""),this.number.html("")},restore:function(){e.jqShowItem(this.body,this,this.number),ItemTypes.isObject(this.itemKind)||ItemTypes.isCraftItem(this.itemKind)||this.body.html(this.itemDurabilityPercent.toFixed()+"%")}})}),define("dialog/storedialog",["./dialog","../tabbook","../tabpage","../entity/item","../inventorystore","../pageNavigator","data/items"],function(t,e,n,i,r,a,s){var o=Class.extend({init:function(t,e,n){this.parent=t,this.id=e,this.index=n,this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),this.item=null,this.rescale(),this.buyButton.text("Buy")},rescale:function(){var t=this.parent.scale,e=this.id;this.body=$(e),1==t?this.body.css({position:"absolute",left:"0px",top:20*this.index+"px"}):2==t?this.body.css({position:"absolute",left:"0px",top:40*this.index+"px"}):3==t&&this.body.css({position:"absolute",left:"0px",top:60*this.index+"px"}),this.item&&this.assign(this.item)},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){var e=this;this.body.css("display",t?"block":"none"),this.buyButton.text("Buy"),t&&this.buyButton.off().on("click",function(t){e.item.buyPrice>game.player.gold[0]?game.showNotification(["SHOP","SHOP_NOGOLD"]):(game&&game.ready&&game.client.sendStoreBuy(e.parent.itemType,parseInt(e.item.kind),1),t.stopPropagation())})},assign:function(t){this.item=t,s.jqShowItem(this.basket,this.item,this.basket);var e=new ItemRoom(0,t.kind,1,900,900,0),e=i.getInfoMsgEx(e),n=ItemTypes.getName(t.kind);this.basket.attr("title",e),ItemTypes.isConsumableItem(t.kind)?(this.basket.text(""),this.extra.text((0<t.buyCount?"x"+t.buyCount:"")+" "+e)):this.extra.text(n),this.price.text(getGoldShortHand(t.buyPrice))}}),n=n.extend({init:function(t,e,n,i,r,a){this._super(t,e+"Page",e+a+"Button"),this.itemType=n,this.racks=[],this.items=i,this.scale=r,this.pageIndex=0,this.parent=t,this.rackRows=5;for(var s=0;s<this.rackRows;s++)this.racks.push(new o(this,e+s,s))},rescale:function(t){this.scale=t;for(var e=0;e<this.rackRows;e++)this.racks[e].rescale()},getPageCount:function(){return this.items?(log.info("this.items.length="+this.items.length),Math.ceil(this.items.length/this.rackRows)):0},getPageIndex:function(){return this.pageIndex},setPageIndex:function(t){this.pageIndex=t,this.open(this.parent.minLevel,this.parent.maxLevel),this.reload()},open:function(t,e){this.items=ItemTypes.Store.getItems(this.itemType,t,e),log.info(JSON.stringify(this.items));for(var n=function(t){return ItemTypes.isConsumableItem(t.kind)},i=(2==this.itemType&&(n=function(t){return ItemTypes.isArmor(t.kind)}),3==this.itemType&&(n=function(t){return ItemTypes.isWeapon(t.kind)}),this.items.length);0<=--i;){var r=this.items[i];n(r)||this.items.splice(this.items.indexOf(r),1)}},reload:function(){this.clear();for(var t=this.pageIndex*this.rackRows;t<Math.min((this.pageIndex+1)*this.rackRows,this.items.length);t++){var e=this.racks[t-this.pageIndex*this.rackRows];e.assign(this.items[t]),e.setVisible(!0)}},clear:function(){for(var t=0;t<this.rackRows;t++)this.racks[t].setVisible(!1)},close:function(){this.clear(),this.setVisible(!1)}}),l=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",1,null,e,0)}}),c=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",2,null,e,1)}}),h=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",3,null,e,2)}}),u=e.extend({init:function(t){this._super("#storeDialogStore"),this.parent=t,this.scale=this.parent.scale,this.pagePotion=new l(this,this.scale),this.pageArmor=new c(this,this.scale),this.pageWeapon=new h(this,this.scale),this.add(this.pagePotion),this.add(this.pageArmor),this.add(this.pageWeapon),this.pageNavigator=new a(t.scale),this.pageNavigator.onChange(function(t){var e=n.getActivePage();e&&game.storeDialog.visible&&(log.info("self.parent.game.storeDialog.visible"),e.setPageIndex(t.getIndex()-1))});var n=this;this.minLevel=1,this.maxLevel=100},rescale:function(){this.scale=this.parent.scale,this.pagePotion.rescale(this.scale),this.pageArmor.rescale(this.scale),this.pageWeapon.rescale(this.scale),this.pageNavigator.rescale(this.scale)},setPageIndex:function(t){game.storeDialog.visible&&(this.pages[t].open(this.minLevel,this.maxLevel),this._super(t),t=this.getActivePage())&&(1<t.getPageCount()?(this.pageNavigator.setCount(t.getPageCount()),this.pageNavigator.setIndex(t.getPageIndex()+1),this.pageNavigator.open(),this.pageNavigator.setVisible(!0)):this.pageNavigator.setVisible(!1),t.reload())},open:function(t,e){this.minLevel=t,this.maxLevel=e,this.setPageIndex(0),this.pagePotion.setPageIndex(0)}});return t.extend({init:function(t){this._super(t,"#storeDialog"),this.setScale(),this.storeFrame=new u(this),this.sellButton=$("#storeDialogStore3Button"),this.sellButton.show(),this.scale=this.setScale()},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale(),this.storeFrame.rescale()},show:function(t,e){$("#storeDialog .frameheading div").text("SHOPS"),$("#storeDialogStore0Button").text("CONSUME"),$("#storeDialogStore0Button").show(),$("#storeDialogStore2Button").show(),this.sellButton.text("SELL"),this.sellButton.show(),this.sellButton.off().on("click",function(t){game.inventoryMode=InventoryMode.MODE_SELL,game.inventoryHandler.showInventory(!0)}),this.rescale(),this.storeFrame.open(t,e),this.addClose(),this._super(),$("#storeDialogStore0Button").trigger("click")},hide:function(){var t=this.storeFrame.getActivePage();t&&t.close(),this._super()}})}),define("dialog/auctiondialog",["./dialog","../tabbook","../tabpage","../entity/item","data/items","../inventorystore","../pageNavigator"],function(t,e,n,i,r,a,s){var o=Class.extend({init:function(t,e,n){this.parent=t,this.id=e,this.index=n,this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),this.item=null,this.rescale(),this.buyButton.text("BUY")},rescale:function(){var t=this.parent.scale,e=this.id;this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),1==t?this.body.css({position:"absolute",left:"0px",top:18*this.index+"px"}):2==t?this.body.css({position:"absolute",left:"0px",top:40*this.index+"px"}):3==t&&this.body.css({position:"absolute",left:"0px",top:60*this.index+"px"}),this.item&&this.assign(this.item)},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){var e=this;this.body.css("display",!0===t?"block":"none"),0==this.parent.parent.pageIndex?this.buyButton.text("DELETE"):this.buyButton.text("BUY"),this.buyButton.off().on("click",function(t){e.item&&game&&game.ready&&game.auctionDialog.visible&&(0==e.parent.parent.pageIndex?game.client.sendAuctionDelete(e.item.index,e.parent.itemType):e.item.buyPrice>game.player.gold[0]?game.showNotification(["SHOP","SHOP_NOGOLD"]):game.client.sendAuctionBuy(e.item.index,e.parent.itemType))})},assign:function(t){this.item=t,log.info(JSON.stringify(t)),r.jqShowItem(this.basket,t.item,this.basket);ItemTypes.KindData[t.kind];var e=i.getInfoMsgEx(t.item);this.extra.text(e),this.price.text(t.buyPrice+"g")},clear:function(){this.basket.css("background-image","none"),this.basket.attr("title",""),this.extra.text(""),this.price.text("")}}),n=n.extend({init:function(t,e,n,i,r,a){this._super(t,e+"Page",e+a+"Button"),this.itemType=n,this.racks=[],this.items=i,this.scale=r,this.rackSize=5;for(var s=0;s<this.rackSize;s++)this.racks.push(new o(this,e+s,s))},rescale:function(t){this.scale=t;for(var e=0;e<this.rackSize;e++)this.racks[e].rescale()},getPageCount:function(){return this.items?Math.ceil(this.items.length/this.rackSize):0},getPageIndex:function(){return this.pageIndex},setPageIndex:function(t){log.info("setPageIndex: "+t),this.pageIndex=t,this.reload()},sendOpen:function(){game.client.sendAuctionOpen(this.itemType)},reload:function(){for(var t of this.racks)t.clear();if(this.close(),this.items&&0!=this.items.length){log.info("reload - this.pageIndex: "+this.pageIndex);for(var e=this.pageIndex*this.rackSize;e<Math.min((this.pageIndex+1)*this.rackSize,this.items.length);e++)(t=this.racks[e-this.pageIndex*this.rackSize]).assign(this.items[e]),t.setVisible(!0);this.parent.updatePageNav()}},close:function(){for(var t=0;t<this.rackSize;t++)this.racks[t].setVisible(!1)},setItems:function(t){if(this.items=[],t||this.close(),t)for(var e in t){e=(i=t[e]).item.itemKind;this.items.push({index:i.index,name:ItemTypes.KindData[e].name,kind:e,itemKind:e,player:i.player,buyPrice:i.buy,item:i.item,rank:ItemTypes.KindData[e].modifier})}if(0<this.items.length&&(this.items.sort(function(t,e){return t.rank-e.rank||t.kind-e.kind||t.itemCount-e.itemCount||t.buyPrice-e.buyPrice}),0<this.itemType))for(var n=this.items.length-1;0<n;--n){var i=this.items[n],r=this.items[n-1];i.kind==r.kind&&i.itemCount==r.itemCount&&i.itemSkillKind==r.itemSkillKind&&i.itemSkillLevel==r.itemSkillLevel&&this.items.splice(n,1)}}}),l=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",0,[],e,0)}}),c=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",1,[],e,1)}}),h=n.extend({init:function(t,e){this._super(t,"#storeDialogStore",2,[],e,2)}}),u=e.extend({init:function(t){this._super("#storeDialogStore"),this.parent=t,this.scale=this.parent.scale,this.pageMyAuctions=new l(t,this.scale),this.pageArmor=new c(t,this.scale),this.pageWeapon=new h(t,this.scale),this.add(this.pageMyAuctions),this.add(this.pageArmor),this.add(this.pageWeapon),this.pageNavigator=new s(t.scale);var n=this;this.pageNavigator.onChange(function(t){var e=n.getActivePage();e&&game.auctionDialog.visible&&(log.info("activePage.setPageIndex("+(t.getIndex()-1)+");"),e.setPageIndex(t.getIndex()-1))})},rescale:function(){this.scale=this.parent.scale,this.pageArmor.rescale(this.scale),this.pageWeapon.rescale(this.scale),this.pageMyAuctions.rescale(this.scale),this.pageNavigator.rescale(this.scale)},setPageIndex:function(t){t=t||0,game.auctionDialog.visible&&(this.pages[t].sendOpen(),this._super(t))},updatePageNav:function(t){var e=this.getActivePage();e&&(1<e.getPageCount()?(this.pageNavigator.setCount(e.getPageCount()),this.pageNavigator.setIndex(e.getPageIndex()+1),this.pageNavigator.setVisible(!0)):this.pageNavigator.setVisible(!1))},open:function(t){this.setPageIndex(t),this.pageNavigator.setVisible(!1)}});return t.extend({init:function(t){this._super(t,"#storeDialog"),this.setScale(),this.storeFrame=new u(this),this.modal=$("#storeDialogModal"),this.scale=this.setScale(),this.addClose()},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale(),this.storeFrame.rescale()},show:function(){this.rescale(),$("#storeDialog .frameheading div").text("AUCTION"),$("#storeDialogStore0Button").text("LIST"),$("#storeDialogStore0Button").show(),$("#storeDialogStore2Button").show(),$("#storeDialogStore3Button").text("SELL"),$("#storeDialogStore3Button").show(),$("#storeDialogStore3Button").off().on("click",function(t){game.inventoryMode=InventoryMode.MODE_AUCTION,game.inventoryHandler.toggleInventory()}),this.storeFrame.open(0),this._super(),$("#storeDialogStore0Button").trigger("click")},hide:function(){var t=this.storeFrame.getActivePage();t&&(t.close(),t.setVisible(!1)),this._super()}})}),define("dialog/bankdialog",["./dialog","../tabbook","../tabpage","../entity/item","data/items","data/itemlootdata","../inventorystore"],function(t,e,n,i,r,a,s){var o=Class.extend({init:function(t,e){this.parent=t,this.index=e,this.item=null;function i(t){t+=r.parent.page*r.parent.pageItems,null===DragBank?(DragBank={type:0}).slot=t:(game.client.sendItemSlot([2,1,DragBank.slot,1,1,t]),DragBank=null,r.parent.deselectItem())}var t="#bankDialogBank"+(t=this.index,e=2,(t="00000000"+t).substring(t.length-e)),r=(this.background=$(t+"Background"),this.body=$(t+"Body"),this.rescale(),this);this.background.data("itemSlot",this.index),this.body.data("itemSlot",this.index),this.body.attr("draggable",!0),this.body.draggable=!0;this.background.off().on("click tap",function(t){var e,n=$(this).data("itemSlot");null==r.parent.getItem(n)?(game.gamepad.isActive()&&i(n),r.parent.deselectItem()):(e=r.parent.selectedItem%24==n,r.parent.selectBankItem(this),game.renderer.isDesktop&&!e&&!game.gamepad.isActive()||i(n))}),this.body.on("dragstart touchstart",function(t){-1==r.parent.selectedItem&&r.parent.selectBankItem(this),DragBank||i($(this).data("itemSlot"))}),this.body.on("dragover touchover",function(t){t.preventDefault()}),this.background.on("drop touchend",function(t){i($(this).data("itemSlot"))})},rescale:function(){this.scale=game.renderer.guiScale,1==this.scale?this.background.css({position:"absolute",left:0+18*Math.floor(this.index%6)+"px",top:0+18*Math.floor(this.index/6)+"px"}):2==this.scale?this.background.css({position:"absolute",left:0+50*Math.floor(this.index%6)+"px",top:0+50*Math.floor(this.index/6)+"px"}):3==this.scale&&this.background.css({position:"absolute",left:0+60*Math.floor(this.index%6)+"px",top:0+60*Math.floor(this.index/6)+"px"}),this.item&&this.restore()},getIndex:function(){return this.index},getItemKind:function(){return this.item.itemKind},setItemName:function(){var t=this.item.itemKind;ItemTypes.isLootItem(t)?this.itemName=a[t-1e3].name:this.itemName=ItemTypes.KindData[t].name},getItemName:function(){return this.itemName},getComment:function(){return i.getInfoMsgEx(this.item)},assign:function(t){var e=(this.item=t).itemKind;this.setItemName(e),this.itemDurabilityPercent=t.itemDurability/t.itemDurabilityMax*100,this.body.data("itemNumber",this.item.itemNumber),this.background.data("itemNumber",this.item.itemNumber),this.restore()},clear:function(){this.item=null,this.release()},release:function(){this.body.css("background-image",""),this.body.html(""),this.body.attr("title","")},restore:function(){itemKind=this.item.itemKind,game.renderer.getIconScaleFactor();r.jqShowItem(this.body,this.item,this.body)}}),l=Class.extend({init:function(t){this.parent=t,this.bankslots=[],this.page=0,this.pageItems=24;var n=this;this.selectBankItem=function(t){var e;game&&game.ready&&(e=$(t).data("itemSlot"),t=$(t).data("itemNumber"),log.info("selectInventory - click, slot:"+e),e=e+n.page*n.pageItems,game.bankHandler.banks[e])&&(n.selectedItem!=e?(n.deselectItem(),n.selectItem(e,!0)):(n.select(e,t),n.deselectItem()))};for(var e=0;e<this.pageItems;e++)this.bankslots.push(new o(this,e));this.goldNumber=$(".bankGold"),this.selectedBank=null,this.selectedItem=null,$("#bankDialogBankGoldBody").click(function(t){game.app.showDropDialog(-2)})},rescale:function(t){for(var e=0;e<this.bankslots.length;e++)this.bankslots[e].rescale()},getItem:function(t){t+=this.page*this.pageItems;return game.bankHandler.banks[t]},getInventory:function(t){return this.bankslots[t]},open:function(t){this.page=t,game.bankHandler.pageIndex=t;for(var e=0;e<24;e++)this.bankslots[e].release();if(game&&game.ready)for(var n=0;n<this.pageItems;n++){var i=game.bankHandler.banks[this.pageItems*t+n];i&&this.bankslots[n].assign(i)}},select:function(t,e=1){game.inventoryHandler.isInventoryFull()||(game.client.sendItemSlot([2,1,t,e,0,-1]),this.bankslots[t%24].release())},deselectItem:function(){this.selectItem(this.selectedItem,!1)},selectItem:function(t,e){var n;(pageslot=t%this.pageItems)<0||(n=this.bankslots[pageslot].background,e?(e=game.renderer.getUiScaleFactor(),this.selectedItem=t,n.css({border:e+"px solid white"})):(this.selectedItem=-1,n.css({border:"none"})))}});return t.extend({init:function(e){this._super(e,"#bankDialog"),this.scale=0,this.setScale();var n=this;this.bankFrame=new l(this),this.storeButton=$("#bankDialogStoreButton"),this.storeButton.off().on("click",function(t){e.inventoryMode=InventoryMode.MODE_BANK,e.inventoryHandler.showInventory()}),$("#bankGoldFrame").click(function(t){n.game.app.showDropDialog(-2)}),$("#bankDialog0Button").click(function(t){n.bankFrame.open(0)}),$("#bankDialog1Button").click(function(t){n.bankFrame.open(1)}),$("#bankDialog2Button").click(function(t){n.bankFrame.open(2)}),$("#bankDialog3Button").click(function(t){n.bankFrame.open(3)}),this.closeButton=$("#bankDialogCloseButton"),this.closeButton.click(function(t){n.hide()})},setScale:function(){game.renderer.getUiScaleFactor()},rescale:function(){this.setScale(),this.bankFrame.rescale(this.scale)},show:function(){this.rescale(),this.bankFrame.open(this.bankFrame.page),this._super()},hide:function(){this._super()}})}),define("gamepad",[],function(){var h=0,u=1,d=2,p=3,f=4,a=$("#allinventorywindow"),s=$("#menucontainer"),o=$("#attackContainer"),l=$("#skillsDialog"),c=$("#statsDialog"),n=$("#playerPopupMenuContainer"),t=$("#partyconfirm"),m=$("#questlog"),g=$("#socialwindow"),y=$("#settings"),v=$("#leaderboard"),b=$("#dropDialog"),e=$("#inputDialog"),k=$("#dialogModalConfirm"),w=$("#dialogModalNotify"),x=$("#diedwindow"),S=$("#auctionSellDialog"),T=$("#achievementlog"),_=$("#shopDialog"),i={allinventorywindow:"#equipBackground0",menucontainer:"#inventorybutton",statsDialog:"#charAddAttack",skillsDialog:"#characterSkill0Body",playerPopupMenuContainer:"#playerPopupMenuPartyInvite",questlog:"#questCloseButton",socialwindow:"#socialclose",settings:"#settingchat",leaderboard:"#lbselect",dropDialog:"#dropAccept",dialogModalConfirm:"#dialogModalConfirmButton1",dialogModalNotify:"#dialogModalNotifyButton1",combatContainer:"#scinventory0",auctionSellDialog:"#auctionSellAccept",bankDialog:"#bankDialogBank00Background",appearanceDialog:"#changeLookArmorPrev",shopDialog:"#shopSKU",storeDialog:"#storeDialogStore0Button",socialconfirm:"#socialconfirmyes",diedwindow:"#respawn"};return Class.extend({init:function(i){function t(t){var t=((e=r.bankPages.length)+r.bankPageIndex+t)%e,e=(r.bankPageIndex=t,$(r.bankPages[t]));r.setSelectedItem(e),e.trigger("click")}function e(t){var t=((e=r.storeDialogSide.length)+r.shopPageIndex+t)%e,e=(r.shopPageIndex=t,$(r.storeDialogSide[t]));r.setSelectedItem(e),e.trigger("click")}var r=this;r.shopPageIndex=0,r.storeDialogSide=["#storeDialogStore0Button","#storeDialogStore1Button","#storeDialogStore2Button","#storeDialogStore3Button"],r.storeDialogBuyButton="#storeDialogStore{0}BuyButton",r.bankPages=["#bankDialog0Button","#bankDialog1Button","#bankDialog2Button","#bankDialog3Button","#bankDialogStoreButton"],r.bankPageIndex=0,r.playerInventory="#inventorybackground{0}",r.playerInventoryButtons=["#inventoryGearItems","inventoryGear2Items"],r.playerBank="#bankDialogBank{0}Background",r.playerEquipment=["#equipBackground0","#equipBackground1","#equipBackground2","#equipBackground3","#equipBackground4"],r.playerShortcut=["#shortcut0","#shortcut1","#shortcut2","#shortcut3","#shortcut4","#shortcut5","#shortcut6","#shortcut7"],r.playerDialogSkill="#characterSkill{0}Body",r.playerShortcutSkill="#skill{0}Body",r.playerDialogStat=["#charAddAttack","#charAddDefense","#charAddHealth","#charAddEnergy","#charAddLuck"],r.playerSettings=["#buttonchat","#buttonsound","#buttonjoystick","#buttonmenucolor","#buttonbuttoncolor","#gamezoom"],r.leaderboardselect=["#lbselect","#lbindex"],r.mainButtonsActive=!1,r.mainButtons=["#charactermenu","#chatbutton","#shortcutbutton"],r.menuButtons=["#inventorybutton","#characterbutton","#skillbutton","#helpbutton","#achievementbutton","#socialbutton","#warpbutton","#settingsbutton","#storebutton"],r.navMouse=!1,r.navigate=h,r.navNone=!1,r.movePad=!1,r.shortcutAssign=0,r.selectedItem=null,r.resetNavInterval=function(t){clearInterval(r.navInterval),r.navInterval=setInterval(function(){r.funcNavigation()},t)},r.resetNavInterval(180),r.funcNavigation=function(){var t,e,n;r.navNone||r.isActive()&&(t=r.navigate,!a.is(":visible")&&(i.storeDialog.visible||i.auctionDialog.visible||i.appearanceDialog.visible)?(t==p&&(r.joystickY=(r.joystickY-1).clamp(0,5),0==r.joystickY?(n=r.storeDialogSide[r.joystickX],this.setSelectedItem($(n)),3==r.joystickX&&(r.joystickX=0,r.joystickY=0),$(n).trigger("click")):(n=r.storeDialogBuyButton.format(r.joystickY-1),this.setSelectedItem($(n)))),t==f&&(r.joystickY=(r.joystickY+1).clamp(0,5),1<=r.joystickY)&&(n=r.storeDialogBuyButton.format(r.joystickY-1),this.setSelectedItem($(n))),t==u&&(0==r.joystickY?(r.joystickX=(r.joystickX-1).clamp(0,3),n=r.storeDialogSide[r.joystickX],this.setSelectedItem($(n)),$(n)):$("#storePageNavPrev")).trigger("click"),t==d&&(0==r.joystickY?(r.joystickX=(r.joystickX+1).clamp(0,3),n=r.storeDialogSide[r.joystickX],3==r.joystickX&&(r.joystickX=0,r.joystickY=0),this.setSelectedItem($(n)),$(n)):$("#storePageNavNext")).trigger("click")):!a.is(":visible")&&i.bankDialog.visible?(e=0,t==p&&(r.joystickY=(r.joystickY-1).clamp(0,4),4==r.joystickY)&&(e=~~(r.joystickX/3)),t==f&&(r.joystickY=(r.joystickY+1).clamp(0,4),4==r.joystickY)&&(e=~~(r.joystickX/3)),t==u&&(r.joystickX=(r.joystickX-1).clamp(0,5),4==r.joystickY)&&(e=r.joystickX%2),t==d&&(r.joystickX=(r.joystickX+1).clamp(0,5),4==r.joystickY)&&(e=r.joystickX%2),t!=h&&(4==r.joystickY?this.setSelectedItem($(["#bankGoldFrame","#bankDialogStoreButton"][e])):(n=r.playerBank.format(padding(6*r.joystickY+r.joystickX,2)),this.setSelectedItem($(n))))):a.is(":visible")?(t==p&&(0<r.joystickX&&r.joystickY<4&&(r.joystickY=((r.joystickY+3)%4).clamp(0,3),n=r.playerInventory.format(6*r.joystickY+r.joystickX-1),this.setSelectedItem($(n))),0==r.joystickX)&&(r.joystickY=((r.joystickY+4)%5).clamp(0,4),n=r.playerEquipment[r.joystickY],this.setSelectedItem($(n))),t==f&&(0<r.joystickX&&r.joystickY<4&&(r.joystickY=((r.joystickY+5)%4).clamp(0,3),n=r.playerInventory.format(6*r.joystickY+r.joystickX-1),this.setSelectedItem($(n))),0==r.joystickX)&&(r.joystickY=((r.joystickY+6)%5).clamp(0,4),n=r.playerEquipment[r.joystickY],this.setSelectedItem($(n))),t==u&&(r.joystickX=((r.joystickX+6)%7).clamp(0,6),4==r.joystickY&&(r.joystickY=3),0<r.joystickX&&r.joystickY<4&&(n=r.playerInventory.format(6*r.joystickY+r.joystickX-1),this.setSelectedItem($(n))),0==r.joystickX)&&(n=r.playerEquipment[r.joystickY],this.setSelectedItem($(n))),t==d&&(r.joystickX=((r.joystickX+8)%7).clamp(0,6),4==r.joystickY&&(r.joystickY=3),0<r.joystickX&&r.joystickY<4&&(n=r.playerInventory.format(6*r.joystickY+r.joystickX-1),this.setSelectedItem($(n))),0==r.joystickX)&&(n=r.playerEquipment[r.joystickY],this.setSelectedItem($(n)))):s.is(":visible")?(e=r.menuButtons.length,t==p&&(r.joystickY=((r.joystickY-1+e)%e).clamp(0,9),n=r.menuButtons[r.joystickY],this.setSelectedItem($(n))),t==f&&(r.joystickY=((r.joystickY+1+e)%e).clamp(0,9),n=r.menuButtons[r.joystickY],this.setSelectedItem($(n)))):r.mainButtonsActive?(e=r.mainButtons.length,t==p?r.joystickX=(e+r.joystickX-2)%e:t==f?r.joystickX=(e+r.joystickX+2)%e:t==u&&0<r.joystickX?r.joystickX=(e+r.joystickX-1)%e:t==d&&0<r.joystickX&&(r.joystickX=(e+r.joystickX+1)%e),t!=h&&(n=r.mainButtons[r.joystickX],this.setSelectedItem($(n)))):r.shortcutActive&&o.is(":visible")?(t==p&&(r.joystickY=(r.joystickY+7)%8,n=r.playerShortcut[2*r.joystickY+r.joystickX],this.setSelectedItem($(n))),t==f&&(r.joystickY=(r.joystickY+1)%8,n=r.playerShortcut[2*r.joystickY+r.joystickX],this.setSelectedItem($(n))),t==u&&(r.joystickX=r.joystickX+1,n=r.playerShortcut[2*r.joystickY+r.joystickX],this.setSelectedItem($(n))),t==d&&(r.joystickX=r.joystickX+1,n=r.playerShortcut[2*r.joystickY+r.joystickX],this.setSelectedItem($(n)))):l.is(":visible")?(t==u&&(r.joystickX=(r.joystickX-1).clamp(0,5),n=r.playerDialogSkill.format(6*r.joystickY+r.joystickX),this.setSelectedItem($(n))),t==d&&(r.joystickX=(r.joystickX+1).clamp(0,5),n=r.playerDialogSkill.format(6*r.joystickY+r.joystickX),this.setSelectedItem($(n)))):c.is(":visible")?(t==p&&(r.joystickY=(r.joystickY-1).clamp(0,4),n=r.playerDialogStat[r.joystickY],this.setSelectedItem($(n))),t==f&&(r.joystickY=(r.joystickY+1).clamp(0,4),n=r.playerDialogStat[r.joystickY],this.setSelectedItem($(n)))):y.is(":visible")?(t==p&&(r.joystickY=(r.joystickY-1).clamp(0,5),n=r.playerSettings[r.joystickY],this.setSelectedItem($(n))),t==f&&(r.joystickY=(r.joystickY+1).clamp(0,5),n=r.playerSettings[r.joystickY],this.setSelectedItem($(n)))):v.is(":visible")&&(t==u&&(n=r.leaderboardselect[0],this.setSelectedItem($(n))),t==d)&&(n=r.leaderboardselect[1],this.setSelectedItem($(n))))},r.setSelectedItem=function(t){var e="2px solid rgb(0, 0, 255)";r.selectedItem&&r.selectedItem.css("border")==e&&r.selectedItem.css("border",r.selectedItemBorder),t&&(r.selectedItemBorder=t.css("border"),t.css({border:e}),r.selectedItem=t)},r.pxgamepad=new PxGamepad,r.pxgamepad.start(),r.joystickSide=0,r.joystickIndex=0,r.joystickX=0,r.joystickY=0,r.dpadActive=!1,r.pxgamepad.buttonOn("select",function(){log.info("buttonOn = select"),r.mainButtonsActive?(r.mainButtonsActive=!1,r.setSelectedItem(null)):(r.mainButtonsActive=!0,r.setSelectedItem($("#charactermenu")))}),r.pressShortcut=function(t){o.show(),r.setSelectedItem($(r.playerShortcut[t])),r.selectedItem.trigger("click")},r.pxgamepad.buttonOn("x",function(){r.leftTopPressed?r.pressShortcut(2):r.rightTopPressed?r.pressShortcut(6):(log.info("buttonOn = x"),i.playerTargetClosestEntity(1))}),r.pxgamepad.buttonOff("x",function(){log.info("buttonOff = x")}),r.pxgamepad.buttonOn("y",function(){r.leftTopPressed?r.pressShortcut(3):r.rightTopPressed?r.pressShortcut(7):(log.info("buttonOn = y"),r.navMouse=!r.navMouse)}),r.pxgamepad.buttonOff("y",function(){log.info("buttonOff = y")}),r.pxgamepad.buttonOn("a",function(){if(log.info("buttonOn = a"),r.leftTopPressed)r.pressShortcut(0);else if(r.rightTopPressed)r.pressShortcut(4);else if(r.isDialogOpen())if(S.is(":visible"))$("#auctionSellAccept").trigger("click");else if(x.is(":visible"))$("#respawn").trigger("click");else if(k.is(":visible"))$("#dialogModalConfirmButton1").trigger("click");else if(w.is(":visible"))$("#dialogModalNotifyButton1").trigger("click");else{if($("#socialconfirm").is(":visible"))$("#socialconfirmyes").trigger("click");else if(n.is(":visible"))$(r.playerMode).trigger("click");else{if(b.is(":visible"))return void $("#dropAccept").trigger("click");if(l.is(":visible"))i.selectedSkill?($(r.playerShortcut.format(r.shortcutAssign)).trigger("click"),r.shortcutAssign=(r.shortcutAssign+1)%8):r.selectedItem&&r.selectedItem.trigger("click");else if(c.is(":visible"))r.selectedItem&&r.selectedItem.trigger("click");else{if(a.is(":visible"))return-1!=i.inventoryHandler.selectedItem&&r.lastSelectedItem==r.selectedItem?void $("#invActionButton").trigger("click"):(r.selectedItem&&r.selectedItem.trigger("click"),void(r.lastSelectedItem=r.selectedItem));if(s.is(":visible"))r.selectedItem&&r.selectedItem.trigger("click");else if(!a.is(":visible")&&(i.storeDialog.visible||i.auctionDialog.visible||i.appearanceDialog.visible))r.selectedItem&&r.selectedItem.trigger("click");else{if(!a.is(":visible")&&i.bankDialog.visible)return void(r.selectedItem&&(r.selectedItem.trigger("click"),r.setSelectedItem(r.selectedItem)));var t;y.is(":visible")?r.selectedItem&&("gamezoom"==r.selectedItem.attr("id")?(t=($(".cgamezoom option:selected").index()+1)%$(".cgamezoom option").length,$(".cgamezoom option:selected").removeAttr("selected"),$(".cgamezoom option:eq("+t+")").prop("selected",!0),$(".cgamezoom").trigger("chosen:updated"),$(".cgamezoom").trigger("change")):r.selectedItem.trigger("click")):v.is(":visible")?r.selectedItem&&("lbselect"==r.selectedItem.attr("id")&&(t=($("#lbselect option:selected").index()+1)%$("#lbselect option").length,$("#lbselect option:selected").removeAttr("selected"),$("#lbselect option:eq("+t+")").prop("selected",!0),$("#lbselect").trigger("chosen:updated"),$("#lbselect").trigger("change")),"lbindex"==r.selectedItem.attr("id"))&&(t=($("#lbindex option:selected").index()+1)%$("#lbindex option").length,$("#lbindex option:selected").removeAttr("selected"),$("#lbindex option:eq("+t+")").prop("selected",!0),$("#lbindex").trigger("chosen:updated"),$("#lbindex").trigger("change")):r.mainButtonsActive&&(log.info("self.mainButtonsActive"),r.selectedItem&&(r.selectedItem.trigger("click"),r.dialogOpen()),r.mainButtonsActive=!1)}}}r.joystickX=0,r.joystickY=0}else r.navMouse?i.click():i.makePlayerInteractNextTo()}),r.pxgamepad.buttonOn("b",function(){if(log.info("buttonOn = b"),r.leftTopPressed)r.pressShortcut(1);else if(r.rightTopPressed)r.pressShortcut(5);else if(r.isDialogOpen())if(k.is(":visible"))$("#dialogModalConfirmButton2").trigger("click");else if(w.is(":visible"))$("#dialogModalNotifyButton1").trigger("click");else if(x.is(":visible"))$("#respawn").trigger("click");else if(S.is(":visible"))$("#auctionSellCancel").trigger("click");else{if($("#socialconfirm").is(":visible"))$("#socialconfirmno").trigger("click"),$("#socialconfirm").css("display","none");else if(n.is(":visible"))i.playerPopupMenu.close();else if($("#chatbox").is(":visible"))$("#chatbox").hide();else if(l.is(":visible"))$("#skillsCloseButton").trigger("click");else if(c.is(":visible"))$("#statsCloseButton").trigger("click");else if(a.is(":visible")){var t=i.inventoryHandler;if(0<=t.selectedItem)return void t.deselectItem();$("#inventoryCloseButton").trigger("click")}else m.is(":visible")?$("#questCloseButton").trigger("click"):T.is(":visible")?$("#achievementCloseButton").trigger("click"):g.is(":visible")?$("#socialclose").trigger("click"):y.is(":visible")?$("#settingsclose").trigger("click"):v.is(":visible")?$("#leaderboardclose").trigger("click"):_.is(":visible")?$("#shopCloseButton").trigger("click"):s.is(":visible")?(s.trigger("click"),r.mainButtonsActive=!1):b.is(":visible")?$("#dropCancel").trigger("click"):i.storeDialog.visible||i.auctionDialog.visible||i.appearanceDialog.visible?$("#storeDialogCloseButton").trigger("click"):i.bankDialog.visible?$("#bankDialogCloseButton").trigger("click"):r.shortcutActive?$(r.playerShortcut[r.joystickIndex]).trigger("click"):r.mainButtonsActive&&(r.mainButtonsActive=!1,r.setSelectedItem(null));r.isDialogOpen()||(r.joystickIndex=0,r.setSelectedItem(null),r.joystickX=-1,r.joystickY=-1)}}),r.pxgamepad.buttonOff("b",function(){log.info("buttonOff = b")});r.pxgamepad.buttonOn("leftTop",function(){a.is(":visible")?$("#inventoryGearItems").click():$("#bankDialog").is(":visible")?t(-1):$("#storeDialogStore").is(":visible")?e(1):(o.show(),r.leftTopPressed=!0)}),r.pxgamepad.buttonOff("leftTop",function(){r.leftTopPressed=!1}),r.pxgamepad.buttonOn("rightTop",function(){a.is(":visible")?$("#inventoryGear2Items").click():$("#bankDialog").is(":visible")?t(1):$("#storeDialogStore").is(":visible")?e(1):(o.show(),r.rightTopPressed=!0)}),r.pxgamepad.buttonOff("rightTop",function(){r.rightTopPressed=!1}),r.joystickSide=0,r.joystickIndex=0,r.pxgamepad.buttonOn("dpadUp",function(){r.dpadY=-1}),r.pxgamepad.buttonOn("dpadDown",function(){r.dpadY=1}),r.pxgamepad.buttonOn("dpadLeft",function(){r.dpadX=-1}),r.pxgamepad.buttonOn("dpadRight",function(){r.dpadX=1}),r.pxgamepad.buttonOff("dpadUp",function(){r.dpadY=0}),r.pxgamepad.buttonOff("dpadDown",function(){r.dpadY=0}),r.pxgamepad.buttonOff("dpadLeft",function(){r.dpadX=0}),r.pxgamepad.buttonOff("dpadRight",function(){r.dpadX=0})},interval:function(){var t,e,n,i,r,a,s,o,l,c=this;c.navigate=h,c.pxgamepad.getGamepad()&&(t=game.player)&&game.started&&game.ready&&(c.pxgamepad.update(),r=c.dpadX||c.pxgamepad.leftStick.x,a=c.dpadY||c.pxgamepad.leftStick.y,i=Math.abs(r),n=Math.abs(a),.1<(e=Math.max(i,n))&&.25<e&&(c.navigate=n<i?0<r?d:u:0<a?f:p),e=game.mouse,n=game.renderer.renderer.screen.width,i=game.renderer.renderer.screen.height,r=(game.tilesize>>3)*game.renderer.scale,a=c.navMouse?c.dpadX||c.pxgamepad.leftStick.x:c.pxgamepad.rightStick.x,s=c.navMouse?c.dpadY||c.pxgamepad.leftStick.y:c.pxgamepad.rightStick.y,l=Math.abs(a),o=Math.abs(s),.1<Math.max(l,o)&&(e.x+=a*r,e.y+=s*r),game.mouse.x=~~e.x.clamp(0,n-1),game.mouse.y=~~e.y.clamp(0,i-1),l=c.navigate,c.isDialogOpen()||c.navMouse||(game.player.keyMove||(l==u&&(t.move(3,!0),this.movePad=3),l==d&&(t.move(4,!0),this.movePad=4),l==p&&(t.move(1,!0),this.movePad=1),l==f&&(t.move(2,!0),this.movePad=2)),l==h&&t.keyMove&0<this.movePad&&(t.move(this.movePad,!1),this.movePad=0)),game.movecursor(),game.updateCursorLogic(),c.isDialogOpen()||c.funcNavigation())},isDialogOpen:function(){return game.storeDialog.visible||game.bankDialog.visible||game.auctionDialog.visible||game.appearanceDialog.visible||s.is(":visible")||a.is(":visible")||l.is(":visible")||c.is(":visible")||n.is(":visible")||t.is(":visible")||m.is(":visible")||T.is(":visible")||g.is(":visible")||y.is(":visible")||v.is(":visible")||b.is(":visible")||e.is(":visible")||k.is(":visible")||w.is(":visible")||S.is(":visible")||x.is(":visible")||_.is(":visible")||this.mainButtonsActive},isActive:function(){return null!==this.pxgamepad.getGamepad()},navActive:function(){return null===this.pxgamepad.getGamepad()||!(0===this.navigate)},dialogNavigate:function(t){this.joystickSide=0,this.joystickIndex=0,this.joystickX=0,this.joystickY=0},dialogOpen:function(){for(var t in i)if($("#"+t).is(":visible")&&null==self.selectedItem){i[t]?this.setSelectedItem($(i[t])):this.setSelectedItem(null);break}this.dialogNavigate()},dialogClose:function(){}})}),define("clientcallbacks",["infomanager","hoveringinfo","bubble","renderer","map","mapcontainer","animation","sprite","tile","gameclient","clientcallbacks","audio","updater","pathfinder","entity/entity","entity/entitymoving","entity/item","data/items","data/itemlootdata","data/appearancedata","dialog/appearancedialog","entity/mob","entity/npcstatic","entity/npcmove","data/npcdata","entity/player","entity/character","entity/chest","entity/block","data/mobdata","data/mobspeech","exceptions","config","chathandler","playerpopupmenu","classpopupmenu","quest","data/questdata","questhandler","achievement","equipmenthandler","inventoryhandler","bankhandler","socialhandler","leaderboardhandler","settingshandler","storehandler","bools","skillhandler","data/skilldata","dialog/storedialog","dialog/auctiondialog","dialog/bankdialog","data/langdata","gamepad"],function(t,o,e,n,i,r,a,s,l,c,h,u,d,p,f,m,g,y,v,b,k,w,x,S,T,_,I,E,C,A,M,D,L,B,R,H,N,F,q,O,z,K,U,G,W,Y,X,V,Q,P,Z,J,tt,et,nt){return Class.extend({init:function(c){(this.client=c).onPlayerTeleportMap(function(t){var e=parseInt(t[0]),n=parseInt(t[2]),i=parseInt(t[3]),t=game.mapStatus=parseInt(t[1]);log.info("ON PLAYER TELEPORT MAP:"+e+"status: "+t+",x:"+n+",y:"+i),-1==t?(game.mapIndex=0,game.mapStatus=2,game.player.forceStop(),game.player.clearTarget()):(1==t&&(log.info("spawnMap"),game.player.isMoving()&&game.player.forceStop(),game.mapIndex=e,game.player.mapIndex=e,game.player.clearTarget(),game.player.freeze=!0,game.renderer.clearEntities(),delete game.entities,game.entities={},delete game.camera.entities,game.camera.entities={},delete game.camera.outEntities,game.camera.outEntities={},delete game.items,game.items={},log.info("Map loaded."),c.sendTeleportMap([e,1,n,i]),game.renderer.blankFrame=!0),2==t&&(log.info("spawnMap - Loaded"),game.initPlayer(),game.player.setPositionSpawn(n,i),game.player.forceStop(),e=game.camera,game.initGrid(),e.setRealCoords(),game.pathfinder=new p(game.mapContainer.chunkWidth,game.mapContainer.chunkHeight),log.info("spawnMap - Cleared"),game.mapContainer.allReady(function(){var t;log.info("spawnPlayer - started"),t=game.player,game.addEntity(t),game.audioManager.updateMusic(),game.mapStatus=2,log.info("moveGrid"),game.renderer.forceRedraw=!0,log.info("spawnPlayer - finished"),game.player.freeze=!1}),game.renderer.forceRedraw=!0))}),c.onLogin(function(){c.sendLogin(game.player)}),c.onSpawnItem(function(t,e){var n,i,r,a;e&&(n=parseInt(t[5]),i=parseInt(t[6]),t=parseInt(t[8]),r=e.kind,a=null,a=ItemTypes.isLootItem(r)?game.sprites.itemloot:game.sprites[ItemTypes.KindData[e.kind].spriteName],e.setSprite(a),e.wasDropped=!0,log.info("x:"+n+",y:"+i),e.setPosition(n,i),e.count=parseInt(t),game.addItem(e),game.updateCursor(),game.updateCameraEntity(e.id,e))});function n(t,r){var e,n,i,a,s;t[0]!==game.playerId&&(r.setPosition(t[5],t[6]),e=t[7],r.level=parseInt(t[8]),10<t.length&&!(r instanceof C)&&(r.setHP(parseInt(t[9])),r.setMaxHP(parseInt(t[10]))),r.type===Types.EntityTypes.PLAYER&&(r.sprites[0]=parseInt(t[12]),r.sprites[1]=parseInt(t[13]),r.armorColor="#"+t[14],r.weaponColor="#"+t[15]),r.type===Types.EntityTypes.NODE&&(r.name=t[3],r.isDying=r.isDead=!1,n=t[9],i=t[10],r.weaponType=t[11],r.setSprite(game.sprites[n]),r.animate(i,r.idleSpeed)),r instanceof w?(n=r.getSpriteName(),r.name=n,r.setSprite(game.sprites[n])):r instanceof _?(r.setArmorSprite(),r.setWeaponSprite()):r instanceof C?(s=t[3].split("-"),n="block-"+r.kind,r.setSprite(game.sprites[n]),r.animate(s[1],r.idleSpeed)):r.type==Types.EntityTypes.TRAP?(n="trap-"+r.kind,r.setSprite(game.sprites[n]),i=0==spriteId?"off":"on",r.animate(i,r.idleSpeed)):r instanceof x?(a=T.Kinds[r.kind].uid,r.setSprite(game.sprites[a])):r instanceof S&&(a="npc"+(1+~~(r.kind/8)%4)+"_"+(1+r.kind%8),r.setSprite(game.sprites[a]),r.questId=t[8]),r instanceof m&&!(r instanceof C)&&(r.setOrientation(e),r.idle(e)),game.addEntity(r),s=r.name,r instanceof x?s=T.Kinds[r.kind].uid:r instanceof g&&(s=ItemTypes.KindData[r.kind].name),log.debug("Spawned "+s+" ("+r.id+") at "+r.x+", "+r.y),r instanceof I&&(r.onBeforeStep(function(){}),r.onStep(function(){}),r.onStopPathing(function(t,e){}),r.onRequestPath(function(e,t){function n(t){i.push(t)}var i=[r],e=(r.hasTarget()?n(r.target):r.previousTarget&&n(r.previousTarget),game.findPath(r,e,t,i,[]));if(!game.pathfinder.checkValidPath(e))try{throw new Error}catch(t){console.error("invalidpath: "+JSON.stringify(e))}return e}),r.onHasMoved(function(t){})),r instanceof I||r.type===Types.EntityTypes.NODE)&&(r.isDead=!1,r.isDying=!1,r.onRemove(function(){var t=game.player;t.target===r&&t.disengage(),log.info(r.id+" was removed"),r.isDead=!0,game.removeEntity(r)}),r.onDeath(function(){var t=game.player;r!=t&&(t.targetIndex=0,log.info(r.id+" is dead"),t.target===r&&t.disengage(),r.isDying=!0,r.forceStop(),r.freeze=!0,r.setSprite(game.sprites.death),r.animate("death",150,1,function(){log.info(r.id+" was removed"),r.isDead=!0,game.removeEntity(r)}),game.camera.isVisible(r,0)&&game.audioManager.playSound("kill"+Math.floor(2*Math.random()+1)),game.updateCursor())}))}c.onSpawnCharacter(function(t,e){n(t,e)}),c.onDespawnEntity(function(t){var e;game.mapIndex==t[1]&&(t=game.getEntityById(t[0]))&&(t instanceof w?e=A.Kinds[t.kind].name:t instanceof x||t instanceof S?e=T.Kinds[t.kind].name:t instanceof g&&(e=(ItemTypes.isLootItem(t.kind)?v[t.kind-1e3]:ItemTypes.KindData[t.kind]).name),log.info("Despawned "+e+" ("+t.id+") at "+t.x+", "+t.y),t instanceof g?game.removeItem(t):t instanceof I?t.die():t instanceof E?t.open():(t instanceof C||t.type==Types.EntityTypes.TRAP||t.type==Types.EntityTypes.NODE)&&game.removeEntity(t),t.clean())}),c.onEntityMove(function(t){var e=parseInt(t[0]),n=parseInt(t[1]),i=parseInt(t[2]),r=parseInt(t[3]),a=parseInt(t[4]),s=parseInt(t[5]),o=parseInt(t[6]),t=parseInt(t[7]);if(!(game.mapStatus<2||game.mapIndex!=n||n!=game.player.mapIndex)){var l,n=game.getEntityById(i);if(n)if(n.isDying||n.isDead)log.info("ENTITY DYING OR DEAD CANT MOVE");else{if(n==game.player)return!(l=n)||l.isDying||l.isDead?void 0:void(l.x==o&&l.y==t||(console.warn("PLAYER NOT IN CORRECT POSITION."),log.info("p.x="+l.x+",x="+o+"p.y="+l.y+",y="+t),l.forceStop(),l.setPositionGrid(o,t),game.player.user.client.sendSyncTime(),game.renderer.forceRedraw));n.setMoveRate(s),a&&n.move(e,r,!1,o,t),n.move(e,r,a,o,t)}else log.info("UNKNOWN ENTITY"),game.unknownEntities.push(i)}}),c.onEntityMovePath(function(t){var e,n=parseInt(t[0]),i=parseInt(t[1]),r=parseInt(t[2]),a=parseInt(t[3]),s=(t[4],parseInt(t[5])),o=t.splice(6,t.length-6);game.mapStatus<2||game.mapIndex!=i||i!=game.player.mapIndex||(e=null,r!==game.player.id&&((e=game.getEntityById(r))?e.isDying||e.isDead||e!=game.player&&(t=(t=G_LATENCY-(getWorldTime()-n)+G_UPDATE_INTERVAL).clamp(0,G_LATENCY),e.forceStop(),e.setPosition(o[0][0],o[0][1]),e.orientation=a,i=function(){e.isDying||e.isDead?e.forceStop():o.length<2||(s&&e.setMoveRate(s),e.movePath(o,a))},0==t?i():setTimeout(i,t)):game.unknownEntities.push(r)))}),c.onEntityDestroy(function(t){t=t[0],t=game.getEntityById(t);t&&(t instanceof g?game.removeItem(t):game.removeEntity(t),log.debug("Entity was destroyed: "+t.id))}),c.onCharacterDamage(function(t){t.parseInt();var e=game.getEntityById(t[0]),n=game.getEntityById(t[1]),i=(t[2],t[3]),r=t[4],a=t[5],s=t[6],o=t[7],l=t[8],t=1==t[9];e&&n&&(c.change_points_callback([n.id,r,a,i,o,l,s,t]),i<0&&e!=game.player&&(e.lookAtEntity(n),e.hit(e.orientation)),game.player===e)&&(e.attackTime=game.currentTime)}),c.onPlayerStat(function(t){var e=parseInt(t[0]),n=parseInt(t[1]),t=parseInt(t[2]);1==e&&(game.player.exp.base=n,game.player.level.base=Types.getLevel(n),0<t&&game.infoManager.addDamageInfo("+"+t+" exp",game.player.x,game.player.y,"experience",3e3),game.updateExpBar())}),c.onPlayerLevelUp(function(t){var e,n=t[0],i=t[1],t=t[2],r=(game.renderer.scale,game.player.x),a=game.player.y,s=game.player.id;1==n&&game.player.level.base!=i?(e=new o(s="lu"+s+"_"+i,"Level "+i,r,a,5e3,"levelUp"),game.infoManager.addInfo(e),game.player.level.base=i):2==n&&game.player.level.attack!=i?(e=new o(s="lau"+s+"_"+i,"Attack Level "+i,r,a,3500,"minorLevelUp"),game.infoManager.addInfo(e),game.player.level.attack=i):3==n&&game.player.level.defense!=i?(e=new o(s="ldu"+s+"_"+i,"Defense Level "+i,r,a,3500,"minorLevelUp"),game.infoManager.addInfo(e),game.player.level.defense=i):10<=n&&(weaponType={10:"sword",11:"bow",12:"hammer",13:"axe"}[n],Types.getWeaponLevel(game.player.exp[weaponType])!=i&&(e=new o(s="wu"+s+"_"+i,weaponType+" Level "+i,r,a,3500,"minorLevelUp"),game.infoManager.addInfo(e)),game.player.exp[weaponType]=t,game.player.level[weaponType]=i)}),c.onPlayerItemLevelUp(function(t){var e,n=t[0],i=t[1],t=(t[2],game.player.x),r=game.player.y,a=game.player.id;0==n?(e=new o(a="laru"+a+"_"+i,"Armor Level "+i,t,r,3500,"minorLevelUp"),game.infoManager.addInfo(e)):1==n&&(e=new o(a="lweu"+a+"_"+i,"Weapon Level "+i,t,r,3500,"minorLevelUp"),game.infoManager.addInfo(e))}),c.onGold(function(t){var e=parseInt(t[0]),n=parseInt(t[1]),t=parseInt(t[2]);game.player.gold[0]=e,game.player.gold[1]=n,game.player.gems=t,game.inventoryHandler.setCurrency(e,t),game.bankHandler.setGold(n)}),c.onChatMessage(function(t){var e=t[0],t=t[1];game.chathandler.processReceiveMessage(e,t)||(e=game.getEntityById(e))&&(game.camera.isVisible(e)&&game.bubbleManager.create(e,t),game.chathandler.addNormalChat(e,t)),game.audioManager.playSound("chat")}),c.onDisconnected(function(t){game.player&&game.player.die(),game.disconnect_callback&&game.disconnect_callback(t);for(var e=0;e<game.dialogs.length;e++)game.dialogs[e].hide()}),c.onQuest(function(t){t.parseInt();var e,n,i=t[0],r=game.player.quests[i],t=(r?r.update(t):(r=new N(t),game.player.quests[i]=r),game.getNpcByQuestId(r.npcQuestId));t&&game.bubbleManager.destroyBubble(t.id),t&&game.player.canInteract(t)&&(i=r,t=game.getNpcByQuestId(i.npcQuestId))&&(e=game.player,n=i.desc,Array.isArray(i.desc)||(n=[[0,i.desc]]),t.dialogue=n,t.dialogueIndex=0,t.quest=i,e.dialogueEntity=t,game.showDialogue()),0==r.status&&game.questhandler.handleQuest(r),r.status!=QuestStatus.COMPLETE||r.type!=QuestType.KILLMOBKIND&&r.type!=QuestType.KILLMOBS||game.questhandler.handleQuest(r)}),c.onAchievement(function(t){t.parseInt();var e=t[0],t=new O(t);game.player.achievements[e]=t,game.achievementHandler.handleAchievement(t)}),c.onItemSlot(function(t){t.parseInt();for(var e=t.shift(),n=t.shift(),i=[],r=0,a=0;a<n;++a){var s=parseInt(t[r]),o=parseInt(t[r+1]);-1==o?(i.push({slot:s,itemKind:-1}),r+=2):(s=new ItemRoom(parseInt(s),parseInt(o),parseInt(t[r+2]),parseInt(t[r+3]),parseInt(t[r+4]),parseInt(t[r+5])),r+=6,i.push(s))}0==e?(game.inventoryHandler.setInventory(i),game.shortcuts.refresh()):1==e&&(game.bankHandler.setBank(i),game.bankDialog.visible)&&game.bankDialog.bankFrame.open(game.bankDialog.bankFrame.page),2==e&&game.equipmentHandler.setEquipment(i)}),c.onDialogue(function(t){var e=t.shift(),n=t.shift(),e=game.getEntityById(e),i=game.player,n=JSON.parse(JSON.stringify(lang.data[n]));if(0<t.length)if(Array.isArray(n))for(var r of n)r[1]=r[1].format(t);else n[1]=n[1].format(t);e.dialogue=n,e.dialogueIndex=0,i.dialogueEntity=e,game.showDialogue()}),c.onNotify(function(t){game.showNotification(t)}),c.onStatInfo(function(t){t.parseInt();t={attack:t[0],defense:t[1],health:t[2],energy:t[3],luck:t[4],free:t[5]};game.player.stats=t,game.statDialog.update()}),c.onAuction(function(t){for(var e=t.shift(),n=t.shift(),i=[],r=0;r<n;++r)j=9*r,i.push({index:t[j],player:t[j+1],buy:t[j+2],item:new ItemRoom(t[j+3],t[j+4],t[j+5],t[j+6],t[j+7],t[j+8])});curPage=game.auctionDialog.storeFrame.getActivePage();e=game.auctionDialog.storeFrame.pages[e];curPage===e&&(e.setPageIndex(0),e.setItems(i),e.reload())}),c.onSkillLoad(function(t){var e=t[0],t=t[1];skillLevel=Types.getSkillLevel(t),game.player.skillHandler.setSkill(e,t),game.skillsDialog.page.setSkill(e,skillLevel)}),c.onSkillXP(function(t){t.parseInt();var e=message.shift();if(0!=e)for(var n=0;n<e;++n)game.player.skillHandler.setSkill(message[2*n],message[2*n+1])}),c.onSkillEffects(function(t){var e=t.shift();if(entity=game.getEntityById(e)){var n,i,r=entity.effects=t,a=(game.player==entity?(n=$("#playereffects"),i="playereffect"):entity==game.player.target&&(n=$("#targeteffects"),i="targeteffect"),n&&n.empty(),game.renderer.scale);if(r)for(var s=0;s<r.length;++s){var o=r[s],o=P.Ordered[o].iconOffset;n.append("<div id='"+(i+s)+"' ></div>"),$("#"+i+s).css({display:"inline-block",width:12*a+"px",height:12*a+"px","background-image":'url("img/1/skillicons.png")',"background-position":12*-o[0]*a+"px "+12*-o[1]*a+"px","background-repeat":"no-repeat"}),1==a&&$("#"+i+s).css({"background-size":"180px 168px"})}}}),c.onSpeech(function(t,e,n){var i,t=game.getEntityById(t);t&&(i="",t instanceof w&&(i=M.Speech[e][n]),game.createBubble(t,i))}),c.onMapStatus(function(t,e){log.info("mapStatus="+t+","+e),game.mapIndex=parseInt(t),game.mapStatus=parseInt(e)}),c.onSetSprite(function(t){var e=game.getEntityById(parseInt(t[0]));e&&(e instanceof _?(e.sprites[0]=parseInt(t[1]),e.sprites[1]=parseInt(t[2]),e.setArmorSprite(),e.setWeaponSprite()):e.setSprite(game.sprites[t[1]]))}),c.onSetAnimation(function(t){game.getEntityById(parseInt(t[0]))}),c.onProducts(function(t){game.products=t}),c.onSwapSprite(function(t){var e=parseInt(t[0]),n=parseInt(t[1]),t=(parseInt(t[2]),game.getEntityById(e));t.type===Types.EntityTypes.TRAP&&(t.setSprite(game.sprites["trap-"+n]),t.animate(0==n?"off":"on",t.idleSpeed))}),c.onAppearance(function(t){game.appearanceDialog.assign(t)}),c.onBlockModify(function(t){var e=parseInt(t[0]),n=parseInt(t[1]),t=parseInt(t[2]),e=game.getEntityById(e),t=game.getEntityById(t);e&&t&&(0===n?t.pickup(e):1===n&&(t.place(e),e.holdingBlock=null))});c.onCharacterChangePoints(function(t){t.parseInt();var e,n,i,r=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],h=t[6],t=t[7]||0;r<=0||(r=game.getEntityById(r))&&((i=r.stats).hp=a,i.hpMax=s,i.ep=l,i.epMax=c,i=o,e=r.x,n=r.y,t=t,0==i?game.infoManager.addDamageInfo("miss",e,n-15,"health"):i<0?(0<t?game.infoManager.addDamageInfo(-i,e,n-15,"crit",1500,t):game.infoManager.addDamageInfo(-i,e,n-15,"inflicted"),game.audioManager.playSound("hurt")):game.infoManager.addDamageInfo(i,e,n-15,"healed"),a<o&&(o+=a-o),r==game.player?(0!=o&&(game.playerhp_callback(a,s),t=-o,i=r)&&i instanceof _&&!i.isDead&&(i.stats.hp=(i.stats.hp-t).clamp(0,i.stats.hpMax),t<=i.stats.hp&&game.playerhurt_callback&&game.playerhurt_callback(),game.updateBars(),i.stats.hp<=0)&&(i.stats.hp=0,i.die()),0!=h&&game.playerep_callback(l,c),game.updateBars()):a<=0&&(r.stats.hp=0,r.die()))}),c.onParty(function(t){var e=t.shift();1==e&&game.socialHandler.setPartyMembers(t),2==e&&(e=t[0],t=game.getEntityById(e),game.socialHandler.inviteParty(t))}),c.onLooks(function(t){var e=(t=t.parseInt()).shift(),e=game.getEntityById(e);e&&(t.shift(),e.sprites[0]=t.shift(),e.sprites[1]=t.shift(),e.setWeaponSprite(),e.setArmorSprite())}),c.onHarvest(function(t){var e,n,i,r=(t=t.parseInt()).shift(),r=game.getEntityById(r);r&&(e=t.shift(),n=t.shift(),i=t.shift(),1==e&&("HARVEST"!=r.fsm&&(r.lookAtTile(n,i),r.harvestOn()),r==game.player)&&(r.harvestDuration=t.shift()),2==e)&&r.harvestOff()}),c.onPlayerInfo(function(t){game.statDialog.page.assign(t)})}})}),define("achievementhandler",[],function(){return Class.extend({init:function(){this.hideDelay=5e3,this.progressHideDelay=1e3,this.showlog=!1;var e=this;this.closeButton=$("#achievementCloseButton"),this.closeButton.click(function(t){e.toggleShowLog()})},toggleShowLog:function(){this.showlog=!this.showlog,this.showlog?(this.achievementReloadLog(),$("#achievementlog").css("display","block"),$("#achievementCloseButton").css("display","block")):($("#achievementlog").css("display","none"),$("#achievementCloseButton").css("display","none"))},achievementReloadLog:function(){$("#achievementLogInfo tbody").find("tr:gt(0)").remove();for(var t of game.player.achievements){var e=Number(t.count/t.objectCount*100).toFixed(0)+"%";$("#achievementLogInfo tbody").append("<tr id='ad_"+t.index+"'><td class='frame-stroke1'>"+t.summary+"</td><td class='frame-stroke1'>"+e+"</td></tr>")}},handleAchievement:function(t){t.count==t.objectCount&&(t="<p><h2>Achievement Completed</h2></p><p>"+t.summary+"</p>",game.userAlarm.alarm(t,this.hideDelay)),this.achievementReloadLog()}})}),define("useralarm",[],function(){return Class.extend({init:function(){this.hideDelay=5e3,this.queue=[],this.jqAlarm=$("#useralarm"),this.showing=!1,this.disabled=!1},alarmQueue:function(t,e){e=e||this.hideDelay,this.queue.push([t,e]),this.showing||this.showQueue()},hide:function(){this.jqAlarm.hide(),this.disabled=!0},show:function(){this.disabled=!1,this.showing||this.showQueue()},showQueue:function(){var t,e=this;this.disabled?setTimeout(function(){e.showQueue()},1e3):0<this.queue.length?(this.showing=!0,t=this.queue.pop(),this.jqAlarm.html(t[0]),this.jqAlarm.fadeIn(),setTimeout(function(){e.jqAlarm.fadeOut(1500,function(){e.showQueue()})},t[1])):this.showing=!1},alarm:function(t,e){this.alarmQueue(t,e)}})}),define("shortcuthandler",["data/skilldata","data/items"],function(i,e){var n=Class.extend({init:function(t,e,n){var i=this;this.parent=t,this.slot=e,this.type=n,this.shortcutId=-1,this.cooldownTime=0,this.jq=$("#shortcut"+e),this.jqb=$("#scbackground"+e),this.jqnum=$("#shortcutnum"+e),this.jq.data("slot",e);this.jq.click(function(t){0<i.type?i.exec():i.setup()}),this.jq.on("drop touchend",function(t){i.setup()}),this.jq.unbind("dragover").bind("dragover",function(t){t.preventDefault()})},setup:function(){var t,e=this.jq.data("slot");DragItem&&(t=game.inventory.getItem(DragItem.slot))&&this.install(e,1,t.itemKind),ShortcutData&&this.install(e,2,ShortcutData.index),-1<this.shortcutId&&game.client.sendShortcut(this.slot,this.type,this.shortcutId),this.display()},install:function(t,e,n){this.slot=t,this.type=e,this.shortcutId=n,1==this.type?this.cooldownTime=5:2==this.type&&(this.cooldownTime=~~(i.Data[n].recharge/1e3)),this.display()},display:function(){var t;1==this.type?(t=game.inventory.getItemTotalCount(this.shortcutId),t={itemKind:this.shortcutId,itemNumber:t},e.jqShowItem(this.jq,t,this.jq,1.5)):2==this.type&&i.jqShowSkill(this.jq,this.shortcutId,this.jq)},exec:function(){var t;for(t of this.parent.getSameShortcuts(this))if(t.cooldown&&0<t.cooldown.cooltimeCounter)return;var e,n=!1;1==this.type?(e=game.inventory.getItemByKind(this.shortcutId))&&(n=game.useItem(e)):2==this.type&&(e=game.player.skillHandler.skills[this.shortcutId])&&(n=e.execute()),n&&this.cooldownStart(this.cooldownTime),this.display()},cooldownStart:function(t){this.parent.getSameShortcuts(this);this.cooldown=new r(this.parent,this),this.cooldown.start(t)}}),r=Class.extend({init:function(t,e){this.parent=t,this.shortcut=e,this.children=this.parent.getSameShortcuts(e)},start:function(t){function e(){0<=i.cooltimeCounter?(i.tick(),--i.cooltimeCounter):i.done()}var n,i=this;this.cooltimeCounter=t;clearInterval(this.cooltimeTickHandle),this.cooltimeTickHandle=setInterval(e,1e3),e(),this.children=this.parent.getSameShortcuts(this.shortcut);for(n of this.children)$("#scCD"+n.slot).show()},tick:function(){this.children=this.parent.getSameShortcuts(this.shortcut),0==this.cooltimeCounter&&this.done();for(var t of this.children)$("#scCD"+t.slot).html(this.cooltimeCounter)},done:function(){clearInterval(this.cooltimeTickHandle),this.cooltimeTickHandle=null,this.cooltimeCounter=0,this.children=this.parent.getSameShortcuts(this.shortcut);for(var t of this.children)$("#scCD"+t.slot).hide()}});return Class.extend({init:function(){var t;this.shortcuts=[],this.shortcutCount=8;for(var e=0;e<this.shortcutCount;++e)t=new n(this,e,0),this.shortcuts.push(t)},installAll:function(t){var e;for(e of t)e&&this.shortcuts[e[0]].install(e[0],e[1],e[2])},install:function(t,e,n){this.shortcuts[t]&&this.shortcuts[t].install(e,n)},exec:function(t){this.shortcuts[t]&&this.shortcuts[t].exec()},refresh:function(){for(var t of this.shortcuts)t.display()},getSameShortcuts:function(t){var e,n=[];for(e of this.shortcuts)e.type==t.type&&e.shortcutId==t.shortcutId&&n.push(e);return n}})}),define("dialog/statdialog",["./dialog","../tabpage"],function(t,e){var n=e.extend({init:function(t){this._super(t,"#frameStatsPage"),this.parent=t;var e=this;$("#charAddAttack").click(function(t){game.client.sendAddStat(1,1),e.refreshStats()}),$("#charAddDefense").click(function(t){game.client.sendAddStat(2,1),e.refreshStats()}),$("#charAddHealth").click(function(t){game.client.sendAddStat(3,1),e.refreshStats()}),$("#charAddEnergy").click(function(t){game.client.sendAddStat(4,1),e.refreshStats()}),$("#charAddLuck").click(function(t){game.client.sendAddStat(5,1),e.refreshStats()})},refreshStats:function(){var t=game.player,e=game.player.stats;$("#characterPoints").text("Free Points:\t\t"+e.free),$("#characterAttack").text("Attack:\t\t"+e.attack),$("#characterDefense").text("Defense:\t\t"+e.defense),$("#characterHealth").text("Health:\t\t"+e.health),$("#characterEnergy").text("Energy:\t\t"+e.energy),$("#characterLuck").text("Luck:\t\t"+e.luck),$("#characterBaseCrit").text("Base Crit\t\t"+t.baseCrit()),$("#characterBaseCritDef").text("Base Crit Def\t\t"+t.baseCritDef()),$("#characterBaseDamage").html("Base Damage<br/>"+t.baseDamage()[0]+"-"+t.baseDamage()[1]),$("#characterBaseDamageDef").html("Base Damage Def<br/>"+t.baseDamageDef()[0]+"-"+t.baseDamageDef()[1]),0<e.free&&($("#charAddAttack").css("display","inline-block"),$("#charAddDefense").css("display","inline-block"),$("#charAddHealth").css("display","inline-block"),$("#charAddEnergy").css("display","inline-block"),$("#charAddLuck").css("display","inline-block"))},assign:function(t){game.renderer?game.renderer.mobile?this.scale=1:this.scale=game.renderer.getUiScaleFactor():this.scale=2,t=t.parseInt();var e=game.player,t=(e.exp.base=t.shift(),e.exp.attack=t.shift(),e.exp.defense=t.shift(),e.exp.sword=t.shift(),e.exp.bow=t.shift(),e.exp.hammer=t.shift(),e.exp.axe=t.shift(),e.exp.logging=t.shift(),e.exp.mining=t.shift(),this.refreshStats(),game.renderer?game.renderer.mobile?this.scale=1:this.scale=game.renderer.getUiScaleFactor():this.scale=2,$("#characterName").text("Name\t\t"+e.name),e.exp.sword||0),n=Types.getWeaponLevel(t),i=t?(t-Types.weaponExp[n-1])/(Types.weaponExp[n]-Types.weaponExp[n-1])*100:0,t=($("#characterLevelSword").text("Sword Level\t\t"+n+"\t"+i.toFixed(0)+"%"),t=e.exp.bow||0,n=Types.getWeaponLevel(t),i=t?(t-Types.weaponExp[n-1])/(Types.weaponExp[n]-Types.weaponExp[n-1])*100:0,$("#characterLevelBow").text("Bow Level\t\t"+n+"\t"+i.toFixed(0)+"%"),t=e.exp.hammer||0,n=Types.getWeaponLevel(t),i=t?(t-Types.weaponExp[n-1])/(Types.weaponExp[n]-Types.weaponExp[n-1])*100:0,$("#characterLevelHammer").text("Hammer Level\t\t"+n+"\t"+i.toFixed(0)+"%"),t=e.exp.axe||0,n=Types.getWeaponLevel(t),i=t?(t-Types.weaponExp[n-1])/(Types.weaponExp[n]-Types.weaponExp[n-1])*100:0,$("#characterLevelAxe").text("Axe Level\t\t"+n+"\t"+i.toFixed(0)+"%"),t=e.exp.logging||0,n=Types.getSkillLevel(t),i=t?(t-Types.skillExp[n-1])/(Types.skillExp[n]-Types.skillExp[n-1])*100:0,$("#characterLevelLogging").text("Logging Level\t\t"+n+"\t"+i.toFixed(0)+"%"),t=e.exp.mining||0,n=Types.getSkillLevel(t),i=t?(t-Types.skillExp[n-1])/(Types.skillExp[n]-Types.skillExp[n-1])*100:0,$("#characterLevelMining").text("Mining Level\t\t"+n+"\t"+i.toFixed(0)+"%"),e.level.base=Types.getLevel(e.exp.base),e.level.attack=Types.getAttackLevel(e.exp.attack),e.level.defense=Types.getDefenseLevel(e.exp.defense),e.exp.base?(e.exp.base-Types.expForLevel[e.level.base-1])/(Types.expForLevel[e.level.base]-Types.expForLevel[e.level.base-1])*100:0),n=e.exp.attack?(e.exp.attack-Types.attackExp[e.level.attack-1])/(Types.attackExp[e.level.attack]-Types.attackExp[e.level.attack-1])*100:0,i=e.exp.defense?(e.exp.defense-Types.defenseExp[e.level.defense-1])/(Types.defenseExp[e.level.defense]-Types.defenseExp[e.level.defense-1])*100:0;$("#characterLevel").text("Level\t\t"+e.level.base+"\t"+t.toFixed(0)+"%"),$("#characterAttackLevel").text("Attack Level\t\t"+e.level.attack+"\t"+n.toFixed(0)+"%"),$("#characterDefenseLevel").text("Defense Level\t\t"+e.level.defense+"\t"+i.toFixed(0)+"%")}});return StatDialog=t.extend({init:function(){this._super(null,"#statsDialog"),this.addClose(),this.page=new n(this)},show:function(t,e){this._super(),this.update()},update:function(){game.client.sendPlayerInfo()}})}),define("dialog/skilldialog",["./dialog","../tabpage","data/skilldata"],function(t,e,o){var a=Class.extend({init:function(t,e,n,i){function r(t){(s.parent.selectedSkill=s).parent.clearHighlight(),s.body.css("border",s.scale+"px solid #f00"),$("#skillDetail").html(s.detail),ShortcutData=s}var a=this.id="#characterSkill"+e,a=(this.background=$(a),this.body=$(a+"Body"),this.levels=[],this.level=n,this.parent=t,this.index=e,this.data=o.Data[e]),s=(log.info(e+" = "+JSON.stringify(a)),this.detail=a.detail.replace("[l]",this.level).replace("[u]",a.baseLevel+a.perLevel*this.level),this.position=i,this.scale=game.renderer.getUiScaleFactor(),this);this.body.data("skillIndex",this.index),this.body.bind("dragstart",function(t){r($(this).data("skillIndex")),log.info("Began DragStart.")}),this.body.on("click tap",function(t){r($(this).data("skillIndex")),t.stopPropagation()}),this.rescale()},rescale:function(){var t=this.scale=game.renderer.getUiScaleFactor(),e=this.position;this.body.css({position:"absolute",left:t+"px",top:t+"px",width:24*t,height:24*t,display:"none"}),e&&this.body.css({"background-image":'url("img/'+t+'/misc/skillicons.png")',"background-position":24*-e[0]*t+"px "+24*-e[1]*t+"px","background-size":360*t+"px "+336*t+"px",display:"block",border:t+"px solid #000"})},getName:function(){return this.name},getLevel:function(){return this.level},setLevel:function(t){0<(this.level=t)?(this.body.css("display","inline"),this.body[0]&&(this.body[0].draggable=!0)):(this.body.css("display","none"),this.body[0]&&(this.body[0].draggable=!1))}}),n=e.extend({init:function(t){this._super(t,"#frameSkillsPage"),this.skills=[],this.selectedSkill=null},setSkills:function(t){for(var e=0;e<t.length;++e)this.skills[e]={level:Types.getSkillLevel(t[e]),skill:null};this.assign()},setSkill:function(t,e){this.skills[t]={level:e,skill:null}},clear:function(){for(var t=game.renderer.getUiScaleFactor(),e=this.skills.length-1;0<=e;--e){var n=this.skills[e];n.skill&&(n.skill.background.css({"background-image":'url("../img/'+t+'/misc/itembackground.png")'}),$("#characterSkill"+e).attr("title",""),$("#characterSkill"+e).html(),n.level=0)}this.skills.splice(0,this.skills.length)},rescale:function(){for(var t=0;t<this.skills.length;++t)this.skills[t].skill.rescale()},assign:function(){for(var t=game.renderer.getUiScaleFactor(),e=0;e<this.skills.length;++e){var n,i=this.skills[e],r=o.Data[e];i&&(log.info("#characterSkill1"+e),(n=new a(this,e,i.level,r.iconOffset)).background.css({position:"absolute",left:e%6*26*t+"px",top:(6+14*t+26*Math.floor(e/6))*t+"px",width:24*t+"px",height:24*t+"px",display:"block"}),this.skills[e].skill=n,$("#characterSkill"+e).attr("title",r.name+" Lv: "+i.level),$("#characterSkill"+e+"Body").css({"text-align":"center",color:"#fff","line-height":18*t+"px","font-size":6*t+"px","font-weight":"bold"}),$("#characterSkill"+e+"Body").html("Lv "+i.level),n.setLevel(i.level))}},clearHighlight:function(){for(var t=0;t<this.skills.length;++t)this.skills[t].skill&&this.skills[t].skill.body.css("border","3px solid black")}});return SkillDialog=t.extend({init:function(){this._super(null,"#skillsDialog"),this.addClose(),this.page=new n(this),ShortcutData=null,$("#skillsCloseButton").add("#skillsDialog").add("#game").on("click tap",function(t){ShortcutData&&ShortcutData.parent.clearHighlight(),ShortcutData=null})},show:function(){this._super(),this.page.rescale()},update:function(t){this.page.update(t)}})}),define("dialog/confirmdialog",["./dialog"],function(t){return t.extend({init:function(){this._super(game,"#dialogModalConfirm"),this.setScale(),this.modalParent=$("#dialogModal"),this.modal=$("#dialogModalConfirm"),this.modalConfirmMessage=$("#dialogModalConfirmMessage"),this.modalConfirmButton1=$("#dialogModalConfirmButton1"),this.modalConfirmButton2=$("#dialogModalConfirmButton2"),this.confirmCallback=null,this.scale=this.setScale();var e=this;this.modalConfirmButton1.click(function(t){e.hide(),e.confirmCallback&&e.confirmCallback(!0)}),this.modalConfirmButton2.click(function(t){e.hide(),e.confirmCallback&&e.confirmCallback(!1)})},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale()},show:function(){this.rescale(),this.modalParent.css("display","block"),this.modal.css("display","block"),this._super()},hide:function(){this.modalParent.css("display","none"),this.modal.css("display","none"),this._super()},confirm:function(t,e){this.confirmCallback=e,this.modalConfirmMessage.text(t),this.show()}})}),define("dialog/notifydialog",["./dialog"],function(t){return t.extend({init:function(){this._super(game,"#dialogModalNotify"),this.setScale(),this.modalParent=$("#dialogModal"),this.modal=$("#dialogModalNotify"),this.modalNotifyMessage=$("#dialogModalNotifyMessage"),this.modalNotifyButton1=$("#dialogModalNotifyButton1"),this.notifyCallback=null,this.scale=this.setScale();var e=this;this.modalNotifyButton1.click(function(t){e.hide(),e.notifyCallback&&e.notifyCallback()})},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale()},show:function(){this.rescale(),this.modalParent.css("display","block"),this.modal.css("display","block"),this._super()},hide:function(){this.modalParent.css("display","none"),this.modal.css("display","none"),this._super()},notify:function(t,e){this.notifyCallback=e,this.modalNotifyMessage.text(t),this.show()}})}),define("dialog/craftdialog",["./dialog","../tabbook","../tabpage","../entity/item","../inventorystore","../pageNavigator","data/items"],function(t,e,n,o,i,r,l){var c=Class.extend({init:function(t,e,n){this.parent=t,this.id=e,this.index=n,this.body=$(e),this.basketBackground=$(e+"BasketBackground"),this.basket=$(e+"Basket"),this.extra=$(e+"Extra"),this.price=$(e+"Price"),this.buyButton=$(e+"BuyButton"),this.item=null,this.rescale(),this.buyButton.text("Craft")},rescale:function(){var t=this.parent.scale,e=this.id;this.body=$(e),1==t?this.body.css({position:"absolute",left:"0px",top:20*this.index+"px"}):2==t?this.body.css({position:"absolute",left:"0px",top:40*this.index+"px"}):3==t&&this.body.css({position:"absolute",left:"0px",top:60*this.index+"px"}),this.item&&this.assign(this.item)},getVisible:function(){return"block"===this.body.css("display")},setVisible:function(t){var i=this;this.body.css("display",t?"block":"none"),this.buyButton.text("Craft"),t&&this.buyButton.off().on("click",function(t){var e,n=!1;for(e of i.item.craft.i)game.inventoryHandler.hasItems(e[0],e[1])||(game.showNotification(["CHAT","SHOP_MISSINGITEMS",e[1],ItemTypes.getData(e[0]).name]),n=!0);n?game.showNotification(["SHOP","SHOP_NOCRAFTITEMS"]):i.item.craftPrice>game.player.gold[0]?game.showNotification(["SHOP","SHOP_NOGOLD"]):(game&&game.ready&&game.client.sendStoreCraft(parseInt(i.item.craft.id),1),t.stopPropagation())})},assign:function(t){this.item=t,l.jqShowItem(this.basket,this.item,this.basket);var e,n=new ItemRoom(0,t.kind,1,900,900,0),n=o.getInfoMsgEx(n),i=ItemTypes.getName(t.kind),r=(this.basket.attr("title",n),ItemTypes.isConsumableItem(t.kind)?this.basket.text(""):this.extra.text(i),0),a="<span class='craftBecomes'>&lt;&lt;&nbsp;</span><div class='craftReqs'>";for(e of t.craft.i)e.name="craft_"+t.kind+"_"+r,a+="<div class='craftitem'><div id='"+e.name+"'></div></div>",r++;this.extra.html(a+"</div>");for(e of t.craft.i){var s={itemKind:e[0],itemNumber:e[1]};l.jqShowItem($("#"+e.name),s,$("#"+e.name))}this.price.text(getGoldShortHand(t.craftPrice))}}),n=n.extend({init:function(t,e,n,i,r,a){this._super(t,e+"Page",e+a+"Button"),this.itemType=n,this.racks=[],this.items=i,this.scale=r,this.pageIndex=0,this.parent=t,this.rackRows=5;for(var s=0;s<this.rackRows;s++)this.racks.push(new c(this,e+s,s))},rescale:function(t){this.scale=t;for(var e=0;e<this.rackRows;e++)this.racks[e].rescale()},getPageCount:function(){return this.items?(log.info("this.items.length="+this.items.length),Math.ceil(this.items.length/this.rackRows)):0},getPageIndex:function(){return this.pageIndex},setPageIndex:function(t){this.pageIndex=t,this.open(this.parent.minLevel,this.parent.maxLevel),this.reload()},open:function(t,e){this.items=ItemTypes.Store.getItems(this.itemType,t,e),log.info(JSON.stringify(this.items));for(var n=function(t){return!0},i=(2==this.itemType&&(n=function(t){return ItemTypes.isArmor(t.kind)}),3==this.itemType&&(n=function(t){return ItemTypes.isWeapon(t.kind)}),this.items.length);0<=--i;){var r=this.items[i];if(n(r)||this.items.splice(this.items.indexOf(r),1),0==r.craft.length)this.items.splice(this.items.indexOf(r),1);else if(1==r.craft.length)r.craft=r.craft[0];else for(var a=0;a<r.craft.length;a++){Object.assign({},r);var s=r.craft[a];this.items.push(s)}}log.info("this.items="+JSON.stringify(this.items)),this.reload()},reload:function(){this.clear();for(var t=Math.min((this.pageIndex+1)*this.rackRows,this.items.length),e=this.pageIndex*this.rackRows;e<t;e++){var n=this.racks[e-this.pageIndex*this.rackRows];n.assign(this.items[e]),n.setVisible(!0)}},clear:function(){for(var t=0;t<this.rackRows;t++)this.racks[t].setVisible(!1)},close:function(){this.clear(),this.setVisible(!1)}}),a=n.extend({init:function(t,e){this._super(t,"#craftDialogStore",4,null,e,0)}}),s=n.extend({init:function(t,e){this._super(t,"#craftDialogStore",2,null,e,1)}}),h=n.extend({init:function(t,e){this._super(t,"#craftDialogStore",3,null,e,2)}}),u=e.extend({init:function(t){this._super("#craftDialogStore"),this.parent=t,this.scale=this.parent.scale,this.pagePotion=new a(this,this.scale),this.pageArmor=new s(this,this.scale),this.pageWeapon=new h(this,this.scale),this.add(this.pagePotion),this.add(this.pageArmor),this.add(this.pageWeapon),this.pageNavigator=new r(t.scale,"craft"),this.pageNavigator.onChange(function(t){var e=n.getActivePage();e&&game.craftDialog.visible&&(log.info("self.parent.game.craftDialog.visible"),e.setPageIndex(t.getIndex()-1))});var n=this;this.minLevel=1,this.maxLevel=100},rescale:function(){this.scale=this.parent.scale,this.pagePotion.rescale(this.scale),this.pageArmor.rescale(this.scale),this.pageWeapon.rescale(this.scale),this.pageNavigator.rescale(this.scale)},setPageIndex:function(t){game.craftDialog.visible&&(this.pages[t].open(this.minLevel,this.maxLevel),this._super(t),t=this.getActivePage())&&(1<t.getPageCount()?(this.pageNavigator.setCount(t.getPageCount()),this.pageNavigator.setIndex(t.getPageIndex()+1),this.pageNavigator.open(),this.pageNavigator.setVisible(!0)):this.pageNavigator.setVisible(!1),t.reload())},open:function(t,e){this.minLevel=t,this.maxLevel=e,this.setPageIndex(0),this.pagePotion.setPageIndex(0)}});return t.extend({init:function(t){this._super(t,"#craftDialog"),this.setScale(),this.craftFrame=new u(this),this.sellButton=$("#craftDialogStore3Button"),this.sellButton.hide(),this.scale=this.setScale();$("#craftDialogStorePage").css("display","none")},setScale:function(){this.scale=game.renderer.getUiScaleFactor()},rescale:function(){this.setScale(),this.craftFrame.rescale()},show:function(t,e){$("#craftDialog .frameheadingtext").text("CRAFT"),$("#craftDialogStore0Button").text("MISC"),$("#craftDialogStore0Button").show(),this.rescale(),this.craftFrame.open(t,e),this.addClose(),this._super(),$("#craftDialogStore0Button").trigger("click")},hide:function(){var t=this.craftFrame.getActivePage();t&&(t.setVisible(!1),t.close()),this._super()}})}),define("game",["text!../shared/data/sprites.json","lib/localforage","infomanager","bubble","renderer","map","mapcontainer","animation","sprite","sprites","tile","gameclient","clientcallbacks","audio","updater","pathfinder","entity/entity","entity/item","data/items","data/itemlootdata","data/appearancedata","dialog/appearancedialog","entity/mob","entity/npcstatic","entity/npcmove","data/npcdata","entity/player","entity/character","entity/chest","entity/block","entity/node","data/mobdata","data/mobspeech","exceptions","config","chathandler","playerpopupmenu","classpopupmenu","quest","data/questdata","questhandler","achievementhandler","useralarm","equipmenthandler","inventoryhandler","shortcuthandler","bankhandler","socialhandler","leaderboardhandler","settingshandler","storehandler","bools","skillhandler","data/skilldata","dialog/statdialog","dialog/skilldialog","dialog/confirmdialog","dialog/notifydialog","dialog/storedialog","dialog/auctiondialog","dialog/craftdialog","dialog/bankdialog","gamepad"],function(R,j,n,e,i,H,r,t,a,s,F,o,l,c,h,q,z,u,K,U,G,d,p,f,m,g,y,v,b,k,w,W,Y,X,x,S,V,T,Q,Z,I,E,C,A,M,D,N,O,P,L,B,J,tt,et,nt,it,rt,at,st,ot,lt,ct,ht){return Class.extend({init:function(t){var e=this;this.app=t,this.app.config=x,this.ready=!1,this.started=!1,this.hasNeverStarted=!0,this.hasServerPlayer=!1,this.client=null,this.renderer=null,this.camera=null,this.updater=null,this.pathfinder=null,this.chatinput=null,this.bubbleManager=null,this.audioManager=null,this.entities={},this.pathingGrid=[],this.tileGrid=[],this.itemGrid=[],this.currentCursor=null,this.mouse={x:0,y:0},this.previousClickPosition={},this.cursorVisible=!0,this.selectedX=0,this.selectedY=0,this.selectedCellVisible=!1,this.targetColor="rgba(255, 255, 255, 0.5)",this.targetCellVisible=!0,this.hoveringTarget=!1,this.hoveringPlayer=!1,this.hoveringMob=!1,this.hoveringItem=!1,this.hoveringCollidingTile=!1,this.hoveringEntity=null,this.chats=0,this.maxChats=3,this.globalChatColor="#A6FFF9",this.infoManager=new n(this),this.questhandler=new I(this),this.achievementHandler=new E,this.chathandler=new S(this),this.socialHandler=new O(this),this.leaderboardHandler=new P(this),this.storeHandler=new B(this,this.app),this.lastCurrentTime=0,this.updateCurrentTime=0,this.logicTime=0,this.currentTime=getTime(),this.cursors={},this.sprites={},this.animatedTiles=null,this.dialogs=[],this.statDialog=new nt,this.skillDialog=new it,this.equipmentHandler=new A(this),this.userAlarm=new C,this.dialogs.push(this.statDialog),this.dialogs.push(this.skillDialog),this.soundButton=null,this.expMultiplier=1,this.showInventory=0,this.selectedSkillIndex=0,this.usejoystick=!1,this.joystick=null,this.clickMove=!1,this.inputLatency=0,this.keyInterval=null,this.optimized=!0,this.products=null,this.musicOn=!0,this.sfxOn=!0,this.ignorePlayer=!1,this.mapStatus=0,this.mapNames=["map0","map1"],this.gameTime=0,this.updateTime=0,this.previousDelta=0,this.animFrame="undefined"!=typeof requestAnimFrame,this.spritesReady=!1,this.unknownEntities=[],this.removeObsoleteEntitiesChunk=32,this.inventoryMode=0,this.spriteJSON=new s,this.dialogueWindow=$("#npcDialog"),this.npcText=$("#npcText"),setInterval(function(){e.removeObsoleteEntities()},3e4)},setSpriteJSON:function(){sprites=this.spriteJSON.sprites,this.loadSprites(),this.spritesReady=!0},setup:function(t){this.bubbleManager=new e,this.renderer=new i(this),this.tilesize=this.renderer.tilesize,this.camera=this.renderer.camera,this.bankHandler=new N(this),this.setChatInput(t),this.storeDialog=new st(this),this.dialogs.push(this.storeDialog),this.craftDialog=new lt(this),this.dialogs.push(this.craftDialog),this.bankDialog=new ct(this),this.dialogs.push(this.bankDialog),this.auctionDialog=new ot(this),this.dialogs.push(this.auctionDialog),this.appearanceDialog=new d(this),this.dialogs.push(this.appearanceDialog),this.confirmDialog=new rt,this.notifyDialog=new at,this.classPopupMenu=new T(this),this.inventoryHandler=new M(this),this.inventory=this.inventoryHandler,this.shortcuts=new D},setChatInput:function(t){this.chatinput=t},initPlayer:function(){this.app.initTargetHud(),this.player.respawn(),this.camera.entities[this.player.id]=this.player,this.camera.outEntities[this.player.id]=this.player,log.debug("Finished initPlayer")},initCursors:function(){var t=this.sprites.cursors,e=this.sprites.target,n=(t.container=Container.HUD,e.container=Container.HUD,this.renderer.createSprite(t));t.pjsSprite=n,e.pjsSprite=n,this.cursorAnim=t.createAnimations(),this.targetAnim=e.createAnimations(),this.cursors.hand=t,this.cursors.sword=t,this.cursors.loot=t,this.cursors.arrow=t,this.cursors.talk=t,this.cursors.join=t,this.cursors.target=e},initAnimations:function(){this.targetAnimation=new t("idle_down",0,4,0,16,16),this.targetAnimation.setSpeed(50)},loadSprite:function(t){this.spritesets[0][t.id]=new a(t,2,Container.ENTITIES)},setSpriteScale:function(t){var n=this;_.each(this.entities,function(t){try{var e;t!==game.player&&(e=n.sprites[t.getSpriteName()])&&t.setSprite(e)}catch(t){}})},loadSprites:function(){log.info("Loading sprites..."),this.spritesets=[],this.spritesets[0]={},this.sprites=this.spritesets[0];var t,e;for(e in sprites)t=sprites[e],this.loadSprite(t);this.setSpriteScale(this.renderer.scale)},setCursor:function(t,e){t in this.cursors?(this.currentCursor=this.cursors[t],this.currentCursor.setAnimation(t),this.currentCursorOrientation=e):log.error("Unknown cursor name :"+t)},updateCursorLogic:function(){this.hoveringCollidingTile&&this.started?this.targetColor="rgba(255, 50, 50, 0.5)":this.targetColor="rgba(255, 255, 255, 0.5)",this.hoveringPlayer&&this.started&&this.player?(this.player.pvpFlag||this.namedEntity&&this.namedEntity instanceof y&&this.namedEntity.isWanted?this.setCursor("sword"):this.setCursor("hand"),this.hoveringTarget=!1,this.hoveringMob=!1):this.hoveringMob&&this.started?(this.setCursor("sword"),this.hoveringTarget=!1,this.hoveringPlayer=!1):this.hoveringNpc&&this.started?(this.setCursor("talk"),this.hoveringTarget=!1):(this.hoveringItem||this.hoveringChest)&&this.started?(this.setCursor("loot"),this.hoveringTarget=!1):"hand"!=this.currentCursor.currentAnimation.name&&(this.setCursor("hand"),this.hoveringTarget=!1,this.hoveringPlayer=!1)},addEntity:function(t){this.entities[t.id]=t,this.updateCameraEntity(t.id,this.entities[t.id])},removeEntity:function(t){var e;t.id in this.entities?(e=t.id,this.player.target==t&&(this.player.clearTarget(),this.player.targetIndex=0),this.renderer.removeEntity(t),this.updateCameraEntity(e,null),delete this.entities[e]):log.info("Cannot remove entity. Unknown ID : "+t.id)},addItem:function(t){this.items?(this.items[t.id]=t,this.addEntity(t)):console.warn("TODO: Cannot add item. Unknown ID : "+t.id)},removeItem:function(t){t?(this.removeFromItems(t),t.id,this.removeEntity(t)):log.error("Cannot remove item. Unknown ID : "+t.id)},removeFromItems:function(t){t&&delete this.items[t.id]},initGrid:function(){this.camera.focusEntity=this.player,this.mapContainer.reloadMaps(!0)},registerEntityPosition:function(t){var e=t.gx,n=t.gy;t&&t instanceof u&&(this.itemGrid[n][e][t.id]=t,this.items[t.id]=t)},loadAudio:function(){this.audioManager=new c(this)},initMusicAreas:function(){},run:function(t,e){var n=this;game.player=user.createPlayer(e),this.loadGameData(),this.updater=new h(this),this.camera=this.renderer.camera,setTimeout(function(){n.renderer.rescale(),n.renderer.resizeCanvases()},1500),game.gamepad=new ht(n),this.gameTick=setInterval(n.tick,G_UPDATE_INTERVAL),this.animFrame?requestAnimFrame(this.render.bind(this)):this.renderTick=setInterval(this.render,G_UPDATE_INTERVAL)},render:function(){var t=game;t.renderer.renderFrame(),t.animFrame&&requestAnimationFrame(t.render.bind(t))},tick:function(){var t=game;t.currentTime=getTime(),t.started&&!t.isStopped&&(t.updateTime=t.currentTime,t.gamepad&&t.gamepad.interval(),t.updater.update(),2<=t.mapStatus)&&t.updateCursorLogic()},start:function(){this.started=!0,this.ready=!0,this.hasNeverStarted=!1,log.info("Game loop started.")},stop:function(){log.info("Game stopped."),this.isStopped=!0},entityIdExists:function(t){return t in this.entities},getEntityById:function(t){return this.entities&&t in this.entities?this.entities[t]:this.items&&t in this.items?this.items[t]:void 0},getNpcByQuestId:function(t){for(var e in this.entities){e=this.entities[e];if(e.hasOwnProperty("questId")&&e.questId==t)return e}return null},getEntityByName:function(t){for(var e in this.entities){e=this.entities[e];if(e.name.toLowerCase()===t.toLowerCase())return e}return null},loadGameData:function(){this.loadAudio(),this.initMusicAreas(),this.initCursors(),this.initAnimations(),this.setCursor("hand")},teleportMaps:function(t,e,n){var i=this;this.mapStatus=0,log.info("teleportMaps"),e=e||-1,n=n||-1,this.mapContainer&&(this.mapContainer=null),this.mapContainer=new r(this,t,this.mapNames[t]),this.mapContainer.ready(function(){i.client.sendTeleportMap([t,0,e,n])})},onPlayerLoad:function(t){game.settingsHandler=new L(game,game.app),game.settingsHandler.apply(),game.client=new o(game,user.client),game.client.callbacks=new l(game.client),game.client.setHandlers(),log.info("Received player ID from server : "+t.id),setInterval(function(){2<=game.mapStatus&&!t.isMoving()&&t.canObserve(game.currentTime)&&(game.client.sendWho(),t.observeTimer.lastTime=game.currentTime)},4*t.moveSpeed),game.renderer.initPIXI(),game.app.initPlayerBar(),game.updateBars(),game.updateExpBar(),log.info("onWelcome"),$(".validation-summary").text("Loading Map.."),$("#player_window").is(":visible")&&($("#intro").hide(),$("#container").fadeIn(1e3));game.tilesize;if(game.teleportMaps(1),game.chathandler.show(),game.gamestart_callback(),game.hasNeverStarted&&game.start(),t.attackTime=game.currentTime,0==t.level.base)for(var e="["+lang.data.TUTORIAL+"]",n=1;n<=5;++n){var i=1;setTimeout(function(){var t=lang.data["TUTORIAL_"+i++];game.chathandler.addGameNotification(e,t)},12500*n)}},teleportFromTown:function(t){0==t.mapIndex&&63<=t.gx&&t.gx<=65&&70<=t.gy&&t.gy<=72&&this.teleportMaps(1)},addPlayerCallbacks:function(t){var s=this,i=(s.player=t,s.player.onStartPathing(function(t){var e=t.length-1;t[e][0],t[e][1]}),s.player.onKeyMove(function(t){var e=s.player;i(e,e.x,e.y),e.sendMove(t?1:0)}),s.player.onBeforeMove(function(){}),s.player.onBeforeStep(function(){}),s.player.onStep(function(){}),s.player.onAbortPathing(function(t,e){var n=s.player;s.client.sendMoveEntity(n,2)}),function(t,e,n){s.teleportFromTown(t);var i,r,a=s.mapContainer.getDoor(t);!t.hasTarget()&&a&&(a.minLevel&&s.player.level<a.minLevel&&(i="I must be Level "+a.minLevel+" or more to proceed.",r="You must be Level "+a.minLevel+" or more to proceed."),i?(s.bubbleManager.create(s.player,i),s.chathandler.addGameNotification("Notification",r)):(t.orientation=a.orientation,t.buttonMoving=!1,t.forceStop(),a.portal&&s.audioManager.playSound("teleport")))});s.player.onStopPathing(function(t,e){var n=s.player;log.info("onStopPathing"),n.isDead||(s.client.sendMoveEntity(n,2),log.info("onStopPathing - 1"),n.hasTarget()?n.lookAtEntity(n.target):log.info("onStopPathing - NO TARGET!"),log.info("onStopPathing - 2"),i(n,t,e),s.player.target instanceof f||s.player.target instanceof m?s.makeNpcTalk(s.player.target):s.player.target instanceof b&&(s.client.sendOpen(s.player.target),s.audioManager.playSound("chest")))}),s.player.onRequestPath(function(t,e){var n=[s.player],t=(s.player.hasTarget()&&!s.player.target.isDead&&n.push(s.player.target),s.findPath(s.player,t,e,n));return t&&0<t.length&&(s.player.orientation=s.player.getOrientationTo([t[1][0],t[1][1]]),s.client.sendMovePath(s.player,t.length,t)),t}),s.player.onDeath(function(){log.info(s.playerId+" is dead");var t=s.player;t.skillHandler.clear(),t.forceStop(),t.setSprite(s.sprites.death),t.animate("death",150,1,function(){log.info(s.playerId+" was removed"),t.isDead=!0,s.updateCameraEntity(t.id,null),setTimeout(function(){s.playerdeath_callback()},1e3)}),s.audioManager.fadeOutCurrentMusic(),s.audioManager.playSound("death")}),s.player.onHasMoved(function(t){})},connected:function(t){this.hasServerPlayer?this.client.connectgame_callback&&this.client.connectgame_callback():(this.client.connection.send("startgame,"+t),this.hasServerPlayer=!0)},getMouseGridPosition:function(){return{x:this.mouse.gx,y:this.mouse.gy}},getMousePosition:function(){this.renderer;var t=this.camera,e=this.mouse.x,n=this.mouse.y,e=~~(e+t.x),n=~~(n+t.y);return this.mouse.gx=~~(e/G_TILESIZE),this.mouse.gy=~~(n/G_TILESIZE),{x:e,y:n}},makeCharacterGoTo:function(t,e,n){this.map.isColliding(e,n)||t.isDead||t.go(e,n)},makePlayerInteractNextTo:function(){function e(t){return!(!t||!t.isDying&&!t.isDead)||t.type==Types.EntityTypes.NPCSTATIC||t.type==Types.EntityTypes.NPCMOVE||t.type==Types.EntityTypes.PLAYER||t.type==Types.EntityTypes.NODE}function t(){var t=i.nextTile(),e=i.target;return e&&(e.isDying||e.isDead)?(i.clearTarget(),!1):(game.processInput(t[0],t[1],!0),!0)}var i=this.player;if((a=i.dialogueEntity)&&i.isNextTooEntity(a)&&i.isFacingEntity(a))game.showDialogue();else if(!i.isDying&&!i.isDead){log.info("makePlayerInteractNextTo"),this.ignorePlayer=!0;var n=i.target;if(!(n&&i.isNextTooEntity(n)&&i.isFacingEntity(n)&&t())){var r=i.nextTile();if(!(a=this.getEntityAt(r[0],r[1]))||a==i||(s=a)&&(s.isDying||s.isDead)||(i.setTarget(a),!i.hasTarget()||!t()))if(n&&e(n)&&i.clearTarget(),n&&!game.camera.isVisible(n)&&i.clearTarget(),!(n&&i.isNextToo(n)&&(i.isMoving()&&i.forceStop(),i.lookAtEntity(n),t())))if(this.mapContainer.isColliding(r[0],r[1]))i.clearTarget(),this.processInput(r[0],r[1],!0);else{var a,s=(s=Object.values(this.camera.entities)).filter(t=>!e(t));if(n=(n=i.target)||function(t,e){for(var n of t)if(n&&n!=i&&i.isNextTooEntity(n)&&e(i,n))return n;return null}(s,function(t,e){return t.isNextTooEntity(e)}))i.clearTarget(),i.setTarget(n);else if(i.hasTarget()||(i.targetIndex=0),0==i.targetIndex&&(this.playerTargetClosestEntity(1),i.target)&&!i.isNextTooEntity(i.target))return;t(),this.ignorePlayer=!1}}}},makePlayerGoTo:function(t,e){this.player.go(t,e)},makePlayerGoToItem:function(t){var e=this.player;t&&(e.isNextTooEntity(t)?this.client.sendLootMove(t):e.follow(t))},makePlayerAttack:function(t,e){e=0<=e?e:-1,log.info("makePlayerAttack "+t.id);var n=this.currentTime,i=this.player;!i||i===t||i.isDead||i.isDying||(t&&t.isDead?i.removeTarget():i.canReach(i.target)?(i.isMoving()&&i.forceStop(),i.lookAtEntity(i.target),log.info("CAN REACH TARGET!!"),i.canAttack(n)?i.hit()&&i.hasTarget()&&(this.client.sendAttack(i,i.target,e),log.info("CAN ATTACK!! "+i.target.id),this.audioManager.playSound("hit"+Math.floor(2*Math.random()+1)),i.skillHandler.showActiveSkill(),i.attackCooldown.duration=1e3,i.attackCooldown.lastTime=n):log.info("CANNOT ATTACK DUE TO TIME.")):(i.followAttack(i.target),i.isArcher()&&this.chathandler.addNotification(lang.data.ATTACK_TOOFAR),log.info("CANNOT REACH TARGET!!")))},makeNpcTalk:function(t){var e;t&&game.player.isNextToo(t.x,t.y)&&(t.type==Types.EntityTypes.NPCMOVE?this.client.sendTalkToNPC(t.type,t.id):("Craft"===g.Kinds[t.kind].title&&(this.craftDialog.show(1,100),this.gamepad.isActive())&&this.gamepad.dialogNavigate(),"Beginner shop"===g.Kinds[t.kind].title?(this.storeDialog.show(1,100),this.gamepad.isActive()&&this.gamepad.dialogNavigate()):"Bank"===g.Kinds[t.kind].title?(this.bankDialog.show(),this.gamepad.isActive()&&this.gamepad.dialogNavigate()):"Enchant"===g.Kinds[t.kind].title?(game.inventoryMode=InventoryMode.MODE_ENCHANT,this.inventoryHandler.showInventory(),this.gamepad.isActive()&&this.gamepad.dialogNavigate()):"Repair"===g.Kinds[t.kind].title?(game.inventoryMode=InventoryMode.MODE_REPAIR,this.inventoryHandler.showInventory(),this.gamepad.isActive()&&this.gamepad.dialogNavigate()):"Auction"===g.Kinds[t.kind].title?(this.auctionDialog.show(),this.gamepad.isActive()&&this.gamepad.dialogNavigate()):"Looks"===g.Kinds[t.kind].title?this.appearanceDialog.show():(this.bubbleManager.destroyBubble(t.id),e=this.questhandler.talkToNPC(t),this.previousClickPosition={},e&&(this.bubbleManager.create(t,e),this.audioManager.playSound("npc"))),this.player.removeTarget()))},showDialogue:function(){var t,e=this,n=game.player,i=n.dialogueEntity;clearTimeout(game.destroyMessageTimeout),game.destroyMessage(),e.npcText.html(""),e.dialogueWindow.hide(),game.userAlarm.hide(),i&&((t=i.dialogue[i.dialogueIndex-1])&&3==t.length&&"QUEST"==(t=t[2].split("_"))[0]&&game.client.sendQuest(i.id,parseInt(t[1]),1),i.dialogueIndex>=i.dialogue.length)&&(i.quest&&(e.questhandler.handleQuest(i.quest),n.dialogueQuest=null,i.quest=null),i.dialogueIndex=0,n.dialogueEntity=null,i=null,game.userAlarm.show()),i&&(i.dialogueIndex<i.dialogue.length&&game.createMessage(),i.dialogueIndex++,game.destroyMessageTimeout=setTimeout(function(){game.showDialogue()},5e3))},createMessage:function(){var t,e,n,i=this.player,r=i.dialogueEntity;r&&r.dialogueIndex<r.dialogue.length&&(e=0==(t=r.dialogue[r.dialogueIndex])[0]?r:game.player,n=t[1],r)&&n&&(this.bubbleManager.create(e,n),this.audioManager.playSound("npc"),0==t[0]?(this.chathandler.addNormalChat({name:"[NPC] "+e.name},n),this.npcText.html(e.name+": "+n)):(game.chathandler.addNormalChat(i,n),this.npcText.html(i.name+": "+n)),game.app.npcDialoguePic(e),this.dialogueWindow.show())},destroyMessage:function(){var t=this.player.dialogueEntity;if(t){if(t.dialogue){if(!(t.dialogueIndex<t.dialogue.length))return;t=0==t.dialogue[t.dialogueIndex][0]?t:game.player;this.bubbleManager.destroyBubble(t.id)}this.audioManager.playSound("npc-end"),this.npcText.html(""),this.dialogueWindow.hide()}},forEachEntity:function(t,e){for(var n in e=e||function(t){return!0},this.entities){n=this.entities[n];e(n)&&t(n)}},forEachMob:function(t){this.forEachEntity(t,function(t){return t.type==Types.EntityTypes.MOB})},forEachVisibleTileIndex:function(i){var r=this;this.camera.forEachVisibleValidPosition(function(t,e){var n=r.mapContainer.GridPositionToTileIndex(t,e);i(n,t,e)})},forEachVisibleTile:function(i){var t=this.mapContainer,r=t.tileGrid;t.gridReady&&this.forEachVisibleTileIndex(function(t,e,n){_.isArray(r[n][e])?_.each(r[n][e],function(t,e,n){i(t,e,n)}):_.isNaN(r[n][e])||i(r[n][e],e,n)})},forEachAnimatedTile:function(e){this.animatedTiles&&_.each(this.animatedTiles,function(t){e(t)})},getEntitiesAround:function(t,e,n){var i,r,a=[];for(r of[[t+(n=n||G_TILESIZE),e],[t-n,e],[t,e+n],[t,e-n]])(i=this.getEntityAt(r[0],r[1]))&&a.push(i);return a},getEntityAt:function(t,e){if(this.mapContainer.mapLoaded){var n=this.camera.entities;if(0<Object.keys(n).length){var i,r=null;for(i in n)if((r=n[i])&&r.isOver(t,e))return r}}return null},getMobAt:function(t,e){t=this.getEntityAt(t,e);return t&&t instanceof p?t:null},getPlayerAt:function(t,e){t=this.getEntityAt(t,e);return t&&t instanceof y&&t!==this.player?t:null},getNpcAt:function(t,e){t=this.getEntityAt(t,e);return t&&(t instanceof m||t instanceof f)?t:null},getChestAt:function(t,e){t=this.getEntityAt(t,e);return t&&t instanceof b?t:null},getItemAt:function(t,e){var n;return!this.mapContainer.isOutOfBounds(t,e)&&this.itemGrid&&this.itemGrid[e]?(e=this.itemGrid[e][t],n=null,0<_.size(e)&&(_.each(e,function(t){ItemTypes.isConsumableItem(t.kind)&&(n=t)}),n=n||e[_.keys(e)[0]]),n):null},getItemsAt:function(t,e){return!this.map.isOutOfBounds(t,e)&&this.itemGrid&&this.itemGrid[e]?this.itemGrid[e][t]:null},isEntityAt:function(t,e){return!_.isNull(this.getEntityAt(t,e))},isMobAt:function(t,e){return!_.isNull(this.getMobAt(t,e))},isPlayerAt:function(t,e){return!_.isNull(this.getPlayerAt(t,e))},isItemAt:function(t,e){return!_.isNull(this.getItemAt(t,e))},isNpcAt:function(t,e){return!_.isNull(this.getNpcAt(t,e))},isChestAt:function(t,e){return!_.isNull(this.getChestAt(t,e))},findPath:function(t,e,n,i,r){var a=[],s=(this.player,this.mapContainer);if(!s||!s.gridReady)return null;if(this.mapStatus<2)return null;if(log.info("PATHFINDER CODE"),this.pathfinder&&t){var o=this.tilesize;if(!(d=this.mapContainer.collisionGrid))return console.error("game.js findPath: grid not ready for pathing."),null;var l=this.camera,a=null,c=l.getGridPos([t.x,t.y]);if(s.isColliding(t.x,t.y))return log.info("pathfind - isColliding start."),null;l=l.getGridPos([e,n]);if(s.isColliding(e,n))return log.info("pathfind - isColliding end."),null;if(log.info("pS[0]="+c[0]+",pS[1]="+c[1]),log.info("pE[0]="+l[0]+",pE[1]="+l[1]),c[0]==l[0]&&c[1]==l[1])return null;var s=d[0].length,h=d.length;if(c[0]<0||c[0]>=s||c[1]<0||c[1]>=h||l[0]<0||l[0]>=s||l[1]<0||l[1]>=h)return log.error("path cordinates outside of dimensions."),log.error(JSON.stringify([c,l])),null;this.pathfinder.getShortGrid(d,c,l,3);if(a&&0!=a.length||c[0]!=l[0]&&c[1]!=l[1]||this.pathfinder.isValidPath(d,u=[c,l])&&(log.info("validpath-mp:"+JSON.stringify(u)),a=u),a&&0!=a.length||(u=[c,[c[0],l[1]],l],log.info("mp:"+JSON.stringify(u)),this.pathfinder.isValidPath(d,u)&&(log.info("validpath-mp2:"+JSON.stringify(u)),a=u)),a&&0!=a.length||(u=[c,[l[0],c[1]],l],log.info("mp:"+JSON.stringify(u)),this.pathfinder.isValidPath(d,u)&&(log.info("validpath-mp3:"+JSON.stringify(u)),a=u)),!a||0==a.length){var u,d=(u=this.pathfinder.getShortGrid(d,c,l,3)).crop,c=u.substart,l=u.subend,s=d[0].length,h=d.length;if(c[0]<0||c[0]>=s||c[1]<0||c[1]>=h||l[0]<0||l[0]>=s||l[1]<0||l[1]>=h)return log.error("short path cordinates outside of dimensions."),log.error(JSON.stringify([c,l])),null;log.info("using short path finder."),a=this.pathfinder.findShortPath(u.crop,u.minX,u.minY,u.substart,u.subend)}if(a&&0!=a.length||(log.info("using long path finder."),a=this.pathfinder.findPath(d,c,l,!1)),a&&0<a.length){var p,f=t.x-c[0]*o,m=t.y-c[1]*o;for(p of a)p[0]=~~(p[0]*o+f),p[1]=~~(p[1]*o+m);if(log.info("path_result2: "+JSON.stringify(a)),a[0][0]!=t.x||a[0][1]!=t.y)return log.error("player path start co-ordinates mismatch."),log.error("path start coordinate: "+a[0][0]+","+a[0][1]),log.error("player start coordinate: "+t.x+","+t.y),null}}else log.error("Error while finding the path to "+e+", "+n+" for "+t.id);return a},movecursor:function(){var t=this.getMousePosition(),e=t.x,t=t.y;this.cursorVisible=!0,this.mapContainer.gridReady&&this.player&&!this.renderer.mobile&&!this.renderer.tablet&&(this.hoveringMob=this.isMobAt(e,t),this.hoveringPlayer=this.isPlayerAt(e,t),this.hoveringItem=this.isItemAt(e,t),this.hoveringNpc=this.isNpcAt(e,t),this.hoveringOtherPlayer=this.isPlayerAt(e,t),this.hoveringChest=this.isChestAt(e,t),this.hoveringEntity=this.getEntityAt(e,t),this.hoveringMob||this.hoveringPlayer||this.hoveringNpc||this.hoveringChest||this.hoveringOtherPlayer||this.hoveringItem)&&!this.player.hasTarget()&&(e=this.getEntityAt(e,t))&&(this.player.showTarget(e),this.lastHovered=e)},moveCharacter:function(t,e,n,i){i=i||!1;var r,a,s=!0;return s=(s=(s=(s=s&&t.orientation==Types.Orientations.NONE?!1:s)&&this.mapContainer.isColliding(e,n)?!1:s)&&t instanceof y&&(r=t.holdingBlock,a=t.nextTile(e,n),r)&&this.mapContainer.isColliding(a[0],a[1])?!1:s)&&!i&&this.isOverlapping(t,e,n)?!1:s},isOverlapping:function(t,e,n){var i,r=this.camera.entities;for(i in r){var a=r[i];if(!(t instanceof y&&t.holdingBlock==a)&&(a&&t!=a&&!a.isDead&&!a.isDying&&!a.isWithin(t)&&a.isWithin({x:e,y:n})))return!0}return!1},playerTargetClosestEntity:function(t){var e=this.player,n=(e.hasOwnProperty("targetIndex")||(e.targetIndex=0),[Types.EntityTypes.NODE,Types.EntityTypes.PLAYER]),t=(0!=game.mapContainer.mapIndex&&(n=n.concat([Types.EntityTypes.NPCMOVE,Types.EntityTypes.NPCSTATIC])),this.entityTargetClosestEntity(e,t,e.targetIndex,n));return!!t&&(e.setTarget(t),!0)},entityTargetClosestEntity:function(t,e,n,i){this.tilesize;n=n||0;var r,a=this.camera.forEachInScreenArray();for(r of a=a.filter(t=>!(i.includes(t.type)||t.isDying||t.isDead)))r.playerDistance=realDistance(t,r);return 0==a.length?(t.targetIndex=0,null):1==a.length?(t.targetIndex=1,a[0]):(a.sort(function(t,e){return t.playerDistance>e.playerDistance?1:-1}),n=(n+a.length)%a.length,t.targetIndex=(n+a.length+e)%a.length,a[n])},click:function(){var t=this.getMousePosition(),e=game.player;if(e.dialogueEntity)game.showDialogue();else if(!e.movement.inProgress){this.clickMove=!0;for(var n=0;n<this.dialogs.length;n++)this.dialogs[n].visible&&this.dialogs[n].hide();var i=this.getEntityAt(t.x,t.y);e.setTarget(i)||(this.processInput(t.x,t.y),this.clickMove=!1)}},dropItem:function(t,e,n){var i=this.getMouseGridPosition(),i=(e=e||i.x,n=n||i.y,this.inventoryHandler.inventory[t]),r=i.itemKind,i=i.itemNumber;this.player.droppedX=e,this.player.droppedY=n,(ItemTypes.isConsumableItem(r)||ItemTypes.isLootItem(r)||ItemTypes.isCraftItem(r))&&1<i?($("#dropCount").val(i),this.app.showDropDialog(t)):this.client.sendItemSlot([3,0,t,1])},rightClick:function(){},processInput:function(t,e){this.tilesize;var n,i,r=this.player;this.started&&this.player&&!this.player.isDead&&(t=t.clamp(0,this.mapContainer.widthX),e=e.clamp(0,this.mapContainer.heightY),!(n=r.hasTarget()?r.target:this.getEntityAt(t,e))&&this.renderer.mobile&&(i=this.getEntitiesAround(t,e,16))&&0<i.length&&(n=i[0],r.setTarget(n)),n&&!n.isDying?this.playerInteract(n):this.mapContainer.isColliding(t,e)&&r.isNextToo(t,e)?this.makePlayerHarvest(t,e):this.clickMove&&this.clickMoveTo(t,e))},playerInteract:function(t){var e,n=this.player;t&&(!t||n.hasTarget()||t.isDying||n.setTarget(t),n.isNextTooEntity(t)&&n.lookAtEntity(t),log.info("player target: "+n.target.id),t instanceof k&&n.isNextTooEntity(t)&&n.isFacingEntity(t)?(e=t)==n.holdingBlock?(e.place(n),n.holdingBlock=null):e.pickup(n):t instanceof u?this.makePlayerGoToItem(t):t instanceof f||t instanceof m?this.speakToNPC(t):t instanceof y&&t!==this.player?this.makePlayerAttack(t):t instanceof p||t instanceof y&&t!==this.player&&this.player.pvpTarget==t?(log.info("makePlayerAttack!"),this.makePlayerAttack(t)):t instanceof w?this.makePlayerHarvestEntity(t):t instanceof b&&this.makePlayerOpenChest(t))},makePlayerHarvestEntity:function(t){var e=this.player;e.isNextTooEntity(t)?e.hasHarvestWeapon(t.weaponType)?(e.lookAtEntity(t),e.harvestOn(t.weaponType),this.client.sendHarvestEntity(t)):game.showNotification(["CHAT","HARVEST_WRONG_TYPE",t.weaponType]):e.follow(t)},makePlayerHarvest:function(t,e){var n,i,r=this.player;r.hasHarvestWeapon()?null!=(n=r.getWeaponType())&&(i=getGridPosition(t,e),this.mapContainer.isHarvestTile(i,n))?(r.lookAtTile(t,e),r.harvestOn(n),this.client.sendHarvest(t,e)):game.showNotification(["CHAT","HARVEST_WRONG_TYPE",n]):game.showNotification(["CHAT","HARVEST_NO_WEAPON"])},clickMoveTo:function(t,e){log.info("makePlayerGoTo");var n=G_TILESIZE>>1,i=this.player;if(this.mapContainer.isColliding(t,e)){var r=i.x-t,i=i.y-e,a=r<0?Types.Orientations.LEFT:Types.Orientations.RIGHT,s=i<0?Types.Orientations.UP:Types.Orientations.DOWN,o=Math.abs(r)>Math.abs(i)?a:s,r=[1,2,3,4];r.splice(r.indexOf(o),1),r.unshift(o);for(o of r){var l=this.player.nextDist(t,e,o,n);if(!this.mapContainer.isColliding(l[0],l[1]))return void this.makePlayerGoTo(l[0],l[1])}}else this.makePlayerGoTo(t,e)},speakToNPC:function(t){var e=this.player;e.isNextTooEntity(t)?this.makeNpcTalk(t):e.follow(t)},updateCameraEntity:function(t,e){var n=this;n.camera&&(!e||e instanceof v&&e.isDead?(n.camera.entities[t]=null,n.camera.outEntities[t]=null,delete n.camera.entities[t],delete n.camera.outEntities[t]):!n.camera.entities[t]&&n.camera.isVisible(e,1)?(n.camera.entities[t]=e,n.camera.outEntities[t]=e):!n.camera.outEntities[t]&&n.camera.isVisible(e,10)&&(n.camera.outEntities[t]=e))},say:function(t){this.chathandler.processSendMessage(t)||this.client.sendChat(t)},respawnPlayer:function(){log.debug("Beginning respawn"),this.player.revive(),this.updateBars(),this.initPlayer(),this.started=!0,this.client.sendPlayerRevive(),log.debug("Finished respawn")},onGameStart:function(t){this.gamestart_callback=t},onClientError:function(t){this.clienterror_callback=t},onDisconnect:function(t){this.disconnect_callback=t},onPlayerDeath:function(t){this.playerdeath_callback=t},onUpdateTarget:function(t){this.updatetarget_callback=t},onPlayerExpChange:function(t){this.playerexp_callback=t},onPlayerHealthChange:function(t){this.playerhp_callback=t},onPlayerEnergyChange:function(t){this.playerep_callback=t},onBarStatsChange:function(t){this.barstats_callback=t},onPlayerHurt:function(t){this.playerhurt_callback=t},onNotification:function(t){this.notification_callback=t},resize:function(){this.camera.x,this.camera.y,this.renderer.scale,this.renderer.getScaleFactor();var t=this;t.ready=!1,t.renderer.rescaling=!0,t.renderer.rescale(),t.renderer.resizeCanvases(),t.camera.setRealCoords(),t.moveEntityThreshold=1+~~(t.camera.gridW/2),t.ready=!0,t.renderer.rescaling=!1,t.updateBars(),t.updateExpBar(),this.inventoryHandler.refreshInventory(),this.player&&this.player.skillHandler&&this.player.skillHandler.displayShortcuts(),this.storeDialog.visible&&this.storeDialog.rescale(),this.bankDialog.visible&&this.bankDialog.rescale()},updateBars:function(){this.player&&this.playerhp_callback&&this.playerep_callback&&(this.playerhp_callback(this.player.stats.hp,this.player.stats.hpMax),this.playerep_callback(this.player.stats.ep,this.player.stats.epMax))},updateExpBar:function(){var t,e;this.player&&this.playerexp_callback&&(t=this.player.level.base,e=this.player.exp.base,this.playerexp_callback(t,e))},showNotification:function(t){var e=t.shift(),n=t.shift(),i=lang.data[n];0<t.length&&(i=lang.data[n].format(t)),0==e.indexOf("NOTICE")?game.renderer.pushAnnouncement(i,3e4):(0!=e.indexOf("SHOP")&&0!=e.indexOf("INVENTORY")||(this.craftDialog.visible||this.storeDialog.visible?game.notifyDialog.notify(i):this.auctionDialog.visible?0==n.indexOf("SHOP_SOLD")?(this.auctionDialog.storeFrame.open(),this.auctionDialog.storeFrame.pageMyAuctions.reload(),this.auctionDialog.storeFrame.pageArmor.reload(),this.auctionDialog.storeFrame.pageWeapon.reload()):game.notifyDialog.notify(i):this.appearanceDialog.visible&&(0==n.indexOf("SHOP_SOLD")?this.appearanceDialog.storeFrame.open():0==n.indexOf("SHOP")&&game.notifyDialog.notify(i))),this.chathandler.addNotification(i))},removeObsoleteEntities:function(){var t,e=game.entities,n=game.player,i=null;for(t in e)(i=e[t])||(64<Math.abs(n.x-i.x)||64<Math.abs(n.y-i.y))&&this.obsoleteEntities.push(i);var r=_.size(this.obsoleteEntities),a=[];if(0<r){for(var s=0;s<this.removeObsoleteEntitiesChunk&&s!=r;++s)i=this.obsoleteEntities.shift(),log.info("Removed Entity: "+i.id),a.push(i.id),this.removeEntity(i);this.client.sendWho(a)}},updateCursor:function(){this.movecursor(),this.updateCursorLogic()},forEachEntityRange:function(e,n,i,r){this.forEachEntity(function(t){t.gx>=e-i&&t.gx<=e+i&&t.gy>=n-i&&t.gy<=n+i&&r(t)})},keyDown:function(t){49<=t&&t<=54&&(t=this.inventoryHandler.inventory[t-49].itemKind,ItemTypes.isConsumableItem(t))&&this.eat(inventoryNumber)},equip:function(t){var e=this.inventoryHandler.inventory[t].itemKind,e=ItemTypes.getEquipmentSlot(e);-1<e&&this.client.sendItemSlot([1,0,t,0,2,e]),game.statDialog.update()},unequip:function(t){this.client.sendItemSlot([1,2,t,0,0,-1]),game.statDialog.update()},useItem:function(t,e){var n=t.itemKind;if(ItemTypes.isConsumableItem(n)){if((n&&null===this.inventoryHandler.healingCoolTimeCallback&&ItemTypes.isHealingItem(n)&&this.player.stats.hp<this.player.stats.hpMax&&0<this.player.stats.hp||ItemTypes.isConsumableItem(n)&&!ItemTypes.isHealingItem(n))&&this.inventoryHandler.decInventory(t.slot))return this.client.sendItemSlot([0,0,t.slot,1]),this.audioManager.playSound("heal"),game.shortcuts.refresh(),!0}else if(ItemTypes.isEquippable(n))return 2==e?game.unequip(slot):game.equip(realslot),!0;return!1},repairItem:function(e,t,n){var i,r=this;t&&this.ready&&(i="Cost "+(t=ItemTypes.getRepairPrice(t))+" to Repair.",t>this.player.gold[0]?game.showNotification(["SHOP","SHOP_NOGOLD"]):this.confirmDialog.confirm(i,function(t){t&&r.client.sendStoreRepair(e,n)}))},enchantItem:function(e,t,n){var i,r=this;t&&this.ready&&(i="Cost "+(t=ItemTypes.getEnchantPrice(t))+" to Enchant.",t>this.player.gold[0]?game.showNotification(["SHOP","SHOP_NOGOLD"]):this.confirmDialog.confirm(i,function(t){t&&r.client.sendStoreEnchant(e,n)}))}})}),app=null,G_LATENCY=75,GROUNDTRIP=2*G_LATENCY,G_UPDATE_INTERVAL=16,G_TILESIZE=16,ATTACK_INTERVAL=1e3,ATTACK_MAX=4e3,Container={STAGE:new PIXI.Container,BACKGROUND:new PIXI.Container,ENTITIES:new PIXI.Container,FOREGROUND:new PIXI.Container,COLLISION:new PIXI.Container,COLLISION2:new PIXI.Container,HUD:new PIXI.Container,HUD2:new PIXI.Container},Container.STAGE.interactive=!0,Object.freeze(Container),define("main",["app","entrypoint","data/langdata","util","button2","dialog/dialog","game","bubble"],function(t,s,n){lang=new n("EN");$("#armorColor").change(function(t){log.info($(this).val());var e=$(this).val();game.client.sendColorTint("armorColor",e),game.player.armorColor=e,game.renderer.removeBodyColorCanvas(game.player),game.renderer.createBodyColorCanvas(game.player)}),$("#weaponColor").change(function(t){log.info($(this).val());var e=$(this).val();game.client.sendColorTint("weaponColor",e),game.player.weaponColor=e,game.renderer.removeWeaponColorCanvas(game.player),game.renderer.createWeaponColorCanvas(game.player)}),document.addEventListener("deviceready",function(){"undefined"!=typeof StatusBar&&StatusBar.hide()},!1),window.onbeforeunload=function(t){"undefined"!=typeof userclient&&userclient.connection?userclient.connection.close():"undefined"!=typeof game&&game.client&&game.client.connection&&game.client.connection.close()},$(document).ready(function(){(app=new t).center(),DragItem=null,DragBank=null,Detect.isWindows()&&$("body").addClass("windows"),Detect.isOpera()&&$("body").addClass("opera"),Detect.isFirefoxAndroid()&&$("#chatinput").removeAttr("placeholder"),$(".barbutton").click(function(){$(this).toggleClass("active")}),$("#chatbutton").click(function(){$("#chatbox").hasClass("active")?app.hideChat():app.showChat()}),$("#population").click(function(){app.togglePopulationInfo()}),$(".clickable").click(function(t){clickFunc(e)}),$("#change-password").click(function(){app.loadWindow("loginWindow","passwordWindow")}),$("#shortcutbutton").click(function(){$("#attackContainer").show(),$("#shortcutbutton").hide()}),$("#attackContainerClose").click(function(){$("#shortcutbutton").show(),$("#attackContainer").hide()}),$(".close").click(function(){app.hideWindows()}),log.info("App initialized."),require(["game","button2"],function(t,e){document.getElementById("entities");var i,r,n=document.getElementById("chatinput"),t=((game=new t(app)).setup(n),app.setGame(game),game.useServer,game.onGameStart(function(){(new s).execute(game)}),game.onDisconnect(function(t){$("#errorwindow").find("p").html(t+"<em>Disconnected. Please reload the page.</em>"),$("#errorwindow").show()}),game.onClientError(function(t){$("#errorwindow").find("p").html(t),$("#errorwindow").show()}),game.onPlayerDeath(function(){game.player.dead(),$("#diedwindow").show()}),game.onNotification(function(t){app.showMessage(t)}),app.initHealthBar(),app.initEnergyBar(),app.initExpBar(),app.initPlayerBar(),$("#nameinput").attr("value",""),$("#pwinput").attr("value",""),$("#pwinput2").attr("value",""),$("#emailinput").attr("value",""),$("#chatbox").attr("value",""),$(document).ready(function(){$("#gui").on("click",function(t){}),game.inventoryHandler.loadInventoryEvents()}),$("#respawn").click(function(t){game.audioManager.playSound("revive"),game.respawnPlayer(),$("#diedwindow").hide()}),this.scale=game.renderer.getScaleFactor(),e.configure={background:{top:0*this.scale,width:0*this.scale},kinds:[0,3,2]},this.inventoryButton=new e("#inventory",{background:{left:0,top:32}}),this.inventoryButton.onClick(function(t,e){game&&game.ready&&game.inventoryHandler.toggleInventory()}),this.statButton=new e("#character",{background:{left:128}}),this.statButton.onClick(function(t,e){app.toggleCharacter()}),game.statDialog.button=this.statButton,app.toggleCharacter=function(){game&&game.ready&&game.statDialog.show()},this.skillButton=new e("#skill",{background:{left:96}}),this.skillButton.onClick(function(t,e){app.toggleSkill()}),app.toggleSkill=function(){game&&game.ready&&game.skillDialog.show()},this.questButton=new e("#help",{background:{left:352}}),this.questButton.onClick(function(t,e){game.questhandler.toggleShowLog()}),this.settingsButton=new e("#settings",{background:{left:32},downed:!1}),this.settingsButton.onClick(function(t,e){game.settingsHandler.show()}),game.settingsButton=this.settingsButton,this.warpButton=new e("#warp",{background:{left:482}}),this.warpButton.onClick(function(t,e){app.toggleWarp()}),game.warpButton=this.warpButton,app.toggleWarp=function(){game&&game.ready&&game.teleportMaps(0)},this.socialButton=new e("#social",{background:{left:416}}),this.socialButton.onClick(function(t,e){app.toggleSocial()}),game.socialButton=this.socialButton,app.toggleSocial=function(){game&&game.ready&&game.socialHandler.show()},this.achievementButton=new e("#achievement",{background:{left:448}}),this.achievementButton.onClick(function(t,e){game.achievementHandler.toggleShowLog()}),game.achievementButton=this.achievementButton,this.storeButton=new e("#store",{background:{left:160}}),this.storeButton.onClick(function(t,e){app.toggleStore()}),game.storeButton=this.storeButton,app.toggleStore=function(){game&&game.ready&&game.storeHandler.show()},$(document).bind("mousedown",function(t){if(2===t.button)return!1}),$(document).bind("mouseup",function(t){if(2===t.button&&game.ready)return!1}),$("#game")),a=(t.on("touchstart",function(t){game.playerClick=!1;var e=this.offsetParent.offsetLeft,n=this.offsetParent.offsetTop;i=~~((t.touches[0].pageX-e)*game.renderer.gameZoom),r=~~((t.touches[0].pageY-n)*game.renderer.gameZoom),app.setMouseCoordinates(i,r),game.started&&game.movecursor()}),t.on("touchmove",function(t){}),t.on("touchend",function(t){}),t.on("click touchend",function(t){game.click()}),t.mousemove(function(t){var e=t.offsetX,t=t.offsetY;app.setMouseCoordinates(e,t),game.started&&game.updateCursor()}),$(document).keyup(function(t){a(t,t.which,!1)}),function(t,e,n){if(game.player&&game.started&&!$("#chatbox").hasClass("active"))switch(e){case Types.Keys.LEFT:case Types.Keys.A:case Types.Keys.KEYPAD_4:game.player.move(Types.Orientations.LEFT,n);break;case Types.Keys.RIGHT:case Types.Keys.D:case Types.Keys.KEYPAD_6:game.player.move(Types.Orientations.RIGHT,n);break;case Types.Keys.UP:case Types.Keys.W:case Types.Keys.KEYPAD_8:game.player.move(Types.Orientations.UP,n);break;case Types.Keys.DOWN:case Types.Keys.S:case Types.Keys.KEYPAD_2:game.player.move(Types.Orientations.DOWN,n)}});$(document).keydown(function(t){var e=t.which;$("#chatinput");if(!$("#dropDialog").is(":visible")&&(e===Types.Keys.ENTER&&($("#chatbox").hasClass("active")?app.hideChat():app.showChat()),a(t,t.which,!0),game.player&&game.started&&!$("#chatbox").hasClass("active")))switch(e){case Types.Keys.T:game.playerTargetClosestEntity(1);break;case Types.Keys.Y:game.playerTargetClosestEntity(-1);break;case Types.Keys.SPACE:game.makePlayerInteractNextTo();break;case Types.Keys.KEY_1:$("#shortcut0").trigger("click");break;case Types.Keys.KEY_2:$("#shortcut1").trigger("click");break;case Types.Keys.KEY_3:$("#shortcut2").trigger("click");break;case Types.Keys.KEY_4:$("#shortcut3").trigger("click");break;case Types.Keys.KEY_5:$("#shortcut4").trigger("click");break;case Types.Keys.KEY_6:$("#shortcut5").trigger("click");break;case Types.Keys.KEY_7:$("#shortcut6").trigger("click");break;case Types.Keys.KEY_8:$("#shortcut7").trigger("click")}}),$("#chatinput").keydown(function(t){var e;if(!t.repeat)return t=t.which,e=$("#chatinput"),$(this).attr("placeholder"),13===t?(""!==e.val()?(game.player&&game.say(e.val()),e.val(""),app.hideChat(),$("#foreground").focus()):app.hideChat(),!1):27===t?(app.hideChat(),!1):void 0}),$("#chatinput").focus(function(t){var e=$(this).attr("placeholder");Detect.isFirefoxAndroid()||$(this).val(e),$(this).val()===e&&this.setSelectionRange(0,0)}),$("#dropAccept").click(function(t){var e,n=parseInt($("#dropCount").val());0<n&&(-1==app.inventoryNumber?((e=game.player.gold[0])<n&&(n=e),game.client.sendGold(0,n,1)):-2==app.inventoryNumber?((e=game.player.gold[1])<n&&(n=e),game.client.sendGold(1,n,0)):(n>game.inventoryHandler.inventory[app.inventoryNumber]&&(n=game.inventoryHandler.inventory[app.inventoryNumber]),game.client.sendItemSlot([3,0,app.inventoryNumber,n]),game.inventoryHandler.inventory[app.inventoryNumber]-=n,0===game.inventoryHandler.inventory[app.inventoryNumber]&&(game.inventoryHandler.inventory[app.inventoryNumber]=null))),setTimeout(function(){app.hideDropDialog()},100)}),$("#dropCancel").click(function(t){setTimeout(function(){app.hideDropDialog()},100)}),$("#auctionSellAccept").click(function(t){try{var e=parseInt($("#auctionSellCount").val());0<e&&(game.client.sendAuctionSell(app.inventoryNumber,e),game.inventoryHandler.inventory[app.inventoryNumber]=null)}catch(t){}setTimeout(function(){app.hideAuctionSellDialog()},100)}),$("#auctionSellCancel").click(function(t){setTimeout(function(){app.hideAuctionSellDialog()},100)}),$("#nameinput").focusin(function(){$("#name-tooltip").addClass("visible")}),$("#nameinput").focusout(function(){$("#name-tooltip").removeClass("visible")}),$("#nameinput").keypress(function(t){$("#name-tooltip").removeClass("visible")}),$(document).bind("keydown",function(t){var t=t.which,e=$("#chatinput");if(13===t)return game.started?(e.focus(),!1):$("#user_window").is(":visible")?($("input").blur(),app.tryUserAction(1),!1):$("#player_window").is(":visible")?($("input").blur(),$("#player_create_form").is(":visible")?app.tryPlayerAction(4):$("#player_load").is(":visible")&&app.tryPlayerAction(3),!1):void 0}),game.renderer.tablet&&$("body").addClass("tablet")}),$("#healthbar").bind("mousedown",function(t){if(2===t.button)return!1}),$("#healthbar").bind("mouseup",function(t){if(2===t.button)return game.autoEattingHandler&&(clearInterval(game.autoEattingHandler),$("#hpguide").css("display","none")),!1}),$("#hpguide").bind("mousedown",function(t){if(2===t.button)return!1}),$("#hpguide").bind("mouseup",function(t){if(2===t.button)return game.autoEattingHandler&&(clearInterval(game.autoEattingHandler),$("#hpguide").css("display","none")),!1}),document.addEventListener("DOMContentLoaded",function(){screen.lockOrientation&&screen.lockOrientation("landscape")}),"undefined"==typeof console&&(console={});return app})}),!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(t.document)return e(t);throw new Error("jQuery requires a window with a document")}:e(t)}("undefined"!=typeof window?window:this,function(x,$){"use strict";function v(t){return"function"==typeof t&&"number"!=typeof t.nodeType}function m(t){return null!=t&&t===t.window}var t=[],S=x.document,B=Object.getPrototypeOf,o=t.slice,R=t.concat,j=t.push,H=t.indexOf,F={},q=F.toString,z=F.hasOwnProperty,K=z.toString,U=K.call(Object),g={},G={type:!0,src:!0,nonce:!0,noModule:!0};function W(t,e,n){var i,r,a=(n=n||S).createElement("script");if(a.text=t,e)for(i in G)(r=e[i]||e.getAttribute&&e.getAttribute(i))&&a.setAttribute(i,r);n.head.appendChild(a).parentNode.removeChild(a)}function f(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?F[q.call(t)]||"object":typeof t}var T=function(t,e){return new T.fn.init(t,e)},Y=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function X(t){var e=!!t&&"length"in t&&t.length,n=f(t);return!v(t)&&!m(t)&&("array"===n||0===e||"number"==typeof e&&0<e&&e-1 in t)}T.fn=T.prototype={jquery:"3.4.1",constructor:T,length:0,toArray:function(){return o.call(this)},get:function(t){return null==t?o.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){t=T.merge(this.constructor(),t);return t.prevObject=this,t},each:function(t){return T.each(this,t)},map:function(n){return this.pushStack(T.map(this,function(t,e){return n.call(t,e,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,t=+t+(t<0?e:0);return this.pushStack(0<=t&&t<e?[this[t]]:[])},end:function(){return this.prevObject||this.constructor()},push:j,sort:t.sort,splice:t.splice},T.extend=T.fn.extend=function(){var t,e,n,i,r,a=arguments[0]||{},s=1,o=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===o&&(a=this,s--);s<o;s++)if(null!=(t=arguments[s]))for(e in t)n=t[e],"__proto__"!==e&&a!==n&&(l&&n&&(T.isPlainObject(n)||(i=Array.isArray(n)))?(r=a[e],r=i&&!Array.isArray(r)?[]:i||T.isPlainObject(r)?r:{},i=!1,a[e]=T.extend(l,r,n)):void 0!==n&&(a[e]=n));return a},T.extend({expando:"jQuery"+("3.4.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){return!(!t||"[object Object]"!==q.call(t)||(t=B(t))&&("function"!=typeof(t=z.call(t,"constructor")&&t.constructor)||K.call(t)!==U))},isEmptyObject:function(t){for(var e in t)return!1;return!0},globalEval:function(t,e){W(t,{nonce:e&&e.nonce})},each:function(t,e){var n,i=0;if(X(t))for(n=t.length;i<n&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},trim:function(t){return null==t?"":(t+"").replace(Y,"")},makeArray:function(t,e){e=e||[];return null!=t&&(X(Object(t))?T.merge(e,"string"==typeof t?[t]:t):j.call(e,t)),e},inArray:function(t,e,n){return null==e?-1:H.call(e,t,n)},merge:function(t,e){for(var n=+e.length,i=0,r=t.length;i<n;i++)t[r++]=e[i];return t.length=r,t},grep:function(t,e,n){for(var i=[],r=0,a=t.length,s=!n;r<a;r++)!e(t[r],r)!=s&&i.push(t[r]);return i},map:function(t,e,n){var i,r,a=0,s=[];if(X(t))for(i=t.length;a<i;a++)null!=(r=e(t[a],a,n))&&s.push(r);else for(a in t)null!=(r=e(t[a],a,n))&&s.push(r);return R.apply([],s)},guid:1,support:g}),"function"==typeof Symbol&&(T.fn[Symbol.iterator]=t[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){F["[object "+e+"]"]=e.toLowerCase()});function i(t,e,n){for(var i=[],r=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&T(t).is(n))break;i.push(t)}return i}function V(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}var t=function($){function u(t,e,n){var i="0x"+e-65536;return i!=i||n?e:i<0?String.fromCharCode(65536+i):String.fromCharCode(i>>10|55296,1023&i|56320)}function B(t,e){return e?"\0"===t?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}function R(){x()}var t,d,k,a,j,p,H,F,w,l,c,x,S,n,T,f,i,r,m,_="sizzle"+ +new Date,g=$.document,I=0,q=0,z=D(),K=D(),U=D(),y=D(),G=function(t,e){return t===e&&(c=!0),0},W={}.hasOwnProperty,e=[],Y=e.pop,X=e.push,E=e.push,V=e.slice,v=function(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1},Q="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",s="[\\x20\\t\\r\\n\\f]",o="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",Z="\\["+s+"*("+o+")(?:"+s+"*([*^$|!~]?=)"+s+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+o+"))|)"+s+"*\\]",J=":("+o+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Z+")*)|.*)\\)|)",tt=new RegExp(s+"+","g"),b=new RegExp("^"+s+"+|((?:^|[^\\\\])(?:\\\\.)*)"+s+"+$","g"),et=new RegExp("^"+s+"*,"+s+"*"),nt=new RegExp("^"+s+"*([>+~]|"+s+")"+s+"*"),it=new RegExp(s+"|>"),rt=new RegExp(J),at=new RegExp("^"+o+"$"),C={ID:new RegExp("^#("+o+")"),CLASS:new RegExp("^\\.("+o+")"),TAG:new RegExp("^("+o+"|[*])"),ATTR:new RegExp("^"+Z),PSEUDO:new RegExp("^"+J),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+s+"*(even|odd|(([+-]|)(\\d*)n|)"+s+"*(?:([+-]|)"+s+"*(\\d+)|))"+s+"*\\)|)","i"),bool:new RegExp("^(?:"+Q+")$","i"),needsContext:new RegExp("^"+s+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+s+"*((?:-\\d)?\\d*)"+s+"*\\)|)(?=[^-]|$)","i")},st=/HTML$/i,ot=/^(?:input|select|textarea|button)$/i,lt=/^h\d$/i,h=/^[^{]+\{\s*\[native \w/,ct=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ht=/[+~]/,A=new RegExp("\\\\([\\da-f]{1,6}"+s+"?|("+s+")|.)","ig"),ut=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,dt=vt(function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{E.apply(e=V.call(g.childNodes),g.childNodes),e[g.childNodes.length].nodeType}catch(t){E={apply:e.length?function(t,e){X.apply(t,V.call(e))}:function(t,e){for(var n=t.length,i=0;t[n++]=e[i++];);t.length=n-1}}}function M(t,e,n,i){var r,a,s,o,l,c,h=e&&e.ownerDocument,u=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==u&&9!==u&&11!==u)return n;if(!i&&((e?e.ownerDocument||e:g)!==S&&x(e),e=e||S,T)){if(11!==u&&(o=ct.exec(t)))if(r=o[1]){if(9===u){if(!(c=e.getElementById(r)))return n;if(c.id===r)return n.push(c),n}else if(h&&(c=h.getElementById(r))&&m(e,c)&&c.id===r)return n.push(c),n}else{if(o[2])return E.apply(n,e.getElementsByTagName(t)),n;if((r=o[3])&&d.getElementsByClassName&&e.getElementsByClassName)return E.apply(n,e.getElementsByClassName(r)),n}if(d.qsa&&!y[t+" "]&&(!f||!f.test(t))&&(1!==u||"object"!==e.nodeName.toLowerCase())){if(c=t,h=e,1===u&&it.test(t)){for((s=e.getAttribute("id"))?s=s.replace(ut,B):e.setAttribute("id",s=_),a=(l=p(t)).length;a--;)l[a]="#"+s+" "+L(l[a]);c=l.join(","),h=ht.test(t)&&gt(e.parentNode)||e}try{return E.apply(n,h.querySelectorAll(c)),n}catch(e){y(t,!0)}finally{s===_&&e.removeAttribute("id")}}}return F(t.replace(b,"$1"),e,n,i)}function D(){var i=[];return function t(e,n){return i.push(e+" ")>k.cacheLength&&delete t[i.shift()],t[e+" "]=n}}function N(t){return t[_]=!0,t}function O(t){var e=S.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e)}}function pt(t,e){for(var n=t.split("|"),i=n.length;i--;)k.attrHandle[n[i]]=e}function ft(t,e){var n=e&&t,i=n&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function mt(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&dt(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function P(s){return N(function(a){return a=+a,N(function(t,e){for(var n,i=s([],t.length,a),r=i.length;r--;)t[n=i[r]]&&(t[n]=!(e[n]=t[n]))})})}function gt(t){return t&&void 0!==t.getElementsByTagName&&t}for(t in d=M.support={},j=M.isXML=function(t){var e=t.namespaceURI,t=(t.ownerDocument||t).documentElement;return!st.test(e||t&&t.nodeName||"HTML")},x=M.setDocument=function(t){var t=t?t.ownerDocument||t:g;return t!==S&&9===t.nodeType&&t.documentElement&&(n=(S=t).documentElement,T=!j(S),g!==S&&(t=S.defaultView)&&t.top!==t&&(t.addEventListener?t.addEventListener("unload",R,!1):t.attachEvent&&t.attachEvent("onunload",R)),d.attributes=O(function(t){return t.className="i",!t.getAttribute("className")}),d.getElementsByTagName=O(function(t){return t.appendChild(S.createComment("")),!t.getElementsByTagName("*").length}),d.getElementsByClassName=h.test(S.getElementsByClassName),d.getById=O(function(t){return n.appendChild(t).id=_,!S.getElementsByName||!S.getElementsByName(_).length}),d.getById?(k.filter.ID=function(t){var e=t.replace(A,u);return function(t){return t.getAttribute("id")===e}},k.find.ID=function(t,e){if(void 0!==e.getElementById&&T)return(e=e.getElementById(t))?[e]:[]}):(k.filter.ID=function(t){var e=t.replace(A,u);return function(t){t=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return t&&t.value===e}},k.find.ID=function(t,e){if(void 0!==e.getElementById&&T){var n,i,r,a=e.getElementById(t);if(a){if((n=a.getAttributeNode("id"))&&n.value===t)return[a];for(r=e.getElementsByName(t),i=0;a=r[i++];)if((n=a.getAttributeNode("id"))&&n.value===t)return[a]}return[]}}),k.find.TAG=d.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):d.qsa?e.querySelectorAll(t):void 0}:function(t,e){var n,i=[],r=0,a=e.getElementsByTagName(t);if("*"!==t)return a;for(;n=a[r++];)1===n.nodeType&&i.push(n);return i},k.find.CLASS=d.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&T)return e.getElementsByClassName(t)},i=[],f=[],(d.qsa=h.test(S.querySelectorAll))&&(O(function(t){n.appendChild(t).innerHTML="<a id='"+_+"'></a><select id='"+_+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&f.push("[*^$]="+s+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||f.push("\\["+s+"*(?:value|"+Q+")"),t.querySelectorAll("[id~="+_+"-]").length||f.push("~="),t.querySelectorAll(":checked").length||f.push(":checked"),t.querySelectorAll("a#"+_+"+*").length||f.push(".#.+[+~]")}),O(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=S.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&f.push("name"+s+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&f.push(":enabled",":disabled"),n.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&f.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),f.push(",.*:")})),(d.matchesSelector=h.test(r=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.msMatchesSelector))&&O(function(t){d.disconnectedMatch=r.call(t,"*"),r.call(t,"[s!='']:x"),i.push("!=",J)}),f=f.length&&new RegExp(f.join("|")),i=i.length&&new RegExp(i.join("|")),t=h.test(n.compareDocumentPosition),m=t||h.test(n.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,e=e&&e.parentNode;return t===e||!(!e||1!==e.nodeType||!(n.contains?n.contains(e):t.compareDocumentPosition&&16&t.compareDocumentPosition(e)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},G=t?function(t,e){var n;return t===e?(c=!0,0):!t.compareDocumentPosition-!e.compareDocumentPosition||(1&(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!d.sortDetached&&e.compareDocumentPosition(t)===n?t===S||t.ownerDocument===g&&m(g,t)?-1:e===S||e.ownerDocument===g&&m(g,e)?1:l?v(l,t)-v(l,e):0:4&n?-1:1)}:function(t,e){if(t===e)return c=!0,0;var n,i=0,r=t.parentNode,a=e.parentNode,s=[t],o=[e];if(!r||!a)return t===S?-1:e===S?1:r?-1:a?1:l?v(l,t)-v(l,e):0;if(r===a)return ft(t,e);for(n=t;n=n.parentNode;)s.unshift(n);for(n=e;n=n.parentNode;)o.unshift(n);for(;s[i]===o[i];)i++;return i?ft(s[i],o[i]):s[i]===g?-1:o[i]===g?1:0}),S},M.matches=function(t,e){return M(t,null,null,e)},M.matchesSelector=function(t,e){if((t.ownerDocument||t)!==S&&x(t),d.matchesSelector&&T&&!y[e+" "]&&(!i||!i.test(e))&&(!f||!f.test(e)))try{var n=r.call(t,e);if(n||d.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){y(e,!0)}return 0<M(e,S,null,[t]).length},M.contains=function(t,e){return(t.ownerDocument||t)!==S&&x(t),m(t,e)},M.attr=function(t,e){(t.ownerDocument||t)!==S&&x(t);var n=k.attrHandle[e.toLowerCase()],n=n&&W.call(k.attrHandle,e.toLowerCase())?n(t,e,!T):void 0;return void 0!==n?n:d.attributes||!T?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},M.escape=function(t){return(t+"").replace(ut,B)},M.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},M.uniqueSort=function(t){var e,n=[],i=0,r=0;if(c=!d.detectDuplicates,l=!d.sortStable&&t.slice(0),t.sort(G),c){for(;e=t[r++];)e===t[r]&&(i=n.push(r));for(;i--;)t.splice(n[i],1)}return l=null,t},a=M.getText=function(t){var e,n="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=a(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i++];)n+=a(e);return n},(k=M.selectors={cacheLength:50,createPseudo:N,match:C,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(A,u),t[3]=(t[3]||t[4]||t[5]||"").replace(A,u),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||M.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&M.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return C.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&rt.test(n)&&(e=(e=p(n,!0))&&n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(A,u).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=z[t+" "];return e||(e=new RegExp("(^|"+s+")"+t+"("+s+"|$)"))&&z(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(t){t=M.attr(t,e);return null==t?"!="===n:!n||(t+="","="===n?t===i:"!="===n?t!==i:"^="===n?i&&0===t.indexOf(i):"*="===n?i&&-1<t.indexOf(i):"$="===n?i&&t.slice(-i.length)===i:"~="===n?-1<(" "+t.replace(tt," ")+" ").indexOf(i):"|="===n&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(f,t,e,m,g){var y="nth"!==f.slice(0,3),v="last"!==f.slice(-4),b="of-type"===t;return 1===m&&0===g?function(t){return!!t.parentNode}:function(t,e,n){var i,r,a,s,o,l,c=y!=v?"nextSibling":"previousSibling",h=t.parentNode,u=b&&t.nodeName.toLowerCase(),d=!n&&!b,p=!1;if(h){if(y){for(;c;){for(s=t;s=s[c];)if(b?s.nodeName.toLowerCase()===u:1===s.nodeType)return!1;l=c="only"===f&&!l&&"nextSibling"}return!0}if(l=[v?h.firstChild:h.lastChild],v&&d){for(p=(o=(i=(r=(a=(s=h)[_]||(s[_]={}))[s.uniqueID]||(a[s.uniqueID]={}))[f]||[])[0]===I&&i[1])&&i[2],s=o&&h.childNodes[o];s=++o&&s&&s[c]||(p=o=0,l.pop());)if(1===s.nodeType&&++p&&s===t){r[f]=[I,o,p];break}}else if(!1===(p=d?o=(i=(r=(a=(s=t)[_]||(s[_]={}))[s.uniqueID]||(a[s.uniqueID]={}))[f]||[])[0]===I&&i[1]:p))for(;(s=++o&&s&&s[c]||(p=o=0,l.pop()))&&((b?s.nodeName.toLowerCase()!==u:1!==s.nodeType)||!++p||(d&&((r=(a=s[_]||(s[_]={}))[s.uniqueID]||(a[s.uniqueID]={}))[f]=[I,p]),s!==t)););return(p-=g)===m||p%m==0&&0<=p/m}}},PSEUDO:function(t,a){var e,s=k.pseudos[t]||k.setFilters[t.toLowerCase()]||M.error("unsupported pseudo: "+t);return s[_]?s(a):1<s.length?(e=[t,t,"",a],k.setFilters.hasOwnProperty(t.toLowerCase())?N(function(t,e){for(var n,i=s(t,a),r=i.length;r--;)t[n=v(t,i[r])]=!(e[n]=i[r])}):function(t){return s(t,0,e)}):s}},pseudos:{not:N(function(t){var i=[],r=[],o=H(t.replace(b,"$1"));return o[_]?N(function(t,e,n,i){for(var r,a=o(t,null,i,[]),s=t.length;s--;)(r=a[s])&&(t[s]=!(e[s]=r))}):function(t,e,n){return i[0]=t,o(i,null,n,r),i[0]=null,!r.pop()}}),has:N(function(e){return function(t){return 0<M(e,t).length}}),contains:N(function(e){return e=e.replace(A,u),function(t){return-1<(t.textContent||a(t)).indexOf(e)}}),lang:N(function(n){return at.test(n||"")||M.error("unsupported lang: "+n),n=n.replace(A,u).toLowerCase(),function(t){var e;do{if(e=T?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(e=e.toLowerCase())===n||0===e.indexOf(n+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var e=$.location&&$.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===n},focus:function(t){return t===S.activeElement&&(!S.hasFocus||S.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:mt(!1),disabled:mt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!k.pseudos.empty(t)},header:function(t){return lt.test(t.nodeName)},input:function(t){return ot.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(t=t.getAttribute("type"))||"text"===t.toLowerCase())},first:P(function(){return[0]}),last:P(function(t,e){return[e-1]}),eq:P(function(t,e,n){return[n<0?n+e:n]}),even:P(function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t}),odd:P(function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t}),lt:P(function(t,e,n){for(var i=n<0?n+e:e<n?e:n;0<=--i;)t.push(i);return t}),gt:P(function(t,e,n){for(var i=n<0?n+e:n;++i<e;)t.push(i);return t})}}).pseudos.nth=k.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})k.pseudos[t]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(t);for(t in{submit:!0,reset:!0})k.pseudos[t]=function(n){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===n}}(t);function yt(){}function L(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e].value;return i}function vt(s,t,e){var o=t.dir,l=t.next,c=l||o,h=e&&"parentNode"===c,u=q++;return t.first?function(t,e,n){for(;t=t[o];)if(1===t.nodeType||h)return s(t,e,n);return!1}:function(t,e,n){var i,r,a=[I,u];if(n){for(;t=t[o];)if((1===t.nodeType||h)&&s(t,e,n))return!0}else for(;t=t[o];)if(1===t.nodeType||h)if(r=(r=t[_]||(t[_]={}))[t.uniqueID]||(r[t.uniqueID]={}),l&&l===t.nodeName.toLowerCase())t=t[o]||t;else{if((i=r[c])&&i[0]===I&&i[1]===u)return a[2]=i[2];if((r[c]=a)[2]=s(t,e,n))return!0}return!1}}function bt(r){return 1<r.length?function(t,e,n){for(var i=r.length;i--;)if(!r[i](t,e,n))return!1;return!0}:r[0]}function kt(t,e,n,i,r){for(var a,s=[],o=0,l=t.length,c=null!=e;o<l;o++)!(a=t[o])||n&&!n(a,i,r)||(s.push(a),c&&e.push(o));return s}function wt(t){for(var i,e,n,r=t.length,a=k.relative[t[0].type],s=a||k.relative[" "],o=a?1:0,l=vt(function(t){return t===i},s,!0),c=vt(function(t){return-1<v(i,t)},s,!0),h=[function(t,e,n){t=!a&&(n||e!==w)||((i=e).nodeType?l:c)(t,e,n);return i=null,t}];o<r;o++)if(e=k.relative[t[o].type])h=[vt(bt(h),e)];else{if((e=k.filter[t[o].type].apply(null,t[o].matches))[_]){for(n=++o;n<r&&!k.relative[t[n].type];n++);return function t(p,f,m,g,y,e){return g&&!g[_]&&(g=t(g)),y&&!y[_]&&(y=t(y,e)),N(function(t,e,n,i){var r,a,s,o=[],l=[],c=e.length,h=t||function(t,e,n){for(var i=0,r=e.length;i<r;i++)M(t,e[i],n);return n}(f||"*",n.nodeType?[n]:n,[]),u=!p||!t&&f?h:kt(h,o,p,n,i),d=m?y||(t?p:c||g)?[]:e:u;if(m&&m(u,d,n,i),g)for(r=kt(d,l),g(r,[],n,i),a=r.length;a--;)(s=r[a])&&(d[l[a]]=!(u[l[a]]=s));if(t){if(y||p){if(y){for(r=[],a=d.length;a--;)(s=d[a])&&r.push(u[a]=s);y(null,d=[],r,i)}for(a=d.length;a--;)(s=d[a])&&-1<(r=y?v(t,s):o[a])&&(t[r]=!(e[r]=s))}}else d=kt(d===e?d.splice(c,d.length):d),y?y(null,e,d,i):E.apply(e,d)})}(1<o&&bt(h),1<o&&L(t.slice(0,o-1).concat({value:" "===t[o-2].type?"*":""})).replace(b,"$1"),e,o<n&&wt(t.slice(o,n)),n<r&&wt(t=t.slice(n)),n<r&&L(t))}h.push(e)}return bt(h)}return yt.prototype=k.filters=k.pseudos,k.setFilters=new yt,p=M.tokenize=function(t,e){var n,i,r,a,s,o,l,c=K[t+" "];if(c)return e?0:c.slice(0);for(s=t,o=[],l=k.preFilter;s;){for(a in n&&!(i=et.exec(s))||(i&&(s=s.slice(i[0].length)||s),o.push(r=[])),n=!1,(i=nt.exec(s))&&(n=i.shift(),r.push({value:n,type:i[0].replace(b," ")}),s=s.slice(n.length)),k.filter)!(i=C[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),r.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return e?s.length:s?M.error(t):K(t,o).slice(0)},H=M.compile=function(t,e){var n,g,y,v,b,i,r=[],a=[],s=U[t+" "];if(!s){for(n=(e=e||p(t)).length;n--;)((s=wt(e[n]))[_]?r:a).push(s);(s=U(t,(v=0<(y=r).length,b=0<(g=a).length,i=function(t,e,n,i,r){var a,s,o,l=0,c="0",h=t&&[],u=[],d=w,p=t||b&&k.find.TAG("*",r),f=I+=null==d?1:Math.random()||.1,m=p.length;for(r&&(w=e===S||e||r);c!==m&&null!=(a=p[c]);c++){if(b&&a){for(s=0,e||a.ownerDocument===S||(x(a),n=!T);o=g[s++];)if(o(a,e||S,n)){i.push(a);break}r&&(I=f)}v&&((a=!o&&a)&&l--,t)&&h.push(a)}if(l+=c,v&&c!==l){for(s=0;o=y[s++];)o(h,u,e,n);if(t){if(0<l)for(;c--;)h[c]||u[c]||(u[c]=Y.call(i));u=kt(u)}E.apply(i,u),r&&!t&&0<u.length&&1<l+y.length&&M.uniqueSort(i)}return r&&(I=f,w=d),h},v?N(i):i))).selector=t}return s},F=M.select=function(t,e,n,i){var r,a,s,o,l,c="function"==typeof t&&t,h=!i&&p(t=c.selector||t);if(n=n||[],1===h.length){if(2<(a=h[0]=h[0].slice(0)).length&&"ID"===(s=a[0]).type&&9===e.nodeType&&T&&k.relative[a[1].type]){if(!(e=(k.find.ID(s.matches[0].replace(A,u),e)||[])[0]))return n;c&&(e=e.parentNode),t=t.slice(a.shift().value.length)}for(r=C.needsContext.test(t)?0:a.length;r--&&(s=a[r],!k.relative[o=s.type]);)if((l=k.find[o])&&(i=l(s.matches[0].replace(A,u),ht.test(a[0].type)&&gt(e.parentNode)||e))){if(a.splice(r,1),t=i.length&&L(a))break;return E.apply(n,i),n}}return(c||H(t,h))(i,e,!T,n,!e||ht.test(t)&&gt(e.parentNode)||e),n},d.sortStable=_.split("").sort(G).join("")===_,d.detectDuplicates=!!c,x(),d.sortDetached=O(function(t){return 1&t.compareDocumentPosition(S.createElement("fieldset"))}),O(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||pt("type|href|height|width",function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),d.attributes&&O(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||pt("value",function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),O(function(t){return null==t.getAttribute("disabled")})||pt(Q,function(t,e,n){if(!n)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),M}(x),Q=(T.find=t,T.expr=t.selectors,T.expr[":"]=T.expr.pseudos,T.uniqueSort=T.unique=t.uniqueSort,T.text=t.getText,T.isXMLDoc=t.isXML,T.contains=t.contains,T.escapeSelector=t.escape,T.expr.match.needsContext);function l(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var Z=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function J(t,n,i){return v(n)?T.grep(t,function(t,e){return!!n.call(t,e,t)!==i}):n.nodeType?T.grep(t,function(t){return t===n!==i}):"string"!=typeof n?T.grep(t,function(t){return-1<H.call(n,t)!==i}):T.filter(n,t,i)}T.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?T.find.matchesSelector(i,t)?[i]:[]:T.find.matches(t,T.grep(e,function(t){return 1===t.nodeType}))},T.fn.extend({find:function(t){var e,n,i=this.length,r=this;if("string"!=typeof t)return this.pushStack(T(t).filter(function(){for(e=0;e<i;e++)if(T.contains(r[e],this))return!0}));for(n=this.pushStack([]),e=0;e<i;e++)T.find(t,r[e],n);return 1<i?T.uniqueSort(n):n},filter:function(t){return this.pushStack(J(this,t||[],!1))},not:function(t){return this.pushStack(J(this,t||[],!0))},is:function(t){return!!J(this,"string"==typeof t&&Q.test(t)?T(t):t||[],!1).length}});var tt,et=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,nt=((T.fn.init=function(t,e,n){if(t){if(n=n||tt,"string"!=typeof t)return t.nodeType?(this[0]=t,this.length=1,this):v(t)?void 0!==n.ready?n.ready(t):t(T):T.makeArray(t,this);if(!(i="<"===t[0]&&">"===t[t.length-1]&&3<=t.length?[null,t,null]:et.exec(t))||!i[1]&&e)return(!e||e.jquery?e||n:this.constructor(e)).find(t);if(i[1]){if(e=e instanceof T?e[0]:e,T.merge(this,T.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:S,!0)),Z.test(i[1])&&T.isPlainObject(e))for(var i in e)v(this[i])?this[i](e[i]):this.attr(i,e[i])}else(n=S.getElementById(i[2]))&&(this[0]=n,this.length=1)}return this}).prototype=T.fn,tt=T(S),/^(?:parents|prev(?:Until|All))/),it={children:!0,contents:!0,next:!0,prev:!0};function rt(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}T.fn.extend({has:function(t){var e=T(t,this),n=e.length;return this.filter(function(){for(var t=0;t<n;t++)if(T.contains(this,e[t]))return!0})},closest:function(t,e){var n,i=0,r=this.length,a=[],s="string"!=typeof t&&T(t);if(!Q.test(t))for(;i<r;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(s?-1<s.index(n):1===n.nodeType&&T.find.matchesSelector(n,t))){a.push(n);break}return this.pushStack(1<a.length?T.uniqueSort(a):a)},index:function(t){return t?"string"==typeof t?H.call(T(t),this[0]):H.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),T.each({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(t){return i(t,"parentNode")},parentsUntil:function(t,e,n){return i(t,"parentNode",n)},next:function(t){return rt(t,"nextSibling")},prev:function(t){return rt(t,"previousSibling")},nextAll:function(t){return i(t,"nextSibling")},prevAll:function(t){return i(t,"previousSibling")},nextUntil:function(t,e,n){return i(t,"nextSibling",n)},prevUntil:function(t,e,n){return i(t,"previousSibling",n)},siblings:function(t){return V((t.parentNode||{}).firstChild,t)},children:function(t){return V(t.firstChild)},contents:function(t){return void 0!==t.contentDocument?t.contentDocument:(l(t,"template")&&(t=t.content||t),T.merge([],t.childNodes))}},function(i,r){T.fn[i]=function(t,e){var n=T.map(this,r,t);return(e="Until"!==i.slice(-5)?t:e)&&"string"==typeof e&&(n=T.filter(e,n)),1<this.length&&(it[i]||T.uniqueSort(n),nt.test(i))&&n.reverse(),this.pushStack(n)}});var _=/[^\x20\t\r\n\f]+/g;function h(t){return t}function at(t){throw t}function st(t,e,n,i){var r;try{t&&v(r=t.promise)?r.call(t).done(e).fail(n):t&&v(r=t.then)?r.call(t,e,n):e.apply(void 0,[t].slice(i))}catch(t){n.apply(void 0,[t])}}T.Callbacks=function(i){var t,n;i="string"==typeof i?(t=i,n={},T.each(t.match(_)||[],function(t,e){n[e]=!0}),n):T.extend({},i);function r(){for(o=o||i.once,s=a=!0;c.length;h=-1)for(e=c.shift();++h<l.length;)!1===l[h].apply(e[0],e[1])&&i.stopOnFalse&&(h=l.length,e=!1);i.memory||(e=!1),a=!1,o&&(l=e?[]:"")}var a,e,s,o,l=[],c=[],h=-1,u={add:function(){return l&&(e&&!a&&(h=l.length-1,c.push(e)),function n(t){T.each(t,function(t,e){v(e)?i.unique&&u.has(e)||l.push(e):e&&e.length&&"string"!==f(e)&&n(e)})}(arguments),e)&&!a&&r(),this},remove:function(){return T.each(arguments,function(t,e){for(var n;-1<(n=T.inArray(e,l,n));)l.splice(n,1),n<=h&&h--}),this},has:function(t){return t?-1<T.inArray(t,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return o=c=[],l=e="",this},disabled:function(){return!l},lock:function(){return o=c=[],e||a||(l=e=""),this},locked:function(){return!!o},fireWith:function(t,e){return o||(e=[t,(e=e||[]).slice?e.slice():e],c.push(e),a)||r(),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!s}};return u},T.extend({Deferred:function(t){var a=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],r="pending",s={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(t){return s.then(null,t)},pipe:function(){var r=arguments;return T.Deferred(function(i){T.each(a,function(t,e){var n=v(r[e[4]])&&r[e[4]];o[e[1]](function(){var t=n&&n.apply(this,arguments);t&&v(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[e[0]+"With"](this,n?[t]:arguments)})}),r=null}).promise()},then:function(e,n,i){var l=0;function c(r,a,s,o){return function(){function t(){var t,e;if(!(r<l)){if((t=s.apply(n,i))===a.promise())throw new TypeError("Thenable self-resolution");e=t&&("object"==typeof t||"function"==typeof t)&&t.then,v(e)?o?e.call(t,c(l,a,h,o),c(l,a,at,o)):(l++,e.call(t,c(l,a,h,o),c(l,a,at,o),c(l,a,h,a.notifyWith))):(s!==h&&(n=void 0,i=[t]),(o||a.resolveWith)(n,i))}}var n=this,i=arguments,e=o?t:function(){try{t()}catch(t){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(t,e.stackTrace),l<=r+1&&(s!==at&&(n=void 0,i=[t]),a.rejectWith(n,i))}};r?e():(T.Deferred.getStackHook&&(e.stackTrace=T.Deferred.getStackHook()),x.setTimeout(e))}}return T.Deferred(function(t){a[0][3].add(c(0,t,v(i)?i:h,t.notifyWith)),a[1][3].add(c(0,t,v(e)?e:h)),a[2][3].add(c(0,t,v(n)?n:at))}).promise()},promise:function(t){return null!=t?T.extend(t,s):s}},o={};return T.each(a,function(t,e){var n=e[2],i=e[5];s[e[1]]=n.add,i&&n.add(function(){r=i},a[3-t][2].disable,a[3-t][3].disable,a[0][2].lock,a[0][3].lock),n.add(e[3].fire),o[e[0]]=function(){return o[e[0]+"With"](this===o?void 0:this,arguments),this},o[e[0]+"With"]=n.fireWith}),s.promise(o),t&&t.call(o,o),o},when:function(t){function e(e){return function(t){r[e]=this,a[e]=1<arguments.length?o.call(arguments):t,--n||s.resolveWith(r,a)}}var n=arguments.length,i=n,r=Array(i),a=o.call(arguments),s=T.Deferred();if(n<=1&&(st(t,s.done(e(i)).resolve,s.reject,!n),"pending"===s.state()||v(a[i]&&a[i].then)))return s.then();for(;i--;)st(a[i],e(i),s.reject);return s.promise()}});var ot=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/,lt=(T.Deferred.exceptionHook=function(t,e){x.console&&x.console.warn&&t&&ot.test(t.name)&&x.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},T.readyException=function(t){x.setTimeout(function(){throw t})},T.Deferred());function ct(){S.removeEventListener("DOMContentLoaded",ct),x.removeEventListener("load",ct),T.ready()}T.fn.ready=function(t){return lt.then(t).catch(function(t){T.readyException(t)}),this},T.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--T.readyWait:T.isReady)||(T.isReady=!0)!==t&&0<--T.readyWait||lt.resolveWith(S,[T])}}),T.ready.then=lt.then,"complete"===S.readyState||"loading"!==S.readyState&&!S.documentElement.doScroll?x.setTimeout(T.ready):(S.addEventListener("DOMContentLoaded",ct),x.addEventListener("load",ct));function u(t,e,n,i,r,a,s){var o=0,l=t.length,c=null==n;if("object"===f(n))for(o in r=!0,n)u(t,e,o,n[o],!0,a,s);else if(void 0!==i&&(r=!0,v(i)||(s=!0),e=c?s?(e.call(t,i),null):(c=e,function(t,e,n){return c.call(T(t),n)}):e))for(;o<l;o++)e(t[o],n,s?i:i.call(t[o],o,e(t[o],n)));return r?t:c?e.call(t):l?e(t[0],n):a}var ht=/^-ms-/,ut=/-([a-z])/g;function dt(t,e){return e.toUpperCase()}function b(t){return t.replace(ht,"ms-").replace(ut,dt)}function pt(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType}function e(){this.expando=T.expando+e.uid++}e.uid=1,e.prototype={cache:function(t){var e=t[this.expando];return e||(e={},pt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var i,r=this.cache(t);if("string"==typeof e)r[b(e)]=n;else for(i in e)r[b(i)]=e[i];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][b(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,i=t[this.expando];if(void 0!==i){if(void 0!==e){n=(e=Array.isArray(e)?e.map(b):(e=b(e))in i?[e]:e.match(_)||[]).length;for(;n--;)delete i[e[n]]}void 0!==e&&!T.isEmptyObject(i)||(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){t=t[this.expando];return void 0!==t&&!T.isEmptyObject(t)}};var y=new e,c=new e,ft=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,mt=/[A-Z]/g;function gt(t,e,n){var i,r;if(void 0===n&&1===t.nodeType)if(i="data-"+e.replace(mt,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(i))){try{n="true"===(r=n)||"false"!==r&&("null"===r?null:r===+r+""?+r:ft.test(r)?JSON.parse(r):r)}catch(t){}c.set(t,e,n)}else n=void 0;return n}T.extend({hasData:function(t){return c.hasData(t)||y.hasData(t)},data:function(t,e,n){return c.access(t,e,n)},removeData:function(t,e){c.remove(t,e)},_data:function(t,e,n){return y.access(t,e,n)},_removeData:function(t,e){y.remove(t,e)}}),T.fn.extend({data:function(n,t){var e,i,r,a=this[0],s=a&&a.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){c.set(this,n)}):u(this,function(t){var e;if(a&&void 0===t)return void 0!==(e=c.get(a,n))||void 0!==(e=gt(a,n))?e:void 0;this.each(function(){c.set(this,n,t)})},null,t,1<arguments.length,null,!0);if(this.length&&(r=c.get(a),1===a.nodeType)&&!y.get(a,"hasDataAttrs")){for(e=s.length;e--;)s[e]&&0===(i=s[e].name).indexOf("data-")&&(i=b(i.slice(5)),gt(a,i,r[i]));y.set(a,"hasDataAttrs",!0)}return r},removeData:function(t){return this.each(function(){c.remove(this,t)})}}),T.extend({queue:function(t,e,n){var i;if(t)return i=y.get(t,e=(e||"fx")+"queue"),n&&(!i||Array.isArray(n)?i=y.access(t,e,T.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=T.queue(t,e),i=n.length,r=n.shift(),a=T._queueHooks(t,e);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===e&&n.unshift("inprogress"),delete a.stop,r.call(t,function(){T.dequeue(t,e)},a)),!i&&a&&a.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return y.get(t,n)||y.access(t,n,{empty:T.Callbacks("once memory").add(function(){y.remove(t,[e+"queue",n])})})}}),T.fn.extend({queue:function(e,n){var t=2;return"string"!=typeof e&&(n=e,e="fx",t--),arguments.length<t?T.queue(this[0],e):void 0===n?this:this.each(function(){var t=T.queue(this,e,n);T._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&T.dequeue(this,e)})},dequeue:function(t){return this.each(function(){T.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){function n(){--r||a.resolveWith(s,[s])}var i,r=1,a=T.Deferred(),s=this,o=this.length;for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=y.get(s[o],t+"queueHooks"))&&i.empty&&(r++,i.empty.add(n));return n(),a.promise(e)}});function yt(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&w(t)&&"none"===T.css(t,"display")}function vt(t,e,n,i){var r,a={};for(r in e)a[r]=t.style[r],t.style[r]=e[r];for(r in n=n.apply(t,i||[]),e)t.style[r]=a[r];return n}var t=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,d=new RegExp("^(?:([+-])=|)("+t+")([a-z%]*)$","i"),p=["Top","Right","Bottom","Left"],k=S.documentElement,w=function(t){return T.contains(t.ownerDocument,t)},bt={composed:!0};k.getRootNode&&(w=function(t){return T.contains(t.ownerDocument,t)||t.getRootNode(bt)===t.ownerDocument});function kt(t,e,n,i){var r,a,s=20,o=i?function(){return i.cur()}:function(){return T.css(t,e,"")},l=o(),c=n&&n[3]||(T.cssNumber[e]?"":"px"),h=t.nodeType&&(T.cssNumber[e]||"px"!==c&&+l)&&d.exec(T.css(t,e));if(h&&h[3]!==c){for(c=c||h[3],h=+(l/=2)||1;s--;)T.style(t,e,h+c),(1-a)*(1-(a=o()/l||.5))<=0&&(s=0),h/=a;T.style(t,e,(h*=2)+c),n=n||[]}return n&&(h=+h||+l||0,r=n[1]?h+(n[1]+1)*n[2]:+n[2],i)&&(i.unit=c,i.start=h,i.end=r),r}var wt={};function I(t,e){for(var n,i,r,a,s,o,l=[],c=0,h=t.length;c<h;c++)(i=t[c]).style&&(n=i.style.display,e?("none"===n&&(l[c]=y.get(i,"display")||null,l[c]||(i.style.display="")),""===i.style.display&&yt(i)&&(l[c]=(o=a=r=void 0,a=i.ownerDocument,s=i.nodeName,(o=wt[s])||(r=a.body.appendChild(a.createElement(s)),o=T.css(r,"display"),r.parentNode.removeChild(r),wt[s]=o="none"===o?"block":o)))):"none"!==n&&(l[c]="none",y.set(i,"display",n)));for(c=0;c<h;c++)null!=l[c]&&(t[c].style.display=l[c]);return t}T.fn.extend({show:function(){return I(this,!0)},hide:function(){return I(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){yt(this)?T(this).show():T(this).hide()})}});var xt=/^(?:checkbox|radio)$/i,St=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Tt=/^$|^module$|\/(?:java|ecma)script/i,E={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function C(t,e){var n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&l(t,e)?T.merge([t],n):n}function _t(t,e){for(var n=0,i=t.length;n<i;n++)y.set(t[n],"globalEval",!e||y.get(e[n],"globalEval"))}E.optgroup=E.option,E.tbody=E.tfoot=E.colgroup=E.caption=E.thead,E.th=E.td;var It=/<|&#?\w+;/;function Et(t,e,n,i,r){for(var a,s,o,l,c,h=e.createDocumentFragment(),u=[],d=0,p=t.length;d<p;d++)if((a=t[d])||0===a)if("object"===f(a))T.merge(u,a.nodeType?[a]:a);else if(It.test(a)){for(s=s||h.appendChild(e.createElement("div")),o=(St.exec(a)||["",""])[1].toLowerCase(),o=E[o]||E._default,s.innerHTML=o[1]+T.htmlPrefilter(a)+o[2],c=o[0];c--;)s=s.lastChild;T.merge(u,s.childNodes),(s=h.firstChild).textContent=""}else u.push(e.createTextNode(a));for(h.textContent="",d=0;a=u[d++];)if(i&&-1<T.inArray(a,i))r&&r.push(a);else if(l=w(a),s=C(h.appendChild(a),"script"),l&&_t(s),n)for(c=0;a=s[c++];)Tt.test(a.type||"")&&n.push(a);return h}N=S.createDocumentFragment().appendChild(S.createElement("div")),(s=S.createElement("input")).setAttribute("type","radio"),s.setAttribute("checked","checked"),s.setAttribute("name","t"),N.appendChild(s),g.checkClone=N.cloneNode(!0).cloneNode(!0).lastChild.checked,N.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!N.cloneNode(!0).lastChild.defaultValue;var Ct=/^key/,At=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Mt=/^([^.]*)(?:\.(.+)|)/;function n(){return!0}function A(){return!1}function Dt(t,e){return t===function(){try{return S.activeElement}catch(t){}}()==("focus"===e)}function Nt(t,e,n,i,r,a){var s,o;if("object"==typeof e){for(o in"string"!=typeof n&&(i=i||n,n=void 0),e)Nt(t,o,n,i,e[o],a);return t}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=A;else if(!r)return t;return 1===a&&(s=r,(r=function(t){return T().off(t),s.apply(this,arguments)}).guid=s.guid||(s.guid=T.guid++)),t.each(function(){T.event.add(this,e,r,i,n)})}function Ot(t,r,a){a?(y.set(t,r,!1),T.event.add(t,r,{namespace:!1,handler:function(t){var e,n,i=y.get(this,r);if(1&t.isTrigger&&this[r]){if(i.length)(T.event.special[r]||{}).delegateType&&t.stopPropagation();else if(i=o.call(arguments),y.set(this,r,i),e=a(this,r),this[r](),i!==(n=y.get(this,r))||e?y.set(this,r,!1):n={},i!==n)return t.stopImmediatePropagation(),t.preventDefault(),n.value}else i.length&&(y.set(this,r,{value:T.event.trigger(T.extend(i[0],T.Event.prototype),i.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===y.get(t,r)&&T.event.add(t,r,n)}T.event={global:{},add:function(e,t,n,i,r){var a,s,o,l,c,h,u,d,p,f=y.get(e);if(f)for(n.handler&&(n=(a=n).handler,r=a.selector),r&&T.find.matchesSelector(k,r),n.guid||(n.guid=T.guid++),o=(o=f.events)||(f.events={}),s=(s=f.handle)||(f.handle=function(t){return void 0!==T&&T.event.triggered!==t.type?T.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(_)||[""]).length;l--;)u=p=(d=Mt.exec(t[l])||[])[1],d=(d[2]||"").split(".").sort(),u&&(c=T.event.special[u]||{},u=(r?c.delegateType:c.bindType)||u,c=T.event.special[u]||{},p=T.extend({type:u,origType:p,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&T.expr.match.needsContext.test(r),namespace:d.join(".")},a),(h=o[u])||((h=o[u]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(e,i,d,s))||e.addEventListener&&e.addEventListener(u,s),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),r?h.splice(h.delegateCount++,0,p):h.push(p),T.event.global[u]=!0)},remove:function(t,e,n,i,r){var a,s,o,l,c,h,u,d,p,f,m,g=y.hasData(t)&&y.get(t);if(g&&(l=g.events)){for(c=(e=(e||"").match(_)||[""]).length;c--;)if(p=m=(o=Mt.exec(e[c])||[])[1],f=(o[2]||"").split(".").sort(),p){for(u=T.event.special[p]||{},d=l[p=(i?u.delegateType:u.bindType)||p]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=a=d.length;a--;)h=d[a],!r&&m!==h.origType||n&&n.guid!==h.guid||o&&!o.test(h.namespace)||i&&i!==h.selector&&("**"!==i||!h.selector)||(d.splice(a,1),h.selector&&d.delegateCount--,u.remove&&u.remove.call(t,h));s&&!d.length&&(u.teardown&&!1!==u.teardown.call(t,f,g.handle)||T.removeEvent(t,p,g.handle),delete l[p])}else for(p in l)T.event.remove(t,p+e[c],n,i,!0);T.isEmptyObject(l)&&y.remove(t,"handle events")}},dispatch:function(t){var e,n,i,r,a,s=T.event.fix(t),o=new Array(arguments.length),t=(y.get(this,"events")||{})[s.type]||[],l=T.event.special[s.type]||{};for(o[0]=s,e=1;e<arguments.length;e++)o[e]=arguments[e];if(s.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,s)){for(a=T.event.handlers.call(this,s,t),e=0;(i=a[e++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!1!==r.namespace&&!s.rnamespace.test(r.namespace)||(s.handleObj=r,s.data=r.data,void 0!==(r=((T.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,o))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,s),s.result}},handlers:function(t,e){var n,i,r,a,s,o=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&1<=t.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(a=[],s={},n=0;n<l;n++)void 0===s[r=(i=e[n]).selector+" "]&&(s[r]=i.needsContext?-1<T(r,this).index(c):T.find(r,this,null,[c]).length),s[r]&&a.push(i);a.length&&o.push({elem:c,handlers:a})}return c=this,l<e.length&&o.push({elem:c,handlers:e.slice(l)}),o},addProp:function(e,t){Object.defineProperty(T.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(t){return t[T.expando]?t:new T.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){t=this||t;return xt.test(t.type)&&t.click&&l(t,"input")&&Ot(t,"click",n),!1},trigger:function(t){t=this||t;return xt.test(t.type)&&t.click&&l(t,"input")&&Ot(t,"click"),!0},_default:function(t){t=t.target;return xt.test(t.type)&&t.click&&l(t,"input")&&y.get(t,"click")||l(t,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},T.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},T.Event=function(t,e){if(!(this instanceof T.Event))return new T.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?n:A,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&T.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:A,isPropagationStopped:A,isImmediatePropagationStopped:A,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=n,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=n,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=n,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Ct.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&At.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},function(t,e){T.event.special[t]={setup:function(){return Ot(this,t,Dt),!1},trigger:function(){return Ot(this,t),!0},delegateType:e}}),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,r){T.event.special[t]={delegateType:r,bindType:r,handle:function(t){var e,n=t.relatedTarget,i=t.handleObj;return n&&(n===this||T.contains(this,n))||(t.type=i.origType,e=i.handler.apply(this,arguments),t.type=r),e}}}),T.fn.extend({on:function(t,e,n,i){return Nt(this,t,e,n,i)},one:function(t,e,n,i){return Nt(this,t,e,n,i,1)},off:function(t,e,n){var i,r;if(t&&t.preventDefault&&t.handleObj)i=t.handleObj,T(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);else{if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=A),this.each(function(){T.event.remove(this,t,n,e)});for(r in t)this.off(r,e,t[r])}return this}});var Pt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Lt=/<script|<style|<link/i,$t=/checked\s*(?:[^=]|=\s*.checked.)/i,Bt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Rt(t,e){return l(t,"table")&&l(11!==e.nodeType?e:e.firstChild,"tr")&&T(t).children("tbody")[0]||t}function jt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Ht(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Ft(t,e){var n,i,r,a,s,o;if(1===e.nodeType){if(y.hasData(t)&&(a=y.access(t),s=y.set(e,a),o=a.events))for(r in delete s.handle,s.events={},o)for(n=0,i=o[r].length;n<i;n++)T.event.add(e,r,o[r][n]);c.hasData(t)&&(a=c.access(t),s=T.extend({},a),c.set(e,s))}}function M(n,i,r,a){i=R.apply([],i);var t,e,s,o,l,c,h=0,u=n.length,d=u-1,p=i[0],f=v(p);if(f||1<u&&"string"==typeof p&&!g.checkClone&&$t.test(p))return n.each(function(t){var e=n.eq(t);f&&(i[0]=p.call(this,t,e.html())),M(e,i,r,a)});if(u&&(e=(t=Et(i,n[0].ownerDocument,!1,n,a)).firstChild,1===t.childNodes.length&&(t=e),e||a)){for(o=(s=T.map(C(t,"script"),jt)).length;h<u;h++)l=t,h!==d&&(l=T.clone(l,!0,!0),o)&&T.merge(s,C(l,"script")),r.call(n[h],l,h);if(o)for(c=s[s.length-1].ownerDocument,T.map(s,Ht),h=0;h<o;h++)l=s[h],Tt.test(l.type||"")&&!y.access(l,"globalEval")&&T.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?T._evalUrl&&!l.noModule&&T._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")}):W(l.textContent.replace(Bt,""),l,c))}return n}function qt(t,e,n){for(var i,r=e?T.filter(e,t):t,a=0;null!=(i=r[a]);a++)n||1!==i.nodeType||T.cleanData(C(i)),i.parentNode&&(n&&w(i)&&_t(C(i,"script")),i.parentNode.removeChild(i));return t}T.extend({htmlPrefilter:function(t){return t.replace(Pt,"<$1></$2>")},clone:function(t,e,n){var i,r,a,s,o,l,c,h=t.cloneNode(!0),u=w(t);if(!(g.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||T.isXMLDoc(t)))for(s=C(h),i=0,r=(a=C(t)).length;i<r;i++)o=a[i],"input"===(c=(l=s[i]).nodeName.toLowerCase())&&xt.test(o.type)?l.checked=o.checked:"input"!==c&&"textarea"!==c||(l.defaultValue=o.defaultValue);if(e)if(n)for(a=a||C(t),s=s||C(h),i=0,r=a.length;i<r;i++)Ft(a[i],s[i]);else Ft(t,h);return 0<(s=C(h,"script")).length&&_t(s,!u&&C(t,"script")),h},cleanData:function(t){for(var e,n,i,r=T.event.special,a=0;void 0!==(n=t[a]);a++)if(pt(n)){if(e=n[y.expando]){if(e.events)for(i in e.events)r[i]?T.event.remove(n,i):T.removeEvent(n,i,e.handle);n[y.expando]=void 0}n[c.expando]&&(n[c.expando]=void 0)}}}),T.fn.extend({detach:function(t){return qt(this,t,!0)},remove:function(t){return qt(this,t)},text:function(t){return u(this,function(t){return void 0===t?T.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return M(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Rt(this,t).appendChild(t)})},prepend:function(){return M(this,arguments,function(t){var e;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(e=Rt(this,t)).insertBefore(t,e.firstChild)})},before:function(){return M(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return M(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(T.cleanData(C(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return T.clone(this,t,e)})},html:function(t){return u(this,function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Lt.test(t)&&!E[(St.exec(t)||["",""])[1].toLowerCase()]){t=T.htmlPrefilter(t);try{for(;n<i;n++)1===(e=this[n]||{}).nodeType&&(T.cleanData(C(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var n=[];return M(this,arguments,function(t){var e=this.parentNode;T.inArray(this,n)<0&&(T.cleanData(C(this)),e)&&e.replaceChild(t,this)},n)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,s){T.fn[t]=function(t){for(var e,n=[],i=T(t),r=i.length-1,a=0;a<=r;a++)e=a===r?this:this.clone(!0),T(i[a])[s](e),j.apply(n,e.get());return this.pushStack(n)}});function zt(t){var e=t.ownerDocument.defaultView;return(e=e&&e.opener?e:x).getComputedStyle(t)}var Kt,Ut,Gt,Wt,Yt,Xt,r,Vt=new RegExp("^("+t+")(?!px)[a-z%]+$","i"),Qt=new RegExp(p.join("|"),"i");function Zt(t,e,n){var i,r,a=t.style;return(n=n||zt(t))&&(""!==(r=n.getPropertyValue(e)||n[e])||w(t)||(r=T.style(t,e)),!g.pixelBoxStyles())&&Vt.test(r)&&Qt.test(e)&&(t=a.width,e=a.minWidth,i=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=n.width,a.width=t,a.minWidth=e,a.maxWidth=i),void 0!==r?r+"":r}function Jt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}function te(){var t;r&&(Xt.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",r.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",k.appendChild(Xt).appendChild(r),t=x.getComputedStyle(r),Kt="1%"!==t.top,Yt=12===ee(t.marginLeft),r.style.right="60%",Wt=36===ee(t.right),Ut=36===ee(t.width),r.style.position="absolute",Gt=12===ee(r.offsetWidth/3),k.removeChild(Xt),r=null)}function ee(t){return Math.round(parseFloat(t))}Xt=S.createElement("div"),(r=S.createElement("div")).style&&(r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===r.style.backgroundClip,T.extend(g,{boxSizingReliable:function(){return te(),Ut},pixelBoxStyles:function(){return te(),Wt},pixelPosition:function(){return te(),Kt},reliableMarginLeft:function(){return te(),Yt},scrollboxSize:function(){return te(),Gt}}));var ne=["Webkit","Moz","ms"],ie=S.createElement("div").style,re={};function ae(t){return T.cssProps[t]||re[t]||(t in ie?t:re[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=ne.length;n--;)if((t=ne[n]+e)in ie)return t}(t)||t)}var se=/^(none|table(?!-c[ea]).+)/,oe=/^--/,le={position:"absolute",visibility:"hidden",display:"block"},ce={letterSpacing:"0",fontWeight:"400"};function he(t,e,n){var i=d.exec(e);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):e}function ue(t,e,n,i,r,a){var s="width"===e?1:0,o=0,l=0;if(n===(i?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(l+=T.css(t,n+p[s],!0,r)),i?("content"===n&&(l-=T.css(t,"padding"+p[s],!0,r)),"margin"!==n&&(l-=T.css(t,"border"+p[s]+"Width",!0,r))):(l+=T.css(t,"padding"+p[s],!0,r),"padding"!==n?l+=T.css(t,"border"+p[s]+"Width",!0,r):o+=T.css(t,"border"+p[s]+"Width",!0,r));return!i&&0<=a&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-a-l-o-.5))||0),l}function de(t,e,n){var i=zt(t),r=(!g.boxSizingReliable()||n)&&"border-box"===T.css(t,"boxSizing",!1,i),a=r,s=Zt(t,e,i),o="offset"+e[0].toUpperCase()+e.slice(1);if(Vt.test(s)){if(!n)return s;s="auto"}return(!g.boxSizingReliable()&&r||"auto"===s||!parseFloat(s)&&"inline"===T.css(t,"display",!1,i))&&t.getClientRects().length&&(r="border-box"===T.css(t,"boxSizing",!1,i),a=o in t)&&(s=t[o]),(s=parseFloat(s)||0)+ue(t,e,n||(r?"border":"content"),a,i,s)+"px"}function a(t,e,n,i,r){return new a.prototype.init(t,e,n,i,r)}T.extend({cssHooks:{opacity:{get:function(t,e){if(e)return""===(e=Zt(t,"opacity"))?"1":e}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,a,s,o=b(e),l=oe.test(e),c=t.style;if(l||(e=ae(o)),s=T.cssHooks[e]||T.cssHooks[o],void 0===n)return s&&"get"in s&&void 0!==(r=s.get(t,!1,i))?r:c[e];"string"==(a=typeof n)&&(r=d.exec(n))&&r[1]&&(n=kt(t,e,r),a="number"),null!=n&&n==n&&("number"!==a||l||(n+=r&&r[3]||(T.cssNumber[o]?"":"px")),g.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),s&&"set"in s&&void 0===(n=s.set(t,n,i))||(l?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,i){var r,a=b(e);return oe.test(e)||(e=ae(a)),"normal"===(r=void 0===(r=(a=T.cssHooks[e]||T.cssHooks[a])&&"get"in a?a.get(t,!0,n):r)?Zt(t,e,i):r)&&e in ce&&(r=ce[e]),(""===n||n)&&(a=parseFloat(r),!0===n||isFinite(a))?a||0:r}}),T.each(["height","width"],function(t,s){T.cssHooks[s]={get:function(t,e,n){if(e)return!se.test(T.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?de(t,s,n):vt(t,le,function(){return de(t,s,n)})},set:function(t,e,n){var i=zt(t),r=!g.scrollboxSize()&&"absolute"===i.position,a=(r||n)&&"border-box"===T.css(t,"boxSizing",!1,i),n=n?ue(t,s,n,a,i):0;return a&&r&&(n-=Math.ceil(t["offset"+s[0].toUpperCase()+s.slice(1)]-parseFloat(i[s])-ue(t,s,"border",!1,i)-.5)),n&&(a=d.exec(e))&&"px"!==(a[3]||"px")&&(t.style[s]=e,e=T.css(t,s)),he(0,e,n)}}}),T.cssHooks.marginLeft=Jt(g.reliableMarginLeft,function(t,e){if(e)return(parseFloat(Zt(t,"marginLeft"))||t.getBoundingClientRect().left-vt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),T.each({margin:"",padding:"",border:"Width"},function(r,a){T.cssHooks[r+a]={expand:function(t){for(var e=0,n={},i="string"==typeof t?t.split(" "):[t];e<4;e++)n[r+p[e]+a]=i[e]||i[e-2]||i[0];return n}},"margin"!==r&&(T.cssHooks[r+a].set=he)}),T.fn.extend({css:function(t,e){return u(this,function(t,e,n){var i,r,a={},s=0;if(Array.isArray(e)){for(i=zt(t),r=e.length;s<r;s++)a[e[s]]=T.css(t,e[s],!1,i);return a}return void 0!==n?T.style(t,e,n):T.css(t,e)},t,e,1<arguments.length)}}),((T.Tween=a).prototype={constructor:a,init:function(t,e,n,i,r,a){this.elem=t,this.prop=n,this.easing=r||T.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=a||(T.cssNumber[n]?"":"px")},cur:function(){var t=a.propHooks[this.prop];return(t&&t.get?t:a.propHooks._default).get(this)},run:function(t){var e,n=a.propHooks[this.prop];return this.options.duration?this.pos=e=T.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:a.propHooks._default).set(this),this}}).init.prototype=a.prototype,(a.propHooks={_default:{get:function(t){return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(t=T.css(t.elem,t.prop,""))&&"auto"!==t?t:0},set:function(t){T.fx.step[t.prop]?T.fx.step[t.prop](t):1!==t.elem.nodeType||!T.cssHooks[t.prop]&&null==t.elem.style[ae(t.prop)]?t.elem[t.prop]=t.now:T.style(t.elem,t.prop,t.now+t.unit)}}}).scrollTop=a.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},T.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},T.fx=a.prototype.init,T.fx.step={};var D,pe,s,N,fe=/^(?:toggle|show|hide)$/,me=/queueHooks$/;function ge(){pe&&(!1===S.hidden&&x.requestAnimationFrame?x.requestAnimationFrame(ge):x.setTimeout(ge,T.fx.interval),T.fx.tick())}function ye(){return x.setTimeout(function(){D=void 0}),D=Date.now()}function ve(t,e){var n,i=0,r={height:t};for(e=e?1:0;i<4;i+=2-e)r["margin"+(n=p[i])]=r["padding"+n]=t;return e&&(r.opacity=r.width=t),r}function be(t,e,n){for(var i,r=(O.tweeners[e]||[]).concat(O.tweeners["*"]),a=0,s=r.length;a<s;a++)if(i=r[a].call(n,e,t))return i}function O(r,t,e){var n,a,i,s,o,l,c,h=0,u=O.prefilters.length,d=T.Deferred().always(function(){delete p.elem}),p=function(){if(a)return!1;for(var t=D||ye(),t=Math.max(0,f.startTime+f.duration-t),e=1-(t/f.duration||0),n=0,i=f.tweens.length;n<i;n++)f.tweens[n].run(e);return d.notifyWith(r,[f,e,t]),e<1&&i?t:(i||d.notifyWith(r,[f,1,0]),d.resolveWith(r,[f]),!1)},f=d.promise({elem:r,props:T.extend({},t),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},e),originalProperties:t,originalOptions:e,startTime:D||ye(),duration:e.duration,tweens:[],createTween:function(t,e){e=T.Tween(r,f.opts,t,e,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(e),e},stop:function(t){var e=0,n=t?f.tweens.length:0;if(!a){for(a=!0;e<n;e++)f.tweens[e].run(1);t?(d.notifyWith(r,[f,1,0]),d.resolveWith(r,[f,t])):d.rejectWith(r,[f,t])}return this}}),m=f.props,g=m,y=f.opts.specialEasing;for(i in g)if(o=y[s=b(i)],l=g[i],Array.isArray(l)&&(o=l[1],l=g[i]=l[0]),i!==s&&(g[s]=l,delete g[i]),(c=T.cssHooks[s])&&"expand"in c)for(i in l=c.expand(l),delete g[s],l)i in g||(g[i]=l[i],y[i]=o);else y[s]=o;for(;h<u;h++)if(n=O.prefilters[h].call(f,r,m,f.opts))return v(n.stop)&&(T._queueHooks(f.elem,f.opts.queue).stop=n.stop.bind(n)),n;return T.map(m,be,f),v(f.opts.start)&&f.opts.start.call(r,f),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always),T.fx.timer(T.extend(p,{elem:r,anim:f,queue:f.opts.queue})),f}T.Animation=T.extend(O,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return kt(n.elem,t,d.exec(e),n),n}]},tweener:function(t,e){for(var n,i=0,r=(t=v(t)?(e=t,["*"]):t.match(_)).length;i<r;i++)n=t[i],O.tweeners[n]=O.tweeners[n]||[],O.tweeners[n].unshift(e)},prefilters:[function(t,e,n){var i,r,a,s,o,l,c,h="width"in e||"height"in e,u=this,d={},p=t.style,f=t.nodeType&&yt(t),m=y.get(t,"fxshow");for(i in n.queue||(null==(s=T._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,o=s.empty.fire,s.empty.fire=function(){s.unqueued||o()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,T.queue(t,"fx").length||s.empty.fire()})})),e)if(r=e[i],fe.test(r)){if(delete e[i],a=a||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;f=!0}d[i]=m&&m[i]||T.style(t,i)}if((l=!T.isEmptyObject(e))||!T.isEmptyObject(d))for(i in h&&1===t.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=m&&m.display)&&(c=y.get(t,"display")),"none"===(h=T.css(t,"display"))&&(c?h=c:(I([t],!0),c=t.style.display||c,h=T.css(t,"display"),I([t]))),"inline"===h||"inline-block"===h&&null!=c)&&"none"===T.css(t,"float")&&(l||(u.done(function(){p.display=c}),null==c&&(h=p.display,c="none"===h?"":h)),p.display="inline-block"),n.overflow&&(p.overflow="hidden",u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),l=!1,d)l||(m?"hidden"in m&&(f=m.hidden):m=y.access(t,"fxshow",{display:c}),a&&(m.hidden=!f),f&&I([t],!0),u.done(function(){for(i in f||I([t]),y.remove(t,"fxshow"),d)T.style(t,i,d[i])})),l=be(f?m[i]:0,i,u),i in m||(m[i]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?O.prefilters.unshift(t):O.prefilters.push(t)}}),T.speed=function(t,e,n){var i=t&&"object"==typeof t?T.extend({},t):{complete:n||!n&&e||v(t)&&t,duration:t,easing:n&&e||e&&!v(e)&&e};return T.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in T.fx.speeds?i.duration=T.fx.speeds[i.duration]:i.duration=T.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){v(i.old)&&i.old.call(this),i.queue&&T.dequeue(this,i.queue)},i},T.fn.extend({fadeTo:function(t,e,n,i){return this.filter(yt).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(e,t,n,i){function r(){var t=O(this,T.extend({},e),s);(a||y.get(this,"finish"))&&t.stop(!0)}var a=T.isEmptyObject(e),s=T.speed(t,n,i);return r.finish=r,a||!1===s.queue?this.each(r):this.queue(s.queue,r)},stop:function(r,t,a){function s(t){var e=t.stop;delete t.stop,e(a)}return"string"!=typeof r&&(a=t,t=r,r=void 0),t&&!1!==r&&this.queue(r||"fx",[]),this.each(function(){var t=!0,e=null!=r&&r+"queueHooks",n=T.timers,i=y.get(this);if(e)i[e]&&i[e].stop&&s(i[e]);else for(e in i)i[e]&&i[e].stop&&me.test(e)&&s(i[e]);for(e=n.length;e--;)n[e].elem!==this||null!=r&&n[e].queue!==r||(n[e].anim.stop(a),t=!1,n.splice(e,1));!t&&a||T.dequeue(this,r)})},finish:function(s){return!1!==s&&(s=s||"fx"),this.each(function(){var t,e=y.get(this),n=e[s+"queue"],i=e[s+"queueHooks"],r=T.timers,a=n?n.length:0;for(e.finish=!0,T.queue(this,s,[]),i&&i.stop&&i.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===s&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<a;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete e.finish})}}),T.each(["toggle","show","hide"],function(t,i){var r=T.fn[i];T.fn[i]=function(t,e,n){return null==t||"boolean"==typeof t?r.apply(this,arguments):this.animate(ve(i,!0),t,e,n)}}),T.each({slideDown:ve("show"),slideUp:ve("hide"),slideToggle:ve("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,i){T.fn[t]=function(t,e,n){return this.animate(i,t,e,n)}}),T.timers=[],T.fx.tick=function(){var t,e=0,n=T.timers;for(D=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||T.fx.stop(),D=void 0},T.fx.timer=function(t){T.timers.push(t),T.fx.start()},T.fx.interval=13,T.fx.start=function(){pe||(pe=!0,ge())},T.fx.stop=function(){pe=null},T.fx.speeds={slow:600,fast:200,_default:400},T.fn.delay=function(i,t){return i=T.fx&&T.fx.speeds[i]||i,this.queue(t=t||"fx",function(t,e){var n=x.setTimeout(t,i);e.stop=function(){x.clearTimeout(n)}})},s=S.createElement("input"),N=S.createElement("select").appendChild(S.createElement("option")),s.type="checkbox",g.checkOn=""!==s.value,g.optSelected=N.selected,(s=S.createElement("input")).value="t",s.type="radio",g.radioValue="t"===s.value;var ke,we=T.expr.attrHandle,xe=(T.fn.extend({attr:function(t,e){return u(this,T.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){T.removeAttr(this,t)})}}),T.extend({attr:function(t,e,n){var i,r,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===t.getAttribute?T.prop(t,e,n):(1===a&&T.isXMLDoc(t)||(r=T.attrHooks[e.toLowerCase()]||(T.expr.match.bool.test(e)?ke:void 0)),void 0!==n?null===n?void T.removeAttr(t,e):r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:(t.setAttribute(e,n+""),n):!(r&&"get"in r&&null!==(i=r.get(t,e)))&&null==(i=T.find.attr(t,e))?void 0:i)},attrHooks:{type:{set:function(t,e){var n;if(!g.radioValue&&"radio"===e&&l(t,"input"))return n=t.value,t.setAttribute("type",e),n&&(t.value=n),e}}},removeAttr:function(t,e){var n,i=0,r=e&&e.match(_);if(r&&1===t.nodeType)for(;n=r[i++];)t.removeAttribute(n)}}),ke={set:function(t,e,n){return!1===e?T.removeAttr(t,n):t.setAttribute(n,n),n}},T.each(T.expr.match.bool.source.match(/\w+/g),function(t,e){var s=we[e]||T.find.attr;we[e]=function(t,e,n){var i,r,a=e.toLowerCase();return n||(r=we[a],we[a]=i,i=null!=s(t,e,n)?a:null,we[a]=r),i}}),/^(?:input|select|textarea|button)$/i),Se=/^(?:a|area)$/i;function P(t){return(t.match(_)||[]).join(" ")}function L(t){return t.getAttribute&&t.getAttribute("class")||""}function Te(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(_)||[]}T.fn.extend({prop:function(t,e){return u(this,T.prop,t,e,1<arguments.length)},removeProp:function(t){return this.each(function(){delete this[T.propFix[t]||t]})}}),T.extend({prop:function(t,e,n){var i,r,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&T.isXMLDoc(t)||(e=T.propFix[e]||e,r=T.propHooks[e]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:t[e]=n:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=T.find.attr(t,"tabindex");return e?parseInt(e,10):xe.test(t.nodeName)||Se.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(T.propHooks.selected={get:function(t){t=t.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(t){t=t.parentNode;t&&(t.selectedIndex,t.parentNode)&&t.parentNode.selectedIndex}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){T.propFix[this.toLowerCase()]=this}),T.fn.extend({addClass:function(e){var t,n,i,r,a,s,o=0;if(v(e))return this.each(function(t){T(this).addClass(e.call(this,t,L(this)))});if((t=Te(e)).length)for(;n=this[o++];)if(s=L(n),i=1===n.nodeType&&" "+P(s)+" "){for(a=0;r=t[a++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");s!==(s=P(i))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,i,r,a,s,o=0;if(v(e))return this.each(function(t){T(this).removeClass(e.call(this,t,L(this)))});if(!arguments.length)return this.attr("class","");if((t=Te(e)).length)for(;n=this[o++];)if(s=L(n),i=1===n.nodeType&&" "+P(s)+" "){for(a=0;r=t[a++];)for(;-1<i.indexOf(" "+r+" ");)i=i.replace(" "+r+" "," ");s!==(s=P(i))&&n.setAttribute("class",s)}return this},toggleClass:function(r,e){var a=typeof r,s="string"==a||Array.isArray(r);return"boolean"==typeof e&&s?e?this.addClass(r):this.removeClass(r):v(r)?this.each(function(t){T(this).toggleClass(r.call(this,t,L(this),e),e)}):this.each(function(){var t,e,n,i;if(s)for(e=0,n=T(this),i=Te(r);t=i[e++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==r&&"boolean"!=a||((t=L(this))&&y.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",!t&&!1!==r&&y.get(this,"__className__")||""))})},hasClass:function(t){for(var e,n=0,i=" "+t+" ";e=this[n++];)if(1===e.nodeType&&-1<(" "+P(L(e))+" ").indexOf(i))return!0;return!1}});function _e(t){t.stopPropagation()}var Ie=/\r/g,Ee=(T.fn.extend({val:function(e){var n,t,i,r=this[0];return arguments.length?(i=v(e),this.each(function(t){1===this.nodeType&&(null==(t=i?e.call(this,t,T(this).val()):e)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=T.map(t,function(t){return null==t?"":t+""})),(n=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,t,"value")||(this.value=t))})):r?(n=T.valHooks[r.type]||T.valHooks[r.nodeName.toLowerCase()])&&"get"in n&&void 0!==(t=n.get(r,"value"))?t:"string"==typeof(t=r.value)?t.replace(Ie,""):null==t?"":t:void 0}}),T.extend({valHooks:{option:{get:function(t){var e=T.find.attr(t,"value");return null!=e?e:P(T.text(t))}},select:{get:function(t){for(var e,n=t.options,i=t.selectedIndex,r="select-one"===t.type,a=r?null:[],s=r?i+1:n.length,o=i<0?s:r?i:0;o<s;o++)if(((e=n[o]).selected||o===i)&&!e.disabled&&(!e.parentNode.disabled||!l(e.parentNode,"optgroup"))){if(e=T(e).val(),r)return e;a.push(e)}return a},set:function(t,e){for(var n,i,r=t.options,a=T.makeArray(e),s=r.length;s--;)((i=r[s]).selected=-1<T.inArray(T.valHooks.option.get(i),a))&&(n=!0);return n||(t.selectedIndex=-1),a}}}}),T.each(["radio","checkbox"],function(){T.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=-1<T.inArray(T(t).val(),e)}},g.checkOn||(T.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),g.focusin="onfocusin"in x,/^(?:focusinfocus|focusoutblur)$/),Ce=(T.extend(T.event,{trigger:function(t,e,n,i){var r,a,s,o,l,c,h,u=[n||S],d=z.call(t,"type")?t.type:t,p=z.call(t,"namespace")?t.namespace.split("."):[],f=h=a=n=n||S;if(3!==n.nodeType&&8!==n.nodeType&&!Ee.test(d+T.event.triggered)&&(-1<d.indexOf(".")&&(d=(p=d.split(".")).shift(),p.sort()),o=d.indexOf(":")<0&&"on"+d,(t=t[T.expando]?t:new T.Event(d,"object"==typeof t&&t)).isTrigger=i?2:3,t.namespace=p.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:T.makeArray(e,[t]),c=T.event.special[d]||{},i||!c.trigger||!1!==c.trigger.apply(n,e))){if(!i&&!c.noBubble&&!m(n)){for(s=c.delegateType||d,Ee.test(s+d)||(f=f.parentNode);f;f=f.parentNode)u.push(f),a=f;a===(n.ownerDocument||S)&&u.push(a.defaultView||a.parentWindow||x)}for(r=0;(f=u[r++])&&!t.isPropagationStopped();)h=f,t.type=1<r?s:c.bindType||d,(l=(y.get(f,"events")||{})[t.type]&&y.get(f,"handle"))&&l.apply(f,e),(l=o&&f[o])&&l.apply&&pt(f)&&(t.result=l.apply(f,e),!1===t.result)&&t.preventDefault();return t.type=d,i||t.isDefaultPrevented()||c._default&&!1!==c._default.apply(u.pop(),e)||!pt(n)||o&&v(n[d])&&!m(n)&&((a=n[o])&&(n[o]=null),T.event.triggered=d,t.isPropagationStopped()&&h.addEventListener(d,_e),n[d](),t.isPropagationStopped()&&h.removeEventListener(d,_e),T.event.triggered=void 0,a)&&(n[o]=a),t.result}},simulate:function(t,e,n){n=T.extend(new T.Event,n,{type:t,isSimulated:!0});T.event.trigger(n,null,e)}}),T.fn.extend({trigger:function(t,e){return this.each(function(){T.event.trigger(t,e,this)})},triggerHandler:function(t,e){var n=this[0];if(n)return T.event.trigger(t,e,n,!0)}}),g.focusin||T.each({focus:"focusin",blur:"focusout"},function(n,i){function r(t){T.event.simulate(i,t.target,T.event.fix(t))}T.event.special[i]={setup:function(){var t=this.ownerDocument||this,e=y.access(t,i);e||t.addEventListener(n,r,!0),y.access(t,i,(e||0)+1)},teardown:function(){var t=this.ownerDocument||this,e=y.access(t,i)-1;e?y.access(t,i,e):(t.removeEventListener(n,r,!0),y.remove(t,i))}}}),x.location),Ae=Date.now(),Me=/\?/,De=(T.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new x.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||T.error("Invalid XML: "+t),e},/\[\]$/),Ne=/\r?\n/g,Oe=/^(?:submit|button|image|reset|file)$/i,Pe=/^(?:input|select|textarea|keygen)/i;T.param=function(t,e){function n(t,e){e=v(e)?e():e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==e?"":e)}var i,r=[];if(null==t)return"";if(Array.isArray(t)||t.jquery&&!T.isPlainObject(t))T.each(t,function(){n(this.name,this.value)});else for(i in t)!function n(i,t,r,a){if(Array.isArray(t))T.each(t,function(t,e){r||De.test(i)?a(i,e):n(i+"["+("object"==typeof e&&null!=e?t:"")+"]",e,r,a)});else if(r||"object"!==f(t))a(i,t);else for(var e in t)n(i+"["+e+"]",t[e],r,a)}(i,t[i],e,n);return r.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=T.prop(this,"elements");return t?T.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!T(this).is(":disabled")&&Pe.test(this.nodeName)&&!Oe.test(t)&&(this.checked||!xt.test(t))}).map(function(t,e){var n=T(this).val();return null==n?null:Array.isArray(n)?T.map(n,function(t){return{name:e.name,value:t.replace(Ne,"\r\n")}}):{name:e.name,value:n.replace(Ne,"\r\n")}}).get()}});var Le=/%20/g,$e=/#.*$/,Be=/([?&])_=[^&]*/,Re=/^(.*?):[ \t]*([^\r\n]*)$/gm,je=/^(?:GET|HEAD)$/,He=/^\/\//,Fe={},qe={},ze="*/".concat("*"),Ke=S.createElement("a");function Ue(a){return function(t,e){"string"!=typeof t&&(e=t,t="*");var n,i=0,r=t.toLowerCase().match(_)||[];if(v(e))for(;n=r[i++];)"+"===n[0]?(n=n.slice(1)||"*",(a[n]=a[n]||[]).unshift(e)):(a[n]=a[n]||[]).push(e)}}function Ge(e,i,r,a){var s={},o=e===qe;function l(t){var n;return s[t]=!0,T.each(e[t]||[],function(t,e){e=e(i,r,a);return"string"!=typeof e||o||s[e]?o?!(n=e):void 0:(i.dataTypes.unshift(e),l(e),!1)}),n}return l(i.dataTypes[0])||!s["*"]&&l("*")}function We(t,e){var n,i,r=T.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((r[n]?t:i=i||{})[n]=e[n]);return i&&T.extend(!0,t,i),t}Ke.href=Ce.href,T.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ce.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ce.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ze,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":T.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?We(We(t,T.ajaxSettings),e):We(T.ajaxSettings,t)},ajaxPrefilter:Ue(Fe),ajaxTransport:Ue(qe),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0);var l,c,h,n,u,d,p,i,r,f=T.ajaxSetup({},e=e||{}),m=f.context||f,g=f.context&&(m.nodeType||m.jquery)?T(m):T.event,y=T.Deferred(),v=T.Callbacks("once memory"),b=f.statusCode||{},a={},s={},o="canceled",k={readyState:0,getResponseHeader:function(t){var e;if(d){if(!n)for(n={};e=Re.exec(h);)n[e[1].toLowerCase()+" "]=(n[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=n[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return d?h:null},setRequestHeader:function(t,e){return null==d&&(t=s[t.toLowerCase()]=s[t.toLowerCase()]||t,a[t]=e),this},overrideMimeType:function(t){return null==d&&(f.mimeType=t),this},statusCode:function(t){if(t)if(d)k.always(t[k.status]);else for(var e in t)b[e]=[b[e],t[e]];return this},abort:function(t){t=t||o;return l&&l.abort(t),w(0,t),this}};if(y.promise(k),f.url=((t||f.url||Ce.href)+"").replace(He,Ce.protocol+"//"),f.type=e.method||e.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(_)||[""],null==f.crossDomain){r=S.createElement("a");try{r.href=f.url,r.href=r.href,f.crossDomain=Ke.protocol+"//"+Ke.host!=r.protocol+"//"+r.host}catch(t){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=T.param(f.data,f.traditional)),Ge(Fe,f,e,k),!d){for(i in(p=T.event&&f.global)&&0==T.active++&&T.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!je.test(f.type),c=f.url.replace($e,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Le,"+")):(r=f.url.slice(c.length),f.data&&(f.processData||"string"==typeof f.data)&&(c+=(Me.test(c)?"&":"?")+f.data,delete f.data),!1===f.cache&&(c=c.replace(Be,"$1"),r=(Me.test(c)?"&":"?")+"_="+Ae+++r),f.url=c+r),f.ifModified&&(T.lastModified[c]&&k.setRequestHeader("If-Modified-Since",T.lastModified[c]),T.etag[c])&&k.setRequestHeader("If-None-Match",T.etag[c]),(f.data&&f.hasContent&&!1!==f.contentType||e.contentType)&&k.setRequestHeader("Content-Type",f.contentType),k.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+ze+"; q=0.01":""):f.accepts["*"]),f.headers)k.setRequestHeader(i,f.headers[i]);if(f.beforeSend&&(!1===f.beforeSend.call(m,k,f)||d))return k.abort();if(o="abort",v.add(f.complete),k.done(f.success),k.fail(f.error),l=Ge(qe,f,e,k)){if(k.readyState=1,p&&g.trigger("ajaxSend",[k,f]),d)return k;f.async&&0<f.timeout&&(u=x.setTimeout(function(){k.abort("timeout")},f.timeout));try{d=!1,l.send(a,w)}catch(t){if(d)throw t;w(-1,t)}}else w(-1,"No Transport")}return k;function w(t,e,n,i){var r,a,s,o=e;d||(d=!0,u&&x.clearTimeout(u),l=void 0,h=i||"",k.readyState=0<t?4:0,i=200<=t&&t<300||304===t,n&&(s=function(t,e,n){for(var i,r,a,s,o=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(r in o)if(o[r]&&o[r].test(i)){l.unshift(r);break}if(l[0]in n)a=l[0];else{for(r in n){if(!l[0]||t.converters[r+" "+l[0]]){a=r;break}s=s||r}a=a||s}if(a)return a!==l[0]&&l.unshift(a),n[a]}(f,k,n)),s=function(t,e,n,i){var r,a,s,o,l,c={},h=t.dataTypes.slice();if(h[1])for(s in t.converters)c[s.toLowerCase()]=t.converters[s];for(a=h.shift();a;)if(t.responseFields[a]&&(n[t.responseFields[a]]=e),!l&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=a,a=h.shift())if("*"===a)a=l;else if("*"!==l&&l!==a){if(!(s=c[l+" "+a]||c["* "+a]))for(r in c)if((o=r.split(" "))[1]===a&&(s=c[l+" "+o[0]]||c["* "+o[0]])){!0===s?s=c[r]:!0!==c[r]&&(a=o[0],h.unshift(o[1]));break}if(!0!==s)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+a}}}return{state:"success",data:e}}(f,s,k,i),i?(f.ifModified&&((n=k.getResponseHeader("Last-Modified"))&&(T.lastModified[c]=n),n=k.getResponseHeader("etag"))&&(T.etag[c]=n),204===t||"HEAD"===f.type?o="nocontent":304===t?o="notmodified":(o=s.state,r=s.data,i=!(a=s.error))):(a=o,!t&&o||(o="error",t<0&&(t=0))),k.status=t,k.statusText=(e||o)+"",i?y.resolveWith(m,[r,o,k]):y.rejectWith(m,[k,o,a]),k.statusCode(b),b=void 0,p&&g.trigger(i?"ajaxSuccess":"ajaxError",[k,f,i?r:a]),v.fireWith(m,[k,o]),p&&(g.trigger("ajaxComplete",[k,f]),--T.active||T.event.trigger("ajaxStop")))}},getJSON:function(t,e,n){return T.get(t,e,n,"json")},getScript:function(t,e){return T.get(t,void 0,e,"script")}}),T.each(["get","post"],function(t,r){T[r]=function(t,e,n,i){return v(e)&&(i=i||n,n=e,e=void 0),T.ajax(T.extend({url:t,type:r,dataType:i,data:e,success:n},T.isPlainObject(t)&&t))}}),T._evalUrl=function(t,e){return T.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){T.globalEval(t,e)}})},T.fn.extend({wrapAll:function(t){return this[0]&&(v(t)&&(t=t.call(this[0])),t=T(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(t){T(this).wrapInner(n.call(this,t))}):this.each(function(){var t=T(this),e=t.contents();e.length?e.wrapAll(n):t.append(n)})},wrap:function(e){var n=v(e);return this.each(function(t){T(this).wrapAll(n?e.call(this,t):e)})},unwrap:function(t){return this.parent(t).not("body").each(function(){T(this).replaceWith(this.childNodes)}),this}}),T.expr.pseudos.hidden=function(t){return!T.expr.pseudos.visible(t)},T.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},T.ajaxSettings.xhr=function(){try{return new x.XMLHttpRequest}catch(t){}};var Ye={0:200,1223:204},Xe=T.ajaxSettings.xhr();g.cors=!!Xe&&"withCredentials"in Xe,g.ajax=Xe=!!Xe,T.ajaxTransport(function(r){var a,s;if(g.cors||Xe&&!r.crossDomain)return{send:function(t,e){var n,i=r.xhr();if(i.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(n in r.xhrFields)i[n]=r.xhrFields[n];for(n in r.mimeType&&i.overrideMimeType&&i.overrideMimeType(r.mimeType),r.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)i.setRequestHeader(n,t[n]);a=function(t){return function(){a&&(a=s=i.onload=i.onerror=i.onabort=i.ontimeout=i.onreadystatechange=null,"abort"===t?i.abort():"error"===t?"number"!=typeof i.status?e(0,"error"):e(i.status,i.statusText):e(Ye[i.status]||i.status,i.statusText,"text"!==(i.responseType||"text")||"string"!=typeof i.responseText?{binary:i.response}:{text:i.responseText},i.getAllResponseHeaders()))}},i.onload=a(),s=i.onerror=i.ontimeout=a("error"),void 0!==i.onabort?i.onabort=s:i.onreadystatechange=function(){4===i.readyState&&x.setTimeout(function(){a&&s()})},a=a("abort");try{i.send(r.hasContent&&r.data||null)}catch(t){if(a)throw t}},abort:function(){a&&a()}}}),T.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),T.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return T.globalEval(t),t}}}),T.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),T.ajaxTransport("script",function(n){var i,r;if(n.crossDomain||n.scriptAttrs)return{send:function(t,e){i=T("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",r=function(t){i.remove(),r=null,t&&e("error"===t.type?404:200,t.type)}),S.head.appendChild(i[0])},abort:function(){r&&r()}}});var Ve=[],Qe=/(=)\?(?=&|$)|\?\?/,Ze=(T.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ve.pop()||T.expando+"_"+Ae++;return this[t]=!0,t}}),T.ajaxPrefilter("json jsonp",function(t,e,n){var i,r,a,s=!1!==t.jsonp&&(Qe.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qe.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=v(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Qe,"$1"+i):!1!==t.jsonp&&(t.url+=(Me.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||T.error(i+" was not called"),a[0]},t.dataTypes[0]="json",r=x[i],x[i]=function(){a=arguments},n.always(function(){void 0===r?T(x).removeProp(i):x[i]=r,t[i]&&(t.jsonpCallback=e.jsonpCallback,Ve.push(i)),a&&v(r)&&r(a[0]),a=r=void 0}),"script"}),g.createHTMLDocument=((t=S.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===t.childNodes.length),T.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(g.createHTMLDocument?((i=(e=S.implementation.createHTMLDocument("")).createElement("base")).href=S.location.href,e.head.appendChild(i)):e=S),i=!n&&[],(n=Z.exec(t))?[e.createElement(n[1])]:(n=Et([t],e,i),i&&i.length&&T(i).remove(),T.merge([],n.childNodes)));var i},T.fn.load=function(t,e,n){var i,r,a,s=this,o=t.indexOf(" ");return-1<o&&(i=P(t.slice(o)),t=t.slice(0,o)),v(e)?(n=e,e=void 0):e&&"object"==typeof e&&(r="POST"),0<s.length&&T.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){a=arguments,s.html(i?T("<div>").append(T.parseHTML(t)).find(i):t)}).always(n&&function(t,e){s.each(function(){n.apply(this,a||[t.responseText,e,t])})}),this},T.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){T.fn[e]=function(t){return this.on(e,t)}}),T.expr.pseudos.animated=function(e){return T.grep(T.timers,function(t){return e===t.elem}).length},T.offset={setOffset:function(t,e,n){var i,r,a,s,o=T.css(t,"position"),l=T(t),c={};"static"===o&&(t.style.position="relative"),a=l.offset(),i=T.css(t,"top"),s=T.css(t,"left"),o=("absolute"===o||"fixed"===o)&&-1<(i+s).indexOf("auto")?(r=(o=l.position()).top,o.left):(r=parseFloat(i)||0,parseFloat(s)||0),null!=(e=v(e)?e.call(t,n,T.extend({},a)):e).top&&(c.top=e.top-a.top+r),null!=e.left&&(c.left=e.left-a.left+o),"using"in e?e.using.call(t,c):l.css(c)}},T.fn.extend({offset:function(e){var t,n;return arguments.length?void 0===e?this:this.each(function(t){T.offset.setOffset(this,e,t)}):(n=this[0])?n.getClientRects().length?(t=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,i=this[0],r={top:0,left:0};if("fixed"===T.css(i,"position"))e=i.getBoundingClientRect();else{for(e=this.offset(),n=i.ownerDocument,t=i.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===T.css(t,"position");)t=t.parentNode;t&&t!==i&&1===t.nodeType&&((r=T(t).offset()).top+=T.css(t,"borderTopWidth",!0),r.left+=T.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-T.css(i,"marginTop",!0),left:e.left-r.left-T.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===T.css(t,"position");)t=t.offsetParent;return t||k})}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var a="pageYOffset"===r;T.fn[e]=function(t){return u(this,function(t,e,n){var i;if(m(t)?i=t:9===t.nodeType&&(i=t.defaultView),void 0===n)return i?i[r]:t[e];i?i.scrollTo(a?i.pageXOffset:n,a?n:i.pageYOffset):t[e]=n},e,t,arguments.length)}}),T.each(["top","left"],function(t,n){T.cssHooks[n]=Jt(g.pixelPosition,function(t,e){if(e)return e=Zt(t,n),Vt.test(e)?T(t).position()[n]+"px":e})}),T.each({Height:"height",Width:"width"},function(s,o){T.each({padding:"inner"+s,content:o,"":"outer"+s},function(i,a){T.fn[a]=function(t,e){var n=arguments.length&&(i||"boolean"!=typeof t),r=i||(!0===t||!0===e?"margin":"border");return u(this,function(t,e,n){var i;return m(t)?0===a.indexOf("outer")?t["inner"+s]:t.document.documentElement["client"+s]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+s],i["scroll"+s],t.body["offset"+s],i["offset"+s],i["client"+s])):void 0===n?T.css(t,e,r):T.style(t,e,n,r)},o,n?t:void 0,n)}})}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,n){T.fn[n]=function(t,e){return 0<arguments.length?this.on(n,null,t,e):this.trigger(n)}}),T.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),T.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}}),T.proxy=function(t,e){var n,i;if("string"==typeof e&&(i=t[e],e=t,t=i),v(t))return n=o.call(arguments,2),(i=function(){return t.apply(e||this,n.concat(o.call(arguments)))}).guid=t.guid=t.guid||T.guid++,i},T.holdReady=function(t){t?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=l,T.isFunction=v,T.isWindow=m,T.camelCase=b,T.type=f,T.now=Date.now,T.isNumeric=function(t){var e=T.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return T}),x.jQuery),Je=x.$;return T.noConflict=function(t){return x.$===T&&(x.$=Je),t&&x.jQuery===T&&(x.jQuery=Ze),T},$||(x.jQuery=x.$=T),T}),define("lib/jquery",function(){}),define("home",["lib/class","lib/underscore.min","lib/stacktrace","util","../shared/js/itemtypes","../shared/js/gametypes","main","lib/jquery"],function(t,e,n,i,r,a,s,o){return require.config({baseUrl:"js",waitSeconds:20,paths:{home:"home",jquery:"lib/jquery",class:"lib/class",itemtypes:"../shared/js/itemtypes",gametypes:"../shared/js/gametypes"},shim:{jquery:{exports:["jQuery","$","jquery"]},class:{exports:["Class"]},itemtypes:{exports:"ItemTypes"},gametypes:{exports:"Types"},home:{deps:["jquery"]}}}),s});
